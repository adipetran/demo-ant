(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{64335:function(Cr,oe,Q){"use strict";var Pe=Q(67294),De=(0,Pe.createContext)({});oe.Z=De},21349:function(Cr,oe,Q){"use strict";var Pe=Q(84305),De=Q(75901),m=Q(53645),Ie=Q.n(m),X=Q(67294),de=Q(94184),ce=Q.n(de),ze=Q(64335),ge=function(ct){var Et=(0,X.useContext)(ze.Z),ar=ct.children,dr=ct.contentWidth,kt=ct.className,nr=ct.style,Ut=(0,X.useContext)(De.ZP.ConfigContext),ht=Ut.getPrefixCls,St=ct.prefixCls||ht("pro"),or=dr||Et.contentWidth,q="".concat(St,"-grid-content");return X.createElement("div",{className:ce()(q,kt,{wide:or==="Fixed"}),style:nr},X.createElement("div",{className:"".concat(St,"-grid-content-children")},ar))};oe.Z=ge},66213:function(Cr,oe,Q){"use strict";Q.d(oe,{Z:function(){return m}});var Pe=Q(77608);function De(Ie,X){for(;!Object.prototype.hasOwnProperty.call(Ie,X)&&(Ie=(0,Pe.Z)(Ie),Ie!==null););return Ie}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(X,de,ce){var ze=De(X,de);if(!!ze){var ge=Object.getOwnPropertyDescriptor(ze,de);return ge.get?ge.get.call(arguments.length<3?X:ce):ge.value}},m.apply(this,arguments)}},31795:function(Cr,oe,Q){var Pe=Q(75752);Cr.exports.geometry=De,Cr.exports.ring=Ie;function De(de){var ce=0,ze;switch(de.type){case"Polygon":return m(de.coordinates);case"MultiPolygon":for(ze=0;ze<de.coordinates.length;ze++)ce+=m(de.coordinates[ze]);return ce;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ze=0;ze<de.geometries.length;ze++)ce+=De(de.geometries[ze]);return ce}}function m(de){var ce=0;if(de&&de.length>0){ce+=Math.abs(Ie(de[0]));for(var ze=1;ze<de.length;ze++)ce-=Math.abs(Ie(de[ze]))}return ce}function Ie(de){var ce,ze,ge,nt,ct,Et,ar,dr=0,kt=de.length;if(kt>2){for(ar=0;ar<kt;ar++)ar===kt-2?(nt=kt-2,ct=kt-1,Et=0):ar===kt-1?(nt=kt-1,ct=0,Et=1):(nt=ar,ct=ar+1,Et=ar+2),ce=de[nt],ze=de[ct],ge=de[Et],dr+=(X(ge[0])-X(ce[0]))*Math.sin(X(ze[1]));dr=dr*Pe.RADIUS*Pe.RADIUS/2}return dr}function X(de){return de*Math.PI/180}},38163:function(Cr,oe,Q){var Pe=Q(31795);Cr.exports=De;function De(ze,ge){switch(ze&&ze.type||null){case"FeatureCollection":return ze.features=ze.features.map(m(De,ge)),ze;case"GeometryCollection":return ze.geometries=ze.geometries.map(m(De,ge)),ze;case"Feature":return ze.geometry=De(ze.geometry,ge),ze;case"Polygon":case"MultiPolygon":return Ie(ze,ge);default:return ze}}function m(ze,ge){return function(nt){return ze(nt,ge)}}function Ie(ze,ge){return ze.type==="Polygon"?ze.coordinates=X(ze.coordinates,ge):ze.type==="MultiPolygon"&&(ze.coordinates=ze.coordinates.map(m(X,ge))),ze}function X(ze,ge){ge=!!ge,ze[0]=de(ze[0],ge);for(var nt=1;nt<ze.length;nt++)ze[nt]=de(ze[nt],!ge);return ze}function de(ze,ge){return ce(ze)===ge?ze:ze.reverse()}function ce(ze){return Pe.ring(ze)>=0}},70499:function(Cr){Cr.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Cr){Cr.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},11438:function(Cr,oe,Q){"use strict";Q.r(oe),Q.d(oe,{default:function(){return uP}});var Pe={};Q.r(Pe),Q.d(Pe,{add:function(){return $o},adjoint:function(){return cr},clone:function(){return N},copy:function(){return fe},create:function(){return hc},determinant:function(){return gr},equals:function(){return Ka},exactEquals:function(){return gs},frob:function(){return Xa},fromQuat:function(){return Jr},fromQuat2:function(){return Qt},fromRotation:function(){return zr},fromRotationTranslation:function(){return Un},fromRotationTranslationScale:function(){return Sr},fromRotationTranslationScaleOrigin:function(){return $r},fromScaling:function(){return xr},fromTranslation:function(){return zt},fromValues:function(){return Le},fromXRotation:function(){return lr},fromYRotation:function(){return kr},fromZRotation:function(){return Qr},frustum:function(){return yi},getRotation:function(){return Xr},getScaling:function(){return xn},getTranslation:function(){return er},identity:function(){return rr},invert:function(){return Kt},lookAt:function(){return so},mul:function(){return _i},multiply:function(){return hr},multiplyScalar:function(){return Qo},multiplyScalarAndAdd:function(){return Uo},ortho:function(){return zi},orthoNO:function(){return li},orthoZO:function(){return io},perspective:function(){return Gr},perspectiveFromFieldOfView:function(){return Qn},perspectiveNO:function(){return ri},perspectiveZO:function(){return on},rotate:function(){return jr},rotateX:function(){return yr},rotateY:function(){return wr},rotateZ:function(){return it},scale:function(){return Ar},set:function(){return It},str:function(){return ss},sub:function(){return Zo},subtract:function(){return vo},targetTo:function(){return Fi},translate:function(){return Er},transpose:function(){return Pt}});var De=Q(58024),m=Q(39144),Ie=Q(13062),X=Q(71230),de=Q(89032),ce=Q(15746),ze=Q(95300),ge=Q(7277),nt=Q(25377),ct=Q(72178),Et=Q(21349),ar=Q(92077),dr=Q.n(ar),kt=Q(2824),nr=Q(3182),Ut=Q(69610),ht=Q(54941),St=Q(81306),or=Q(59206),q=Q(94043),Gt=Q.n(q),He=Q(67294),$e=(0,He.createContext)({});function bt(){return(0,He.useContext)($e)}var et={},qt={},Tr=function(i){return qt[i]},Br=function(i,r){qt[i]=r},rn=function(i){return et[i]},Ee=function(i,r){et[i]=r},We={},Re={},_t=34,ft=10,Lt=13;function Ht(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Mr(e,i){var r=Ht(e);return function(n,a){return i(r(n),a,e)}}function Kn(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function Wr(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function na(e){return e<0?"-"+Wr(-e,6):e>9999?"+"+Wr(e,6):Wr(e,4)}function Yn(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":na(e.getUTCFullYear(),4)+"-"+Wr(e.getUTCMonth()+1,2)+"-"+Wr(e.getUTCDate(),2)+(a?"T"+Wr(i,2)+":"+Wr(r,2)+":"+Wr(n,2)+"."+Wr(a,3)+"Z":n?"T"+Wr(i,2)+":"+Wr(r,2)+":"+Wr(n,2)+"Z":r||i?"T"+Wr(i,2)+":"+Wr(r,2)+"Z":"")}function ai(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(w,O){var F,j,Y=a(w,function(ee,ye){if(F)return F(ee,ye-1);j=ee,F=O?Mr(ee,O):Ht(ee)});return Y.columns=j||[],Y}function a(w,O){var F=[],j=w.length,Y=0,ee=0,ye,Fe=j<=0,qe=!1;w.charCodeAt(j-1)===ft&&--j,w.charCodeAt(j-1)===Lt&&--j;function rt(){if(Fe)return Re;if(qe)return qe=!1,We;var xt,Yt=Y,ur;if(w.charCodeAt(Yt)===_t){for(;Y++<j&&w.charCodeAt(Y)!==_t||w.charCodeAt(++Y)===_t;);return(xt=Y)>=j?Fe=!0:(ur=w.charCodeAt(Y++))===ft?qe=!0:ur===Lt&&(qe=!0,w.charCodeAt(Y)===ft&&++Y),w.slice(Yt+1,xt-1).replace(/""/g,'"')}for(;Y<j;){if((ur=w.charCodeAt(xt=Y++))===ft)qe=!0;else if(ur===Lt)qe=!0,w.charCodeAt(Y)===ft&&++Y;else if(ur!==r)continue;return w.slice(Yt,xt)}return Fe=!0,w.slice(Yt,j)}for(;(ye=rt())!==Re;){for(var yt=[];ye!==We&&ye!==Re;)yt.push(ye),ye=rt();O&&(yt=O(yt,ee++))==null||F.push(yt)}return F}function s(w,O){return w.map(function(F){return O.map(function(j){return C(F[j])}).join(e)})}function p(w,O){return O==null&&(O=Kn(w)),[O.map(C).join(e)].concat(s(w,O)).join(`
`)}function v(w,O){return O==null&&(O=Kn(w)),s(w,O).join(`
`)}function g(w){return w.map(x).join(`
`)}function x(w){return w.map(C).join(e)}function C(w){return w==null?"":w instanceof Date?Yn(w):i.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var oi=ai(","),ci=oi.parse,gi=oi.parseRows,xa=oi.format,qi=oi.formatBody,Gi=oi.formatRows,ia=oi.formatRow,ba=oi.formatValue,R=Q(96156),sn=Q(85061),Ea=Q(38163),Bi=Q.n(Ea);function aa(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qi(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?aa(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aa(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cs(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var w=[parseFloat(g[r]),parseFloat(g[n])],O=[parseFloat(g[a]),parseFloat(g[s])];C=[w,O]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var j={type:F,coordinates:(0,sn.Z)(g[p])};Bi()(j,!0),C=j.coordinates}var Y=Qi(Qi({},g),{},{_id:x,coordinates:C});v.push(Y)}),{dataArray:v}):{dataArray:[]}}var pe=[{lng1:100,lat1:30,lng2:130,lat2:30}],fi={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function lo(e,i){var r=ci(e);return cs(r,i)}var Va=63710088e-1,Bt={centimeters:Va*100,centimetres:Va*100,degrees:Va/111325,feet:Va*3.28084,inches:Va*39.37,kilometers:Va/1e3,kilometres:Va/1e3,meters:Va,metres:Va,miles:Va/1609.344,millimeters:Va*1e3,millimetres:Va*1e3,nauticalmiles:Va/1852,radians:1,yards:Va*1.0936},tr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Va,yards:1.0936133},Or={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Vr(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function Ln(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return zn(i).geometry;case"LineString":return Mi(i).geometry;case"Polygon":return pi(i).geometry;case"MultiPoint":return Lo(i).geometry;case"MultiLineString":return fs(i).geometry;case"MultiPolygon":return ka(i).geometry;default:throw new Error(e+" is invalid")}}function zn(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pt(e[0])||!pt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Vr(n,i,r)}function bi(e,i,r){return r===void 0&&(r={}),Na(e.map(function(n){return zn(n,i)}),r)}function pi(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Vr(v,i,r)}function An(e,i,r){return r===void 0&&(r={}),Na(e.map(function(n){return pi(n,i)}),r)}function Mi(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Vr(n,i,r)}function Li(e,i,r){return r===void 0&&(r={}),Na(e.map(function(n){return Mi(n,i)}),r)}function Na(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function fs(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Vr(n,i,r)}function Lo(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Vr(n,i,r)}function ka(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Vr(n,i,r)}function Sa(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Vr(n,i,r)}function W(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function $(e,i){i===void 0&&(i="kilometers");var r=Bt[i];if(!r)throw new Error(i+" units is invalid");return e*r}function re(e,i){i===void 0&&(i="kilometers");var r=Bt[i];if(!r)throw new Error(i+" units is invalid");return e/r}function he(e,i){return je(re(e,i))}function Ae(e){var i=e%360;return i<0&&(i+=360),i}function je(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Je(e){var i=e%360;return i*Math.PI/180}function ue(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return $(re(e,i),r)}function Oe(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Or[i];if(!n)throw new Error("invalid original units");var a=Or[r];if(!a)throw new Error("invalid final units");return e/n*a}function pt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function pr(e){return!!e&&e.constructor===Object}function Ot(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!pt(i))throw new Error("bbox must only contain numbers")})}function Dt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function mr(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _n(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function cn(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return cn(e[0]);throw new Error("coordinates must only contain numbers")}function Ct(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function un(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Zr(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Yr(e){return e.type==="Feature"?e.geometry:e}function vi(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function qr(e,i,r){if(e!==null)for(var n,a,s,p,v,g,x,C=0,w=0,O,F=e.type,j=F==="FeatureCollection",Y=F==="Feature",ee=j?e.features.length:1,ye=0;ye<ee;ye++){x=j?e.features[ye].geometry:Y?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Fe=0;Fe<v;Fe++){var qe=0,rt=0;if(p=O?x.geometries[Fe]:x,p!==null){g=p.coordinates;var yt=p.type;switch(C=r&&(yt==="Polygon"||yt==="MultiPolygon")?1:0,yt){case null:break;case"Point":if(i(g,w,ye,qe,rt)===!1)return!1;w++,qe++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],w,ye,qe,rt)===!1)return!1;w++,yt==="MultiPoint"&&qe++}yt==="LineString"&&qe++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],w,ye,qe,rt)===!1)return!1;w++}yt==="MultiLineString"&&qe++,yt==="Polygon"&&rt++}yt==="Polygon"&&qe++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(rt=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],w,ye,qe,rt)===!1)return!1;w++}rt++}qe++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(qr(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function wi(e,i,r,n){var a=r;return qr(e,function(s,p,v,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,g,x)},n),a}function oa(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Ei(e,i,r){var n=r;return oa(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Ti(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Si(e,i,r){var n=r;return Ti(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function ei(e){var i=[];return qr(e,function(r){i.push(r)}),i}function ji(e,i){var r,n,a,s,p,v,g,x,C,w,O=0,F=e.type==="FeatureCollection",j=e.type==="Feature",Y=F?e.features.length:1;for(r=0;r<Y;r++){for(v=F?e.features[r].geometry:j?e.geometry:e,x=F?e.features[r].properties:j?e.properties:{},C=F?e.features[r].bbox:j?e.bbox:void 0,w=F?e.features[r].id:j?e.id:void 0,g=v?v.type==="GeometryCollection":!1,p=g?v.geometries.length:1,a=0;a<p;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,O,x,C,w)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,w)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function La(e,i,r){var n=r;return ji(e,function(a,s,p,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,g)}),n}function Hi(e,i){ji(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Vr(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],w={type:g,coordinates:C};if(i(Vr(w,a),n,x)===!1)return!1}})}function Pi(e,i,r){var n=r;return Hi(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function Ni(e,i){Hi(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,g=0,x=0,C=0;if(qr(r,function(w,O,F,j,Y){if(v===void 0||n>g||j>x||Y>C){v=w,g=n,x=j,C=Y,s=0;return}var ee=lineString([v,w],r.properties);if(i(ee,n,a,Y,s)===!1)return!1;s++,v=w})===!1)return!1}}})}function Da(e,i,r){var n=r,a=!1;return Ni(e,function(s,p,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,g,x),a=!0}),n}function Js(e,i){if(!e)throw new Error("geojson is required");Hi(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function za(e,i,r){var n=r;return Js(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function Ca(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Ps(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function Vo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ji(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vo(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pu(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),Bi()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return Hi(e,function(s,p){var v=_n(s),g=p,x=Ji(Ji({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function co(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Ga(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var $n=Q(28481),Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function bo(e){this.message=e}bo.prototype=new Error,bo.prototype.name="InvalidCharacterError";function Go(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new bo("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Wi.indexOf(s);return r}function vu(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Wi.charAt(i>>18&63)+Wi.charAt(i>>12&63)+Wi.charAt(i>>6&63)+Wi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var Vt=Q(6610),Wt=Q(5991),fa=function(){function e(i,r){(0,Vt.Z)(this,e),this.buffers=i,this.type=r}return(0,Wt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),pa;typeof window=="undefined"?pa={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:pa=window;var ns=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ao=ns?my.getSystemInfoSync().pixelRatio:pa.devicePixelRatio,ln=Q(10379),Sn=Q(46070),Tt=Q(77608),te=(0,Wt.Z)(function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"cancelBubble",void 0),(0,R.Z)(this,"cancelable",void 0),(0,R.Z)(this,"target",void 0),(0,R.Z)(this,"currentTarget",void 0),(0,R.Z)(this,"preventDefault",void 0),(0,R.Z)(this,"stopPropagation",void 0),(0,R.Z)(this,"type",void 0),(0,R.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),D=Q(63349);function Ke(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mt(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Mt(e,i){if(!!e){if(typeof e=="string")return Rr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rr(e,i)}}function Rr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Mn=new WeakMap,Ci=function(){function e(){(0,Vt.Z)(this,e),Mn.set(this,{})}return(0,Wt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Mn.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Mn.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Mn.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Mn.get(this)[r.type];if(n){var a=Ke(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function eo(e){var i=Fa();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Fa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ua=function(e){(0,ln.Z)(r,e);var i=eo(r);function r(){var n;return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Wt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ci);function Ho(e){var i=_s();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function _s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Do=function(e){(0,ln.Z)(r,e);var i=Ho(r);function r(){var n;return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"className",void 0),(0,R.Z)((0,D.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Wt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ua),xs=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,is,ps,Is,Hs;if(xs){var Wo=my.getSystemInfoSync();is=Wo.screenWidth,ps=Wo.screenHeight,Is=Wo.windowWidth,Hs=Wo.windowHeight}else{var da=pa.innerWidth,Eo=pa.innerHeight;is=da,ps=Eo,Is=da,Hs=Eo}var Iu={width:is,height:ps,availWidth:Is,availHeight:Hs,availLeft:0,availTop:0},rl=Iu.availWidth,mu=Iu.availHeight,ic={style:[]};function nl(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return ic}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return ic}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function il(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:rl+"px",height:mu+"px",margin:"0px",padding:"0px"})}function uu(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=rl,e.clientHeight=mu),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Il(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=rl,e.offsetHeight=mu)}function _(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=rl,e.scrollHeight=mu)}function T(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function B(e){var i=I();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function K(){}var ve=function(e){(0,ln.Z)(r,e);var i=B(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"className",void 0),(0,R.Z)((0,D.Z)(n),"children",void 0),(0,R.Z)((0,D.Z)(n),"focus",void 0),(0,R.Z)((0,D.Z)(n),"blur",void 0),(0,R.Z)((0,D.Z)(n),"insertBefore",void 0),(0,R.Z)((0,D.Z)(n),"appendChild",void 0),(0,R.Z)((0,D.Z)(n),"removeChild",void 0),(0,R.Z)((0,D.Z)(n),"remove",void 0),(0,R.Z)((0,D.Z)(n),"innerHTML",void 0),(0,R.Z)((0,D.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=K,n.blur=K,n.insertBefore=K,n.appendChild=K,n.removeChild=K,n.remove=K,n.innerHTML="",n.tagName=a.toUpperCase(),nl((0,D.Z)(n),s),il((0,D.Z)(n)),T((0,D.Z)(n)),uu((0,D.Z)(n)),Il((0,D.Z)(n)),_((0,D.Z)(n)),n}return(0,Wt.Z)(r)}(Do);function Ge(e){var i=ut();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lt=function(e){(0,ln.Z)(r,e);var i=Ge(r);function r(n){return(0,Vt.Z)(this,r),i.call(this,n)}return(0,Wt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(ve);function sr(e){var i=_r();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function _r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rn=function(e){(0,ln.Z)(r,e);var i=sr(r);function r(){return(0,Vt.Z)(this,r),i.call(this,"video")}return(0,Wt.Z)(r)}(lt),jn={},Nn={};function Ki(e,i){jn=e,jn.id=i,"tagName"in jn||(jn.tagName="CANVAS"),jn.type="canvas",Mixin.parentNode(jn),Mixin.style(jn),Mixin.classList(jn),Mixin.clientRegion(jn),Mixin.offsetRegion(jn),jn.focus=function(){},jn.blur=function(){}}function ya(e,i){var r=1024,n=1024;Nn={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Nn||(Nn.tagName="CANVAS"),Mixin.parentNode(Nn),Mixin.style(Nn),Mixin.classList(Nn),Mixin.clientRegion(Nn),Mixin.offsetRegion(Nn),Nn.getContext=function(a){if(a==="2d")return e},Nn.focus=function(){},Nn.blur=function(){}}function ea(){return jn}function Xi(){return Nn}var hs=(0,Wt.Z)(function e(){(0,Vt.Z)(this,e);var i=ea(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),nl(r),T(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),lu={href:"",protocol:"",host:""};function Hu(e){var i=Qc();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Qc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var al=function(e){(0,ln.Z)(r,e);var i=Hu(r);function r(){return(0,Vt.Z)(this,r),i.call(this,"body",0)}return(0,Wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(ve),Cc=function(e){(0,ln.Z)(r,e);var i=Hu(r);function r(){return(0,Vt.Z)(this,r),i.call(this,"html",0)}return(0,Wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(ve),Ws={},Fo={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:lu,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new hs:i==="video"?new Rn:new ve(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Ws[i]||(Ws[i]=[]),Ws[i].push(r)},removeEventListener:function(i,r){var n=Ws[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=Ws[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new te(i)}};Fo.documentElement=new Cc,Fo.head=new ve("head"),Fo.body=new al;var Ou=Object,to=Q(90484),Ff=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"_w",void 0),(0,R.Z)(this,"_h",void 0),(0,R.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,to.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Wt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Bf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,as,ds,eu;if(Bf){var Os=my.getSystemInfoSync();as=Os.system,ds=Os.platform,eu=Os.language}else{var bs={versions:function(){var e=pa.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(pa.navigator.browserLanguage||pa.navigator.language).toLowerCase()};bs.versions.android?ds="android":bs.versions.trident?ds="IE":bs.versions.presto?ds="Opera":bs.versions.webKit?ds="webKit":bs.versions.gecko?ds="Firefox":bs.versions.mobile?ds="mobile":bs.versions.ios?ds="ios":bs.versions.iPhone?ds="iPhone":bs.versions.iPad?ds="ipad":bs.versions.webApp?ds="webApp":bs.versions.weixin?ds="weixin":bs.versions.qq&&(ds="qq"),as=pa.navigator.userAgent,eu=bs.language}var ol=as.toLowerCase().indexOf("android")!==-1,va=ol?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ol="Mozilla/5.0 (".concat(va,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(eu),dp={platform:ds,language:eu,appVersion:"5.0 (".concat(va,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ol},sl={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},Jc=0,vp=0;function mp(e){var i=Date.now(),r=Math.max(Jc+23,i);return vp=setTimeout(function(){e(Jc=r)},r-i),vp}function ef(e){var i=ea();return i.requestAnimationFrame?i.requestAnimationFrame(e):mp(e)}function ac(e){var i=ea();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Rl=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Vt.Z)(this,e),(0,R.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Wt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=kl(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function kl(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return vu(i)}var Ll={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},ul={};function Dl(e){var i=ll();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rs=new Map,Ac=new Map,tf=new Map,gp={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function cl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function wc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,cl.call(this,"readystatechange",i)}var Es=function(e){(0,ln.Z)(r,e);var i=Dl(r);function r(){var n;return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"onabort",void 0),(0,R.Z)((0,D.Z)(n),"onerror",void 0),(0,R.Z)((0,D.Z)(n),"onload",void 0),(0,R.Z)((0,D.Z)(n),"onloadstart",void 0),(0,R.Z)((0,D.Z)(n),"onprogress",void 0),(0,R.Z)((0,D.Z)(n),"ontimeout",void 0),(0,R.Z)((0,D.Z)(n),"onloadend",void 0),(0,R.Z)((0,D.Z)(n),"onreadystatechange",void 0),(0,R.Z)((0,D.Z)(n),"readyState",void 0),(0,R.Z)((0,D.Z)(n),"response",void 0),(0,R.Z)((0,D.Z)(n),"responseText",void 0),(0,R.Z)((0,D.Z)(n),"_responseType",void 0),(0,R.Z)((0,D.Z)(n),"responseXML",void 0),(0,R.Z)((0,D.Z)(n),"status",void 0),(0,R.Z)((0,D.Z)(n),"statusText",void 0),(0,R.Z)((0,D.Z)(n),"upload",void 0),(0,R.Z)((0,D.Z)(n),"withCredentials",void 0),(0,R.Z)((0,D.Z)(n),"timeout",void 0),(0,R.Z)((0,D.Z)(n),"_url",void 0),(0,R.Z)((0,D.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Rs.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Wt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=tf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Ac.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Ac.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=Rs.get("requestHeader");p[a]=s,Rs.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ci);(0,R.Z)(Es,"UNSEND",void 0),(0,R.Z)(Es,"OPENED",void 0),(0,R.Z)(Es,"HEADERS_RECEIVED",void 0),(0,R.Z)(Es,"LOADING",void 0),(0,R.Z)(Es,"DONE",void 0),Es.UNSEND=0,Es.OPENED=1,Es.HEADERS_RECEIVED=2,Es.LOADING=3,Es.DONE=4;function rf(e){var i=Tc();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Tc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yp=function(e){(0,ln.Z)(r,e);var i=rf(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this,n),(0,R.Z)((0,D.Z)(a),"touches",void 0),(0,R.Z)((0,D.Z)(a),"targetTouches",void 0),(0,R.Z)((0,D.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=ea(),a.currentTarget=ea(),a}return(0,Wt.Z)(r)}(te);function Fl(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Ru(e){return function(i){var r=new yp(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Fl(n)}),r.touches.forEach(function(n){return Fl(n)}),r.targetTouches.forEach(function(n){return Fl(n)}),Fo.dispatchEvent(r)}}function nf(e){return function(i){i.type=e,Fo.dispatchEvent(i)}}var Nf=Ru("touchstart"),Bl=Ru("touchmove"),_p=Ru("touchend"),xp=nf("mapCameaParams");function zf(e){var i=Nl();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bp=function(e){(0,ln.Z)(r,e);var i=zf(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this,n),(0,R.Z)((0,D.Z)(a),"buttons",void 0),(0,R.Z)((0,D.Z)(a),"which",void 0),(0,R.Z)((0,D.Z)(a),"pointerId",void 0),(0,R.Z)((0,D.Z)(a),"bubbles",void 0),(0,R.Z)((0,D.Z)(a),"button",void 0),(0,R.Z)((0,D.Z)(a),"width",void 0),(0,R.Z)((0,D.Z)(a),"height",void 0),(0,R.Z)((0,D.Z)(a),"pressure",void 0),(0,R.Z)((0,D.Z)(a),"isPrimary",void 0),(0,R.Z)((0,D.Z)(a),"pointerType",void 0),(0,R.Z)((0,D.Z)(a),"altKey",void 0),(0,R.Z)((0,D.Z)(a),"ctrlKey",void 0),(0,R.Z)((0,D.Z)(a),"metaKey",void 0),(0,R.Z)((0,D.Z)(a),"shiftKey",void 0),a.target=ea(),a.currentTarget=ea(),a}return(0,Wt.Z)(r)}(te),fl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Ha=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],oc="touch";function zl(e,i,r){for(var n=new bp(e),a=0;a<fl.length;a++){var s=fl[a];n[s]=i[s]||Ha[a]}return n.type=e,n.target=ea(),n.currentTarget=ea(),n.buttons=ku(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=Ma(i),n.pointerType=oc,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function ku(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Ii=null;function Ma(e){return Ii===e.identifier}function ks(e){Ii===null&&(Ii=e.identifier)}function Mc(e){Ii===e.identifier&&(Ii=null)}function gu(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?ks(a):(e==="pointerup"||e==="pointercancel")&&Mc(a);var s=zl(e,a,i);Fo.dispatchEvent(s)}}}var af=gu("pointerdown"),Zh=gu("pointermove"),jh=gu("pointerup");function Pc(e){var i=Ic();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pl=function(e){(0,ln.Z)(r,e);var i=Pc(r);function r(n){return(0,Vt.Z)(this,r),i.call(this,n)}return(0,Wt.Z)(r)}(te);function fo(e){return function(i){i.type=e,Fo.dispatchEvent(i)}}var Oc=fo("mousedown"),Rc=fo("mousemove"),Mo=fo("mouseup"),vn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ro=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Po=vn||ro,Ul={atob:Go,btoa:vu,devicePixelRatio:ao,Blob:fa,document:Fo,Element:Do,Event:te,EventTarget:Ci,HTMLCanvasElement:Ou,HTMLElement:ve,HTMLMediaElement:lt,HTMLVideoElement:Rn,Image:hs,ImageData:Ff,navigator:dp,Node:Ua,requestAnimationFrame:ef,cancelAnimationFrame:ac,screen:Iu,XMLHttpRequest:Es,performance:sl,URL:Rl,WebGLRenderingContext:Ll,WebGL2RenderingContext:ul,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Fo.addEventListener(i,r,n)},removeEventListener:function(i,r,n){Fo.removeEventListener(i,r)},dispatchEvent:function(i){Fo.dispatchEvent(i)},innerWidth:Iu.availWidth,innerHeight:Iu.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Yi=Po?Ul:pa,Ls=Po?Es:pa.XMLHttpRequest,Uf=Po?lu:pa.location;function Kr(e){var i=e;return typeof e=="string"&&(i=Yi.document.getElementById(e)),i}function kc(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function of(e){return kc(e).split(/\s+/)}function hl(e){var i,r,n=Yi==null||(i=Yi.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function mi(e,i,r){var n=Yi.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function Bo(e){var i=e.parentNode;i&&i.removeChild(e)}function yu(e,i){if(e.classList!==void 0)for(var r=of(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Ds(e,i)){var s=sf(e);_u(e,(s?s+" ":"")+i)}}function Xs(e,i){e.classList!==void 0?e.classList.remove(i):_u(e,kc((" "+sf(e)+" ").replace(" "+i+" "," ")))}function Ds(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=sf(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function _u(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function sf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function sc(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Zf=hl(["transform","WebkitTransform"]);function uf(e,i){e.style[Zf]=i}function tu(){if(typeof Event=="function")Yi.dispatchEvent(new Event("resize"));else{var e=Yi.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Yi,0),Yi.dispatchEvent(e)}}function ru(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Oi(){var e,i=Yi.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,$n.Z)(s,2),v=p[0],g=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var _a=Oi()<1?1:Yi.devicePixelRatio,nu=Q(14665);function Xo(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var dl=Q(51814);function xu(e,i,r){return(0,dl.Z)()?xu=Reflect.construct:xu=function(a,s,p){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return p&&(0,nu.Z)(x,p.prototype),x},xu.apply(null,arguments)}function Ss(e){var i=typeof Map=="function"?new Map:void 0;return Ss=function(n){if(n===null||!Xo(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return xu(n,arguments,(0,Tt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,nu.Z)(a,n)},Ss(e)}function Cs(e){var i=cu();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dn=function(e){(0,ln.Z)(r,e);var i=Cs(r);function r(n,a,s){var p;return(0,Vt.Z)(this,r),p=i.call(this,n),(0,R.Z)((0,D.Z)(p),"status",void 0),(0,R.Z)((0,D.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,Wt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Ss(Error));function Pn(e){var i=new Ls;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var lf=function(i,r){var n=Pn(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Dn("".concat(n.statusText),n.status,i.url)):r(new Dn(n.statusText,n.status,i.url))},n.send(),n},vs=function(i,r){var n=Pn(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Dn(n.statusText,n.status,i.url))},n.send(),n};function bu(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Yo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",fu=function(i,r){return vs(i,function(n,a){if(n)r(n);else if(a){var s=new Yi.Image;s.crossOrigin="anonymous";var p=Yi.URL||Yi.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new Yi.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):Yo}})},Zl=2*Math.PI*6378137/2;function Lc(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;sa(i,n)}),i}function sa(e,i){return Array.isArray(i[0])?i.forEach(function(r){sa(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Za(e,i){return cf(e,i)}function cf(e,i){return Array.isArray(e[0])?e.map(function(r){return cf(r,i)}):i(e)}function Wu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Xu(e,i);var n=e[0],a=e[1],s=n*Zl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*Zl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Lu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Zl*180,s=n/Zl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function Eu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function No(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Xu(e,i){if(i===!1)return e;var r=Eu(e[0]),n=No(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function zo(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function ff(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],g=p[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function jl(e,i,r){var n=Je(i[1]-e[1]),a=Je(i[0]-e[0]),s=Je(e[1]),p=Je(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return $(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Dc(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function Vl(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Gl(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Hl(e){return[[e[0],e[1]],[e[2],e[3]]]}function pf(e){var i=Yu(e,[0,0]);return[e[0]/i,e[1]/i]}function Yu(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function vl(e,i){return e[0]*i[0]+e[1]*i[1]}function Fc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Wl(e,i){return Math.acos(vl(e,i)/(Fc(e)*Fc(i)))*180/Math.PI}function iu(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function jf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],g=Yu(p,v);n+=g;var x=[p[0]-v[0],p[1]-v[1]],C=iu(r,x);if(s>0){var w=a[s-1].rotation;w-C>360-w+C&&(C=C+360)}a.push({start:p,end:v,dis:g,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var Bc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,Vt.Z)(this,e),(0,R.Z)(this,"limit",void 0),(0,R.Z)(this,"cache",void 0),(0,R.Z)(this,"destroy",void 0),(0,R.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Wt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function ml(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Nc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,Vt.Z)(this,e),(0,R.Z)(this,"duration",16),(0,R.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Wt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),l=Q(2650);function f(e){return typeof e=="string"?!!l.ZP(e):!1}function c(e){var i=l.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function d(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function E(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function A(e){var i=Yi.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(p-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Po)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var M;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(M||(M={}));var k={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function U(e,i,r){var n=e.classList;for(var a in k)k.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function H(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var ie={BACK:1029,FRONT:1028};function se(e){switch(e){case"GAODE1.x":return ie.BACK;case"GAODE2.x":return ie.BACK;case"MAPBOX":return ie.FRONT;case"SIMPLE":return ie.FRONT;case"GLOBEL":return ie.BACK;case"L7MAP":return ie.FRONT;default:return ie.FRONT}}function le(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Me(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function we(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Ve(e){if(e.length===0)throw new Error("mean requires at least one data point");return we(e)/e.length}function be(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var Ue={min:Me,max:le,mean:Ve,sum:we,mode:be};function Qe(e,i){return e.map(function(r){return r[i]})}function dt(e,i){return Ue[e](i)}function jt(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){Nt(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Nt(e,i){var r=e,n=[];if(typeof r=="string")fu({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){fu({url:p},function(v,g){s++,n.push(g),s===a&&i(n)})})}return jt}function Xt(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var vr=Q(30236),Dr=Q.n(vr),Lr=Q(47037),Ur=Q.n(Lr),Zn=Q(23560),kn=Q.n(Zn),Vn=Q(50361),Ai=Q.n(Vn),an=Q(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function si(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(w){p(w)}}function g(C){try{x(n.throw(C))}catch(w){p(w)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function hi(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function ti(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function Xn(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(ti(arguments[i]));return e}function Fn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function wn(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Gn=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Fn(Gn);var po=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Fn(po);var Ta=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof an=="object"&&typeof an.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=an.nextTick:p=a,i.default=s(p)});Fn(Ta);var qo=Ta.fallback,Ko=Ta.wrap,no=Ta.hasSetImmediate,ho=Ta.hasNextTick,As=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(po),n=a(Ta);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,Wa.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var w=x.pop(),O=g.apply(this,x);return p(O,w)}:(0,r.default)(function(x,C){var w;try{w=g.apply(this,x)}catch(O){return C(O)}if(w&&typeof w.then=="function")return p(w,C);C(null,w)})}function p(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(w){(0,n.default)(function(O){throw O},w)}}e.exports=i.default});Fn(As);var Wa=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(As);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});Fn(Wa);var qu=Wa.isAsyncIterable,ws=Wa.isAsyncGenerator,Su=Wa.isAsync,os=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(w){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(w)return C(w);x(O.length>1?O:O[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Fn(os);var gl=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Gn),n=s(Wa),a=s(os);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,g){var x=(0,r.default)(v)?[]:{};p(v,function(C,w,O){(0,n.default)(C)(function(F){for(var j,Y=[],ee=arguments.length-1;ee-- >0;)Y[ee]=arguments[ee+1];Y.length<2&&(j=Y,Y=j[0]),x[w]=Y,O(F)})},function(C){return g(C,x)})},3),e.exports=i.default});Fn(gl);var Du=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Fn(Du);var Cu=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Fn(Cu);var yl=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(Gn),n=a(Cu);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,w=x.length;return function(){return++C<w?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],w=-1,O=C.length;return function(){var j=C[++w];return w<O?{value:x[j],key:j}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});Fn(yl);var Ku=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});Fn(Ku);var Fs=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Fn(Fs);var _l=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Fs);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,g){var x=!1,C=!1,w=!1,O=0,F=0;function j(){O>=p||w||x||(w=!0,s.next().then(function(ye){var Fe=ye.value,qe=ye.done;if(!(C||x)){if(w=!1,qe){x=!0,O<=0&&g(null);return}O++,v(Fe,F,Y),F++,j()}}).catch(ee))}function Y(ye,Fe){if(O-=1,!C){if(ye)return ee(ye);if(ye===!1){x=!0,C=!0;return}if(Fe===r.default||x&&O<=0)return x=!0,g(null);j()}}function ee(ye){C||(w=!1,x=!0,g(ye))}j()}e.exports=i.default});Fn(_l);var pu=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(Du),n=v(yl),a=v(Ku),s=v(_l),p=v(Fs);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,w){if(w=(0,r.default)(w),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return w(null);if((0,Wa.isAsyncGenerator)(x))return(0,s.default)(x,g,C,w);if((0,Wa.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,w);var O=(0,n.default)(x),F=!1,j=!1,Y=0,ee=!1;function ye(qe,rt){if(!j)if(Y-=1,qe)F=!0,w(qe);else if(qe===!1)F=!0,j=!0;else{if(rt===p.default||F&&Y<=0)return F=!0,w(null);ee||Fe()}}function Fe(){for(ee=!0;Y<g&&!F;){var qe=O();if(qe===null){F=!0,Y<=0&&w(null);return}Y+=1,C(qe.value,qe.key,(0,a.default)(ye))}ee=!1}Fe()}},e.exports=i.default});Fn(pu);var oo=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(pu),n=s(Wa),a=s(os);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});Fn(oo);var Au=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(oo),n=a(os);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,g){return(0,r.default)(p,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});Fn(Au);var $u=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(gl),n=a(Au);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),Fu=Fn($u),Ri=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Fu(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Xn(n.args)),a(null,i)})},e}(),Bs=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(Gn),n=x(Fs),a=x(oo),s=x(Du),p=x(Ku),v=x(Wa),g=x(os);function x(F){return F&&F.__esModule?F:{default:F}}function C(F,j,Y){Y=(0,s.default)(Y);var ee=0,ye=0,Fe=F.length,qe=!1;Fe===0&&Y(null);function rt(yt,xt){yt===!1&&(qe=!0),qe!==!0&&(yt?Y(yt):(++ye===Fe||xt===n.default)&&Y(null))}for(;ee<Fe;ee++)j(F[ee],ee,(0,p.default)(rt))}function w(F,j,Y){return(0,a.default)(F,Infinity,j,Y)}function O(F,j,Y){var ee=(0,r.default)(F)?C:w;return ee(F,(0,v.default)(j),Y)}i.default=(0,g.default)(O,3),e.exports=i.default});Fn(Bs);var ms=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Bs),n=a(gl);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),Qu=Fn(ms),zc=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Qu(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return si(n,void 0,void 0,function(){return hi(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Uc=wn(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(Du),n=p(Ku),a=p(Wa),s=p(os);function p(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function w(F){var j=(0,a.default)(g[C++]);j.apply(void 0,F.concat([(0,n.default)(O)]))}function O(F){for(var j=[],Y=arguments.length-1;Y-- >0;)j[Y]=arguments[Y+1];if(F!==!1){if(F||C===g.length)return x.apply(void 0,[F].concat(j));w(j)}}w([])}i.default=(0,s.default)(v),e.exports=i.default}),hf=Fn(Uc),au=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return hf(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),xl=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Fu(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),So=Q(26729),bl=Q.n(So),Zc=Q(69848),hu=Q.n(Zc);function Io(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Io(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Io(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function df(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Ep(C),e}var w=new(hu())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:uc({},F)}}),w.load(O.features),w}function Ep(e){return e.map(function(i,r){return uc({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Vf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function nh(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Sp(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function lc(e){if(e.length===0)throw new Error("mean requires at least one data point");return Sp(e)/e.length}var vf={min:nh,max:Vf,mean:lc,sum:Sp};function Cp(e,i){return e.map(function(r){return r[i]*1})}function ih(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ih(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ih(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mf(e){var i=Vh();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Vh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Sd(e,i){if(Array.isArray(i))return i}var gf=function(e){(0,ln.Z)(r,e);var i=mf(r);function r(n,a){var s;return(0,Vt.Z)(this,r),s=i.call(this),(0,R.Z)((0,D.Z)(s),"data",void 0),(0,R.Z)((0,D.Z)(s),"extent",void 0),(0,R.Z)((0,D.Z)(s),"hooks",{init:new Ri}),(0,R.Z)((0,D.Z)(s),"parser",{type:"geojson"}),(0,R.Z)((0,D.Z)(s),"transforms",[]),(0,R.Z)((0,D.Z)(s),"cluster",!1),(0,R.Z)((0,D.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,R.Z)((0,D.Z)(s),"mapService",void 0),(0,R.Z)((0,D.Z)(s),"invalidExtent",!1),(0,R.Z)((0,D.Z)(s),"dataArrayChanged",!1),(0,R.Z)((0,D.Z)(s),"originData",void 0),(0,R.Z)((0,D.Z)(s),"rawData",void 0),(0,R.Z)((0,D.Z)(s),"cfg",{}),(0,R.Z)((0,D.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Wt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,g=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(w){w.id||(w.properties.point_count=1)}),(x||kn()(g))&&(C=C.map(function(w){var O=w.id;if(O){var F=s.clusterIndex.getLeaves(O,Infinity),j=F.map(function(ye){return ye.properties}),Y;if(Ur()(g)&&x){var ee=Cp(j,x);Y=vf[g](ee)}kn()(g)&&(Y=g(j)),w.properties.stat=Y}else w.properties.point_count=1;return w})),this.data=Tr("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=Ai()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?Bu(Bu({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=Vl(Hl(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=Dr()(this.cfg,a,Sd);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Bu(Bu({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=Tr(s);this.data=p(this.originData,a),this.extent=Lc(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,g=rn(v)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=df(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(So.EventEmitter);function ah(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Gh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Cd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Cd(e,i){if(!!e){if(typeof e=="string")return oh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oh(e,i)}}function oh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Gf=6378e3;function Ad(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Gf)*(256<<20)/2,p=yf(r,a),v=p.gridHash,g=p.gridOffset,x=Hh(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function yf(e,i){var r=Infinity,n=-Infinity,a,s=Gh(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(qe){s.e(qe)}finally{s.f()}var g=(r+n)/2,x=wd(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},w=Gh(e),O;try{for(w.s();!(O=w.n()).done;){var F=O.value,j=F.coordinates[1],Y=F.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(Y)){var ee=Math.floor((j+90)/x.yOffset),ye=Math.floor((Y+180)/x.xOffset),Fe="".concat(ee,"-").concat(ye);C[Fe]=C[Fe]||{count:0,points:[]},C[Fe].count+=1,C[Fe].points.push(F)}}}catch(qe){w.e(qe)}finally{w.f()}return{gridHash:C,gridOffset:x}}function wd(e,i){var r=Oo(e),n=Ap(i,e);return{yOffset:r,xOffset:n}}function Oo(e){return e/Gf*(180/Math.PI)}function Ap(e,i){return i/Gf*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Hh(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=Qe(e[a].points,r.field);x[r.method]=Ue[r.method](C)}return Object.assign(x,{_id:s,coordinates:zo([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Xl=Math.PI/3,wp=[0,Xl,2*Xl,3*Xl,4*Xl,5*Xl];function Hf(e){return e[0]}function Tp(e){return e[1]}function Wf(){var e=0,i=0,r=1,n=1,a=Hf,s=Tp,p,v,g;function x(w){var O={},F=[],j,Y=w.length;for(j=0;j<Y;++j)if(!(isNaN(ye=+a.call(null,ee=w[j],j,w))||isNaN(Fe=+s.call(null,ee,j,w)))){var ee,ye,Fe,qe=Math.round(Fe=Fe/g),rt=Math.round(ye=ye/v-(qe&1)/2),yt=Fe-qe;if(Math.abs(yt)*3>1){var xt=ye-rt,Yt=rt+(ye<rt?-1:1)/2,ur=qe+(Fe<qe?-1:1),Ir=ye-Yt,tn=Fe-ur;xt*xt+yt*yt>Ir*Ir+tn*tn&&(rt=Yt+(qe&1?1:-1)/2,qe=ur)}var br=rt+"-"+qe,gn=O[br];gn?gn.push(ee):(F.push(gn=O[br]=[ee]),gn.x=(rt+(qe&1)/2)*v,gn.y=qe*g)}return F}function C(w){var O=0,F=0;return wp.map(function(j){var Y=Math.sin(j)*w,ee=-Math.cos(j)*w,ye=Y-O,Fe=ee-F;return O=Y,F=ee,[ye,Fe]})}return x.hexagon=function(w){return"m"+C(w==null?p:+w).join("l")+"z"},x.centers=function(){for(var w=[],O=Math.round(i/g),F=Math.round(e/v),j=O*g;j<n+p;j+=g,++O)for(var Y=F*v+(O&1)*v/2;Y<r+v/2;Y+=v)w.push([Y,j]);return w},x.mesh=function(){var w=C(p).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+w}).join("")},x.x=function(w){return arguments.length?(a=w,x):a},x.y=function(w){return arguments.length?(s=w,x):s},x.radius=function(w){return arguments.length?(p=+w,v=p*2*Math.sin(Xl),g=p*1.5,x):p},x.size=function(w){return arguments.length?(e=i=0,r=+w[0],n=+w[1],x):[r-e,n-i]},x.extent=function(w){return arguments.length?(e=+w[0][0],i=+w[0][1],r=+w[1][0],n=+w[1][1],x):[[e,i],[r,n]]},x.radius(1)}function Yl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yl(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xf=6378e3;function Mp(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*Xf)*(256<<20)/2,g=r.map(function(O){var F=zo(O.coordinates),j=(0,$n.Z)(F,2),Y=j[0],ee=j[1];return jc(jc({},O),{},{coordinates:[Y,ee]})}),x=Wf().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(g),w={dataArray:C.map(function(O,F){var j;if(i.field&&p){var Y=Qe(O,i.field);O[p]=Ue[p](Y)}return j={},(0,R.Z)(j,i.method,O[p]),(0,R.Z)(j,"count",O.length),(0,R.Z)(j,"rawData",O),(0,R.Z)(j,"coordinates",[O.x,O.y]),(0,R.Z)(j,"_id",F),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return w}function ql(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ql(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ql(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qf(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Yf(Yf({},p),s[v])}),e}function Pp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Br("geojson",Pu),Br("image",jt),Br("csv",lo),Br("json",cs),Br("raster",Xt),Ee("cluster",df),Ee("filter",ah),Ee("join",qf),Ee("map",Pp),Ee("grid",Ad),Ee("hexagon",Mp);var _f=pe,xf=fi,Ns=gf,Ip=Q(28660),Nr=Q(86700),Kf=Q(84879),Zt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Op=Q(31745),El=Q.n(Op);function cc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cc(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $f(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Wh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Wh(e,i){if(!!e){if(typeof e=="string")return Xh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xh(e,i)}}function Xh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Qf=30;function wu(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,w=C===void 0?0:C,O=0,F=x;Array.from(i).forEach(function(Y,ee){if(!v[Y]){var ye=r(Y,ee);F+Qf>s&&(F=0,O++),v[Y]={x:F,y:w+O*Qf,width:Qf,height:Qf,advance:ye},F+=Qf}});var j=n+a*2;return{mapping:v,xOffset:F,yOffset:w+O*j,canvasHeight:Vc(w+(O+1)*j)}}function Yh(e,i,r){var n=0,a=0,s=0,p=[],v={},g=$f(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var w=C.size;n+w+i>r&&(Jf(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+w+i,s=Math.max(s,w)}}}catch(F){g.e(F)}finally{g.f()}p.length>0&&Jf(v,p,a);var O=Vc(s+a+i);return{mapping:v,canvasHeight:O}}function Jf(e,i,r){var n=$f(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=sh(sh({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function Vc(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Nu,uh;function qh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Sl(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Sl(e,i){if(!!e){if(typeof e=="string")return Gc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gc(e,i)}}function Gc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function fc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Cl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fc(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Kh=Md(),lh="sans-serif",Rp="normal",ch=24,ma=3,pc=.25,Ro=8,Ys=1024,$h=1,fh=1,Td=3,d0=null;function Md(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function kp(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Qh(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Pd=(Nu=(0,Nr.b2)(),Nu(uh=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"fontAtlas",void 0),(0,R.Z)(this,"iconFontMap",void 0),(0,R.Z)(this,"iconFontGlyphs",{}),(0,R.Z)(this,"fontOptions",void 0),(0,R.Z)(this,"key",void 0),(0,R.Z)(this,"cache",new Bc(Td))}return(0,Wt.Z)(e,[{key:"scale",get:function(){return fh}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:lh,fontWeight:Rp,characterSet:Kh,fontSize:ch,buffer:ma,sdf:!0,cutoff:pc,radius:Ro,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Cl(Cl({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,w=s.radius,O=s.cutoff,F=s.iconfont,j=a&&a.data;j||(j=Yi.document.createElement("canvas"),j.width=Ys);var Y=j.getContext("2d");kp(Y,p,g,v);var ee=wu(Cl({getFontWidth:function(Vs){return Y.measureText(Vs).width},fontHeight:g*fh,buffer:x,characterSet:n,maxCanvasWidth:Ys},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),ye=ee.mapping,Fe=ee.canvasHeight,qe=ee.xOffset,rt=ee.yOffset,yt=Y.getImageData(0,0,j.width,j.height);if(j.height=Fe,Y.putImageData(yt,0,0),kp(Y,p,g,v),C){var xt=new(El())(g,x,w,O,p,v),Yt=Y.getImageData(0,0,xt.size,xt.size),ur=qh(n),Ir;try{for(ur.s();!(Ir=ur.n()).done;){var tn=Ir.value;if(F){var br=String.fromCharCode(parseInt(tn.replace("&#x","").replace(";",""),16)),gn=xt.draw(br);Qh(gn,Yt)}else Qh(xt.draw(tn),Yt);Y.putImageData(Yt,ye[tn].x,ye[tn].y)}}catch(rs){ur.e(rs)}finally{ur.f()}}else{var In=qh(n),qn;try{for(In.s();!(qn=In.n()).done;){var Ba=qn.value;Y.fillText(Ba,ye[Ba].x,ye[Ba].y+g*$h)}}catch(rs){In.e(rs)}finally{In.f()}}return{xOffset:qe,yOffset:rt,mapping:ye,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||uh),bf,ph;function Jh(e){var i=ep();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pa=3,Lp=1024,Tu=64,Ef=(bf=(0,Nr.b2)(),bf(ph=function(e){(0,ln.Z)(r,e);var i=Jh(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"canvasHeight",128),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"canvas",void 0),(0,R.Z)((0,D.Z)(n),"iconData",void 0),(0,R.Z)((0,D.Z)(n),"iconMap",void 0),(0,R.Z)((0,D.Z)(n),"ctx",void 0),(0,R.Z)((0,D.Z)(n),"loadingImageCount",0),n}return(0,Wt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Yi.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tu}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tu}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var w=v.iconData.find(function(O){return O.id===a});w&&(w.image=x,w.width=x.width,w.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=Lp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,g=p.y,x=p.image,C=p.width,w=C===void 0?64:C,O=p.height,F=O===void 0?64:O,j=Math.max(w,F),Y=j/Tu,ee=F/Y,ye=w/Y;x&&a.ctx.drawImage(x,v+(Tu-ye)/2,g+(Tu-ee)/2,ye,ee)})}},{key:"updateIconMap",value:function(){var a=Yh(this.iconData,Pa,Lp),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(So.EventEmitter))||ph),Ia=Q(49685);function hc(){var e=new Ia.WT(16);return Ia.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function N(e){var i=new Ia.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function fe(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Le(e,i,r,n,a,s,p,v,g,x,C,w,O,F,j,Y){var ee=new Ia.WT(16);return ee[0]=e,ee[1]=i,ee[2]=r,ee[3]=n,ee[4]=a,ee[5]=s,ee[6]=p,ee[7]=v,ee[8]=g,ee[9]=x,ee[10]=C,ee[11]=w,ee[12]=O,ee[13]=F,ee[14]=j,ee[15]=Y,ee}function It(e,i,r,n,a,s,p,v,g,x,C,w,O,F,j,Y,ee){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=w,e[11]=O,e[12]=F,e[13]=j,e[14]=Y,e[15]=ee,e}function rr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pt(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Kt(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],w=i[9],O=i[10],F=i[11],j=i[12],Y=i[13],ee=i[14],ye=i[15],Fe=r*v-n*p,qe=r*g-a*p,rt=r*x-s*p,yt=n*g-a*v,xt=n*x-s*v,Yt=a*x-s*g,ur=C*Y-w*j,Ir=C*ee-O*j,tn=C*ye-F*j,br=w*ee-O*Y,gn=w*ye-F*Y,In=O*ye-F*ee,qn=Fe*In-qe*gn+rt*br+yt*tn-xt*Ir+Yt*ur;return qn?(qn=1/qn,e[0]=(v*In-g*gn+x*br)*qn,e[1]=(a*gn-n*In-s*br)*qn,e[2]=(Y*Yt-ee*xt+ye*yt)*qn,e[3]=(O*xt-w*Yt-F*yt)*qn,e[4]=(g*tn-p*In-x*Ir)*qn,e[5]=(r*In-a*tn+s*Ir)*qn,e[6]=(ee*rt-j*Yt-ye*qe)*qn,e[7]=(C*Yt-O*rt+F*qe)*qn,e[8]=(p*gn-v*tn+x*ur)*qn,e[9]=(n*tn-r*gn-s*ur)*qn,e[10]=(j*xt-Y*rt+ye*Fe)*qn,e[11]=(w*rt-C*xt-F*Fe)*qn,e[12]=(v*Ir-p*br-g*ur)*qn,e[13]=(r*br-n*Ir+a*ur)*qn,e[14]=(Y*qe-j*yt-ee*Fe)*qn,e[15]=(C*yt-w*qe+O*Fe)*qn,e):null}function cr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],w=i[9],O=i[10],F=i[11],j=i[12],Y=i[13],ee=i[14],ye=i[15];return e[0]=v*(O*ye-F*ee)-w*(g*ye-x*ee)+Y*(g*F-x*O),e[1]=-(n*(O*ye-F*ee)-w*(a*ye-s*ee)+Y*(a*F-s*O)),e[2]=n*(g*ye-x*ee)-v*(a*ye-s*ee)+Y*(a*x-s*g),e[3]=-(n*(g*F-x*O)-v*(a*F-s*O)+w*(a*x-s*g)),e[4]=-(p*(O*ye-F*ee)-C*(g*ye-x*ee)+j*(g*F-x*O)),e[5]=r*(O*ye-F*ee)-C*(a*ye-s*ee)+j*(a*F-s*O),e[6]=-(r*(g*ye-x*ee)-p*(a*ye-s*ee)+j*(a*x-s*g)),e[7]=r*(g*F-x*O)-p*(a*F-s*O)+C*(a*x-s*g),e[8]=p*(w*ye-F*Y)-C*(v*ye-x*Y)+j*(v*F-x*w),e[9]=-(r*(w*ye-F*Y)-C*(n*ye-s*Y)+j*(n*F-s*w)),e[10]=r*(v*ye-x*Y)-p*(n*ye-s*Y)+j*(n*x-s*v),e[11]=-(r*(v*F-x*w)-p*(n*F-s*w)+C*(n*x-s*v)),e[12]=-(p*(w*ee-O*Y)-C*(v*ee-g*Y)+j*(v*O-g*w)),e[13]=r*(w*ee-O*Y)-C*(n*ee-a*Y)+j*(n*O-a*w),e[14]=-(r*(v*ee-g*Y)-p*(n*ee-a*Y)+j*(n*g-a*v)),e[15]=r*(v*O-g*w)-p*(n*O-a*w)+C*(n*g-a*v),e}function gr(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],g=e[7],x=e[8],C=e[9],w=e[10],O=e[11],F=e[12],j=e[13],Y=e[14],ee=e[15],ye=i*p-r*s,Fe=i*v-n*s,qe=i*g-a*s,rt=r*v-n*p,yt=r*g-a*p,xt=n*g-a*v,Yt=x*j-C*F,ur=x*Y-w*F,Ir=x*ee-O*F,tn=C*Y-w*j,br=C*ee-O*j,gn=w*ee-O*Y;return ye*gn-Fe*br+qe*tn+rt*Ir-yt*ur+xt*Yt}function hr(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],w=i[8],O=i[9],F=i[10],j=i[11],Y=i[12],ee=i[13],ye=i[14],Fe=i[15],qe=r[0],rt=r[1],yt=r[2],xt=r[3];return e[0]=qe*n+rt*v+yt*w+xt*Y,e[1]=qe*a+rt*g+yt*O+xt*ee,e[2]=qe*s+rt*x+yt*F+xt*ye,e[3]=qe*p+rt*C+yt*j+xt*Fe,qe=r[4],rt=r[5],yt=r[6],xt=r[7],e[4]=qe*n+rt*v+yt*w+xt*Y,e[5]=qe*a+rt*g+yt*O+xt*ee,e[6]=qe*s+rt*x+yt*F+xt*ye,e[7]=qe*p+rt*C+yt*j+xt*Fe,qe=r[8],rt=r[9],yt=r[10],xt=r[11],e[8]=qe*n+rt*v+yt*w+xt*Y,e[9]=qe*a+rt*g+yt*O+xt*ee,e[10]=qe*s+rt*x+yt*F+xt*ye,e[11]=qe*p+rt*C+yt*j+xt*Fe,qe=r[12],rt=r[13],yt=r[14],xt=r[15],e[12]=qe*n+rt*v+yt*w+xt*Y,e[13]=qe*a+rt*g+yt*O+xt*ee,e[14]=qe*s+rt*x+yt*F+xt*ye,e[15]=qe*p+rt*C+yt*j+xt*Fe,e}function Er(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,g,x,C,w,O,F,j,Y,ee,ye;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],g=i[2],x=i[3],C=i[4],w=i[5],O=i[6],F=i[7],j=i[8],Y=i[9],ee=i[10],ye=i[11],e[0]=p,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=w,e[6]=O,e[7]=F,e[8]=j,e[9]=Y,e[10]=ee,e[11]=ye,e[12]=p*n+C*a+j*s+i[12],e[13]=v*n+w*a+Y*s+i[13],e[14]=g*n+O*a+ee*s+i[14],e[15]=x*n+F*a+ye*s+i[15]),e}function Ar(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function jr(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),g,x,C,w,O,F,j,Y,ee,ye,Fe,qe,rt,yt,xt,Yt,ur,Ir,tn,br,gn,In,qn,Ba;return v<Ia.Ib?null:(v=1/v,a*=v,s*=v,p*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,w=i[0],O=i[1],F=i[2],j=i[3],Y=i[4],ee=i[5],ye=i[6],Fe=i[7],qe=i[8],rt=i[9],yt=i[10],xt=i[11],Yt=a*a*C+x,ur=s*a*C+p*g,Ir=p*a*C-s*g,tn=a*s*C-p*g,br=s*s*C+x,gn=p*s*C+a*g,In=a*p*C+s*g,qn=s*p*C-a*g,Ba=p*p*C+x,e[0]=w*Yt+Y*ur+qe*Ir,e[1]=O*Yt+ee*ur+rt*Ir,e[2]=F*Yt+ye*ur+yt*Ir,e[3]=j*Yt+Fe*ur+xt*Ir,e[4]=w*tn+Y*br+qe*gn,e[5]=O*tn+ee*br+rt*gn,e[6]=F*tn+ye*br+yt*gn,e[7]=j*tn+Fe*br+xt*gn,e[8]=w*In+Y*qn+qe*Ba,e[9]=O*In+ee*qn+rt*Ba,e[10]=F*In+ye*qn+yt*Ba,e[11]=j*In+Fe*qn+xt*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function yr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],g=i[7],x=i[8],C=i[9],w=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+w*n,e[7]=g*a+O*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=w*a-v*n,e[11]=O*a-g*n,e}function wr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[8],C=i[9],w=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-w*n,e[3]=g*a-O*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+w*a,e[11]=g*n+O*a,e}function it(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[4],C=i[5],w=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+w*n,e[3]=g*a+O*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=w*a-v*n,e[7]=O*a-g*n,e}function zt(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function xr(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,g,x;return p<Ia.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function lr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Un(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,g=a+a,x=s+s,C=n*v,w=n*g,O=n*x,F=a*g,j=a*x,Y=s*x,ee=p*v,ye=p*g,Fe=p*x;return e[0]=1-(F+Y),e[1]=w+Fe,e[2]=O-ye,e[3]=0,e[4]=w-Fe,e[5]=1-(C+Y),e[6]=j+ee,e[7]=0,e[8]=O+ye,e[9]=j-ee,e[10]=1-(C+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Qt(e,i){var r=new Ia.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],w=n*n+a*a+s*s+p*p;return w>0?(r[0]=(v*p+C*n+g*s-x*a)*2/w,r[1]=(g*p+C*a+x*n-v*s)*2/w,r[2]=(x*p+C*s+v*a-g*n)*2/w):(r[0]=(v*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-g*n)*2),Un(e,i,r),e}function er(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function xn(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(g,x,C),e}function Xr(e,i){var r=new Ia.WT(3);xn(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,w=i[6]*s,O=i[8]*n,F=i[9]*a,j=i[10]*s,Y=p+C+j,ee=0;return Y>0?(ee=Math.sqrt(Y+1)*2,e[3]=.25*ee,e[0]=(w-F)/ee,e[1]=(O-g)/ee,e[2]=(v-x)/ee):p>C&&p>j?(ee=Math.sqrt(1+p-C-j)*2,e[3]=(w-F)/ee,e[0]=.25*ee,e[1]=(v+x)/ee,e[2]=(O+g)/ee):C>j?(ee=Math.sqrt(1+C-p-j)*2,e[3]=(O-g)/ee,e[0]=(v+x)/ee,e[1]=.25*ee,e[2]=(w+F)/ee):(ee=Math.sqrt(1+j-p-C)*2,e[3]=(v-x)/ee,e[0]=(O+g)/ee,e[1]=(w+F)/ee,e[2]=.25*ee),e}function Sr(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],g=a+a,x=s+s,C=p+p,w=a*g,O=a*x,F=a*C,j=s*x,Y=s*C,ee=p*C,ye=v*g,Fe=v*x,qe=v*C,rt=n[0],yt=n[1],xt=n[2];return e[0]=(1-(j+ee))*rt,e[1]=(O+qe)*rt,e[2]=(F-Fe)*rt,e[3]=0,e[4]=(O-qe)*yt,e[5]=(1-(w+ee))*yt,e[6]=(Y+ye)*yt,e[7]=0,e[8]=(F+Fe)*xt,e[9]=(Y-ye)*xt,e[10]=(1-(w+j))*xt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function $r(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],g=i[3],x=s+s,C=p+p,w=v+v,O=s*x,F=s*C,j=s*w,Y=p*C,ee=p*w,ye=v*w,Fe=g*x,qe=g*C,rt=g*w,yt=n[0],xt=n[1],Yt=n[2],ur=a[0],Ir=a[1],tn=a[2],br=(1-(Y+ye))*yt,gn=(F+rt)*yt,In=(j-qe)*yt,qn=(F-rt)*xt,Ba=(1-(O+ye))*xt,rs=(ee+Fe)*xt,Vs=(j+qe)*Yt,Gs=(ee-Fe)*Yt,Qs=(1-(O+Y))*Yt;return e[0]=br,e[1]=gn,e[2]=In,e[3]=0,e[4]=qn,e[5]=Ba,e[6]=rs,e[7]=0,e[8]=Vs,e[9]=Gs,e[10]=Qs,e[11]=0,e[12]=r[0]+ur-(br*ur+qn*Ir+Vs*tn),e[13]=r[1]+Ir-(gn*ur+Ba*Ir+Gs*tn),e[14]=r[2]+tn-(In*ur+rs*Ir+Qs*tn),e[15]=1,e}function Jr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,g=a+a,x=r*p,C=n*p,w=n*v,O=a*p,F=a*v,j=a*g,Y=s*p,ee=s*v,ye=s*g;return e[0]=1-w-j,e[1]=C+ye,e[2]=O-ee,e[3]=0,e[4]=C-ye,e[5]=1-x-j,e[6]=F+Y,e[7]=0,e[8]=O+ee,e[9]=F-Y,e[10]=1-x-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yi(e,i,r,n,a,s,p){var v=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function ri(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var Gr=ri;function on(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function Qn(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function li(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var zi=li;function io(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function so(e,i,r,n){var a,s,p,v,g,x,C,w,O,F,j=i[0],Y=i[1],ee=i[2],ye=n[0],Fe=n[1],qe=n[2],rt=r[0],yt=r[1],xt=r[2];return Math.abs(j-rt)<Ia.Ib&&Math.abs(Y-yt)<Ia.Ib&&Math.abs(ee-xt)<Ia.Ib?rr(e):(C=j-rt,w=Y-yt,O=ee-xt,F=1/Math.hypot(C,w,O),C*=F,w*=F,O*=F,a=Fe*O-qe*w,s=qe*C-ye*O,p=ye*w-Fe*C,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),v=w*p-O*s,g=O*a-C*p,x=C*s-w*a,F=Math.hypot(v,g,x),F?(F=1/F,v*=F,g*=F,x*=F):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=w,e[7]=0,e[8]=p,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*j+s*Y+p*ee),e[13]=-(v*j+g*Y+x*ee),e[14]=-(C*j+w*Y+O*ee),e[15]=1,e)}function Fi(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],w=s-r[1],O=p-r[2],F=C*C+w*w+O*O;F>0&&(F=1/Math.sqrt(F),C*=F,w*=F,O*=F);var j=g*O-x*w,Y=x*C-v*O,ee=v*w-g*C;return F=j*j+Y*Y+ee*ee,F>0&&(F=1/Math.sqrt(F),j*=F,Y*=F,ee*=F),e[0]=j,e[1]=Y,e[2]=ee,e[3]=0,e[4]=w*ee-O*Y,e[5]=O*j-C*ee,e[6]=C*Y-w*j,e[7]=0,e[8]=C,e[9]=w,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function ss(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Xa(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $o(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function vo(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Qo(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Uo(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function gs(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Ka(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],g=e[6],x=e[7],C=e[8],w=e[9],O=e[10],F=e[11],j=e[12],Y=e[13],ee=e[14],ye=e[15],Fe=i[0],qe=i[1],rt=i[2],yt=i[3],xt=i[4],Yt=i[5],ur=i[6],Ir=i[7],tn=i[8],br=i[9],gn=i[10],In=i[11],qn=i[12],Ba=i[13],rs=i[14],Vs=i[15];return Math.abs(r-Fe)<=Ia.Ib*Math.max(1,Math.abs(r),Math.abs(Fe))&&Math.abs(n-qe)<=Ia.Ib*Math.max(1,Math.abs(n),Math.abs(qe))&&Math.abs(a-rt)<=Ia.Ib*Math.max(1,Math.abs(a),Math.abs(rt))&&Math.abs(s-yt)<=Ia.Ib*Math.max(1,Math.abs(s),Math.abs(yt))&&Math.abs(p-xt)<=Ia.Ib*Math.max(1,Math.abs(p),Math.abs(xt))&&Math.abs(v-Yt)<=Ia.Ib*Math.max(1,Math.abs(v),Math.abs(Yt))&&Math.abs(g-ur)<=Ia.Ib*Math.max(1,Math.abs(g),Math.abs(ur))&&Math.abs(x-Ir)<=Ia.Ib*Math.max(1,Math.abs(x),Math.abs(Ir))&&Math.abs(C-tn)<=Ia.Ib*Math.max(1,Math.abs(C),Math.abs(tn))&&Math.abs(w-br)<=Ia.Ib*Math.max(1,Math.abs(w),Math.abs(br))&&Math.abs(O-gn)<=Ia.Ib*Math.max(1,Math.abs(O),Math.abs(gn))&&Math.abs(F-In)<=Ia.Ib*Math.max(1,Math.abs(F),Math.abs(In))&&Math.abs(j-qn)<=Ia.Ib*Math.max(1,Math.abs(j),Math.abs(qn))&&Math.abs(Y-Ba)<=Ia.Ib*Math.max(1,Math.abs(Y),Math.abs(Ba))&&Math.abs(ee-rs)<=Ia.Ib*Math.max(1,Math.abs(ee),Math.abs(rs))&&Math.abs(ye-Vs)<=Ia.Ib*Math.max(1,Math.abs(ye),Math.abs(Vs))}var _i=hr,Zo=vo,ta,Jo,ni=(ta=(0,Nr.b2)(),ta(Jo=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"viewport",void 0),(0,R.Z)(this,"overridedViewProjectionMatrix",void 0),(0,R.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,R.Z)(this,"jitteredProjectionMatrix",void 0),(0,R.Z)(this,"viewMatrixInverse",void 0),(0,R.Z)(this,"cameraPosition",void 0)}return(0,Wt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=hc(),Kt(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,$n.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=zt(hc(),[r,n,0]);this.jitteredProjectionMatrix=hr(hc(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=hr(hc(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Jo),Di,ua;function Co(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Al(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Al(e,i){if(!!e){if(typeof e=="string")return Se(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Se(e,i)}}function Se(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ft=(Di=(0,Nr.b2)(),Di(ua=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"container",void 0),(0,R.Z)(this,"controlCorners",void 0),(0,R.Z)(this,"controlContainer",void 0),(0,R.Z)(this,"scene",void 0),(0,R.Z)(this,"mapsService",void 0),(0,R.Z)(this,"controls",[]),(0,R.Z)(this,"unAddControls",[])}return(0,Wt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Zt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Zt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Co(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=mi("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(g){return n+g}).join(" ");r[p.join("")]=mi("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Bo(this.controlCorners[r]);this.controlContainer&&Bo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||ua),vt,hn,Ui=(vt=(0,Nr.b2)(),vt(hn=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"container",void 0),(0,R.Z)(this,"scene",void 0),(0,R.Z)(this,"mapsService",void 0),(0,R.Z)(this,"markers",[]),(0,R.Z)(this,"markerLayers",[]),(0,R.Z)(this,"unAddMarkers",[]),(0,R.Z)(this,"unAddMarkerLayers",[])}return(0,Wt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Zt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||hn),_e,ae,Ze=(_e=(0,Nr.b2)(),_e(ae=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"scene",void 0),(0,R.Z)(this,"popup",void 0),(0,R.Z)(this,"mapsService",void 0),(0,R.Z)(this,"unAddPopup",void 0)}return(0,Wt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Zt.IMapService)}}]),e}())||ae),ot=Q(82492),At=Q.n(ot),Ye={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ke=Ye,tt,me;function Ne(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xe(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ne(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ne(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var st={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},mt={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},fr=(tt=(0,Nr.b2)(),tt(me=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"sceneConfigCache",{}),(0,R.Z)(this,"layerConfigCache",{})}return(0,Wt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ke[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=xe(xe({},st),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=xe({},At()({},this.sceneConfigCache[r],mt,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||me);function Jt(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function $t(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function en(){var e=new Ia.WT(4);return Ia.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Fr(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Tn(e,i,r,n){var a=new Ia.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function fn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Cn(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function bn(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function mn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Jn(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Aa(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function ys(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function ja(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function ga(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Kl(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function qs(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Ju(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function zu(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function ed(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function Uu(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function Hc(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function Dp(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Sv(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function us(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function td(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function Sf(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function Id(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],w=i[1],O=i[2],F=i[3];return e[0]=w*x-O*g+F*v,e[1]=-(C*x)+O*p-F*s,e[2]=C*g-w*p+F*a,e[3]=-(C*v)+w*s-O*a,e}function Od(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function v0(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function Cf(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function Af(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,w=x*a+g*n-p*s,O=x*s+p*a-v*n,F=-p*n-v*a-g*s;return e[0]=C*x+F*-p+w*-g-O*-v,e[1]=w*x+F*-v+O*-p-C*-g,e[2]=O*x+F*-g+C*-v-w*-p,e[3]=i[3],e}function Cv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Av(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mm(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Ts(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var tp=null,wv=null,t=null,o=null,u=null,h=null,y=null,b=function(){var e=en();return function(i,r,n,a,s,p){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),S=Math.PI/180,P=512,L=4003e4;function z(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},w=P*s,O=Math.cos(r*S),F=w/360,j=F/O,Y=w/L/O;if(C.pixelsPerMeter=[Y,-Y,Y],C.metersPerPixel=[1/Y,-1/Y,1/Y],C.pixelsPerDegree=[F,-j,Y],C.degreesPerPixel=[1/F,-1/j,1/Y],v){var ee=S*Math.tan(r*S)/O,ye=F*ee/2,Fe=w/L*ee,qe=Fe/j*Y;C.pixelsPerDegree2=[0,-ye,Fe],C.pixelsPerMeter2=[qe,0,qe],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Z;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Z||(Z={}));var G={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},J,ne,Ce,Te,Xe,Be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],at=(J=(0,Nr.b2)(),ne=(0,Nr.f3)(Zt.ICameraService),J(Ce=(Te=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"needRefresh",!0),Jt(this,"cameraService",Xe,this),(0,R.Z)(this,"coordinateSystem",void 0),(0,R.Z)(this,"viewportCenter",void 0),(0,R.Z)(this,"viewportCenterProjection",void 0),(0,R.Z)(this,"pixelsPerDegree",void 0),(0,R.Z)(this,"pixelsPerDegree2",void 0),(0,R.Z)(this,"pixelsPerMeter",void 0)}return(0,Wt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=z({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Z.LNGLAT||this.coordinateSystem===Z.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Z.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Z.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=z({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),O=hr([],w,C),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Cf([],[F[0],F[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=hr([],w,C),O=hr([],O,Be),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),Xe=$t(Te.prototype,"cameraService",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te))||Ce),gt=Q(20396),Rt=Q.n(gt),wt;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(wt||(wt={}));var ir,Pr,Hr,Bn,pn;function Hn(e){var i=dn();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function dn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ki={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},ii=(ir=(0,Nr.b2)(),Pr=(0,Nr.f3)(Zt.IMapService),ir(Hr=(Bn=function(e){(0,ln.Z)(r,e);var i=Hn(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"indragging",!1),Jt((0,D.Z)(n),"mapService",pn,(0,D.Z)(n)),(0,R.Z)((0,D.Z)(n),"hammertime",void 0),(0,R.Z)((0,D.Z)(n),"lastClickTime",0),(0,R.Z)((0,D.Z)(n),"lastClickXY",[-1,-1]),(0,R.Z)((0,D.Z)(n),"clickTimer",void 0),(0,R.Z)((0,D.Z)(n),"$containter",void 0),(0,R.Z)((0,D.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=ki[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(wt.Drag,g)}),(0,R.Z)((0,D.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(wt.Hover,g)}),(0,R.Z)((0,D.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,R.Z)((0,D.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,w=x,O=v.type,F=n.mapService.getMapContainer();if(F)if(Po)C=C-F.left-0,w=w-F.top-0;else{var j=F.getBoundingClientRect(),Y=j.top,ee=j.left;C=C-ee-F.clientLeft,w=w-Y-F.clientTop}var ye=n.mapService.containerToLngLat([C,w]);if(O==="click"){if(!Po&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,w,ye);return}if(O==="touch"){n.isDoubleTap(C,w,ye);return}O!=="click"&&O!=="dblclick"&&n.emit(wt.Hover,{x:C,y:w,lngLat:ye,type:O,target:v})}),n}return(0,Wt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(wt.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(wt.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(wt.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(wt.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Po)Yi.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Rt()).Manager(a);s.add(new(Rt()).Tap({event:"dblclick",taps:2})),s.add(new(Rt()).Tap({event:"click"})),s.add(new(Rt()).Pan({threshold:0,pointers:0})),s.add(new(Rt()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Po)Yi.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),w=C.top,O=C.left;v-=O,g-=w}var F=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(wt.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(wt.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(bl()),pn=$t(Bn.prototype,"mapService",[Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bn))||Hr),nn=Q(92137),Zi=Q(87757),En=Q.n(Zi),ra=0;function Wn(e){if(Po)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(ra++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function ha(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var V;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(V||(V={}));var mo,uo,$a,go,es,ts,zs,yo,Us,Ao,ls,Vi,Oa;function wa(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $i(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wa(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wa(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ou=(mo=(0,Nr.b2)(),uo=(0,Nr.f3)(Zt.IMapService),$a=(0,Nr.f3)(Zt.IRendererService),go=(0,Nr.f3)(Zt.IGlobalConfigService),es=(0,Nr.f3)(Zt.IInteractionService),ts=(0,Nr.f3)(Zt.ILayerService),mo(zs=(yo=function(){function e(){var i=this;(0,Vt.Z)(this,e),Jt(this,"mapService",Us,this),Jt(this,"rendererService",Ao,this),Jt(this,"configService",ls,this),Jt(this,"interactionService",Vi,this),Jt(this,"layerService",Oa,this),(0,R.Z)(this,"pickingFBO",void 0),(0,R.Z)(this,"width",0),(0,R.Z)(this,"height",0),(0,R.Z)(this,"alreadyInPicking",!1),(0,R.Z)(this,"pickBufferScale",1),(0,R.Z)(this,"lastPickTime",new Date().getTime()),(0,R.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,w=i.rendererService,O=w.getViewportSize,F=w.readPixels,j=w.getContainer,Y=i.getContainerSize(j()),ee=Y.width,ye=Y.height;ee*=_a,ye*=_a;var Fe=r.getLayerConfig(),qe=Fe.enableHighlight,rt=Fe.enableSelect,yt=s*_a,xt=p*_a;if(yt>ee-1*_a||yt<0||xt>ye-1*_a||xt<0)return!1;var Yt;if(Yt=F({x:Math.floor(yt/i.pickBufferScale),y:Math.floor((ye-(p+1)*_a)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Yt[0]!==0||Yt[1]!==0||Yt[2]!==0){var ur=d(Yt),Ir=r.getSource().getFeatureById(ur);ur!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var tn={x:s,y:p,type:g,lngLat:v,featureId:ur,feature:Ir,target:x};Ir&&(C=!0,r.setCurrentPickId(ur),i.triggerHoverOnLayer(r,tn))}else{var br={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,$i($i({},br),{},{type:"unpick"})),i.triggerHoverOnLayer(r,br),r.setCurrentPickId(null)}if(qe&&i.highlightPickedFeature(r,Yt),rt&&g==="click"&&((a=Yt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var gn=d(Yt);r.getCurrentSelectedId()===null||gn!==r.getCurrentSelectedId()?(i.selectFeature(r,Yt),r.setCurrentSelectedId(gn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Wt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=_a,C*=_a,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.interactionService.on(wt.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,nn.Z)(En().mark(function n(a,s,p){var v=this,g,x,C,w;return En().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,w=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);p(j)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(br){var gn=br<0?0:br;return Math.floor(gn*_a/a.pickBufferScale)}),p=(0,$n.Z)(s,4),v=p[0],g=p[1],x=p[2],C=p[3],w=this.rendererService,O=w.getViewportSize,F=w.readPixels,j=w.getContainer,Y=this.getContainerSize(j()),ee=Y.width,ye=Y.height;if(ee*=_a,ye*=_a,v>(ee-1)*_a/this.pickBufferScale||x<0||g>(ye-1)*_a/this.pickBufferScale||C<0)return[];var Fe,qe=Math.min(ee/this.pickBufferScale,x)-v,rt=Math.min(ye/this.pickBufferScale,C)-g;Fe=F({x:v,y:Math.floor(ye/this.pickBufferScale-(C+1)),width:qe,height:rt,data:new Uint8Array(qe*rt*4),framebuffer:this.pickingFBO});for(var yt=[],xt={},Yt=0;Yt<Fe.length/4;Yt=Yt+1){var ur=Fe.slice(Yt*4,Yt*4+4),Ir=d(ur);if(Ir!==-1&&!xt[Ir]){var tn=r.getSource().getFeatureById(Ir);yt.push($i($i({},tn),{},{pickedFeatureIdx:Ir})),xt[Ir]=!0}}return yt}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/_a,height:r.height/_a}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,nn.Z)(En().mark(function n(a){var s;return En().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=_a,s*=_a,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,nn.Z)(En().mark(function n(a){var s=this,p,v,g,x,C;return En().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(ee){ee.hooks.beforeRenderData.call(),ee.hooks.beforeRender.call(),ee.render(),ee.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call();var Y=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=Y?+j.id:-1,Y&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){ha(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,$n.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,$n.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Us=$t(yo.prototype,"mapService",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=$t(yo.prototype,"rendererService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ls=$t(yo.prototype,"configService",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vi=$t(yo.prototype,"interactionService",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=$t(yo.prototype,"layerService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo))||zs),Zs=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Vt.Z)(this,e),(0,R.Z)(this,"autoStart",void 0),(0,R.Z)(this,"startTime",0),(0,R.Z)(this,"oldTime",0),(0,R.Z)(this,"running",!1),(0,R.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Wt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Ya,ko,Ms,la,$l,Ks,Ql,wo,Jl;function wl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Fp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Fp(e,i){if(!!e){if(typeof e=="string")return wf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wf(e,i)}}function wf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Bp=(Ya=(0,Nr.b2)(),ko=(0,Nr.f3)(Zt.IRendererService),Ms=(0,Nr.f3)(Zt.IMapService),la=(0,Nr.f3)(Zt.IGlobalConfigService),Ya($l=(Ks=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"pickedLayerId",-1),(0,R.Z)(this,"clock",new Zs),(0,R.Z)(this,"alreadyInRendering",!1),(0,R.Z)(this,"layers",[]),(0,R.Z)(this,"layerList",[]),(0,R.Z)(this,"layerRenderID",void 0),(0,R.Z)(this,"sceneInited",!1),(0,R.Z)(this,"animateInstanceCount",0),(0,R.Z)(this,"shaderPicking",!0),(0,R.Z)(this,"enableRender",!0),Jt(this,"renderService",Ql,this),Jt(this,"mapService",wo,this),Jt(this,"configService",Jl,this)}return(0,Wt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,nn.Z)(En().mark(function n(){var a,s,p;return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=wl(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.isLayerGroup&&p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,p.renderMultiPass();case 15:g.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=c(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Yi.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Yi.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Ql=$t(Ks.prototype,"renderService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=$t(Ks.prototype,"mapService",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=$t(Ks.prototype,"configService",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks))||$l),Zu=Q(81253),Np=Q(14293),Tl=Q.n(Np),zp=function(){function e(i){var r=this;(0,Vt.Z)(this,e),(0,R.Z)(this,"name",void 0),(0,R.Z)(this,"type",void 0),(0,R.Z)(this,"scale",void 0),(0,R.Z)(this,"descriptor",void 0),(0,R.Z)(this,"featureBufferLayout",[]),(0,R.Z)(this,"needRescale",!1),(0,R.Z)(this,"needRemapping",!1),(0,R.Z)(this,"needRegenerateVertices",!1),(0,R.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,R.Z)(this,"vertexAttribute",void 0),(0,R.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,Wt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,sn.Z)(r));if(!Tl()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),hh=["buffer","update","name"],rd=["buffer","update","name"],Tf,dc,Up,rp,vc,np;function dh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ip(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dh(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nd(e){return new Promise(function(i){return setTimeout(i,e)})}var vh=(Tf={},(0,R.Z)(Tf,V.FLOAT,4),(0,R.Z)(Tf,V.UNSIGNED_BYTE,1),(0,R.Z)(Tf,V.UNSIGNED_SHORT,2),Tf),id=(dc=(0,Nr.b2)(),Up=(0,Nr.f3)(Zt.IRendererService),dc(rp=(vc=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"attributesAndIndices",void 0),Jt(this,"rendererService",np,this),(0,R.Z)(this,"attributes",[]),(0,R.Z)(this,"triangulation",void 0),(0,R.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Wt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new zp(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(ip(ip({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(rt){return rt.name===r});if(p&&p.descriptor){var v=p.descriptor,g=v.update,x=v.buffer,C=v.size,w=C===void 0?0:C,O=vh[x.type||V.FLOAT];if(g){var F=this.featureLayout,j=F.elements,Y=F.sizePerElement,ee=j.slice(a,s);if(!ee.length)return;var ye=ee[0].offset,Fe=ye*w*O,qe=ee.map(function(rt,yt){for(var xt=rt.featureIdx,Yt=rt.vertices,ur=rt.normals,Ir=Yt.length/Y,tn=[],br=0;br<Ir;br++){var gn=ur?ur.slice(br*3,br*3+3):[];tn.push.apply(tn,(0,sn.Z)(g(n[xt],xt,Yt.slice(br*Y,br*Y+Y),yt,gn)))}return tn}).reduce(function(rt,yt){return rt.push.apply(rt,(0,sn.Z)(yt)),rt},[]);p.vertexAttribute.updateBuffer({data:qe,offset:Fe})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(Fe){return Fe.resetDescriptor(),Fe.descriptor}),v=0,g=[],x=[],C=[],w=3;r.forEach(function(Fe,qe){var rt=s.triangulation(Fe,a),yt=rt.indices,xt=rt.vertices,Yt=rt.normals,ur=rt.size,Ir=rt.indexes;yt.forEach(function(In){x.push(In+v)}),w=ur;var tn=xt.length/ur;s.featureLayout.sizePerElement=w,s.featureLayout.elements.push({featureIdx:qe,vertices:xt,normals:Yt,offset:v}),v+=tn;for(var br=function(qn){var Ba=(Yt==null?void 0:Yt.slice(qn*3,qn*3+3))||[],rs=xt.slice(qn*ur,qn*ur+ur),Vs=0;Ir&&Ir[qn]!==void 0&&(Vs=Ir[qn]),p.forEach(function(Gs,Qs){if(Gs&&Gs.update){var $c;($c=Gs.buffer.data).push.apply($c,(0,sn.Z)(Gs.update(Fe,qe,rs,qn,Ba,Vs)))}})},gn=0;gn<tn;gn++)br(gn)});var O=this.rendererService,F=O.createAttribute,j=O.createBuffer,Y=O.createElements,ee={};p.forEach(function(Fe,qe){if(Fe){var rt=Fe.buffer,yt=Fe.update,xt=Fe.name,Yt=(0,Zu.Z)(Fe,hh),ur=F(ip({buffer:j(rt)},Yt));ee[Fe.name||""]=ur,s.attributes[qe].vertexAttribute=ur}});var ye=Y({data:x,type:V.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:ee,elements:ye},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),p=0,v=[],g=3;r.forEach(function(F,j){var Y=a.triangulation(F),ee=Y.indices,ye=Y.vertices,Fe=Y.normals,qe=Y.size,rt=Y.indexes;ee.forEach(function(ur){v.push(ur+p)}),g=qe;var yt=ye.length/qe;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:j,vertices:ye,normals:Fe,offset:p}),p+=yt;for(var xt=function(Ir){var tn=(Fe==null?void 0:Fe.slice(Ir*3,Ir*3+3))||[],br=ye.slice(Ir*qe,Ir*qe+qe),gn=0;rt&&rt[Ir]!==void 0&&(gn=rt[Ir]),s.forEach(function(In,qn){if(In&&In.update){var Ba;(Ba=In.buffer.data).push.apply(Ba,(0,sn.Z)(In.update(F,j,br,Ir,tn,gn)))}})},Yt=0;Yt<yt;Yt++)xt(Yt)});var x=this.rendererService,C=x.createAttribute,w=x.createBuffer,O={};return s.forEach(function(F,j){if(F){var Y=F.buffer,ee=F.update,ye=F.name,Fe=(0,Zu.Z)(F,rd),qe=C(ip({buffer:w(Y)},Fe));O[F.name||""]=qe,a.attributes[j].vertexAttribute=qe}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),np=$t(vc.prototype,"rendererService",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vc))||rp),Zp=Q(67709),mh=Q.n(Zp),jp,gh,ap,yh,op,Vp,Mf,Gp,sp,ad,Rd,od,kd,sd,m0,Hp,To,_o,g0,Wc,ud,Ld,_h,ec,xh,Wp,bh,Eh,ld,Dd,Xp,Fd,Bd;function y0(e){var i=_0();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function _0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x0=(jp=(0,Nr.b2)(),gh=(0,Nr.f3)(Zt.SceneID),ap=(0,Nr.f3)(Zt.IIconService),yh=(0,Nr.f3)(Zt.IFontService),op=(0,Nr.f3)(Zt.IControlService),Vp=(0,Nr.f3)(Zt.IGlobalConfigService),Mf=(0,Nr.f3)(Zt.IMapService),Gp=(0,Nr.f3)(Zt.ICoordinateSystemService),sp=(0,Nr.f3)(Zt.IRendererService),ad=(0,Nr.f3)(Zt.ILayerService),Rd=(0,Nr.f3)(Zt.ICameraService),od=(0,Nr.f3)(Zt.IInteractionService),kd=(0,Nr.f3)(Zt.IPickingService),sd=(0,Nr.f3)(Zt.IShaderModuleService),m0=(0,Nr.f3)(Zt.IMarkerService),Hp=(0,Nr.f3)(Zt.IPopupService),jp(To=(_o=function(e){(0,ln.Z)(r,e);var i=y0(r);function r(){var n;return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"destroyed",!1),(0,R.Z)((0,D.Z)(n),"loaded",!1),(0,R.Z)((0,D.Z)(n),"loadFont",!1),(0,R.Z)((0,D.Z)(n),"fontFamily",""),Jt((0,D.Z)(n),"id",g0,(0,D.Z)(n)),Jt((0,D.Z)(n),"iconService",Wc,(0,D.Z)(n)),Jt((0,D.Z)(n),"fontService",ud,(0,D.Z)(n)),Jt((0,D.Z)(n),"controlService",Ld,(0,D.Z)(n)),Jt((0,D.Z)(n),"configService",_h,(0,D.Z)(n)),Jt((0,D.Z)(n),"map",ec,(0,D.Z)(n)),Jt((0,D.Z)(n),"coordinateSystemService",xh,(0,D.Z)(n)),Jt((0,D.Z)(n),"rendererService",Wp,(0,D.Z)(n)),Jt((0,D.Z)(n),"layerService",bh,(0,D.Z)(n)),Jt((0,D.Z)(n),"cameraService",Eh,(0,D.Z)(n)),Jt((0,D.Z)(n),"interactionService",ld,(0,D.Z)(n)),Jt((0,D.Z)(n),"pickingService",Dd,(0,D.Z)(n)),Jt((0,D.Z)(n),"shaderModuleService",Xp,(0,D.Z)(n)),Jt((0,D.Z)(n),"markerService",Fd,(0,D.Z)(n)),Jt((0,D.Z)(n),"popupService",Bd,(0,D.Z)(n)),(0,R.Z)((0,D.Z)(n),"inited",!1),(0,R.Z)((0,D.Z)(n),"initPromise",void 0),(0,R.Z)((0,D.Z)(n),"rendering",!1),(0,R.Z)((0,D.Z)(n),"$container",void 0),(0,R.Z)((0,D.Z)(n),"canvas",void 0),(0,R.Z)((0,D.Z)(n),"markerContainer",void 0),(0,R.Z)((0,D.Z)(n),"hooks",void 0),(0,R.Z)((0,D.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),tu(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,R.Z)((0,D.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new zc},n}return(0,Wt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,nn.Z)(En().mark(function p(){return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(wt.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,nn.Z)(En().mark(function p(){var v,g;return En().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Wn(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=mi("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:mh()(s.$container,s.handleWindowResized),Yi.matchMedia&&((g=Yi.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,nn.Z)(En().mark(function p(){return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(wt.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,nn.Z)(En().mark(function p(){var v;return En().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,nn.Z)(En().mark(function s(){return En().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=mi("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Zp.unbind)(this.$container,this.handleWindowResized),Yi.matchMedia){var v;(v=Yi.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=_a,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=_a,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(So.EventEmitter),g0=$t(_o.prototype,"id",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wc=$t(_o.prototype,"iconService",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=$t(_o.prototype,"fontService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld=$t(_o.prototype,"controlService",[op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_h=$t(_o.prototype,"configService",[Vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=$t(_o.prototype,"map",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh=$t(_o.prototype,"coordinateSystemService",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wp=$t(_o.prototype,"rendererService",[sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh=$t(_o.prototype,"layerService",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=$t(_o.prototype,"cameraService",[Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=$t(_o.prototype,"interactionService",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd=$t(_o.prototype,"pickingService",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=$t(_o.prototype,"shaderModuleService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fd=$t(_o.prototype,"markerService",[m0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=$t(_o.prototype,"popupService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_o))||To),ju=Q(44908),Sh=Q.n(ju);function b0(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var mc=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function E0(e){var i={};return e=e.replace(mc,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(b0(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var Nd,Pf;function up(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?up(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):up(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var lp="#define PI 3.14159265359",Yp=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,S0=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,C0=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,A0=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,w0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,zd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ud=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Xc=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,T0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Zd=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,jd=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,M0=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Vd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,P0=/precision\s+(high|low|medium)p\s+float/,I0=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Gd=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,O0=(Nd=(0,Nr.b2)(),Nd(Pf=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"moduleCache",{}),(0,R.Z)(this,"rawContentCache",{})}return(0,Wt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:lp,fs:lp}),this.registerModule("decode",{vs:Yp,fs:""}),this.registerModule("projection",{vs:Ud,fs:""}),this.registerModule("project",{vs:zd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Xc}),this.registerModule("lighting",{vs:C0,fs:""}),this.registerModule("light",{vs:S0,fs:""}),this.registerModule("picking",{vs:w0,fs:A0}),this.registerModule("styleMapping",{vs:T0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Vd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Zd,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:jd,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:M0,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=E0(a),g=v.content,x=v.uniforms,C=E0(s),w=C.content,O=C.uniforms;this.rawContentCache[r]={fs:w,uniforms:gc(gc(gc({},x),O),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,w=x.includeList,O=C,F=Sh()(g.concat(w).concat(r)).reduce(function(j,Y){return gc(gc({},j),n.rawContentCache[Y].uniforms)},{});return P0.test(C)||(O=I0+C),this.moduleCache[r]={fs:O.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(Gd,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var w=s.rawContentCache[C][a];n.push(C);var O=s.processModule(w,n,a),F=O.content;return F});return{content:p,includeList:n}}}]),e}())||Pf),If=Q(66213),Yc;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Yc||(Yc={}));var Ch,R0,Ah=(Ch=(0,Nr.b2)(),Ch(R0=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"shaderModuleService",void 0),(0,R.Z)(this,"rendererService",void 0),(0,R.Z)(this,"cameraService",void 0),(0,R.Z)(this,"mapService",void 0),(0,R.Z)(this,"interactionService",void 0),(0,R.Z)(this,"layerService",void 0),(0,R.Z)(this,"config",void 0)}return(0,Wt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Yc.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Zt.IRendererService),this.cameraService=r.getContainer().get(Zt.ICameraService),this.mapService=r.getContainer().get(Zt.IMapService),this.interactionService=r.getContainer().get(Zt.IInteractionService),this.layerService=r.getContainer().get(Zt.ILayerService),this.shaderModuleService=r.getContainer().get(Zt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||R0),k0,L0;function Tv(e){var i=Mv();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Mv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pv=(k0=(0,Nr.b2)(),k0(L0=function(e){(0,ln.Z)(r,e);var i=Tv(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,If.Z)((0,Tt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Ah))||L0),D0,F0,B0,Ml,wh;function N0(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Th(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Th(e,i){if(!!e){if(typeof e=="string")return Hd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hd(e,i)}}function Hd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Qx=(D0=(0,Nr.b2)(),F0=(0,Nr.f3)(Zt.IPostProcessor),D0(B0=(Ml=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"passes",[]),Jt(this,"postProcessor",wh,this),(0,R.Z)(this,"layer",void 0),(0,R.Z)(this,"renderFlag",void 0),(0,R.Z)(this,"width",0),(0,R.Z)(this,"height",0)}return(0,Wt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,nn.Z)(En().mark(function n(){var a,s,p;return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=N0(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Yc.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),wh=$t(Ml.prototype,"postProcessor",[F0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml))||B0),gm,ym;function _m(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_m(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_m(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jx(e){var i=eb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tb=(gm=(0,Nr.b2)(),gm(ym=function(e){(0,ln.Z)(r,e);var i=Jx(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"pickingFBO",void 0),(0,R.Z)((0,D.Z)(n),"layer",void 0),(0,R.Z)((0,D.Z)(n),"width",0),(0,R.Z)((0,D.Z)(n),"height",0),(0,R.Z)((0,D.Z)(n),"alreadyInRendering",!1),(0,R.Z)((0,D.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,w=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(w))){var O=n.rendererService,F=O.getViewportSize,j=O.readPixels,Y=O.useFramebuffer,ee=F(),ye=ee.width,Fe=ee.height,qe=n.layer.getLayerConfig(),rt=qe.enableHighlight,yt=qe.enableSelect,xt=g*_a,Yt=x*_a;if(!(xt>ye||xt<0||Yt>Fe||Yt<0)){var ur;Y(n.pickingFBO,function(){var Ir;if(ur=j({x:Math.round(xt),y:Math.round(Fe-(x+1)*_a),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ur[0]!==0||ur[1]!==0||ur[2]!==0){var tn=d(ur),br=n.layer.getSource().getFeatureById(tn),gn={x:g,y:x,type:w,lngLat:C,featureId:tn,feature:br};br&&(n.layer.setCurrentPickId(tn),n.triggerHoverOnLayer(gn))}else{var In={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(xm(xm({},In),{},{type:"unpick"})),n.triggerHoverOnLayer(In),n.layer.setCurrentPickId(null)}rt&&n.highlightPickedFeature(ur),yt&&w==="click"&&((Ir=ur)===null||Ir===void 0?void 0:Ir.toString())!==[0,0,0,0].toString()&&n.selectFeature(ur)})}}}),n}return(0,Wt.Z)(r,[{key:"getType",value:function(){return Yc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,If.Z)((0,Tt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),w=C.width,O=C.height;this.pickingFBO=g({color:v({width:w,height:O,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.interactionService.on(wt.Hover,this.pickFromPickingFBO),this.interactionService.on(wt.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(wt.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=v(),w=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==O)&&(this.pickingFBO.resize({width:w,height:O}),this.width=w,this.height=O),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,$n.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,$n.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=E(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=E(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(Ah))||ym),rb=Q(11700),nb=Q.n(rb),ib=Q(68929),ab=Q.n(ib),bm,Em,Sm,Iv,Cm;function Am(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Am(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Am(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ob=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cp=(bm=(0,Nr.b2)(),Em=(0,Nr.f3)(Zt.IShaderModuleService),bm(Sm=(Iv=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"shaderModuleService",Cm,this),(0,R.Z)(this,"rendererService",void 0),(0,R.Z)(this,"config",void 0),(0,R.Z)(this,"quad",ob),(0,R.Z)(this,"enabled",!0),(0,R.Z)(this,"renderToScreen",!1),(0,R.Z)(this,"model",void 0),(0,R.Z)(this,"name",void 0),(0,R.Z)(this,"optionsToUpdate",{})}return(0,Wt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Yc.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Zt.IRendererService),this.shaderModuleService=r.getContainer().get(Zt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,w=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:V.FLOAT}),size:2})},uniforms:Wd(Wd({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),w=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Wd({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[w,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Wd(Wd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Tl()(r[a])||(n["u_".concat(nb()(ab()(a)))]=r[a])}),n}}]),e}(),Cm=$t(Iv.prototype,"shaderModuleService",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv))||Sm),wm,Tm;function Mm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mm(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sb(e){var i=ub();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,cb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fb=(wm=(0,Nr.b2)(),wm(Tm=function(e){(0,ln.Z)(r,e);var i=sb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:cb,fs:lb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Pm(Pm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Tl()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Tl()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Tl()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(cp))||Tm),Im,Om;function Rm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rm(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pb(e){var i=hb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,vb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mb=(Im=(0,Nr.b2)(),Im(Om=function(e){(0,ln.Z)(r,e);var i=pb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:vb,fs:db});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:km(km({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Tl()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(cp))||Om),Lm,Dm;function Fm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fm(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gb(e){var i=yb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bb=(Lm=(0,Nr.b2)(),Lm(Dm=function(e){(0,ln.Z)(r,e);var i=gb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xb,fs:_b});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Bm(Bm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Tl()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(cp))||Dm),Nm,zm;function Um(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Um(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Um(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Eb(e){var i=Sb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wb=(Nm=(0,Nr.b2)(),Nm(zm=function(e){(0,ln.Z)(r,e);var i=Eb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ab,fs:Cb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Zm(Zm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(cp))||zm),jm,Vm;function Tb(e){var i=Mb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ib=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ob=(jm=(0,Nr.b2)(),jm(Vm=function(e){(0,ln.Z)(r,e);var i=Tb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Ib,fs:Pb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(cp))||Vm),Gm,Hm;function Wm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wm(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Rb(e){var i=kb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Db=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fb=(Gm=(0,Nr.b2)(),Gm(Hm=function(e){(0,ln.Z)(r,e);var i=Rb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Db,fs:Lb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Xm(Xm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(cp))||Hm),Ym,qm;function Km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Km(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bb(e){var i=Nb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zb=(Ym=(0,Nr.b2)(),Ym(qm=function(e){(0,ln.Z)(r,e);var i=Bb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ub,fs:zb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:$m($m({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(cp))||qm),Qm,Jm;function jb(e){var i=Vb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Hb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Wb=(Qm=(0,Nr.b2)(),Qm(Jm=function(e){(0,ln.Z)(r,e);var i=jb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Hb,fs:Gb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(cp))||Jm),eg,tg;function Xb(e){var i=Yb();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,$b=(eg=(0,Nr.b2)(),eg(tg=function(e){(0,ln.Z)(r,e);var i=Xb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:qb,fs:Kb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(cp))||tg),rg,ng,ig,ag,cd,og,Qb=(rg=(0,Nr.b2)(),ng=(0,Nr.f3)(Zt.IRendererService),ig=(0,Nr.zY)(),rg(ag=(cd=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"rendererService",og,this),(0,R.Z)(this,"passes",[]),(0,R.Z)(this,"readFBO",void 0),(0,R.Z)(this,"writeFBO",void 0)}return(0,Wt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,nn.Z)(En().mark(function p(){return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,nn.Z)(En().mark(function n(a,s){var p,v;return En().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,nn.Z)(En().mark(function n(a){var s,p;return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),og=$t(cd.prototype,"rendererService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$t(cd.prototype,"init",[ig],Object.getOwnPropertyDescriptor(cd.prototype,"init"),cd.prototype),cd))||ag),sg,ug;function Jb(e){var i=e2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t2=(sg=(0,Nr.b2)(),sg(ug=function(e){(0,ln.Z)(r,e);var i=Jb(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getType",value:function(){return Yc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,If.Z)((0,Tt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Ah))||ug),lg,cg,fg,Ov,pg;function hg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hg(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r2(e){var i=n2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,vg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,a2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function mg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var o2=1,s2=(lg=(0,Nr.b2)(),cg=(0,Nr.f3)(Zt.IShaderModuleService),lg(fg=(Ov=function(e){(0,ln.Z)(r,e);var i=r2(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Jt((0,D.Z)(n),"shaderModuleService",pg,(0,D.Z)(n)),(0,R.Z)((0,D.Z)(n),"haltonSequence",[]),(0,R.Z)((0,D.Z)(n),"accumulatingId",0),(0,R.Z)((0,D.Z)(n),"frame",0),(0,R.Z)((0,D.Z)(n),"timer",void 0),(0,R.Z)((0,D.Z)(n),"sampleRenderTarget",void 0),(0,R.Z)((0,D.Z)(n),"prevRenderTarget",void 0),(0,R.Z)((0,D.Z)(n),"outputRenderTarget",void 0),(0,R.Z)((0,D.Z)(n),"copyRenderTarget",void 0),(0,R.Z)((0,D.Z)(n),"blendModel",void 0),(0,R.Z)((0,D.Z)(n),"outputModel",void 0),(0,R.Z)((0,D.Z)(n),"copyModel",void 0),n}return(0,Wt.Z)(r,[{key:"getType",value:function(){return Yc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,If.Z)((0,Tt.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([mg(x,2),mg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",i2),this.outputModel=this.createTriangleModel("copy-pass",vg,{blend:{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE_MINUS_SRC_ALPHA,srcAlpha:V.ONE,dstAlpha:V.ONE_MINUS_SRC_ALPHA},equation:{rgb:V.FUNC_ADD,alpha:V.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",vg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,O=C.height;this.sampleRenderTarget.resize({width:w,height:O}),this.prevRenderTarget.resize({width:w,height:O}),this.outputRenderTarget.resize({width:w,height:O}),this.copyRenderTarget.resize({width:w,height:O}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function Y(ee){!s.accumulatingId||ee!==s.accumulatingId||s.isFinished()||(s.doRender(a),Yi.requestAnimationFrame(function(){Y(ee)}))};this.accumulatingId=o2++,this.timer=Yi.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,O=C.height,F=a.getLayerConfig(),j=F.jitterScale,Y=j===void 0?1:j,ee=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ee[0]*2-1)/w*Y,(ee[1]*2-1)/O*Y),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var ye=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:ye.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Fe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Fe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Yi.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:a2,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,w=this.rendererService,O=w.createAttribute,F=w.createBuffer,j=w.createModel;return j(dg({vs:g,fs:x,attributes:{a_Position:O({buffer:F({data:[-4,-4,4,-4,0,4],type:V.FLOAT}),size:2})},uniforms:dg({},C),depth:{enable:!1},count:3},p))}}]),r}(Ah),pg=$t(Ov.prototype,"shaderModuleService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov))||fg),Xd=new Nr.W2;Xd.bind(Zt.IGlobalConfigService).to(fr).inSingletonScope(),(0,Nr.GW)((0,Nr.b2)(),So.EventEmitter),Xd.bind(Zt.IEventEmitter).to(So.EventEmitter);var gg=(0,Kf.Z)(Xd,!1),Rv=function(i){var r=gg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},mP=function(i){var r=gg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},tc=Xd,u2=0;function l2(){var e=new Nr.W2;return e.parent=Xd,e.bind(Zt.SceneID).toConstantValue("".concat(u2++)),e.bind(Zt.IShaderModuleService).to(O0).inSingletonScope(),e.bind(Zt.ILayerService).to(Bp).inSingletonScope(),e.bind(Zt.ISceneService).to(x0).inSingletonScope(),e.bind(Zt.ICameraService).to(ni).inSingletonScope(),e.bind(Zt.ICoordinateSystemService).to(at).inSingletonScope(),e.bind(Zt.IInteractionService).to(ii).inSingletonScope(),e.bind(Zt.IPickingService).to(ou).inSingletonScope(),e.bind(Zt.IControlService).to(Ft).inSingletonScope(),e.bind(Zt.IMarkerService).to(Ui).inSingletonScope(),e.bind(Zt.IIconService).to(Ef).inSingletonScope(),e.bind(Zt.IFontService).to(Pd).inSingletonScope(),e.bind(Zt.IPopupService).to(Ze).inSingletonScope(),e.bind(Zt.INormalPass).to(Pv).whenTargetNamed("clear"),e.bind(Zt.INormalPass).to(tb).whenTargetNamed("pixelPicking"),e.bind(Zt.INormalPass).to(t2).whenTargetNamed("render"),e.bind(Zt.INormalPass).to(s2).whenTargetNamed("taa"),e.bind(Zt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Zt.INormalPass,r)}}),e.bind(Zt.IPostProcessingPass).to(Ob).whenTargetNamed("copy"),e.bind(Zt.IPostProcessingPass).to(fb).whenTargetNamed("bloom"),e.bind(Zt.IPostProcessingPass).to(mb).whenTargetNamed("blurH"),e.bind(Zt.IPostProcessingPass).to(bb).whenTargetNamed("blurV"),e.bind(Zt.IPostProcessingPass).to(Wb).whenTargetNamed("noise"),e.bind(Zt.IPostProcessingPass).to($b).whenTargetNamed("sepia"),e.bind(Zt.IPostProcessingPass).to(wb).whenTargetNamed("colorHalftone"),e.bind(Zt.IPostProcessingPass).to(Fb).whenTargetNamed("hexagonalPixelate"),e.bind(Zt.IPostProcessingPass).to(Zb).whenTargetNamed("ink"),e.bind(Zt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Zt.IPostProcessingPass,r);return n.setName(r),n}}),e}function yg(e){var i=new Nr.W2;return i.parent=e,i.bind(Zt.IStyleAttributeService).to(id).inSingletonScope(),i.bind(Zt.IMultiPassRenderer).to(Qx).inSingletonScope(),i.bind(Zt.IPostProcessor).to(Qb).inSingletonScope(),i}var gP=Q(74691),c2=null;function yP(e){return c2.indexOf(e)}var f2=2,_P=4,p2=64,xP=128,h2=256,d2=512,bP=8192,EP=16384,SP=32768,v2=null,_g=131072,CP=262144,m2=524288,AP=1048576,g2=2097152,wP=4194304,y2=8388608,_2=16777216,x2=null;function z0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function TP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],w=[],O=[],F=[z0(i[0],i[1]),z0(i[2],i[3])],j=[z0(v[0],v[1]),z0(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Y){var ee=_slicedToArray(Y,2),ye=ee[0],Fe=ee[1];C.push([].concat(F,[(ye+1)*y2+(Fe+1)*g2+getShapeIndex(s)*_g+r,(n+512)*m2+(a+512)*p2])),w.push([].concat(j,[g,x])),O.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:w,packedBuffer3:O}}function MP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*x2+r*_2+n*_g+r*v2+n*d2+r*h2+n*f2+r}var yc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(yc||(yc={}));var su;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(su||(su={}));var qp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(qp||(qp={}));var On;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(On||(On={}));var b2=["mapload","mapchange","mapAfterFrameChange"],Mh={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},kv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Kp;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Kp||(Kp={}));function xg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xg(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E2(e){var i=S2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C2=0,U0=function(e){(0,ln.Z)(r,e);var i=E2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this),(0,R.Z)((0,D.Z)(a),"controlOption",void 0),(0,R.Z)((0,D.Z)(a),"container",void 0),(0,R.Z)((0,D.Z)(a),"sceneContainer",void 0),(0,R.Z)((0,D.Z)(a),"mapsService",void 0),(0,R.Z)((0,D.Z)(a),"renderService",void 0),(0,R.Z)((0,D.Z)(a),"layerService",void 0),(0,R.Z)((0,D.Z)(a),"controlService",void 0),(0,R.Z)((0,D.Z)(a),"isShow",void 0),a.controlOption=bg(bg({},a.getDefault()),n||{}),a}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{position:Kp.TOPRIGHT,name:"".concat(C2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kp.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Zt.IMapService),this.renderService=a.get(Zt.IRendererService),this.layerService=a.get(Zt.ILayerService),this.controlService=a.get(Zt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return yu(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;yu(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Xs(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Bo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(So.EventEmitter);function A2(e){var i=w2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function w2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PP=function(e){(0,ln.Z)(r,e);var i=A2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this,n),(0,R.Z)((0,D.Z)(a),"layerControlInputs",void 0),(0,R.Z)((0,D.Z)(a),"layers",void 0),(0,R.Z)((0,D.Z)(a),"lastZIndex",void 0),(0,R.Z)((0,D.Z)(a),"handlingClick",void 0),(0,R.Z)((0,D.Z)(a),"layersLink",void 0),(0,R.Z)((0,D.Z)(a),"baseLayersList",void 0),(0,R.Z)((0,D.Z)(a),"separator",void 0),(0,R.Z)((0,D.Z)(a),"overlaysList",void 0),(0,R.Z)((0,D.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),ml(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,D.Z)(a)),a}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Kp.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;yu(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(yu(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):Xs(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Xs(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=mi("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=mi("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=mi("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=mi("div",a+"-base",v),this.separator=mi("div",a+"-separator",v),this.overlaysList=mi("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,w){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,w){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;sc(this.baseLayersList),sc(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,g=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(w,O){return x(w.layer,O.layer,w.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var w=a.overlay?this.overlaysList:this.baseLayersList;return w.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(U0);function T2(e){var i=M2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function M2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P2=function(e){(0,ln.Z)(r,e);var i=T2(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{position:Kp.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=mi("div",a),p=mi("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(U0);function I2(e){var i=O2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IP=function(e){(0,ln.Z)(r,e);var i=I2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this,n),(0,R.Z)((0,D.Z)(a),"mScale",void 0),(0,R.Z)((0,D.Z)(a),"iScale",void 0),ml(["update"],(0,D.Z)(a)),a}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{position:Kp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=mi("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=jl([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,g;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,g=p.imperial;v&&(this.mScale=mi("div",a,s)),g&&(this.iScale=mi("div",a,s))}}]),r}(U0);function R2(e){var i=k2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OP=function(e){(0,ln.Z)(r,e);var i=R2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this,n),(0,R.Z)((0,D.Z)(a),"disabled",void 0),(0,R.Z)((0,D.Z)(a),"zoomInButton",void 0),(0,R.Z)((0,D.Z)(a),"zoomOutButton",void 0),ml(["updateDisabled","zoomIn","zoomOut"],(0,D.Z)(a)),a}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{position:Kp.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=mi("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,g){var x=mi("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Xs(this.zoomInButton,s),Xs(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&yu(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&yu(this.zoomInButton,s)}}]),r}(U0);function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function L2(e){var i=D2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cg=function(e){(0,ln.Z)(r,e);var i=L2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this),(0,R.Z)((0,D.Z)(a),"markerOption",void 0),(0,R.Z)((0,D.Z)(a),"defaultMarker",void 0),(0,R.Z)((0,D.Z)(a),"popup",void 0),(0,R.Z)((0,D.Z)(a),"mapsService",void 0),(0,R.Z)((0,D.Z)(a),"sceneSerive",void 0),(0,R.Z)((0,D.Z)(a),"lngLat",void 0),(0,R.Z)((0,D.Z)(a),"scene",void 0),(0,R.Z)((0,D.Z)(a),"added",!1),(0,R.Z)((0,D.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Sg(Sg({},a.getDefault()),n),ml(["update","onMove","onUp","addDragHandler","onMapClick"],(0,D.Z)(a)),a.init(),a}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:M.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Zt.IMapService),this.sceneSerive=a.get(Zt.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&Bo(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&Bo(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),uf(s,"".concat(k[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),w=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),F=0,j=0;if(O&&(F=O.scrollWidth,j=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(w.x>F){var Y=this.mapsService.lngLatToContainer([g-360,x]);w.x=Y.x}if(w.x<0){var ee=this.mapsService.lngLatToContainer([g+360,x]);w.x=ee.x}}(w.x>F||w.x<0||w.y>j||w.y<0)&&(s.style.display="none"),s.style.left=w.x+p[0]+"px",s.style.top=w.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=mi("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}yu(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var O,F,j=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[w]);s&&(s.style[w]=j)}),s.addEventListener("click",function(w){a.onMapClick(w)}),s.addEventListener("click",this.eventHandle),U(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(So.EventEmitter);function Ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ag(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F2(e){var i=B2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RP=function(e){(0,ln.Z)(r,e);var i=F2(r);function r(n){var a,s;return(0,Vt.Z)(this,r),s=i.call(this),(0,R.Z)((0,D.Z)(s),"markers",[]),(0,R.Z)((0,D.Z)(s),"markerLayerOption",void 0),(0,R.Z)((0,D.Z)(s),"clusterIndex",void 0),(0,R.Z)((0,D.Z)(s),"points",[]),(0,R.Z)((0,D.Z)(s),"clusterMarkers",[]),(0,R.Z)((0,D.Z)(s),"mapsService",void 0),(0,R.Z)((0,D.Z)(s),"scene",void 0),(0,R.Z)((0,D.Z)(s),"zoom",void 0),(0,R.Z)((0,D.Z)(s),"bbox",void 0),s.markerLayerOption=At()(s.getDefault(),n),ml(["update"],(0,D.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Wt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Zt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var p=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=Vl(v,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:wg(wg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(hu())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,w=p.markerLayerOption.clusterOption,O=w.field,F=w.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var j,Y=p.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=Y,O&&F){var ee=Y==null?void 0:Y.map(function(yt){var xt=(0,R.Z)({},O,yt.properties[O]);return xt}),ye=Qe(ee,O),Fe=dt(F,ye),qe="point_"+F;x.properties[qe]=Fe.toFixed(2)}}var rt=p.clusterMarker(x);p.clusterMarkers.push(rt),rt.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,g=v===void 0?this.generateElement.bind(this):v,x=new Cg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Gl(this.bbox,s))&&(this.bbox=Vl(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=mi("div","l7-marker-cluster"),p=mi("div","",s),v=mi("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var w=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=w,s}}]),r}(So.EventEmitter);function Tg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Tg(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function N2(e){var i=z2();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pg=function(e){(0,ln.Z)(r,e);var i=N2(r);function r(n){var a;return(0,Vt.Z)(this,r),a=i.call(this),(0,R.Z)((0,D.Z)(a),"popupOption",void 0),(0,R.Z)((0,D.Z)(a),"mapsService",void 0),(0,R.Z)((0,D.Z)(a),"sceneSerive",void 0),(0,R.Z)((0,D.Z)(a),"lngLat",void 0),(0,R.Z)((0,D.Z)(a),"content",void 0),(0,R.Z)((0,D.Z)(a),"closeButton",void 0),(0,R.Z)((0,D.Z)(a),"timeoutInstance",void 0),(0,R.Z)((0,D.Z)(a),"container",void 0),(0,R.Z)((0,D.Z)(a),"tip",void 0),(0,R.Z)((0,D.Z)(a),"scene",void 0),a.popupOption=Mg(Mg({},a.getdefault()),n),ml(["update","onClickClose","remove"],(0,D.Z)(a)),a}return(0,Wt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Zt.IMapService),this.sceneSerive=a.get(Zt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Bo(this.content),this.content=mi("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=mi("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:M.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var w=this.popupOption.stopPropagation;w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),uf(this.container,"".concat(k[x])),U(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(So.EventEmitter);function U2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}U2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Z2=Q(52353),j2=Q.n(Z2),V2=Q(13218),Vu=Q.n(V2),$p,Ig=($p={},(0,R.Z)($p,yc.additive,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE,srcAlpha:1,dstAlpha:1}}),(0,R.Z)($p,yc.none,{enable:!1}),(0,R.Z)($p,yc.normal,{enable:!0,func:{srcRGB:V.SRC_ALPHA,dstRGB:V.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,R.Z)($p,yc.subtractive,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE,srcAlpha:V.ZERO,dstAlpha:V.ONE_MINUS_SRC_COLOR},equation:{rgb:V.FUNC_SUBTRACT,alpha:V.FUNC_SUBTRACT}}),(0,R.Z)($p,yc.max,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE},equation:{rgb:V.MAX_EXT}}),(0,R.Z)($p,yc.min,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE},equation:{rgb:V.MIN_EXT}}),$p),G2=Q(81763),ca=Q.n(G2),kP=1024;function el(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function H2(e,i){e.opacity&&Z0("opacity",i,e.opacity),e.strokeWidth&&Z0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Z0("strokeOpacity",i,e.strokeOpacity),e.stroke&&W2("stroke",i,e.stroke),e.offsets&&Og("offsets",i,e.offsets),e.textOffset&&Og("textOffset",i,e.textOffset),e.thetaOffset&&Z0("thetaOffset",i,e.thetaOffset)}function Z0(e,i,r){Ur()(r)?el(e,i,r,function(n){return n}):ca()(r)?el(e,i,[r],void 0):Array.isArray(r)&&r.length===2?Ur()(r[0])&&kn()(r[1])||Ur()(r[0])&&Array.isArray(r[1])&&ca()(r[1][0])&&ca()(r[1][1])?el(e,i,r[0],r[1]):el(e,i,[1],void 0):el(e,i,[1],void 0)}function Og(e,i,r){Ur()(r)?el(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&Ur()(r[0])&&kn()(r[1])?el(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ca()(r[0])&&ca()(r[1])?el(e,i,r,void 0):el(e,i,[0,0],void 0)}function W2(e,i,r){Ur()(r)?el(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(Ur()(r[0])&&kn()(r[1])||Ur()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?el(e,i,r[0],r[1]):el(e,i,"#fff",void 0)}var js;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(js||(js={}));function X2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=pf(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function Y2(e,i){var r=this;e.length>0&&i.version===js["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=js["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=js["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function q2(e,i){e.length>0&&i.version===js.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=K2(r.coordinates,i),r.simpleCoordinate=!0)})}function K2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(p){s.push(i.simpleMapCoord.unproject(p))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function $2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var p=e.mapping?e.mapping(s):[];return e.name==="color"&&!f(p[0])?[r]:p}function Q2(e,i,r,n,a,s){var p=s==null?void 0:s.getLayerConfig(),v=p.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var w={id:C._id,coordinates:C.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var Y=$2(j,C,a);j.needRemapping=!1,j.name==="color"&&(Y=Y.map(function(ee){return c(ee)})),w[j.name]=Array.isArray(Y)&&Y.length===1?Y[0]:Y,j.name==="shape"&&(w.shape=r.getIconFontKey(w[j.name]))}),w.shape==="line"&&g.enable){var O=w.coordinates,F=X2(O[0],O[1]);w.coordinates.splice(1,0,F,F)}return w});return Y2(x,n),q2(x,n),x}function J2(e,i,r,n,a,s){var p=new Ns(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=p.data.dataArray,C=x,w=Q2(g,C,i,r,v,e);return p.destroy(),w}function Rg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function kg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Rg(i).forEach(function(g){var x=(0,$n.Z)(g,2),C=x[0],w=x[1];a.add(r(C),w)}),a.add(r("copy")),a}var eE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function tE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}eE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var rE=["passes"],nE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Lg,Lv,Dg;function iE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function aE(e,i){if(!!e){if(typeof e=="string")return Fg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fg(e,i)}}function Fg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bg(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oE(e){var i=sE();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ng=0,Qp=(Lg=Rv(Zt.IGlobalConfigService),Lv=function(e){(0,ln.Z)(r,e);var i=oE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Vt.Z)(this,r),n=i.call(this),(0,R.Z)((0,D.Z)(n),"id","".concat(Ng++)),(0,R.Z)((0,D.Z)(n),"name","".concat(Ng)),(0,R.Z)((0,D.Z)(n),"type",void 0),(0,R.Z)((0,D.Z)(n),"visible",!0),(0,R.Z)((0,D.Z)(n),"zIndex",0),(0,R.Z)((0,D.Z)(n),"minZoom",void 0),(0,R.Z)((0,D.Z)(n),"maxZoom",void 0),(0,R.Z)((0,D.Z)(n),"inited",!1),(0,R.Z)((0,D.Z)(n),"layerModelNeedUpdate",!1),(0,R.Z)((0,D.Z)(n),"pickedFeatureID",null),(0,R.Z)((0,D.Z)(n),"selectedFeatureID",null),(0,R.Z)((0,D.Z)(n),"styleNeedUpdate",!1),(0,R.Z)((0,D.Z)(n),"rendering",void 0),(0,R.Z)((0,D.Z)(n),"clusterZoom",0),(0,R.Z)((0,D.Z)(n),"layerType",void 0),(0,R.Z)((0,D.Z)(n),"isLayerGroup",!1),(0,R.Z)((0,D.Z)(n),"triangulation",void 0),(0,R.Z)((0,D.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,R.Z)((0,D.Z)(n),"hooks",{init:new xl,afterInit:new xl,beforeRender:new xl,beforeRenderData:new au,afterRender:new Ri,beforePickingEncode:new Ri,afterPickingEncode:new Ri,beforeHighlight:new Ri(["pickedColor"]),afterHighlight:new Ri,beforeSelect:new Ri(["pickedColor"]),afterSelect:new Ri,beforeDestroy:new Ri,afterDestroy:new Ri}),(0,R.Z)((0,D.Z)(n),"models",[]),(0,R.Z)((0,D.Z)(n),"multiPassRenderer",void 0),(0,R.Z)((0,D.Z)(n),"plugins",void 0),(0,R.Z)((0,D.Z)(n),"sourceOption",void 0),(0,R.Z)((0,D.Z)(n),"layerModel",void 0),(0,R.Z)((0,D.Z)(n),"shapeOption",void 0),(0,R.Z)((0,D.Z)(n),"sceneContainer",void 0),(0,R.Z)((0,D.Z)(n),"layerChildren",[]),(0,R.Z)((0,D.Z)(n),"masks",[]),Jt((0,D.Z)(n),"configService",Dg,(0,D.Z)(n)),(0,R.Z)((0,D.Z)(n),"shaderModuleService",void 0),(0,R.Z)((0,D.Z)(n),"cameraService",void 0),(0,R.Z)((0,D.Z)(n),"coordinateService",void 0),(0,R.Z)((0,D.Z)(n),"iconService",void 0),(0,R.Z)((0,D.Z)(n),"fontService",void 0),(0,R.Z)((0,D.Z)(n),"pickingService",void 0),(0,R.Z)((0,D.Z)(n),"rendererService",void 0),(0,R.Z)((0,D.Z)(n),"layerService",void 0),(0,R.Z)((0,D.Z)(n),"interactionService",void 0),(0,R.Z)((0,D.Z)(n),"mapService",void 0),(0,R.Z)((0,D.Z)(n),"styleAttributeService",void 0),(0,R.Z)((0,D.Z)(n),"layerSource",void 0),(0,R.Z)((0,D.Z)(n),"postProcessingPassFactory",void 0),(0,R.Z)((0,D.Z)(n),"normalPassFactory",void 0),(0,R.Z)((0,D.Z)(n),"animateOptions",{enable:!1}),(0,R.Z)((0,D.Z)(n),"container",void 0),(0,R.Z)((0,D.Z)(n),"encodedData",void 0),(0,R.Z)((0,D.Z)(n),"configSchema",void 0),(0,R.Z)((0,D.Z)(n),"currentPickId",null),(0,R.Z)((0,D.Z)(n),"rawConfig",void 0),(0,R.Z)((0,D.Z)(n),"needUpdateConfig",void 0),(0,R.Z)((0,D.Z)(n),"pendingStyleAttributes",[]),(0,R.Z)((0,D.Z)(n),"scaleOptions",{}),(0,R.Z)((0,D.Z)(n),"animateStartTime",void 0),(0,R.Z)((0,D.Z)(n),"aniamateStatus",!1),(0,R.Z)((0,D.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,R.Z)((0,D.Z)(n),"isDestroied",!1),(0,R.Z)((0,D.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Wt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Gu(Gu({},this.needUpdateConfig),a);else{var s=this.container.get(Zt.SceneID);H2(a,this),this.configService.setLayerConfig(s,this.id,Gu(Gu(Gu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Zt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Zt.IIconService),this.fontService=this.container.get(Zt.IFontService),this.rendererService=this.container.get(Zt.IRendererService),this.layerService=this.container.get(Zt.ILayerService),this.interactionService=this.container.get(Zt.IInteractionService),this.pickingService=this.container.get(Zt.IPickingService),this.mapService=this.container.get(Zt.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,g=p.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Zt.ICameraService),this.coordinateService=this.container.get(Zt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Zt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Zt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Zt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Zt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Zt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var F=O.attributeName,j=O.attributeField,Y=O.attributeValues,ee=O.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Gu({field:j},a.splitValuesAndCallbackInAttribute(Y,a.getLayerConfig()[F]))},ee)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Zt.ILayerPlugin);var x=iE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var p=this.calculateEncodeData(a,s),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?J2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Gu(Gu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,w=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),tE(this,C,w),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Vu()(a)?(s.enable=!0,s=Gu(Gu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=p.getSource();v?p.layerSource.setData(a,s):(p.source(new Ns(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=this.getLayerConfig(),v=a.passes,g=(0,Zu.Z)(a,rE);return v&&Rg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Gu(Gu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),p&&p.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Vu()(a)?this.scaleOptions=Gu(Gu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,nn.Z)(En().mark(function s(){return En().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Vu()(a)?!0:a,Vu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Vu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Vu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Vu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(E(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Vu()(a)?!0:a,Vu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Vu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Vu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Vu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(E(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,g=v===void 0?[]:v;this.multiPassRenderer=kg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,w=x.height;this.multiPassRenderer.resize(C,w)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,R.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,R.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!j2()(x)}).map(function(x){return(0,R.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,Zu.Z)(a,nE);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var w=this.shaderModuleService.getModule(s),O=w.vs,F=w.fs,j=w.uniforms,Y=this.rendererService.createModel,ee=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),ye=ee.attributes,Fe=ee.elements;return Y(Gu({attributes:ye,uniforms:j,fs:F,vs:O,elements:Fe,blend:Ig[yc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,p=this.styleAttributeService.createAttributes(this.encodedData,s),v=p.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,nn.Z)(En().mark(function s(p){return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Gu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:kn()(a)?void 0:a||s,callback:kn()(a)?a:void 0}}}]),r}(So.EventEmitter),Dg=$t(Lv.prototype,"configService",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv),uE=Q(18446),fd=Q.n(uE),zg,Dv,Ug;function lE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function cE(e,i){if(!!e){if(typeof e=="string")return Zg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zg(e,i)}}function Zg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var xo=(zg=Rv(Zt.IGlobalConfigService),Dv=function(){function e(i){(0,Vt.Z)(this,e),(0,R.Z)(this,"triangulation",void 0),(0,R.Z)(this,"createTexture2D",void 0),(0,R.Z)(this,"layer",void 0),(0,R.Z)(this,"dataTexture",void 0),(0,R.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,R.Z)(this,"rowCount",void 0),(0,R.Z)(this,"cacheStyleProperties",void 0),(0,R.Z)(this,"cellLength",void 0),(0,R.Z)(this,"cellProperties",void 0),(0,R.Z)(this,"cellTypeLayout",void 0),(0,R.Z)(this,"stylePropertyesExist",void 0),(0,R.Z)(this,"dataTextureTest",void 0),Jt(this,"configService",Ug,this),(0,R.Z)(this,"shaderModuleService",void 0),(0,R.Z)(this,"rendererService",void 0),(0,R.Z)(this,"iconService",void 0),(0,R.Z)(this,"fontService",void 0),(0,R.Z)(this,"styleAttributeService",void 0),(0,R.Z)(this,"mapService",void 0),(0,R.Z)(this,"cameraService",void 0),(0,R.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Zt.IRendererService),this.shaderModuleService=i.getContainer().get(Zt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Zt.IStyleAttributeService),this.mapService=i.getContainer().get(Zt.IMapService),this.iconService=i.getContainer().get(Zt.IIconService),this.fontService=i.getContainer().get(Zt.IFontService),this.cameraService=i.getContainer().get(Zt.ICameraService),this.layerService=i.getContainer().get(Zt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:V.NEAREST,min:V.NEAREST,width:1,height:1}))}return(0,Wt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return fd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),fd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),fd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),fd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),fd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),fd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ca()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ca()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ca()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ca()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Ur()(r)?!!(0,l.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=c(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ca()(r[0])&&ca()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=lE(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,sn.Z)(c(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(ca()(C)?C:1):this.patchMod(r,x)}}catch(w){s.e(w)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var w=g.length;w<v;w++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Ig[yc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Ug=$t(Dv.prototype,"configService",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv),fE=Q(9187),Of=Q.n(fE),jg=100,LP=36,DP=40;function Vg(e){return e/180*Math.acos(-1)}function Gg(e){var i=Vg(e[0])+Math.PI/2,r=Vg(e[1]),n=jg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function FP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,g=2*v,x=[],C=[],w=[],O=[],F=[],j=[],Y=0;Y<=v;Y++){for(var ee=Y/v,ye=ee*Math.PI,Fe=0;Fe<=g;Fe++){var qe=Fe/g,rt=qe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-ye),mat4.identity(r),mat4.rotateY(r,r,rt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),w.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),j.push([qe,1-ee]),O.push(qe,1-ee)}if(Y>0)for(var yt=w.length,xt=yt-2*(g+1);xt+g+2<yt;xt++)x.push([xt,xt+1,xt+g+1]),C.push(xt,xt+1,xt+g+1),x.push([xt+g+1,xt+1,xt+g+2]),C.push(xt+g+1,xt+1,xt+g+2)}return{cells:x,positions:w,uvs:j,positionsArr:O,indicesArr:C,normalArr:F}}var xi=Q(31437),j0=xi.create(),BP=xi.create(),$s=xi.create(),Jp=xi.create(),pd=xi.create();function Fv(e,i,r,n,a){xi.add(e,r,n),xi.normalize(e,e),i=xi.fromValues(-e[1],e[0]);var s=xi.fromValues(-r[1],r[0]);return[a/xi.dot(i,s),i]}function eh(e,i){return xi.set(e,-i[1],i[0])}function hd(e,i,r){return xi.sub(e,i,r),xi.normalize(e,e),e}function Bv(e,i){return e[0]===i[0]&&e[1]===i[1]}function NP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Hg=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Vt.Z)(this,e),(0,R.Z)(this,"complex",void 0),(0,R.Z)(this,"join",void 0),(0,R.Z)(this,"cap",void 0),(0,R.Z)(this,"miterLimit",void 0),(0,R.Z)(this,"thickness",void 0),(0,R.Z)(this,"normal",void 0),(0,R.Z)(this,"lastFlip",-1),(0,R.Z)(this,"miter",xi.fromValues(0,0)),(0,R.Z)(this,"started",!1),(0,R.Z)(this,"dash",!1),(0,R.Z)(this,"totalDistance",0),(0,R.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Wt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,w=r[v-1];w.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,sn.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ee=v<n.length-1?n[v+1]:null,ye=this.segment_gaode2(a,p,w,F,Y,O,j,ee);p+=ye}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,w=r[v-1];w.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],Y=v<r.length-1?[].concat((0,sn.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ee=v<n.length-1?n[v+1]:null,ye=this.simpleSegment(a,p,w,F,Y,O,j,ee);p+=ye}if(this.dash)for(var Fe=0;Fe<a.positions.length/6;Fe++)a.positions[Fe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,g,x){var C=0,w=r.indices,O=r.positions,F=r.normals,j=this.cap==="square",Y=this.join==="bevel",ee=zo([g[0],g[1]]),ye=zo([v[0],v[1]]);hd($s,s,a);var Fe=0;if(this.dash&&(Fe=this.lineSegmentDistance(ee,ye),this.totalDistance+=Fe),this.normal||(this.normal=xi.create(),eh(this.normal,$s)),!this.started)if(this.started=!0,j){var qe=xi.create(),rt=xi.create();xi.add(qe,this.normal,$s),xi.add(rt,this.normal,$s),F.push(rt[0],rt[1],0),F.push(qe[0],qe[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Fe,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,a,this.normal,this.thickness,this.totalDistance-Fe);if(w.push(n+0,n+1,n+2),p){Bv(s,p)&&xi.add(p,s,xi.normalize(p,xi.subtract(p,s,a))),hd(Jp,p,s);var Yt=Fv(pd,xi.create(),$s,Jp,this.thickness),ur=(0,$n.Z)(Yt,2),Ir=ur[0],tn=ur[1],br=xi.dot(pd,this.normal)<0?-1:1,gn=Y;if(!gn&&this.join==="miter"){var In=Ir;In>this.miterLimit&&(gn=!0)}gn?(F.push(this.normal[0],this.normal[1],0),F.push(tn[0],tn[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,sn.Z)(this.lastFlip!==-br?[n,n+2,n+3]:[n+2,n+1,n+3])),w.push(n+2,n+3,n+4),eh(j0,Jp),xi.copy(this.normal,j0),F.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,F,s,tn,Ir,this.totalDistance),w.push.apply(w,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),br=-1,xi.copy(this.normal,tn),C+=2),this.lastFlip=br}else{if(eh(this.normal,$s),j){var yt=xi.create(),xt=xi.create();xi.sub(xt,$s,this.normal),xi.add(yt,$s,this.normal),F.push(xt[0],xt[1],0),F.push(yt[0],yt[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,s,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,w=zo([s[0],s[1]]),O=zo([a[0],a[1]]);hd($s,w,O);var F=0;if(this.dash&&(F=this.lineSegmentDistance(w,O),this.totalDistance+=F),this.normal||(this.normal=xi.create(),eh(this.normal,$s)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-F)),g.push(n+0,n+1,n+2),!p)eh(this.normal,$s),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=zo([p[0],p[1]]);Bv(w,j)&&xi.add(j,w,xi.normalize(j,xi.subtract(j,w,O))),hd(Jp,j,w);var Y=Fv(pd,xi.create(),$s,Jp,this.thickness),ee=(0,$n.Z)(Y,2),ye=ee[0],Fe=ee[1],qe=xi.dot(pd,this.normal)<0?-1:1;this.extrusions(x,C,s,Fe,ye,this.totalDistance),g.push.apply(g,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),qe=-1,xi.copy(this.normal,Fe),v+=2,this.lastFlip=qe}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,w=this.cap==="square",O=this.join==="bevel",F=zo([s[0],s[1]]),j=zo([a[0],a[1]]);hd($s,F,j);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(F,j),this.totalDistance+=Y),this.normal||(this.normal=xi.create(),eh(this.normal,$s)),!this.started)if(this.started=!0,w){var ee=xi.create(),ye=xi.create();xi.add(ee,this.normal,$s),xi.add(ye,this.normal,$s),C.push(ye[0],ye[1],0),C.push(ee[0],ee[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-Y,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-Y);if(g.push(n+0,n+1,n+2),p){var rt=zo([p[0],p[1]]);Bv(F,rt)&&xi.add(rt,F,xi.normalize(rt,xi.subtract(rt,F,j))),hd(Jp,rt,F);var yt=Fv(pd,xi.create(),$s,Jp,this.thickness),xt=(0,$n.Z)(yt,2),Yt=xt[0],ur=xt[1],Ir=xi.dot(pd,this.normal)<0?-1:1,tn=O;if(!tn&&this.join==="miter"){var br=Yt;br>this.miterLimit&&(tn=!0)}tn?(C.push(this.normal[0],this.normal[1],0),C.push(ur[0],ur[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,sn.Z)(this.lastFlip!==-Ir?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),eh(j0,Jp),xi.copy(this.normal,j0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Ir,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,ur,Yt,this.totalDistance),g.push.apply(g,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ir=-1,xi.copy(this.normal,ur),v+=2),this.lastFlip=Ir}else{if(eh(this.normal,$s),w){var Fe=xi.create(),qe=xi.create();xi.sub(qe,$s,this.normal),xi.add(Fe,$s,this.normal),C.push(qe[0],qe[1],0),C.push(Fe[0],Fe[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,sn.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Ph(e){if(ca()(e[0]))return e;if(ca()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ca()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function pE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var qa=Q(77160);function hE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Of().flatten(e),s=a.vertices,p=a.dimensions,v=[],g=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Of()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,sn.Z)(C));for(var w=function(j){var Y=a.vertices.slice(j*p,(j+1)*p),ee=a.vertices.slice((j+1)*p,(j+2)*p);ee.length===0&&(ee=a.vertices.slice(0,p));var ye=v.length/3;v.push(Y[0],Y[1],1,ee[0],ee[1],1,Y[0],Y[1],0,ee[0],ee[1],0),g.push.apply(g,(0,sn.Z)([0,2,1,2,3,1].map(function(Fe){return Fe+ye})))},O=0;O<n;O++)w(O);return{positions:v,index:g}}function dE(e){var i=Of().flatten(e),r=Of()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Wg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Of().flatten(e),p=s.vertices,v=s.dimensions,g=[],x=[],C=[],w=0;w<p.length/v;w++)v===2?g.push(p[w*2],p[w*2+1],1,-1,-1):g.push(p[w*3],p[w*3+1],1,-1,-1),C.push(0,0,1);var O=Of()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,sn.Z)(O));for(var F=function(ee){var ye=s.vertices.slice(ee*v,(ee+1)*v),Fe=s.vertices.slice((ee+1)*v,(ee+2)*v);Fe.length===0&&(Fe=s.vertices.slice(0,v));var qe=g.length/5;g.push(ye[0],ye[1],1,0,0,Fe[0],Fe[1],1,.1,0,ye[0],ye[1],0,0,.8,Fe[0],Fe[1],0,.1,.8);var rt=vE([Fe[0],Fe[1],1],[ye[0],ye[1],0],[ye[0],ye[1],1],i);C.push.apply(C,(0,sn.Z)(rt).concat((0,sn.Z)(rt),(0,sn.Z)(rt),(0,sn.Z)(rt))),x.push.apply(x,(0,sn.Z)([1,2,0,3,2,1].map(function(yt){return yt+qe})))},j=0;j<a;j++)F(j);return{positions:g,index:x,normals:C}}function vE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=qa.create(),s=qa.create(),p=qa.create();n&&(e=Wu(e),i=Wu(i),r=Wu(r));var v=qa.fromValues.apply(qa,(0,sn.Z)(e)),g=qa.fromValues.apply(qa,(0,sn.Z)(i)),x=qa.fromValues.apply(qa,(0,sn.Z)(r));qa.sub(a,x,g),qa.sub(s,v,g),qa.cross(p,a,s);var C=qa.create();return qa.normalize(C,p),C}var _c,Ih;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Ih||(Ih={}));var Oh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Oh||(Oh={}));function Yd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[v,g,0]});return s}function Xg(){return Yd(30)}function Yg(){return Yd(4)}function qg(){return Yd(3)}function Kg(){return Yd(6,1)}function $g(){return Yd(5)}var dd=(_c={},(0,R.Z)(_c,Oh.CIRCLE,Xg),(0,R.Z)(_c,Oh.HEXAGON,Kg),(0,R.Z)(_c,Oh.TRIANGLE,qg),(0,R.Z)(_c,Oh.SQUARE,Yg),(0,R.Z)(_c,Oh.PENTAGON,$g),(0,R.Z)(_c,Ih.CYLINDER,Xg),(0,R.Z)(_c,Ih.HEXAGONCOLUMN,Kg),(0,R.Z)(_c,Ih.TRIANGLECOLUMN,qg),(0,R.Z)(_c,Ih.SQUARECOLUMN,Yg),(0,R.Z)(_c,Ih.PENTAGONCOLUMN,$g),_c),V0={};function Rh(e){var i=Ph(e.coordinates);return{vertices:[].concat((0,sn.Z)(i),(0,sn.Z)(i),(0,sn.Z)(i),(0,sn.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Qg(e){var i=Ph(e.coordinates),r=Gg(i);return{vertices:[].concat((0,sn.Z)(r),(0,sn.Z)(r),(0,sn.Z)(r),(0,sn.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Jg(e){var i=e.shape,r=yE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function ey(e){var i=Ph(e.coordinates);return{vertices:(0,sn.Z)(i),indices:[0],size:i.length}}function qd(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Hg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function mE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Hg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function Kd(e){var i=e.coordinates,r=Of().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(n,s,a),vertices:n,size:a}}function ty(e){var i=e.coordinates,r=Of().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(n,s,a),vertices:gE(n),size:a+4}}function gE(e){for(var i=[],r=pE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,sn.Z)(n),[a]))}return i}function ry(e){var i=e.coordinates,r=Wg(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function ny(e){var i=e.shape,r=xE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function iy(e){var i=e.coordinates,r=[].concat((0,sn.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,sn.Z)(i[1]),[0,1,0],(0,sn.Z)(i[0]),[0,0,1],(0,sn.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function G0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,sn.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function ay(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=H0(-1,1),a=H0(1,1),s=H0(-1,-1),p=H0(1,-1),v=[].concat((0,sn.Z)(i),(0,sn.Z)(n),(0,sn.Z)(i),(0,sn.Z)(s),(0,sn.Z)(i),(0,sn.Z)(p),(0,sn.Z)(i),(0,sn.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function yE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(V0&&V0[e])return V0[e];var r=dd[e]?dd[e]():dd.cylinder(),n=Wg([r],i);return V0[e]=n,n}function zP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),w=0,O=i.length;w<O;w+=3){s=i[w+0]*3,p=i[w+1]*3,v=i[w+2]*3;var F=[e[s],e[s+1]],j=[e[p],e[p+1]],Y=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),j=lngLatToMeters(j),Y=lngLatToMeters(Y));var ee=F,ye=_slicedToArray(ee,2),Fe=ye[0],qe=ye[1],rt=vec3.fromValues(Fe,qe,e[s+2]),yt=j,xt=_slicedToArray(yt,2),Yt=xt[0],ur=xt[1],Ir=vec3.fromValues(Yt,ur,e[p+2]),tn=Y,br=_slicedToArray(tn,2),gn=br[0],In=br[1],qn=vec3.fromValues(gn,In,e[v+2]);vec3.sub(g,qn,Ir),vec3.sub(x,rt,Ir),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return _E(a),a}function _E(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function UP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function xE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=dd[e]?dd[e]():dd.circle(),n=i.indexOf(e)===-1?dE([r]):hE([r]);return n}function H0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function ZP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function jP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function bE(e){var i=EE();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function EE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SE=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,CE=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,AE=function(e){(0,ln.Z)(r,e);var i=bE(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?0:s;return{u_opacity:ca()(p)?p:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:CE,fragmentShader:SE,triangulation:Kd,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:V.ALWAYS,ref:1,mask:255},opFront:{fail:V.REPLACE,zfail:V.REPLACE,zpass:V.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(xo),wE={fill:AE},TE=wE;function ME(e){var i=PE();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function PE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IE=function(e){(0,ln.Z)(r,e);var i=ME(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","MaskLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new TE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(Qp),OE=Q(88307),RE=Q.n(OE),kE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"attribute",void 0),(0,R.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,Wt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),fp,$d,pp,xc,Qd,th,Jd,W0,Rf,kh,Mu,kf,Lf,X0,LE=(fp={},(0,R.Z)(fp,V.POINTS,"points"),(0,R.Z)(fp,V.LINES,"lines"),(0,R.Z)(fp,V.LINE_LOOP,"line loop"),(0,R.Z)(fp,V.LINE_STRIP,"line strip"),(0,R.Z)(fp,V.TRIANGLES,"triangles"),(0,R.Z)(fp,V.TRIANGLE_FAN,"triangle fan"),(0,R.Z)(fp,V.TRIANGLE_STRIP,"triangle strip"),fp),oy=($d={},(0,R.Z)($d,V.STATIC_DRAW,"static"),(0,R.Z)($d,V.DYNAMIC_DRAW,"dynamic"),(0,R.Z)($d,V.STREAM_DRAW,"stream"),$d),Nv=(pp={},(0,R.Z)(pp,V.BYTE,"int8"),(0,R.Z)(pp,V.UNSIGNED_INT,"int16"),(0,R.Z)(pp,V.INT,"int32"),(0,R.Z)(pp,V.UNSIGNED_BYTE,"uint8"),(0,R.Z)(pp,V.UNSIGNED_SHORT,"uint16"),(0,R.Z)(pp,V.UNSIGNED_INT,"uint32"),(0,R.Z)(pp,V.FLOAT,"float"),pp),DE=(xc={},(0,R.Z)(xc,V.ALPHA,"alpha"),(0,R.Z)(xc,V.LUMINANCE,"luminance"),(0,R.Z)(xc,V.LUMINANCE_ALPHA,"luminance alpha"),(0,R.Z)(xc,V.RGB,"rgb"),(0,R.Z)(xc,V.RGBA,"rgba"),(0,R.Z)(xc,V.RGBA4,"rgba4"),(0,R.Z)(xc,V.RGB5_A1,"rgb5 a1"),(0,R.Z)(xc,V.RGB565,"rgb565"),(0,R.Z)(xc,V.DEPTH_COMPONENT,"depth"),(0,R.Z)(xc,V.DEPTH_STENCIL,"depth stencil"),xc),FE=(Qd={},(0,R.Z)(Qd,V.DONT_CARE,"dont care"),(0,R.Z)(Qd,V.NICEST,"nice"),(0,R.Z)(Qd,V.FASTEST,"fast"),Qd),sy=(th={},(0,R.Z)(th,V.NEAREST,"nearest"),(0,R.Z)(th,V.LINEAR,"linear"),(0,R.Z)(th,V.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,R.Z)(th,V.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,R.Z)(th,V.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,R.Z)(th,V.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),th),uy=(Jd={},(0,R.Z)(Jd,V.REPEAT,"repeat"),(0,R.Z)(Jd,V.CLAMP_TO_EDGE,"clamp"),(0,R.Z)(Jd,V.MIRRORED_REPEAT,"mirror"),Jd),BE=(W0={},(0,R.Z)(W0,V.NONE,"none"),(0,R.Z)(W0,V.BROWSER_DEFAULT_WEBGL,"browser"),W0),NE=(Rf={},(0,R.Z)(Rf,V.NEVER,"never"),(0,R.Z)(Rf,V.ALWAYS,"always"),(0,R.Z)(Rf,V.LESS,"less"),(0,R.Z)(Rf,V.LEQUAL,"lequal"),(0,R.Z)(Rf,V.GREATER,"greater"),(0,R.Z)(Rf,V.GEQUAL,"gequal"),(0,R.Z)(Rf,V.EQUAL,"equal"),(0,R.Z)(Rf,V.NOTEQUAL,"notequal"),Rf),ly=(kh={},(0,R.Z)(kh,V.FUNC_ADD,"add"),(0,R.Z)(kh,V.MIN_EXT,"min"),(0,R.Z)(kh,V.MAX_EXT,"max"),(0,R.Z)(kh,V.FUNC_SUBTRACT,"subtract"),(0,R.Z)(kh,V.FUNC_REVERSE_SUBTRACT,"reverse subtract"),kh),Y0=(Mu={},(0,R.Z)(Mu,V.ZERO,"zero"),(0,R.Z)(Mu,V.ONE,"one"),(0,R.Z)(Mu,V.SRC_COLOR,"src color"),(0,R.Z)(Mu,V.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,R.Z)(Mu,V.SRC_ALPHA,"src alpha"),(0,R.Z)(Mu,V.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,R.Z)(Mu,V.DST_COLOR,"dst color"),(0,R.Z)(Mu,V.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,R.Z)(Mu,V.DST_ALPHA,"dst alpha"),(0,R.Z)(Mu,V.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,R.Z)(Mu,V.CONSTANT_COLOR,"constant color"),(0,R.Z)(Mu,V.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,R.Z)(Mu,V.CONSTANT_ALPHA,"constant alpha"),(0,R.Z)(Mu,V.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,R.Z)(Mu,V.SRC_ALPHA_SATURATE,"src alpha saturate"),Mu),zE=(kf={},(0,R.Z)(kf,V.NEVER,"never"),(0,R.Z)(kf,V.ALWAYS,"always"),(0,R.Z)(kf,V.LESS,"less"),(0,R.Z)(kf,V.LEQUAL,"lequal"),(0,R.Z)(kf,V.GREATER,"greater"),(0,R.Z)(kf,V.GEQUAL,"gequal"),(0,R.Z)(kf,V.EQUAL,"equal"),(0,R.Z)(kf,V.NOTEQUAL,"notequal"),kf),vd=(Lf={},(0,R.Z)(Lf,V.ZERO,"zero"),(0,R.Z)(Lf,V.KEEP,"keep"),(0,R.Z)(Lf,V.REPLACE,"replace"),(0,R.Z)(Lf,V.INVERT,"invert"),(0,R.Z)(Lf,V.INCR,"increment"),(0,R.Z)(Lf,V.DECR,"decrement"),(0,R.Z)(Lf,V.INCR_WRAP,"increment wrap"),(0,R.Z)(Lf,V.DECR_WRAP,"decrement wrap"),Lf),UE=(X0={},(0,R.Z)(X0,V.FRONT,"front"),(0,R.Z)(X0,V.BACK,"back"),X0),ZE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:oy[a||V.STATIC_DRAW],type:Nv[s||V.UNSIGNED_BYTE]})}return(0,Wt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),jE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:oy[a||V.STATIC_DRAW],type:Nv[s||V.UNSIGNED_BYTE],count:p})}return(0,Wt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),VE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Wt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),GE=Q(36719),HE=Q.n(GE),WE=Q(68630),XE=Q.n(WE);function cy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cy(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var YE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"reGl",void 0),(0,R.Z)(this,"destroyed",!1),(0,R.Z)(this,"drawCommand",void 0),(0,R.Z)(this,"drawPickCommand",void 0),(0,R.Z)(this,"drawParams",void 0),(0,R.Z)(this,"options",void 0),(0,R.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,w=r.blend,O=r.stencil,F=r.cull,j=r.instances,Y={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(qe){Y[qe]=i.prop(qe)}));var ee={};Object.keys(s).forEach(function(qe){ee[qe]=s[qe].get()});var ye={attributes:ee,frag:a,uniforms:Y,vert:n,blend:{},primitive:LE[v===void 0?V.TRIANGLES:v]};j&&(ye.instances=j),g&&(ye.count=g),x&&(ye.elements=x.get()),this.initDepthDrawParams({depth:C},ye),this.initBlendDrawParams({blend:w},ye),this.initStencilDrawParams({stencil:O},ye),this.initCullDrawParams({cull:F},ye),this.drawCommand=i(ye);var Fe=Ai()(ye);Fe.blend=bc(bc({},Fe.blend),{},{enable:!1}),this.drawPickCommand=i(Fe),this.drawParams=ye}return(0,Wt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(p){a[p]=r[p].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=Ai()(this.drawParams);s.blend=bc(bc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=Ai()(this.drawParams);a.blend=bc(bc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=bc(bc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=bc(bc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,to.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:NE[a.func||V.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:Y0[p&&p.srcRGB||V.SRC_ALPHA],srcAlpha:Y0[p&&p.srcAlpha||V.SRC_ALPHA],dstRGB:Y0[p&&p.dstRGB||V.ONE_MINUS_SRC_ALPHA],dstAlpha:Y0[p&&p.dstAlpha||V.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ly[v&&v.rgb||V.FUNC_ADD],alpha:ly[v&&v.alpha||V.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:V.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,w=C===void 0?{fail:V.KEEP,zfail:V.KEEP,zpass:V.KEEP}:C,O=a.opBack,F=O===void 0?{fail:V.KEEP,zfail:V.KEEP,zpass:V.KEEP}:O;n.stencil={enable:!!s,mask:v,func:bc(bc({},x),{},{cmp:zE[x.cmp]}),opFront:{fail:vd[w.fail],zfail:vd[w.zfail],zpass:vd[w.zpass]},opBack:{fail:vd[F.fail],zfail:vd[F.zfail],zpass:vd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?V.BACK:p;n.cull={enable:!!s,face:UE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||HE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}XE()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),qE=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"texture",void 0),(0,R.Z)(this,"width",void 0),(0,R.Z)(this,"height",void 0),(0,R.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?V.UNSIGNED_BYTE:a,p=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,w=C===void 0?V.RGBA:C,O=r.mipmap,F=O===void 0?!1:O,j=r.wrapS,Y=j===void 0?V.CLAMP_TO_EDGE:j,ee=r.wrapT,ye=ee===void 0?V.CLAMP_TO_EDGE:ee,Fe=r.aniso,qe=Fe===void 0?0:Fe,rt=r.alignment,yt=rt===void 0?1:rt,xt=r.premultiplyAlpha,Yt=xt===void 0?!1:xt,ur=r.mag,Ir=ur===void 0?V.NEAREST:ur,tn=r.min,br=tn===void 0?V.NEAREST:tn,gn=r.colorSpace,In=gn===void 0?V.BROWSER_DEFAULT_WEBGL:gn,qn=r.x,Ba=qn===void 0?0:qn,rs=r.y,Vs=rs===void 0?0:rs,Gs=r.copy,Qs=Gs===void 0?!1:Gs;this.width=p,this.height=v;var $c={width:p,height:v,type:Nv[s],format:DE[w],wrapS:uy[Y],wrapT:uy[ye],mag:sy[Ir],min:sy[br],alignment:yt,flipY:x,colorSpace:BE[In],premultiplyAlpha:Yt,aniso:qe,x:Ba,y:Vs,copy:Qs};n&&($c.data=n),typeof F=="number"?$c.mipmap=FE[F]:typeof F=="boolean"&&($c.mipmap=F),this.texture=i.texture($c)}return(0,Wt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),fy,py,KE=(fy=(0,Nr.b2)(),fy(py=function(){function e(){var i=this;(0,Vt.Z)(this,e),(0,R.Z)(this,"extensionObject",void 0),(0,R.Z)(this,"gl",void 0),(0,R.Z)(this,"$container",void 0),(0,R.Z)(this,"canvas",void 0),(0,R.Z)(this,"width",void 0),(0,R.Z)(this,"height",void 0),(0,R.Z)(this,"isDirty",void 0),(0,R.Z)(this,"createModel",function(r){return new YE(i.gl,r)}),(0,R.Z)(this,"createAttribute",function(r){return new kE(i.gl,r)}),(0,R.Z)(this,"createBuffer",function(r){return new ZE(i.gl,r)}),(0,R.Z)(this,"createElements",function(r){return new jE(i.gl,r)}),(0,R.Z)(this,"createTexture2D",function(r){return new qE(i.gl,r)}),(0,R.Z)(this,"createFramebuffer",function(r){return new VE(i.gl,r)}),(0,R.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,R.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,R.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,R.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,g={x:a,y:s,width:p,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,R.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,R.Z)(this,"getContainer",function(){if(Po)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,R.Z)(this,"getCanvas",function(){return i.canvas}),(0,R.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,R.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Wt.Z)(e,[{key:"init",value:function(){var i=(0,nn.Z)(En().mark(function n(a,s){var p=this;return En().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){RE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,F){(O||!F)&&C(O),x(F)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||py);function hy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hy(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var $E=function(){function e(i){(0,Vt.Z)(this,e),(0,R.Z)(this,"sceneService",void 0),(0,R.Z)(this,"mapService",void 0),(0,R.Z)(this,"controlService",void 0),(0,R.Z)(this,"layerService",void 0),(0,R.Z)(this,"iconService",void 0),(0,R.Z)(this,"markerService",void 0),(0,R.Z)(this,"popupService",void 0),(0,R.Z)(this,"fontService",void 0),(0,R.Z)(this,"interactionService",void 0),(0,R.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=l2();this.container=p,n.setContainer(p,r,a,s),p.bind(Zt.IRendererService).to(KE).inSingletonScope(),this.sceneService=p.get(Zt.ISceneService),this.mapService=p.get(Zt.IMapService),this.iconService=p.get(Zt.IIconService),this.fontService=p.get(Zt.IFontService),this.controlService=p.get(Zt.IControlService),this.layerService=p.get(Zt.ILayerService),this.markerService=p.get(Zt.IMarkerService),this.interactionService=p.get(Zt.IInteractionService),this.popupService=p.get(Zt.IPopupService),Po?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Wt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=yg(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,p=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&p){var w=new IE().source(p).shape("fill").color(g).style({opacity:C});this.addMask(w,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=yg(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,$n.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Po?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){kv.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){kv.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){kv.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||dy(dy({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Zt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Kr(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new P2({position:a}))}}]),e}();function QE(e){var i=JE();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,rS=function(e){(0,ln.Z)(r,e);var i=QE(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"cityCenter",void 0),(0,R.Z)((0,D.Z)(n),"cityMinSize",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,w=a.windowColor,O=w===void 0?"rgb(30,60,89)":w,F=a.time,j=F===void 0?0:F,Y=a.sweep,ee=Y===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Y;return{u_cityCenter:ee.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ee.sweepRadius,u_circleSweep:ee.enable?1:0,u_circleSweepColor:c(ee.sweepColor).slice(0,3),u_circleSweepSpeed:ee.sweepSpeed,u_opacity:p,u_baseColor:c(g),u_brightColor:c(C),u_windowColor:c(O),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,$n.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var w=v-s,O=g-p;this.cityCenter=[(v+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:tS,fragmentShader:eS,triangulation:ry,cull:{enable:!0,face:V.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(xo);function nS(e){var i=iS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=function(e){(0,ln.Z)(r,e);var i=nS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","PolygonLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new rS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Qp);function oS(e){var i=sS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function sS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,lS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,cS=function(e){(0,ln.Z)(r,e);var i=oS(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:uS,fragmentShader:lS,triangulation:ny,depth:{enable:!1},primitive:V.TRIANGLES,blend:this.getBlend(),stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo);function fS(e){var i=pS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function pS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,dS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vS=function(e){(0,ln.Z)(r,e);var i=fS(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:hS,fragmentShader:dS,triangulation:Jg,depth:{enable:!0},blend:this.getBlend(),stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo);function mS(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,w=0;w<s;w++){var O=w-v;n.push(O/v,-C/g,0),a.push(w/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var j=0;j<e;j++){var Y=j+s*F,ee=j+s*(F+1),ye=j+1+s*(F+1),Fe=j+1+s*F;r.push(Y,ee,Fe),r.push(ee,ye,Fe)}return{vertices:n,indices:r,uvs:a}}var vy,gy;function yy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _y(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yy(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gS(e){var i=yS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,xS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,bS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ES=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,SS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,CS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,xy=(vy=(0,Nr.b2)(),vy(gy=function(e){(0,ln.Z)(r,e);var i=gS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"colorTexture",void 0),(0,R.Z)((0,D.Z)(n),"heatmapFramerBuffer",void 0),(0,R.Z)((0,D.Z)(n),"intensityModel",void 0),(0,R.Z)((0,D.Z)(n),"colorModel",void 0),(0,R.Z)((0,D.Z)(n),"shapeType",void 0),n}return(0,Wt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,w=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(w==null||(a=w.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=g(),j=F.width,Y=F.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(j/4),height:Math.floor(Y/4),wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.LINEAR,mag:V.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:On.Attribute,descriptor:{name:"a_Dir",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=ay,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:CS,fragmentShader:SS,triangulation:ay,depth:{enable:!1},cull:{enable:!0,face:se(this.mapService.version)},blend:{enable:!0,func:{srcRGB:V.ONE,srcAlpha:1,dstRGB:V.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:ES,fs:bS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,w=x.fs,O=x.uniforms,F=this.rendererService,j=F.createAttribute,Y=F.createElements,ee=F.createBuffer,ye=F.createModel;return ye({vs:C,fs:w,attributes:{a_Position:j({buffer:ee({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:V.FLOAT}),size:3}),a_Uv:j({buffer:ee({data:[0,1,1,1,0,0,1,0],type:V.FLOAT}),size:2})},uniforms:_y({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Y({data:[0,2,1,2,3,1],type:V.UNSIGNED_INT,count:6}),stencil:H(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=hc();Kt(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,sn.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),w=C.width,O=C.height,F=mS(w/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:xS,fs:_S});var j=this.shaderModuleService.getModule("heatmap3dColor"),Y=j.vs,ee=j.fs,ye=j.uniforms,Fe=this.rendererService,qe=Fe.createAttribute,rt=Fe.createElements,yt=Fe.createBuffer,xt=Fe.createModel;return xt({vs:Y,fs:ee,attributes:{a_Position:qe({buffer:yt({data:F.vertices,type:V.FLOAT}),size:3}),a_Uv:qe({buffer:yt({data:F.uvs,type:V.FLOAT}),size:2})},primitive:V.TRIANGLES,uniforms:_y({},ye),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:V.SRC_ALPHA,srcAlpha:1,dstRGB:V.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:rt({data:F.indices,type:V.UNSIGNED_INT,count:F.indices.length}),stencil:H(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=A(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.NEAREST,mag:V.NEAREST,flipY:!1})}}]),r}(xo))||gy);function AS(e){var i=wS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,MS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,PS=function(e){(0,ln.Z)(r,e);var i=AS(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:MS,fragmentShader:TS,triangulation:ny,depth:{enable:!1},primitive:V.TRIANGLES,blend:this.getBlend(),stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(xo),IS={heatmap:xy,heatmap3d:xy,grid:cS,grid3d:vS,hexagon:PS},OS=IS;function RS(e){var i=kS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LS=function(e){(0,ln.Z)(r,e);var i=RS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","HeatMapLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new OS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(Qp);function DS(e){var i=FS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,NS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,zS=function(e){(0,ln.Z)(r,e);var i=DS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),Po){var O=this.layerService.sceneService.getSceneConfig().canvas,F=O.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){a.texture=w({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(j){a.texture=w({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:NS,fragmentShader:BS,triangulation:iy,primitive:V.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:H(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}}]),r}(xo),US={image:zS},ZS=US;function jS(e){var i=VS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=function(e){(0,ln.Z)(r,e);var i=jS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","ImageLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ZS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Qp);function HS(e){var i=WS();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,YS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,qS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,KS=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,$S=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,QS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,JS={solid:0,dash:1},eC=function(e){(0,ln.Z)(r,e);var i=HS(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.forward,Y=j===void 0?!0:j,ee=a.lineTexture,ye=ee===void 0?!1:ee,Fe=a.iconStep,qe=Fe===void 0?100:Fe,rt=a.segmentNumber,yt=rt===void 0?30:rt,xt=a.thetaOffset,Yt=xt===void 0?.314:xt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Yt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Yt});var ur=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,ur,this.cellProperties),tn=Ir.data,br=Ir.width,gn=Ir.height;this.rowCount=gn,this.dataTexture=this.cellLength>0&&tn.length>0?this.createTexture2D({flipY:!0,data:tn,format:V.LUMINANCE,type:V.FLOAT,width:br,height:gn}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var In=0,qn=[0,0,0,0],Ba=[0,0,0,0];return p&&v&&(qn=c(p),Ba=c(v),In=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ca()(Yt)?Yt:0,u_opacity:ca()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:yt,u_line_type:JS[w||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Y?1:-1,u_texture:this.texture,u_line_texture:ye?1:0,u_icon_step:qe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:In,u_sourceColor:qn,u_targetColor:Ba}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:XS,vert:YS,type:"dash"}:s&&p?{frag:$S,vert:QS,type:"linear"}:{frag:qS,vert:KS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),O=w.frag,F=w.vert,j=w.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:F,fragmentShader:O,triangulation:G0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:H(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo);function tC(e){var i=rC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,iC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,aC=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,oC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,sC={solid:0,dash:1},uC=function(e){(0,ln.Z)(r,e);var i=tC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,ye=ee===void 0?100:ee,Fe=a.segmentNumber,qe=Fe===void 0?30:Fe,rt=a.globalArcHeight,yt=rt===void 0?10:rt;F.length===2&&F.push(0,0);var xt=0,Yt=[0,0,0,0],ur=[0,0,0,0];if(p&&v&&(Yt=c(p),ur=c(v),xt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ir=this.layer.getEncodedData(),tn=this.calDataFrame(this.cellLength,Ir,this.cellProperties),br=tn.data,gn=tn.width,In=tn.height;this.rowCount=In,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:V.LUMINANCE,type:V.FLOAT,width:gn,height:In}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:jg,u_global_height:yt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:qe,u_line_type:sC[w]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:xt,u_sourceColor:Yt,u_targetColor:ur}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:aC,vert:oC,type:"linear"}:{frag:nC,vert:iC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),O=w.frag,F=w.vert,j=w.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:F,fragmentShader:O,triangulation:G0,blend:this.getBlend(),segmentNumber:p,stencil:H(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo);function lC(e){var i=cC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,hC=function(e){(0,ln.Z)(r,e);var i=lC(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,w=C===void 0?30:C,O=a.thetaOffset,F=O===void 0?.314:O,j=0,Y=[0,0,0,0],ee=[0,0,0,0];return p&&v&&(Y=c(p),ee=c(v),j=1),{u_thetaOffset:F,u_opacity:ca()(s)?s:1,segmentNumber:w,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:j,u_sourceColor:Y,u_targetColor:ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:pC,fragmentShader:fC,triangulation:G0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(s,p,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(xo);function dC(e){var i=vC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,gC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,yC={solid:0,dash:1},_C=function(e){(0,ln.Z)(r,e);var i=dC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,F=O===void 0?[10,5]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,ye=ee===void 0?100:ee,Fe=a.segmentNumber,qe=Fe===void 0?30:Fe;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var rt=0,yt=[0,0,0,0],xt=[0,0,0,0];if(p&&v&&(yt=c(p),xt=c(v),rt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Yt=this.layer.getEncodedData(),ur=this.calDataFrame(this.cellLength,Yt,this.cellProperties),Ir=ur.data,tn=ur.width,br=ur.height;this.rowCount=br,this.dataTexture=this.cellLength>0&&Ir.length>0?this.createTexture2D({flipY:!0,data:Ir,format:V.LUMINANCE,type:V.FLOAT,width:tn,height:br}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:qe,u_line_type:yC[w]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:yt,u_targetColor:xt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:gC,fragmentShader:mC,triangulation:G0,depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo);function xC(e){var i=bC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,SC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,CC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,by=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,AC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,wC={solid:0,dash:1},Ey=function(e){(0,ln.Z)(r,e);var i=xC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,F=O===void 0?[10,5,0,0]:O,j=a.lineTexture,Y=j===void 0?!1:j,ee=a.iconStep,ye=ee===void 0?100:ee,Fe=a.vertexHeightScale,qe=Fe===void 0?20:Fe,rt=a.borderWidth,yt=rt===void 0?0:rt,xt=a.borderColor,Yt=xt===void 0?"#ccc":xt,ur=a.raisingHeight,Ir=ur===void 0?0:ur,tn=a.heightfixed,br=tn===void 0?!1:tn,gn=a.arrow,In=gn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:gn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var qn=0,Ba=[0,0,0,0],rs=[0,0,0,0];if(p&&v&&(Ba=c(p),rs=c(v),qn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Vs=this.layer.getEncodedData(),Gs=this.calDataFrame(this.cellLength,Vs,this.cellProperties),Qs=Gs.data,$c=Gs.width,Ev=Gs.height;this.rowCount=Ev,this.dataTexture=this.cellLength>0&&Qs.length>0?this.createTexture2D({flipY:!0,data:Qs,format:V.LUMINANCE,type:V.FLOAT,width:$c,height:Ev}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:wC[w],u_dash_array:F,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:yt,u_borderColor:c(Yt),u_linearColor:qn,u_sourceColor:Ba,u_targetColor:rs,u_heightfixed:Number(br),u_vertexScale:qe,u_raisingHeight:Number(Ir),u_arrow:Number(In.enable),u_arrowHeight:In.arrowHeight||3,u_arrowWidth:In.arrowWidth||2,u_tailWidth:In.tailWidth===void 0?1:In.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,w=this.getShaders(),O=w.frag,F=w.vert,j=w.type;return this.layer.triangulation=qd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:O,triangulation:qd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:H(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:EC,vert:SC,type:"dash"}:s&&p?{frag:AC,vert:by,type:"linear"}:{frag:CC,vert:by,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x,C,w){return w===void 0?[g[3],10]:[g[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo);function TC(e){var i=MC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,IC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OC=function(e){(0,ln.Z)(r,e);var i=TC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"colorTexture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=A(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.NEAREST,mag:V.NEAREST,flipY:!1})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.vertexHeightScale,v=p===void 0?20:p,g=a.raisingHeight,x=g===void 0?0:g,C=a.heightfixed,w=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var O=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,O,this.cellProperties),j=F.data,Y=F.width,ee=F.height;this.rowCount=ee,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:V.LUMINANCE,type:V.FLOAT,width:Y,height:ee}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_texture:this.colorTexture,u_heightfixed:Number(w),u_vertexScale:v,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,w=this.getShaders(),O=w.frag,F=w.vert,j=w.type;return this.layer.triangulation=qd,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:F,fragmentShader:O,triangulation:qd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:H(p,g)})]}},{key:"getShaders",value:function(){return{frag:PC,vert:IC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(xo);function RC(e){var i=kC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,DC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Sy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,FC=function(e){(0,ln.Z)(r,e);var i=RC(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,w=[0,0,0,0],O=[0,0,0,0];if(p&&v&&(w=c(p),O=c(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,F,this.cellProperties),Y=j.data,ee=j.width,ye=j.height;this.rowCount=ye,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:V.LUMINANCE,type:V.FLOAT,width:ee,height:ye}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_linearColor:C,u_sourceColor:w,u_targetColor:O,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:LC,vert:Sy,type:"linear"}:{frag:DC,vert:Sy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+O,vertexShader:w,fragmentShader:C,triangulation:mE,primitive:V.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(xo);function BC(e){var i=NC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,UC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ZC=function(e){(0,ln.Z)(r,e);var i=BC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,w=C===void 0?!1:C,O=a.lineTexture,F=O===void 0?!1:O,j=a.iconStep,Y=j===void 0?100:j,ee=a.iconStepCount,ye=ee===void 0?1:ee;this.rendererService.getDirty()&&this.texture.bind();var Fe=0,qe=[0,0,0,0],rt=[0,0,0,0];if(p&&v&&(qe=c(p),rt=c(v),Fe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var yt=this.layer.getEncodedData(),xt=this.calDataFrame(this.cellLength,yt,this.cellProperties),Yt=xt.data,ur=xt.width,Ir=xt.height;this.rowCount=Ir,this.dataTexture=this.cellLength>0&&Yt.length>0?this.createTexture2D({flipY:!0,data:Yt,format:V.LUMINANCE,type:V.FLOAT,width:ur,height:Ir}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:ye,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:qe,u_targetColor:rt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:UC,fragmentShader:zC,triangulation:qd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo),jC={arc:eC,arcmini:hC,arc3d:uC,greatcircle:_C,wall:ZC,line:Ey,simple:FC,linearline:OC},VC=jC;function GC(e){var i=HC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=function(e){(0,ln.Z)(r,e);var i=GC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","LineLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new VC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(Qp);function XC(e){var i=YC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Cy=function(e){(0,ln.Z)(r,e);var i=XC(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"raiseCount",0),(0,R.Z)((0,D.Z)(n),"raiserepeat",0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,w=a.pickLight,O=w===void 0?!1:w,F=a.heightfixed,j=F===void 0?!1:F,Y=a.opacityLinear,ee=Y===void 0?{enable:!1,dir:"up"}:Y,ye=a.lightEnable,Fe=ye===void 0?!0:ye;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var qe=this.layer.getEncodedData(),rt=this.calDataFrame(this.cellLength,qe,this.cellProperties),yt=rt.data,xt=rt.width,Yt=rt.height;this.rowCount=Yt,this.dataTexture=this.cellLength>0&&yt.length>0?this.createTexture2D({flipY:!0,data:yt,format:V.LUMINANCE,type:V.FLOAT,width:xt,height:Yt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}var ur=0,Ir=[0,0,0,0],tn=[0,0,0,0];if(x&&C&&(Ir=c(x),tn=c(C),ur=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var br=p.speed,gn=br===void 0?.01:br,In=p.repeat,qn=In===void 0?!1:In;this.raiseCount+=gn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(j),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(g)?g:1,u_linearColor:ur,u_sourceColor:Ir,u_targetColor:tn,u_opacitylinear:Number(ee.enable),u_opacitylinear_dir:ee.dir==="up"?1:0,u_lightEnable:Number(Fe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:KC,fragmentShader:qC,triangulation:Jg,blend:this.getBlend(),cull:{enable:!0,face:se(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C=p.size;if(C){var w=[];return Array.isArray(C)&&(w=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(w=[C,C,C]),w}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v){var g=Ph(p.coordinates);return a?Gg([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(xo);function $C(e){var i=QC();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ay=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,JC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,zv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,wy=function(e){(0,ln.Z)(r,e);var i=$C(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"meter2coord",1),(0,R.Z)((0,D.Z)(n),"isMeter",!1),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.blur,ye=ee===void 0?0:ee,Fe=a.raisingHeight,qe=Fe===void 0?0:Fe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j});var rt=this.layer.getEncodedData(),yt=this.calDataFrame(this.cellLength,rt,this.cellProperties),xt=yt.data,Yt=yt.width,ur=yt.height;this.rowCount=ur,this.dataTexture=this.cellLength>0&&xt.length>0?this.createTexture2D({flipY:!0,data:xt,format:V.LUMINANCE,type:V.FLOAT,width:Yt,height:ur}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(qe),u_isMeter:Number(this.isMeter),u_blur:ye,u_additive:Y==="additive"?1:0,u_globel:this.mapService.version===js.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(p)?p:1,u_stroke_opacity:ca()(g)?g:1,u_stroke_width:ca()(C)?C:0,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Rh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$n.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*w.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(ee+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,w=this.getShaders(C),O=w.frag,F=w.vert,j=w.type,Y=this.mapService.version==="GLOBEL";return this.layer.triangulation=Y?Qg:Rh,[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:F,fragmentShader:O,triangulation:Y?Qg:Rh,depth:{enable:Y},blend:this.getBlend(),stencil:H(p,g),cull:{enable:!0,face:se(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:Ay,vert:zv,type:"wave"};default:return{frag:Ay,vert:zv,type:"wave"}}else return{frag:JC,vert:zv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(v,g,x,C){var w;if(s){var O=(0,$n.Z)(x,3),F=O[0],j=O[1],Y=O[2],ee=qa.fromValues(0,0,1),ye=qa.fromValues(F,0,Y),Fe=F>=0?qa.angle(ee,ye):Math.PI*2-qa.angle(ee,ye),qe=Math.PI*2-Math.asin(j/100),rt=hc();wr(rt,rt,Fe),yr(rt,rt,qe);var yt=qa.fromValues(1,1,0);qa.transformMat4(yt,yt,rt),qa.normalize(yt,yt);var xt=qa.fromValues(-1,1,0);qa.transformMat4(xt,xt,rt),qa.normalize(xt,xt);var Yt=qa.fromValues(-1,-1,0);qa.transformMat4(Yt,Yt,rt),qa.normalize(Yt,Yt);var ur=qa.fromValues(1,-1,0);qa.transformMat4(ur,ur,rt),qa.normalize(ur,ur),w=[].concat((0,sn.Z)(yt),(0,sn.Z)(xt),(0,sn.Z)(Yt),(0,sn.Z)(ur))}else w=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Ir=C%4*3;return[w[Ir],w[Ir+1],w[Ir+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(v,g,x,C){var w=v.size,O=w===void 0?5:w;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(v,g,x,C){var w=v.shape,O=w===void 0?2:w,F=a.layer.getLayerConfig().shape2d,j=F.indexOf(O);return[j]}}})}}]),r}(xo);function eA(e){var i=tA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,nA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,iA=function(e){(0,ln.Z)(r,e);var i=eA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"meter2coord",1),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"isMeter",!1),(0,R.Z)((0,D.Z)(n),"radian",0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.LINEAR,min:V.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var ye=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(ye=-1),this.radian=ee!==void 0?ye*Math.PI*ee/180:ye*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j});var Fe=this.layer.getEncodedData(),qe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),rt=qe.data,yt=qe.width,xt=qe.height;this.rowCount=xt,this.dataTexture=this.cellLength>0&&rt.length>0?this.createTexture2D({flipY:!0,data:rt,format:V.LUMINANCE,type:V.FLOAT,width:yt,height:xt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ca()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Rh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$n.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*w.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(ee+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:w,fragmentShader:C,triangulation:Rh,depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g),cull:{enable:!0,face:se(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:rA,vert:nA,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.rotate,w=C===void 0?0:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.shape,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}})}}]),r}(xo);function aA(e){var i=oA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,uA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,lA=function(e){(0,ln.Z)(r,e);var i=aA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:uA,fragmentShader:sA,triangulation:ey,primitive:V.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.fontService.mapping,w=p.shape,O=a.fontService.getGlyph(w),F=C[O],j=F.x,Y=F.y;return[j,Y]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:V.LINEAR,min:V.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),w=[];C.forEach(function(O){var F=O.shape,j=F===void 0?"":F;j=j.toString();var Y=a.fontService.getGlyph(j);w.indexOf(Y)===-1&&w.push(Y)}),this.fontService.setFontOptions({characterSet:w,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(xo);function cA(e){var i=fA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,hA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ty=function(e){(0,ln.Z)(r,e);var i=cA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.LINEAR,min:V.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,w=x.width,O=x.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:V.LUMINANCE,type:V.FLOAT,width:w,height:O}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ca()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:hA,fragmentShader:pA,triangulation:ey,primitive:V.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.shape,O=C[w]||{x:0,y:0},F=O.x,j=O.y;return[F,j]}}})}}]),r}(xo);function dA(e){var i=vA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function My(e){var i=e.coordinates;return{vertices:(0,sn.Z)(i),indices:[0],size:i.length}}var Py=function(e){(0,ln.Z)(r,e);var i=dA(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,O=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:V.LUMINANCE,type:V.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=My,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:gA,fragmentShader:mA,triangulation:My,depth:{enable:!1},primitive:V.POINTS,blend:this.getBlend(),stencil:H(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:yc.additive}}}]),r}(xo);function yA(e){var i=_A();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,bA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,EA=function(e){(0,ln.Z)(r,e);var i=yA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"meter2coord",1),(0,R.Z)((0,D.Z)(n),"isMeter",!1),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,F=a.offsets,j=F===void 0?[0,0]:F,Y=a.blend,ee=a.speed,ye=ee===void 0?1:ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j});var Fe=this.layer.getEncodedData(),qe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),rt=qe.data,yt=qe.width,xt=qe.height;this.rowCount=xt,this.dataTexture=this.cellLength>0&&rt.length>0?this.createTexture2D({flipY:!0,data:rt,format:V.LUMINANCE,type:V.FLOAT,width:yt,height:xt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:ye,u_additive:Y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(p)?p:1,u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Rh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==js.L7MAP&&v!==js.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,$n.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===js.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,F=O*w.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),Y=j.toLngLat();this.meter2coord=x[0]-Y.lng;return}var ee=this.mapService.meterToCoord(x,[s,p]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(ee+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:w,fragmentShader:C,triangulation:Rh,depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g),cull:{enable:!0,face:se(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:xA,vert:bA,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.shape,w=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,F=O.indexOf(w);return[F]}}})}}]),r}(xo);function SA(e){var i=CA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function CA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,wA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Iy(e){var i=e.coordinates;return{vertices:(0,sn.Z)(i),indices:[0],size:i.length}}var TA=function(e){(0,ln.Z)(r,e);var i=SA(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,w=C===void 0?1:C,O=a.strokeWidth,F=O===void 0?0:O,j=a.stroke,Y=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var ee=this.layer.getEncodedData(),ye=this.calDataFrame(this.cellLength,ee,this.cellProperties),Fe=ye.data,qe=ye.width,rt=ye.height;this.rowCount=rt,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:V.LUMINANCE,type:V.FLOAT,width:qe,height:rt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:ca()(w)?w:1,u_stroke_width:ca()(F)?F:0,u_stroke_color:this.getStrokeColor(Y)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Iy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:wA,fragmentShader:AA,triangulation:Iy,depth:{enable:!1},primitive:V.POINTS,blend:this.getBlend(),stencil:H(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:yc.additive}}}]),r}(xo);function MA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=PA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function PA(e,i){if(!!e){if(typeof e=="string")return Oy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oy(e,i)}}function Oy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var IA=function(){function e(i,r,n){(0,Vt.Z)(this,e),(0,R.Z)(this,"boxCells",[]),(0,R.Z)(this,"xCellCount",void 0),(0,R.Z)(this,"yCellCount",void 0),(0,R.Z)(this,"boxKeys",void 0),(0,R.Z)(this,"bboxes",void 0),(0,R.Z)(this,"width",void 0),(0,R.Z)(this,"height",void 0),(0,R.Z)(this,"xScale",void 0),(0,R.Z)(this,"yScale",void 0),(0,R.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Wt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,v,g,x){var C=g.seenUids,w=this.boxCells[p];if(w!==null){var O=this.bboxes,F=MA(w),j;try{for(F.s();!(j=F.n()).done;){var Y=j.value;if(!C.box[Y]){C.box[Y]=!0;var ee=Y*4;if(r<=O[ee+2]&&n<=O[ee+3]&&a>=O[ee+0]&&s>=O[ee+1]&&(!x||x(this.boxKeys[Y]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Y],x1:O[ee],y1:O[ee+1],x2:O[ee+2],y2:O[ee+3]})}}}}catch(ye){F.e(ye)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,g,x){for(var C=this.convertToXCellCoord(r),w=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),j=C;j<=O;j++)for(var Y=w;Y<=F;Y++){var ee=this.xCellCount*Y+j;if(p.call(this,r,n,a,s,ee,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),OA=IA,RA=function(){function e(i,r){(0,Vt.Z)(this,e),(0,R.Z)(this,"width",void 0),(0,R.Z)(this,"height",void 0),(0,R.Z)(this,"grid",void 0),(0,R.Z)(this,"viewportPadding",100),(0,R.Z)(this,"screenRightBoundary",void 0),(0,R.Z)(this,"screenBottomBoundary",void 0),(0,R.Z)(this,"gridRightBoundary",void 0),(0,R.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new OA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Wt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Tn(n,a,0,1),p=en(),v=Le.apply(Pe,(0,sn.Z)(r));return Cf(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Ry(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function kA(e,i){if(!!e){if(typeof e=="string")return ky(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ky(e,i)}}function ky(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ly(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Dy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function Fy(e,i,r,n,a,s,p){var v=(i-r)*a,g=(-n*p+.5)*s,x=Ry(e),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.x+=v,w.y+=g}}catch(O){x.e(O)}finally{x.f()}}function LA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,w=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,F=w.length;r.forEach(function(Fe){if(Fe.split("").forEach(function(rt){var yt=i[rt],xt=0;yt&&(w.push({glyph:rt,x:g,y:x+xt,vertical:!1,scale:1,metrics:yt}),g+=yt.advance+p)}),w.length!==F){var qe=g-p;C=Math.max(qe,C),Dy(w,i,F,w.length-1,O)}g=0,x-=n+5});var j=Ly(a),Y=j.horizontalAlign,ee=j.verticalAlign;Fy(w,O,Y,ee,C,n,r.length);var ye=x-v;e.top+=-ee*ye,e.bottom=e.top-ye,e.left+=-Y*C,e.right=e.left+C}function DA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,w=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,F=w.length;r.forEach(function(Fe){var qe=i[Fe],rt=0;if(qe&&(w.push({glyph:Fe,x:qe.advance/2,y:x+rt,vertical:!1,scale:1,metrics:qe}),g+=qe.advance+p),w.length!==F){var yt=g-p;C=Math.max(yt,C),Dy(w,i,F,w.length-1,O)}g=0,x-=n+5});var j=Ly(a),Y=j.horizontalAlign,ee=j.verticalAlign;Fy(w,O,Y,ee,C,n,r.length);var ye=x-v;e.top+=-ee*ye,e.bottom=e.top-ye,e.left+=-Y*C,e.right=e.left+C}function FA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return v?DA(C,i,g,r,n,a,s):LA(C,i,g,r,n,a,s),x.length?C:!1}function BA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=Ry(a),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,x=g.metrics,C=4,w=x.advance*g.scale/2,O=r?[g.x+w,g.y]:[0,0],F=r?[0,0]:[g.x+w+i[0],g.y+i[1]],j=(0-C)*g.scale-w+F[0],Y=(0-C)*g.scale+F[1],ee=j+x.width*g.scale,ye=Y+x.height*g.scale,Fe={x:j,y:Y},qe={x:ee,y:Y},rt={x:j,y:ye},yt={x:ee,y:ye};s.push({tl:Fe,tr:qe,bl:rt,br:yt,tex:x,glyphOffset:O})}}catch(xt){p.e(xt)}finally{p.f()}return s}function NA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=zA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function zA(e,i){if(!!e){if(typeof e=="string")return By(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return By(e,i)}}function By(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function UA(e){var i=ZA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ny=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Uy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,sn.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,sn.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,sn.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,sn.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Zy=function(e){(0,ln.Z)(r,e);var i=UA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"glyphInfo",void 0),(0,R.Z)((0,D.Z)(n),"glyphInfoMap",{}),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"currentZoom",-1),(0,R.Z)((0,D.Z)(n),"extent",void 0),(0,R.Z)((0,D.Z)(n),"textureHeight",0),(0,R.Z)((0,D.Z)(n),"textCount",0),(0,R.Z)((0,D.Z)(n),"preTextStyle",{}),(0,R.Z)((0,D.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,w=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:zy,fragmentShader:Ny,triangulation:Uy.bind((0,D.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:H(x,w)})]}),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,w=a.textAnchor,O=w===void 0?"center":w,F=a.textAllowOverlap,j=F===void 0?!1:F,Y=a.halo,ee=Y===void 0?.5:Y,ye=a.gamma,Fe=ye===void 0?2:ye,qe=a.raisingHeight,rt=qe===void 0?0:qe,yt=this.fontService,xt=yt.canvas,Yt=yt.mapping;if(Object.keys(Yt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Yt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var ur=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,ur,this.cellProperties),tn=Ir.data,br=Ir.width,gn=Ir.height;this.rowCount=gn,this.dataTexture=this.cellLength>0&&tn.length>0?this.createTexture2D({flipY:!0,data:tn,format:V.LUMINANCE,type:V.FLOAT,width:br,height:gn}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(rt),u_opacity:ca()(p)?p:1,u_stroke_width:ca()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:ee,u_gamma_scale:Fe,u_sdf_map_size:[xt.width,xt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=Gl(this.extent,g);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:On.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:On.Attribute,descriptor:{name:"a_tex",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return Vl(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var O=w.shape,F=O===void 0?"":O;F=F.toString();var j=NA(F),Y;try{for(j.s();!(Y=j.n()).done;){var ee=Y.value;C.indexOf(ee)===-1&&C.push(ee)}}catch(ye){j.e(ye)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var O=w.shape,F=O===void 0?"":O;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,w=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var j=F.shape,Y=j===void 0?"":j,ee=F.id,ye=F.size,Fe=ye===void 0?1:ye,qe=F.textOffset,rt=qe===void 0?[0,0]:qe,yt=FA(Y.toString(),p,Fe,w,"left",x,rt,a),xt=BA(yt,rt,!1);return F.shaping=yt,F.glyphQuads=xt,F.centroid=Ph(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Ph(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ee]={shaping:yt,glyphQuads:xt,centroid:Ph(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),w=C.width,O=C.height,F=new RA(w,O),j=this.glyphInfo.filter(function(Y){var ee=Y.shaping,ye=Y.id,Fe=ye===void 0?0:ye,qe=Y.version==="GAODE2.x"?Y.originCentroid:Y.centroid,rt=Y.size,yt=rt/24,xt=a.mapService.lngLatToContainer(qe),Yt=F.placeCollisionBox({x1:ee.left*yt-v[0],x2:ee.right*yt+v[0],y1:ee.top*yt-v[1],y2:ee.bottom*yt+v[1],anchorPointX:xt.x,anchorPointY:xt.y}),ur=Yt.box;return ur&&ur.length?(F.insertCollisionBox(ur,Fe),!0):!1});j.forEach(function(Y){a.glyphInfoMap[Y.id]=Y})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:V.LINEAR,min:V.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:zy,fragmentShader:Ny,triangulation:Uy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g)})]}}]),r}(xo),jA={fillImage:iA,fill:wy,radar:EA,image:Ty,normal:Py,simplePoint:TA,extrude:Cy,text:Zy,icon:lA},VA=jA;function GA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=HA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function HA(e,i){if(!!e){if(typeof e=="string")return jy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jy(e,i)}}function jy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function WA(e){var i=XA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YA=function(e){(0,ln.Z)(r,e);var i=WA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","PointLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new VA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var w=GA(p),O;try{for(w.s();!(O=w.n()).done;){var F=O.value;if(typeof F=="string"&&C.hasOwnProperty(F))return"image"}}catch(j){w.e(j)}finally{w.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var w=C.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":w==="radar"?"radar":w==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(w))!==-1?"fill":(g==null?void 0:g.indexOf(w))!==-1?"extrude":x.hasOwnProperty(w)?"image":this.fontService.getGlyph(w)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Qp);function qA(e){var i=KA();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $A=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,QA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,JA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ew=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,tw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,rw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,nw=function(e){(0,ln.Z)(r,e);var i=qA(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,w=a.topsurface,O=w===void 0?!0:w,F=a.sidesurface,j=F===void 0?!0:F,Y=a.sourceColor,ee=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var ye=this.layer.getEncodedData(),Fe=this.calDataFrame(this.cellLength,ye,this.cellProperties),qe=Fe.data,rt=Fe.width,yt=Fe.height;this.rowCount=yt,this.dataTexture=this.cellLength>0&&qe.length>0?this.createTexture2D({flipY:!0,data:qe,format:V.LUMINANCE,type:V.FLOAT,width:rt,height:yt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}var xt=0,Yt=[1,1,1,1],ur=[1,1,1,1];return Y&&ee&&(Yt=c(Y),ur=c(ee),xt=1),{u_topsurface:Number(O),u_sidesurface:Number(j),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:ca()(p)?p:1,u_linearColor:xt,u_sourceColor:Yt,u_targetColor:ur,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:w,fragmentShader:C,triangulation:ry,stencil:H(p,g),cull:{enable:!0,face:V.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:JA,vert:ew,type:"polygonExtrudeTexture"}:s?{frag:tw,vert:rw,type:"polygonExtrude"}:{frag:$A,vert:QA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,$n.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:On.Attribute,descriptor:{name:"a_uvs",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(F,j,Y,ee,ye){var Fe=Y[0],qe=Y[1];return[(Fe-p)/C,(qe-v)/w,Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(F,j,Y,ee,ye){return ye}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(F,j,Y,ee){var ye=F.size,Fe=ye===void 0?10:ye;return Array.isArray(Fe)?[Fe[0]]:[Fe]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.LINEAR,mag:V.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(xo);function iw(e){var i=aw();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,uw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,lw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,cw=function(e){(0,ln.Z)(r,e);var i=iw(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,p=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var w=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,w,this.cellProperties),F=O.data,j=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:V.LUMINANCE,type:V.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(p),u_opacity:ca()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return this.layer.triangulation=p.enable?ty:Kd,[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?uw:lw,fragmentShader:p.enable?sw:ow,triangulation:p.enable?ty:Kd,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:V.BACK},stencil:H(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:On.Attribute,descriptor:{name:"a_linear",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(g,x,C,w,O){return[C[3],C[4],C[5]]}}})}}]),r}(xo);function fw(e){var i=pw();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hw=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,dw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,vw=function(e){(0,ln.Z)(r,e);var i=fw(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture1",void 0),(0,R.Z)((0,D.Z)(n),"texture2",void 0),(0,R.Z)((0,D.Z)(n),"texture3",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var w=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,w,this.cellProperties),F=O.data,j=O.width,Y=O.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:V.LUMINANCE,type:V.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:c(g),u_watercolor2:c(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ca()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:dw,fragmentShader:hw,triangulation:Kd,depth:{enable:!1},stencil:H(p,g)})]}},{key:"clearModels",value:function(){var a,s,p,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(p=this.texture3)===null||p===void 0||p.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,$n.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(F,j,Y,ee,ye){var Fe=(0,$n.Z)(Y,2),qe=Fe[0],rt=Fe[1];return[(qe-p)/C,(rt-v)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,w=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(F){var j=new Image;j.crossOrigin="",j.src=F,w.push(j),j.onload=function(){C++,C===3&&x(w)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:V.MIRRORED_REPEAT,wrapT:V.MIRRORED_REPEAT,min:V.LINEAR,mag:V.LINEAR})}}}]),r}(xo);function mw(e){var i=gw();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,_w=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,xw=function(e){(0,ln.Z)(r,e);var i=mw(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,O=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:V.LUMINANCE,type:V.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:ca()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:_w,fragmentShader:yw,triangulation:Kd,depth:{enable:!1},stencil:H(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,$n.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(F,j,Y,ee,ye){var Fe=(0,$n.Z)(Y,2),qe=Fe[0],rt=Fe[1];return[(qe-p)/C,(rt-v)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:V.MIRRORED_REPEAT,wrapT:V.MIRRORED_REPEAT,min:V.LINEAR,mag:V.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(xo),bw={fill:cw,line:Ey,extrude:nw,text:Zy,point_fill:wy,point_image:Ty,point_normal:Py,point_extrude:Cy,water:xw,ocean:vw},Ew=bw;function Sw(e){var i=Cw();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vy=function(e){(0,ln.Z)(r,e);var i=Sw(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","PolygonLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Ew[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(w){return w.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(Qp);function Aw(e){var i=ww();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Mw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Gy=function(e){(0,ln.Z)(r,e);var i=Aw(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"texture",void 0),(0,R.Z)((0,D.Z)(n),"colorTexture",void 0),n}return(0,Wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,w=a.noDataValue,O=w===void 0?-9999999:w,F=a.domain,j=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:j,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,w=x.data.dataArray[0];this.texture=C({data:w.data,width:w.width,height:w.height,format:V.LUMINANCE,type:V.FLOAT});var O=this.layer.getLayerConfig(),F=O.rampColors,j=A(F);return this.colorTexture=C({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Mw,fragmentShader:Tw,triangulation:iy,primitive:V.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:H(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=A(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(xo),Pw={raster:Gy,raster3d:Gy},Iw=Pw;function Ow(e){var i=Rw();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function Rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kw=function(e){(0,ln.Z)(r,e);var i=Ow(r);function r(){var n;(0,Vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,R.Z)((0,D.Z)(n),"type","RasterLayer"),n}return(0,Wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Iw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Qp),Hy,Wy,Xy,Yy,qy,e0,Ky,$y,Qy;function Jy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jy(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Dw=(Hy=(0,Nr.b2)(),Wy=(0,Nr.f3)(Zt.IGlobalConfigService),Xy=(0,Nr.f3)(Zt.IMapService),Yy=(0,Nr.f3)(Zt.IFontService),Hy(qy=(e0=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"configService",Ky,this),Jt(this,"mapService",$y,this),Jt(this,"fontService",Qy,this)}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),w=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(w=x.filter(function(O){return a.applyAttributeMapping(g,O,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,w,void 0,p,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,w,r.getEncodedData(),p,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(w){return a.applyAttributeMapping(g,w,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=pf(a),p=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return p}},{key:"mapping",value:function(r,n,a,s,p){var v=this,g=p==null?void 0:p.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,w=n.map(function(O,F){var j=a?a[F]:{},Y=Lw({id:O._id,coordinates:O.coordinates},j);if(r.filter(function(Fe){return Fe.scale!==void 0}).forEach(function(Fe){var qe=v.applyAttributeMapping(Fe,O,s);Fe.needRemapping=!1,Fe.name==="color"&&(qe=qe.map(function(rt){return c(rt)})),Y[Fe.name]=Array.isArray(qe)&&qe.length===1?qe[0]:qe,Fe.name==="shape"&&(Y.shape=v.fontService.getIconFontKey(Y[Fe.name]))}),Y.shape==="line"&&C.enable){var ee=Y.coordinates,ye=v.getArrowPoints(ee[0],ee[1]);Y.coordinates.splice(1,0,ye,ye)}return Y});return this.adjustData2Amap2Coordinates(w),this.adjustData2SimpleCoordinates(w),w}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===js["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=js["GAODE2.x"],a.originCoordinates=Ai()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=js["GAODE2.x"],a.originCoordinates=Ai()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===js.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,w=x.field;(n.hasOwnProperty(w)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[w])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!f(g[0])?[a]:g}}]),e}(),Ky=$t(e0.prototype,"configService",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=$t(e0.prototype,"mapService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=$t(e0.prototype,"fontService",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e0))||qy),e_,t_,Fw=(e_=(0,Nr.b2)(),e_(t_=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"mapService",void 0)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Zt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:_f,options:xf},p=s.data,v=s.options;r.setSource(new Ns(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,w=r.dataState.dataSourceNeedUpdate;return a&&(w||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||t_);function Uv(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function r_(e){return e.length===1&&(e=Bw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function Bw(e){return function(i,r){return Uv(e(i),r)}}var n_=r_(Uv),Nw=n_.right,VP=n_.left,q0=Nw;function zw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var i_=Array.prototype,GP=i_.slice,HP=i_.map,Zv=Math.sqrt(50),jv=Math.sqrt(10),Vv=Math.sqrt(2);function a_(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=K0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function K0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Zv?10:s>=jv?5:s>=Vv?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Zv?10:s>=jv?5:s>=Vv?2:1)}function Gv(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Zv?a*=10:s>=jv?a*=5:s>=Vv&&(a*=2),i<e?-a:a}function WP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],w=x[1],O=r(g,C,w);Array.isArray(O)||(O=tickStep(C,w,O),O=range(Math.ceil(C/O)*O,w,O));for(var F=O.length;O[0]<=C;)O.shift(),--F;for(;O[F-1]>w;)O.pop(),--F;var j=new Array(F+1),Y;for(s=0;s<=F;++s)Y=j[s]=[],Y.x0=s>0?O[s-1]:C,Y.x1=s<F?O[s]:w;for(s=0;s<p;++s)v=g[s],C<=v&&v<=w&&j[bisect(O,v,0,F)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function XP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Uw(e){return e===null?NaN:+e}function Zw(e,i,r){if(r==null&&(r=Uw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var Ec="$";function $0(){}$0.prototype=o_.prototype={constructor:$0,has:function(e){return Ec+e in this},get:function(e){return this[Ec+e]},set:function(e,i){return this[Ec+e]=i,this},remove:function(e){var i=Ec+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Ec&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Ec&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Ec&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Ec&&++e;return e},empty:function(){for(var e in this)if(e[0]===Ec)return!1;return!0},each:function(e){for(var i in this)i[0]===Ec&&e(this[i],i.slice(1),this)}};function o_(e,i){var r=new $0;if(e instanceof $0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var Hv=o_;function YP(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var w=-1,O=v.length,F=e[g++],j,Y,ee=map(),ye,Fe=x();++w<O;)(ye=ee.get(j=F(Y=v[w])+""))?ye.push(Y):ee.set(j,[Y]);return ee.each(function(qe,rt){C(Fe,rt,s(qe,g,x,C))}),Fe}function p(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(w,O){x.push({key:O,values:p(w,g)})})),C!=null?x.sort(function(w,O){return C(w.key,O.key)}):x}return a={object:function(v){return s(v,0,jw,Vw)},map:function(v){return s(v,0,s_,u_)},entries:function(v){return p(s(v,0,s_,u_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function jw(){return{}}function Vw(e,i,r){e[i]=r}function s_(){return map()}function u_(e,i,r){e.set(i,r)}function Q0(){}var Lh=Hv.prototype;Q0.prototype=Gw.prototype={constructor:Q0,has:Lh.has,add:function(e){return e+="",this[Ec+e]=e,this},remove:Lh.remove,clear:Lh.clear,values:Lh.keys,size:Lh.size,empty:Lh.empty,each:Lh.each};function Gw(e,i){var r=new Q0;if(e instanceof Q0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var qP=null,l_=Array.prototype,J0=l_.map,Dh=l_.slice;function rh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function KP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var c_={name:"implicit"};function ev(){var e=Hv(),i=[],r=[],n=c_;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==c_)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Hv();for(var p=-1,v=s.length,g,x;++p<v;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Dh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return ev(i,r).unknown(n)},rh.apply(a,arguments),a}function f_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var w=i().length,O=n[1]<n[0],F=n[O-0],j=n[1-O];a=(j-F)/Math.max(1,w-v+g*2),p&&(a=Math.floor(a)),F+=(j-F-a*(w-v))*x,s=a*(1-v),p&&(F=Math.round(F),s=Math.round(s));var Y=sequence(w).map(function(ee){return F+a*ee});return r(O?Y.reverse():Y)}return e.domain=function(w){return arguments.length?(i(w),C()):i()},e.range=function(w){return arguments.length?(n=[+w[0],+w[1]],C()):n.slice()},e.rangeRound=function(w){return n=[+w[0],+w[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(w){return arguments.length?(p=!!w,C()):p},e.padding=function(w){return arguments.length?(v=Math.min(1,g=+w),C()):v},e.paddingInner=function(w){return arguments.length?(v=Math.min(1,w),C()):v},e.paddingOuter=function(w){return arguments.length?(g=+w,C()):g},e.align=function(w){return arguments.length?(x=Math.max(0,Math.min(1,w)),C()):x},e.copy=function(){return f_(i(),n).round(p).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function p_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return p_(i())},e}function $P(){return p_(f_.apply(null,arguments).paddingInner(1))}var Hw=Q(26257),Ww=Q(73626);function Xw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function Yw(e){return function(){return e}}function Wv(e){return+e}var h_=[0,1];function Sc(e){return e}function Xv(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:Yw(isNaN(i)?NaN:.5)}function d_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function qw(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=Xv(a,n),s=r(p,s)):(n=Xv(n,a),s=r(s,p)),function(v){return s(n(v))}}function Kw(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=Xv(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var g=q0(e,v,1,n)-1;return s[g](a[g](v))}}function tv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Yv(){var e=h_,i=h_,r=Hw.Z,n,a,s,p=Sc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?Kw:qw,g=x=null,w}function w(O){return isNaN(O=+O)?s:(g||(g=v(e.map(n),i,r)))(n(p(O)))}return w.invert=function(O){return p(a((x||(x=v(i,e.map(n),Ww.Z)))(O)))},w.domain=function(O){return arguments.length?(e=J0.call(O,Wv),p===Sc||(p=d_(e)),C()):e.slice()},w.range=function(O){return arguments.length?(i=Dh.call(O),C()):i.slice()},w.rangeRound=function(O){return i=Dh.call(O),r=Xw,C()},w.clamp=function(O){return arguments.length?(p=O?d_(e):Sc,w):p!==Sc},w.interpolate=function(O){return arguments.length?(r=O,C()):r},w.unknown=function(O){return arguments.length?(s=O,w):s},function(O,F){return n=O,a=F,C()}}function v_(e,i){return Yv()(e,i)}var $w=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rv(e){if(!(i=$w.exec(e)))throw new Error("invalid format: "+e);var i;return new qv({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}rv.prototype=qv.prototype;function qv(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}qv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Qw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function nv(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function md(e){return e=nv(Math.abs(e)),e?e[1]:NaN}function Jw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(md(i)/3)))*3-md(Math.abs(e)))}function eT(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function tT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function rT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var m_;function nT(e,i){var r=nv(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(m_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+nv(e,Math.max(0,i+s-1))[0]}function g_(e,i){var r=nv(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var y_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Qw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return g_(e*100,i)},r:g_,s:nT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function __(e){return e}var x_=Array.prototype.map,b_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function iT(e){var i=e.grouping===void 0||e.thousands===void 0?__:eT(x_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?__:tT(x_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(w){w=rv(w);var O=w.fill,F=w.align,j=w.sign,Y=w.symbol,ee=w.zero,ye=w.width,Fe=w.comma,qe=w.precision,rt=w.trim,yt=w.type;yt==="n"?(Fe=!0,yt="g"):y_[yt]||(qe===void 0&&(qe=12),rt=!0,yt="g"),(ee||O==="0"&&F==="=")&&(ee=!0,O="0",F="=");var xt=Y==="$"?r:Y==="#"&&/[boxX]/.test(yt)?"0"+yt.toLowerCase():"",Yt=Y==="$"?n:/[%p]/.test(yt)?p:"",ur=y_[yt],Ir=/[defgprs%]/.test(yt);qe=qe===void 0?6:/[gprs]/.test(yt)?Math.max(1,Math.min(21,qe)):Math.max(0,Math.min(20,qe));function tn(br){var gn=xt,In=Yt,qn,Ba,rs;if(yt==="c")In=ur(br)+In,br="";else{br=+br;var Vs=br<0||1/br<0;if(br=isNaN(br)?g:ur(Math.abs(br),qe),rt&&(br=rT(br)),Vs&&+br==0&&j!=="+"&&(Vs=!1),gn=(Vs?j==="("?j:v:j==="-"||j==="("?"":j)+gn,In=(yt==="s"?b_[8+m_/3]:"")+In+(Vs&&j==="("?")":""),Ir){for(qn=-1,Ba=br.length;++qn<Ba;)if(rs=br.charCodeAt(qn),48>rs||rs>57){In=(rs===46?a+br.slice(qn+1):br.slice(qn))+In,br=br.slice(0,qn);break}}}Fe&&!ee&&(br=i(br,Infinity));var Gs=gn.length+br.length+In.length,Qs=Gs<ye?new Array(ye-Gs+1).join(O):"";switch(Fe&&ee&&(br=i(Qs+br,Qs.length?ye-In.length:Infinity),Qs=""),F){case"<":br=gn+br+In+Qs;break;case"=":br=gn+Qs+br+In;break;case"^":br=Qs.slice(0,Gs=Qs.length>>1)+gn+br+In+Qs.slice(Gs);break;default:br=Qs+gn+br+In;break}return s(br)}return tn.toString=function(){return w+""},tn}function C(w,O){var F=x((w=rv(w),w.type="f",w)),j=Math.max(-8,Math.min(8,Math.floor(md(O)/3)))*3,Y=Math.pow(10,-j),ee=b_[8+j/3];return function(ye){return F(Y*ye)+ee}}return{format:x,formatPrefix:C}}var iv,Kv,E_;aT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function aT(e){return iv=iT(e),Kv=iv.format,E_=iv.formatPrefix,iv}function oT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,md(i)-md(e))+1}function sT(e){return Math.max(0,-md(Math.abs(e)))}function uT(e,i,r,n){var a=Gv(e,i,r),s;switch(n=rv(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=Jw(a,p))&&(n.precision=s),E_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=oT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=sT(a))&&(n.precision=s-(n.type==="%")*2);break}}return Kv(n)}function av(e){var i=e.domain;return e.ticks=function(r){var n=i();return a_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return uT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],g;return v<p&&(g=p,p=v,v=g,g=a,a=s,s=g),g=K0(p,v,r),g>0?(p=Math.floor(p/g)*g,v=Math.ceil(v/g)*g,g=K0(p,v,r)):g<0&&(p=Math.ceil(p*g)/g,v=Math.floor(v*g)/g,g=K0(p,v,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function S_(){var e=v_(Sc,Sc);return e.copy=function(){return tv(e,S_())},rh.apply(e,arguments),av(e)}function C_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=J0.call(n,Wv),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return C_(e).unknown(i)},e=arguments.length?J0.call(e,Wv):[0,1],av(r)}function A_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function w_(e){return Math.log(e)}function T_(e){return Math.exp(e)}function lT(e){return-Math.log(-e)}function cT(e){return-Math.exp(-e)}function fT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function pT(e){return e===10?fT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function hT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function M_(e){return function(i){return-e(-i)}}function dT(e){var i=e(w_,T_),r=i.domain,n=10,a,s;function p(){return a=hT(n),s=pT(n),r()[0]<0?(a=M_(a),s=M_(s),e(lT,cT)):e(w_,T_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],w;(w=C<x)&&(O=x,x=C,C=O);var O=a(x),F=a(C),j,Y,ee,ye=v==null?10:+v,Fe=[];if(!(n%1)&&F-O<ye){if(O=Math.round(O)-1,F=Math.round(F)+1,x>0){for(;O<F;++O)for(Y=1,j=s(O);Y<n;++Y)if(ee=j*Y,!(ee<x)){if(ee>C)break;Fe.push(ee)}}else for(;O<F;++O)for(Y=n-1,j=s(O);Y>=1;--Y)if(ee=j*Y,!(ee<x)){if(ee>C)break;Fe.push(ee)}}else Fe=a_(O,F,Math.min(F-O,ye)).map(s);return w?Fe.reverse():Fe},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Kv(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var w=C/s(Math.round(a(C)));return w*n<n-.5&&(w*=n),w<=x?g(C):""}},i.nice=function(){return r(A_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function P_(){var e=dT(Yv()).domain([1,10]);return e.copy=function(){return tv(e,P_()).base(e.base())},rh.apply(e,arguments),e}function I_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function O_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function vT(e){var i=1,r=e(I_(i),O_(i));return r.constant=function(n){return arguments.length?e(I_(i=+n),O_(i)):i},linearish(r)}function mT(){var e=vT(transformer());return e.copy=function(){return copy(e,mT()).constant(e.constant())},initRange.apply(e,arguments)}function R_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function gT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function yT(e){return e<0?-e*e:e*e}function _T(e){var i=e(Sc,Sc),r=1;function n(){return r===1?e(Sc,Sc):r===.5?e(gT,yT):e(R_(r),R_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},av(i)}function $v(){var e=_T(Yv());return e.copy=function(){return tv(e,$v()).exponent(e.exponent())},rh.apply(e,arguments),e}function QP(){return $v.apply(null,arguments).exponent(.5)}function k_(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=Zw(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[q0(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,g=p.length,x;v<g;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Uv),a()},s.range=function(p){return arguments.length?(i=Dh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return k_().domain(e).range(i).unknown(n)},rh.apply(s,arguments)}function L_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[q0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},p.range=function(g){return arguments.length?(r=(a=Dh.call(g)).length-1,v()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return L_().domain([e,i]).range(a).unknown(s)},rh.apply(av(p),arguments)}function D_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[q0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Dh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Dh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return D_().domain(e).range(i).unknown(r)},rh.apply(a,arguments)}var Qv=new Date,Jv=new Date;function tl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return g},a.filter=function(s){return tl(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return Qv.setTime(+s),Jv.setTime(+p),e(Qv),e(Jv),Math.floor(r(Qv,Jv))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var em=tl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});em.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:tl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var gd=em,JP=em.range,F_=tl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),xT=F_,e4=F_.range,ov=1e3,t0=6e4,B_=36e5,N_=864e5,z_=6048e5;function Fh(e){return tl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*t0)/z_})}var tm=Fh(0),sv=Fh(1),bT=Fh(2),ET=Fh(3),yd=Fh(4),ST=Fh(5),CT=Fh(6),t4=tm.range,r4=sv.range,n4=bT.range,i4=ET.range,a4=yd.range,o4=ST.range,s4=CT.range,U_=tl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*t0)/N_},function(e){return e.getDate()-1}),rm=U_,u4=U_.range,Z_=tl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ov-e.getMinutes()*t0)},function(e,i){e.setTime(+e+i*B_)},function(e,i){return(i-e)/B_},function(e){return e.getHours()}),AT=Z_,l4=Z_.range,j_=tl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ov)},function(e,i){e.setTime(+e+i*t0)},function(e,i){return(i-e)/t0},function(e){return e.getMinutes()}),wT=j_,c4=j_.range,V_=tl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*ov)},function(e,i){return(i-e)/ov},function(e){return e.getUTCSeconds()}),TT=V_,f4=V_.range,uv=tl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});uv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?tl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):uv};var MT=uv,p4=uv.range;function Bh(e){return tl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/z_})}var G_=Bh(0),lv=Bh(1),PT=Bh(2),IT=Bh(3),_d=Bh(4),OT=Bh(5),RT=Bh(6),h4=G_.range,d4=lv.range,v4=PT.range,m4=IT.range,g4=_d.range,y4=OT.range,_4=RT.range,H_=tl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/N_},function(e){return e.getUTCDate()-1}),W_=H_,x4=H_.range,nm=tl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});nm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:tl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var r0=nm,b4=nm.range;function im(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function am(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function n0(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function kT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,g=e.shortMonths,x=i0(a),C=a0(a),w=i0(s),O=a0(s),F=i0(p),j=a0(p),Y=i0(v),ee=a0(v),ye=i0(g),Fe=a0(g),qe={a:Vs,A:Gs,b:Qs,B:$c,c:null,d:Q_,e:Q_,f:r5,g:p5,G:d5,H:JT,I:e5,j:t5,L:J_,m:n5,M:i5,p:Ev,q:lP,Q:a1,s:o1,S:a5,u:o5,U:s5,V:u5,w:l5,W:c5,x:null,X:null,y:f5,Y:h5,Z:v5,"%":i1},rt={a:cP,A:fP,b:pP,B:hP,c:null,d:t1,e:t1,f:_5,g:P5,G:O5,H:m5,I:g5,j:y5,L:r1,m:x5,M:b5,p:dP,q:vP,Q:a1,s:o1,S:E5,u:S5,U:C5,V:A5,w:w5,W:T5,x:null,X:null,y:M5,Y:I5,Z:R5,"%":i1},yt={a:tn,A:br,b:gn,B:In,c:qn,d:K_,e:K_,f:qT,g:q_,G:Y_,H:$_,I:$_,j:HT,L:YT,m:GT,M:WT,p:Ir,q:VT,Q:$T,s:QT,S:XT,u:NT,U:zT,V:UT,w:BT,W:ZT,x:Ba,X:rs,y:q_,Y:Y_,Z:jT,"%":KT};qe.x=xt(r,qe),qe.X=xt(n,qe),qe.c=xt(i,qe),rt.x=xt(r,rt),rt.X=xt(n,rt),rt.c=xt(i,rt);function xt(ui,Ra){return function(Ja){var yn=[],Pl=-1,jo=0,rc=ui.length,nc,Uh,$x;for(Ja instanceof Date||(Ja=new Date(+Ja));++Pl<rc;)ui.charCodeAt(Pl)===37&&(yn.push(ui.slice(jo,Pl)),(Uh=X_[nc=ui.charAt(++Pl)])!=null?nc=ui.charAt(++Pl):Uh=nc==="e"?" ":"0",($x=Ra[nc])&&(nc=$x(Ja,Uh)),yn.push(nc),jo=Pl+1);return yn.push(ui.slice(jo,Pl)),yn.join("")}}function Yt(ui,Ra){return function(Ja){var yn=n0(1900,void 0,1),Pl=ur(yn,ui,Ja+="",0),jo,rc;if(Pl!=Ja.length)return null;if("Q"in yn)return new Date(yn.Q);if("s"in yn)return new Date(yn.s*1e3+("L"in yn?yn.L:0));if(Ra&&!("Z"in yn)&&(yn.Z=0),"p"in yn&&(yn.H=yn.H%12+yn.p*12),yn.m===void 0&&(yn.m="q"in yn?yn.q:0),"V"in yn){if(yn.V<1||yn.V>53)return null;"w"in yn||(yn.w=1),"Z"in yn?(jo=am(n0(yn.y,0,1)),rc=jo.getUTCDay(),jo=rc>4||rc===0?lv.ceil(jo):lv(jo),jo=W_.offset(jo,(yn.V-1)*7),yn.y=jo.getUTCFullYear(),yn.m=jo.getUTCMonth(),yn.d=jo.getUTCDate()+(yn.w+6)%7):(jo=im(n0(yn.y,0,1)),rc=jo.getDay(),jo=rc>4||rc===0?sv.ceil(jo):sv(jo),jo=rm.offset(jo,(yn.V-1)*7),yn.y=jo.getFullYear(),yn.m=jo.getMonth(),yn.d=jo.getDate()+(yn.w+6)%7)}else("W"in yn||"U"in yn)&&("w"in yn||(yn.w="u"in yn?yn.u%7:"W"in yn?1:0),rc="Z"in yn?am(n0(yn.y,0,1)).getUTCDay():im(n0(yn.y,0,1)).getDay(),yn.m=0,yn.d="W"in yn?(yn.w+6)%7+yn.W*7-(rc+5)%7:yn.w+yn.U*7-(rc+6)%7);return"Z"in yn?(yn.H+=yn.Z/100|0,yn.M+=yn.Z%100,am(yn)):im(yn)}}function ur(ui,Ra,Ja,yn){for(var Pl=0,jo=Ra.length,rc=Ja.length,nc,Uh;Pl<jo;){if(yn>=rc)return-1;if(nc=Ra.charCodeAt(Pl++),nc===37){if(nc=Ra.charAt(Pl++),Uh=yt[nc in X_?Ra.charAt(Pl++):nc],!Uh||(yn=Uh(ui,Ja,yn))<0)return-1}else if(nc!=Ja.charCodeAt(yn++))return-1}return yn}function Ir(ui,Ra,Ja){var yn=x.exec(Ra.slice(Ja));return yn?(ui.p=C[yn[0].toLowerCase()],Ja+yn[0].length):-1}function tn(ui,Ra,Ja){var yn=F.exec(Ra.slice(Ja));return yn?(ui.w=j[yn[0].toLowerCase()],Ja+yn[0].length):-1}function br(ui,Ra,Ja){var yn=w.exec(Ra.slice(Ja));return yn?(ui.w=O[yn[0].toLowerCase()],Ja+yn[0].length):-1}function gn(ui,Ra,Ja){var yn=ye.exec(Ra.slice(Ja));return yn?(ui.m=Fe[yn[0].toLowerCase()],Ja+yn[0].length):-1}function In(ui,Ra,Ja){var yn=Y.exec(Ra.slice(Ja));return yn?(ui.m=ee[yn[0].toLowerCase()],Ja+yn[0].length):-1}function qn(ui,Ra,Ja){return ur(ui,i,Ra,Ja)}function Ba(ui,Ra,Ja){return ur(ui,r,Ra,Ja)}function rs(ui,Ra,Ja){return ur(ui,n,Ra,Ja)}function Vs(ui){return p[ui.getDay()]}function Gs(ui){return s[ui.getDay()]}function Qs(ui){return g[ui.getMonth()]}function $c(ui){return v[ui.getMonth()]}function Ev(ui){return a[+(ui.getHours()>=12)]}function lP(ui){return 1+~~(ui.getMonth()/3)}function cP(ui){return p[ui.getUTCDay()]}function fP(ui){return s[ui.getUTCDay()]}function pP(ui){return g[ui.getUTCMonth()]}function hP(ui){return v[ui.getUTCMonth()]}function dP(ui){return a[+(ui.getUTCHours()>=12)]}function vP(ui){return 1+~~(ui.getUTCMonth()/3)}return{format:function(ui){var Ra=xt(ui+="",qe);return Ra.toString=function(){return ui},Ra},parse:function(ui){var Ra=Yt(ui+="",!1);return Ra.toString=function(){return ui},Ra},utcFormat:function(ui){var Ra=xt(ui+="",rt);return Ra.toString=function(){return ui},Ra},utcParse:function(ui){var Ra=Yt(ui+="",!0);return Ra.toString=function(){return ui},Ra}}}var X_={"-":"",_:" ","0":"0"},du=/^\s*\d+/,LT=/^%/,DT=/[\\^$*+?|[\]().{}]/g;function Qa(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function FT(e){return e.replace(DT,"\\$&")}function i0(e){return new RegExp("^(?:"+e.map(FT).join("|")+")","i")}function a0(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function BT(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function NT(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function zT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function UT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function ZT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Y_(e,i,r){var n=du.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function q_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function jT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function VT(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function GT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function K_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function HT(e,i,r){var n=du.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function $_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function WT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function XT(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function YT(e,i,r){var n=du.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function qT(e,i,r){var n=du.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function KT(e,i,r){var n=LT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function $T(e,i,r){var n=du.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function QT(e,i,r){var n=du.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Q_(e,i){return Qa(e.getDate(),i,2)}function JT(e,i){return Qa(e.getHours(),i,2)}function e5(e,i){return Qa(e.getHours()%12||12,i,2)}function t5(e,i){return Qa(1+rm.count(gd(e),e),i,3)}function J_(e,i){return Qa(e.getMilliseconds(),i,3)}function r5(e,i){return J_(e,i)+"000"}function n5(e,i){return Qa(e.getMonth()+1,i,2)}function i5(e,i){return Qa(e.getMinutes(),i,2)}function a5(e,i){return Qa(e.getSeconds(),i,2)}function o5(e){var i=e.getDay();return i===0?7:i}function s5(e,i){return Qa(tm.count(gd(e)-1,e),i,2)}function e1(e){var i=e.getDay();return i>=4||i===0?yd(e):yd.ceil(e)}function u5(e,i){return e=e1(e),Qa(yd.count(gd(e),e)+(gd(e).getDay()===4),i,2)}function l5(e){return e.getDay()}function c5(e,i){return Qa(sv.count(gd(e)-1,e),i,2)}function f5(e,i){return Qa(e.getFullYear()%100,i,2)}function p5(e,i){return e=e1(e),Qa(e.getFullYear()%100,i,2)}function h5(e,i){return Qa(e.getFullYear()%1e4,i,4)}function d5(e,i){var r=e.getDay();return e=r>=4||r===0?yd(e):yd.ceil(e),Qa(e.getFullYear()%1e4,i,4)}function v5(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Qa(i/60|0,"0",2)+Qa(i%60,"0",2)}function t1(e,i){return Qa(e.getUTCDate(),i,2)}function m5(e,i){return Qa(e.getUTCHours(),i,2)}function g5(e,i){return Qa(e.getUTCHours()%12||12,i,2)}function y5(e,i){return Qa(1+W_.count(r0(e),e),i,3)}function r1(e,i){return Qa(e.getUTCMilliseconds(),i,3)}function _5(e,i){return r1(e,i)+"000"}function x5(e,i){return Qa(e.getUTCMonth()+1,i,2)}function b5(e,i){return Qa(e.getUTCMinutes(),i,2)}function E5(e,i){return Qa(e.getUTCSeconds(),i,2)}function S5(e){var i=e.getUTCDay();return i===0?7:i}function C5(e,i){return Qa(G_.count(r0(e)-1,e),i,2)}function n1(e){var i=e.getUTCDay();return i>=4||i===0?_d(e):_d.ceil(e)}function A5(e,i){return e=n1(e),Qa(_d.count(r0(e),e)+(r0(e).getUTCDay()===4),i,2)}function w5(e){return e.getUTCDay()}function T5(e,i){return Qa(lv.count(r0(e)-1,e),i,2)}function M5(e,i){return Qa(e.getUTCFullYear()%100,i,2)}function P5(e,i){return e=n1(e),Qa(e.getUTCFullYear()%100,i,2)}function I5(e,i){return Qa(e.getUTCFullYear()%1e4,i,4)}function O5(e,i){var r=e.getUTCDay();return e=r>=4||r===0?_d(e):_d.ceil(e),Qa(e.getUTCFullYear()%1e4,i,4)}function R5(){return"+0000"}function i1(){return"%"}function a1(e){return+e}function o1(e){return Math.floor(+e/1e3)}var xd,s1,k5,L5,D5;F5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function F5(e){return xd=kT(e),s1=xd.format,k5=xd.parse,L5=xd.utcFormat,D5=xd.utcParse,xd}var o0=1e3,s0=o0*60,u0=s0*60,l0=u0*24,B5=l0*7,u1=l0*30,om=l0*365;function N5(e){return new Date(e)}function z5(e){return e instanceof Date?+e:+new Date(+e)}function l1(e,i,r,n,a,s,p,v,g){var x=v_(Sc,Sc),C=x.invert,w=x.domain,O=g(".%L"),F=g(":%S"),j=g("%I:%M"),Y=g("%I %p"),ee=g("%a %d"),ye=g("%b %d"),Fe=g("%B"),qe=g("%Y"),rt=[[p,1,o0],[p,5,5*o0],[p,15,15*o0],[p,30,30*o0],[s,1,s0],[s,5,5*s0],[s,15,15*s0],[s,30,30*s0],[a,1,u0],[a,3,3*u0],[a,6,6*u0],[a,12,12*u0],[n,1,l0],[n,2,2*l0],[r,1,B5],[i,1,u1],[i,3,3*u1],[e,1,om]];function yt(Yt){return(p(Yt)<Yt?O:s(Yt)<Yt?F:a(Yt)<Yt?j:n(Yt)<Yt?Y:i(Yt)<Yt?r(Yt)<Yt?ee:ye:e(Yt)<Yt?Fe:qe)(Yt)}function xt(Yt,ur,Ir,tn){if(Yt==null&&(Yt=10),typeof Yt=="number"){var br=Math.abs(Ir-ur)/Yt,gn=r_(function(In){return In[2]}).right(rt,br);gn===rt.length?(tn=Gv(ur/om,Ir/om,Yt),Yt=e):gn?(gn=rt[br/rt[gn-1][2]<rt[gn][2]/br?gn-1:gn],tn=gn[1],Yt=gn[0]):(tn=Math.max(Gv(ur,Ir,Yt),1),Yt=v)}return tn==null?Yt:Yt.every(tn)}return x.invert=function(Yt){return new Date(C(Yt))},x.domain=function(Yt){return arguments.length?w(J0.call(Yt,z5)):w().map(N5)},x.ticks=function(Yt,ur){var Ir=w(),tn=Ir[0],br=Ir[Ir.length-1],gn=br<tn,In;return gn&&(In=tn,tn=br,br=In),In=xt(Yt,tn,br,ur),In=In?In.range(tn,br+1):[],gn?In.reverse():In},x.tickFormat=function(Yt,ur){return ur==null?yt:g(ur)},x.nice=function(Yt,ur){var Ir=w();return(Yt=xt(Yt,Ir[0],Ir[Ir.length-1],ur))?w(A_(Ir,Yt)):x},x.copy=function(){return tv(x,l1(e,i,r,n,a,s,p,v,g))},x}function U5(){return rh.apply(l1(gd,xT,tm,rm,AT,wT,TT,MT,s1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function E4(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function cv(){var e=0,i=1,r,n,a,s,p=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function fv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Z5(){var e=linearish(cv()(identity));return e.copy=function(){return fv(e,Z5())},initInterpolator.apply(e,arguments)}function j5(){var e=loggish(cv()).domain([1,10]);return e.copy=function(){return fv(e,j5()).base(e.base())},initInterpolator.apply(e,arguments)}function V5(){var e=symlogish(cv());return e.copy=function(){return fv(e,V5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function c1(){var e=powish(cv());return e.copy=function(){return fv(e,c1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function S4(){return c1.apply(null,arguments).exponent(.5)}function G5(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return G5(i).domain(e)},initInterpolator.apply(r,arguments)}function pv(){var e=0,i=.5,r=1,n,a,s,p,v,g=identity,x,C=!1,w;function O(F){return isNaN(F=+F)?w:(F=.5+((F=+x(F))-a)*(F<a?p:v),g(C?Math.max(0,Math.min(1,F)):F))}return O.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(F){return arguments.length?(C=!!F,O):C},O.interpolator=function(F){return arguments.length?(g=F,O):g},O.unknown=function(F){return arguments.length?(w=F,O):w},function(F){return x=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function H5(){var e=linearish(pv()(identity));return e.copy=function(){return copy(e,H5())},initInterpolator.apply(e,arguments)}function W5(){var e=loggish(pv()).domain([.1,1,10]);return e.copy=function(){return copy(e,W5()).base(e.base())},initInterpolator.apply(e,arguments)}function X5(){var e=symlogish(pv());return e.copy=function(){return copy(e,X5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function f1(){var e=powish(pv());return e.copy=function(){return copy(e,f1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function C4(){return f1.apply(null,arguments).exponent(.5)}var qc,p1,h1,d1,sm,v1,Y5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,q5=(qc={},(0,R.Z)(qc,su.LINEAR,S_),(0,R.Z)(qc,su.POWER,$v),(0,R.Z)(qc,su.LOG,P_),(0,R.Z)(qc,su.IDENTITY,C_),(0,R.Z)(qc,su.TIME,U5),(0,R.Z)(qc,su.QUANTILE,k_),(0,R.Z)(qc,su.QUANTIZE,L_),(0,R.Z)(qc,su.THRESHOLD,D_),(0,R.Z)(qc,su.CAT,ev),qc),K5=(p1=(0,Nr.b2)(),h1=(0,Nr.f3)(Zt.IGlobalConfigService),p1(d1=(sm=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"configService",v1,this),(0,R.Z)(this,"scaleCache",{}),(0,R.Z)(this,"scaleOptions",{})}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===qp.VARIABLE})?(p.type=qp.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var w;if(((w=x.option)===null||w===void 0?void 0:w.type)==="linear"&&p.values.length>2){var O=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(O)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=qp.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Ur()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:qp.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=ev([r]),x.type=qp.CONSTANT),x;var C=(v=s.find(function(F){return!Tl()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Tl()(C)&&!g)x.scale=ev([r]),x.type=qp.CONSTANT;else{var w=g&&g.type||this.getDefaultType(C);a==="text"&&(w=su.CAT);var O=this.createDefaultScaleConfig(w,r,s);Object.assign(O,g),x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=su.LINEAR;return typeof r=="string"&&(n=Y5.test(r)?su.TIME:su.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==su.CAT&&r!==su.QUANTILE?s.domain=zw(p):r===su.CAT?s.domain=Sh()(p):r===su.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=q5[n]();return a&&s.domain(a),s}}]),e}(),v1=$t(sm.prototype,"configService",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm))||d1),m1,g1,y1,_1,hv,x1,b1;function E1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?E1(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Q5=(m1=(0,Nr.b2)(),g1=(0,Nr.f3)(Zt.ICameraService),y1=(0,Nr.f3)(Zt.IRendererService),m1(_1=(hv=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"cameraService",x1,this),Jt(this,"rendererService",b1,this)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms($5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),x1=$t(hv.prototype,"cameraService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b1=$t(hv.prototype,"rendererService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv))||_1),S1,C1,J5=(S1=(0,Nr.b2)(),S1(C1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||C1),A1,w1,eM=(A1=(0,Nr.b2)(),A1(w1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||w1),T1,M1,tM=["type"];function P1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function c0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?P1(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var I1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},rM={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},nM={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},iM={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},A4=null;function aM(e){var i={u_DirectionalLights:new Array(3).fill(c0({},nM)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(c0({},iM)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[rM]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,Zu.Z)(r,tM),v=I1[s].lights,g=I1[s].num,x=i[g];i[v][x]=c0(c0({},i[v][x]),p),i[g]++}),i}var oM=(T1=(0,Nr.b2)(),T1(M1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(c0({},aM()))})})}}]),e}())||M1),O1,R1,k1,um,L1,sM=(O1=(0,Nr.b2)(),R1=(0,Nr.f3)(Zt.IGlobalConfigService),O1(k1=(um=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"configService",L1,this),(0,R.Z)(this,"enabled",void 0)}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,w=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=kg(r,w,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),L1=$t(um.prototype,"configService",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um))||k1),D1,F1,dv={NONE:0,ENCODE:1,HIGHLIGHT:2},uM=(D1=(0,Nr.b2)(),D1(F1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:On.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:V.FLOAT},size:3,update:function(g,x){var C=g.id;return p?E(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:dv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:dv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,w=typeof g=="string"?c(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:d(new Uint8Array(p))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:dv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(F){return F*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,w=typeof g=="string"?c(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:d(new Uint8Array(p))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:dv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:w.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||F1),B1,N1,lM=(B1=(0,Nr.b2)(),B1(N1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:On.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:V.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:On.Attribute,descriptor:{name:"filter",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:On.Attribute,descriptor:{name:"a_Color",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:On.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||N1),z1,U1,Z1,j1,V1,G1,bd,H1,W1,X1,Y1,cM=(z1=(0,Nr.b2)(),U1=(0,Nr.f3)(Zt.ICameraService),Z1=(0,Nr.f3)(Zt.ICoordinateSystemService),j1=(0,Nr.f3)(Zt.IRendererService),V1=(0,Nr.f3)(Zt.IMapService),z1(G1=(bd=function(){function e(){(0,Vt.Z)(this,e),Jt(this,"cameraService",H1,this),Jt(this,"coordinateSystemService",W1,this),Jt(this,"rendererService",X1,this),Jt(this,"mapService",Y1,this)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var w;C.addUniforms((w={},(0,R.Z)(w,Mh.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,R.Z)(w,Mh.ViewMatrix,n.cameraService.getViewMatrix()),(0,R.Z)(w,Mh.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,R.Z)(w,Mh.Zoom,n.cameraService.getZoom()),(0,R.Z)(w,Mh.ZoomScale,n.cameraService.getZoomScale()),(0,R.Z)(w,Mh.FocalDistance,n.cameraService.getFocalDistance()),(0,R.Z)(w,Mh.CameraPosition,n.cameraService.getCameraPosition()),(0,R.Z)(w,G.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,R.Z)(w,G.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,R.Z)(w,G.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,R.Z)(w,G.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,R.Z)(w,G.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,R.Z)(w,G.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,R.Z)(w,G.Mvp,s),(0,R.Z)(w,"u_SceneCenterMKT",p),(0,R.Z)(w,"u_ViewportSize",[g,x]),(0,R.Z)(w,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,R.Z)(w,"u_DevicePixelRatio",Yi.devicePixelRatio),(0,R.Z)(w,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,R.Z)(w,"u_shaderPick",Number(r.getShaderPickStat())),w))})})}}]),e}(),H1=$t(bd.prototype,"cameraService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=$t(bd.prototype,"coordinateSystemService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=$t(bd.prototype,"rendererService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y1=$t(bd.prototype,"mapService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd))||G1),q1,K1,fM=(q1=(0,Nr.b2)(),q1(K1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||K1),$1,Q1,pM=($1=(0,Nr.b2)(),$1(Q1=function(){function e(){(0,Vt.Z)(this,e)}return(0,Wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||Q1);tc.bind(Zt.ILayerPlugin).to(Fw).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(lM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(K5).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(Dw).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(eM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(pM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(fM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(sM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(cM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(Q5).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(oM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(uM).inRequestScope(),tc.bind(Zt.ILayerPlugin).to(J5).inRequestScope();var w4="2.8.34";function J1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function T4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J1(Object(r),!0).forEach(function(n){hM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function M4(e,i){return gM(e)||mM(e,i)||vM(e,i)||dM()}function dM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vM(e,i){if(!!e){if(typeof e=="string")return ex(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ex(e,i)}}function ex(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function gM(e){if(Array.isArray(e))return e}var P4=null,I4=null,tx,lm,rx;function nx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ix(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nx(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var yM=(tx=Rv(Zt.IGlobalConfigService),lm=function(){function e(i){(0,Vt.Z)(this,e),Jt(this,"configService",rx,this),(0,R.Z)(this,"config",void 0),this.config=i}return(0,Wt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Zt.MapConfig).toConstantValue(ix(ix({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Zt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),rx=$t(lm.prototype,"configService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm),_M=Q(6158),f0=Q.n(_M);function p0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function vv(e,i){var r=Cf([],i,e);return Ju(r,r,1/r[3]),r}function O4(e,i){var r=e%i;return r<0?i+r:r}function R4(e,i,r){return r*i+(1-r)*e}function Nh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Kc=Math.PI,ax=Kc/4,hp=Kc/180,ox=180/Kc,cm=512,fm=4003e4,xM=1.5;function sx(e){return Math.pow(2,e)}function bM(e){return Math.log2(e)}function mv(e,i){var r=(0,$n.Z)(e,2),n=r[0],a=r[1];Nh(Number.isFinite(n)&&Number.isFinite(i)),Nh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=cm;var s=n*hp,p=a*hp,v=i*(s+Kc)/(2*Kc),g=i*(Kc-Math.log(Math.tan(ax+p*.5)))/(2*Kc);return[v,g]}function pm(e,i){var r=(0,$n.Z)(e,2),n=r[0],a=r[1];i*=cm;var s=n/i*(2*Kc)-Kc,p=2*(Math.atan(Math.exp(Kc-a/i*(2*Kc)))-ax);return[s*ox,p*ox]}function k4(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*hp);return bM(fm*r)-9}function ux(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:sx(n),Nh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=cm*a,x=Math.cos(i*hp),C=g/360,w=C/x,O=g/fm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-w,O],v.degreesPerPixel=[1/C,-1/w,1/O],p){var F=hp*Math.tan(i*hp)/x,j=C*F/2,Y=g/fm*F,ee=Y/w*O;v.pixelsPerDegree2=[0,-j,Y],v.pixelsPerMeter2=[ee,0,ee]}return v}function L4(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],g=p[1],x=p[2],C=1,w=ux({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=w.pixelsPerMeter,F=w.pixelsPerMeter2,j=mv(e,C);j[0]+=v*(O[0]+F[0]*g),j[1]+=g*(O[1]+F[1]*g);var Y=pm(j,C),ee=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[Y[0],Y[1],ee]:Y}function EM(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=p0();return Er(x,x,[0,0,-a]),Ar(x,x,[1,1,1/i]),yr(x,x,-r*hp),it(x,x,n*hp),g&&Ar(x,x,[1,-1,1]),p&&Er(x,x,qa.negate([],p)),x}function SM(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?xM:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,w=p*hp,O=Math.atan(.5/a),F=Math.sin(O)*a/Math.sin(Math.PI/2-w-O),j=Math.cos(Math.PI/2-w)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:j*C}}function CM(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=SM({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=v.fov,x=v.aspect,C=v.near,w=v.far,O=Gr([],g,x,C,w);return O}function AM(e,i){var r=(0,$n.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Nh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),vv(i,[n,a,p,1])}function lx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,$n.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Nh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=vv(i,[a,s,p,1]);return v}var g=vv(i,[a,s,0,1]),x=vv(i,[a,s,1,1]),C=g[2],w=x[2],O=C===w?0:((r||0)-C)/(w-C);return xi.lerp([],g,x,O)}var cx=p0(),wM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?cx:a,p=i.projectionMatrix,v=p===void 0?cx:p;(0,Vt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=p0();hr(g,g,this.projectionMatrix),hr(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=p0();Ar(x,x,[this.width/2,-this.height/2,1]),Er(x,x,[1,-1,0]),hr(x,x,this.viewProjectionMatrix);var C=Kt(p0(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Wt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Ka(r.projectionMatrix,this.projectionMatrix)&&Ka(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=AM(p,this.pixelProjectionMatrix),g=(0,$n.Z)(v,2),x=g[0],C=g[1],w=s?C:this.height-C;return r.length===2?[x,w]:[x,w,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,$n.Z)(r,3),g=v[0],x=v[1],C=v[2],w=s?x:this.height-x,O=p&&p*this.pixelsPerMeter,F=lx([g,w,C],this.pixelUnprojectionMatrix,O),j=this.unprojectPosition(F),Y=(0,$n.Z)(j,3),ee=Y[0],ye=Y[1],Fe=Y[2];return Number.isFinite(C)?[ee,ye,Fe]:Number.isFinite(p)?[ee,ye,p]:[ee,ye]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,$n.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,$n.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function TM(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,w=C===void 0?[0,0]:C,O=(0,$n.Z)(n,2),F=(0,$n.Z)(O[0],2),j=F[0],Y=F[1],ee=(0,$n.Z)(O[1],2),ye=ee[0],Fe=ee[1];if(Number.isFinite(x)){var qe=x;x={top:qe,bottom:qe,left:qe,right:qe}}else Nh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var rt=new fx({width:i,height:r,longitude:0,latitude:0,zoom:0}),yt=rt.project([j,Fe]),xt=rt.project([ye,Y]),Yt=[Math.max(Math.abs(xt[0]-yt[0]),s),Math.max(Math.abs(xt[1]-yt[1]),s)],ur=[i-x.left-x.right-Math.abs(w[0])*2,r-x.top-x.bottom-Math.abs(w[1])*2];Nh(ur[0]>0&&ur[1]>0);var Ir=ur[0]/Yt[0],tn=ur[1]/Yt[1],br=(x.right-x.left)/2/Ir,gn=(x.bottom-x.top)/2/tn,In=[(xt[0]+yt[0])/2+br,(xt[1]+yt[1])/2+gn],qn=rt.unproject(In),Ba=rt.zoom+Math.log2(Math.abs(Math.min(Ir,tn)));return{longitude:qn[0],latitude:qn[1],zoom:Math.min(Ba,v)}}var fx=function(e){(0,ln.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,w=C===void 0?0:C,O=n.pitch,F=O===void 0?0:O,j=n.bearing,Y=j===void 0?0:j,ee=n.altitude,ye=ee===void 0?1.5:ee,Fe=n.nearZMultiplier,qe=n.farZMultiplier;(0,Vt.Z)(this,i),a=a||1,s=s||1;var rt=sx(w);ye=Math.max(.75,ye);var yt=mv([x,v],rt);yt[2]=0;var xt=CM({width:a,height:s,pitch:F,bearing:Y,altitude:ye,nearZMultiplier:Fe||1/s,farZMultiplier:qe||1.01}),Yt=EM({height:s,center:yt,pitch:F,bearing:Y,altitude:ye,flipY:!0});return r=(0,Sn.Z)(this,(0,Tt.Z)(i).call(this,{width:a,height:s,viewMatrix:Yt,projectionMatrix:xt})),r.latitude=v,r.longitude=x,r.zoom=w,r.pitch=F,r.bearing=Y,r.altitude=ye,r.scale=rt,r.center=yt,r.pixelsPerMeter=ux((0,D.Z)((0,D.Z)(r))).pixelsPerMeter[2],Object.freeze((0,D.Z)((0,D.Z)(r))),r}return(0,Wt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return mv(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return pm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=lx(s,this.pixelUnprojectionMatrix),v=mv(a,this.scale),g=xi.add([],v,xi.negate([],p)),x=xi.add([],this.center,g);return pm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=TM(Object.assign({width:s,height:p,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(wM),MM=function(){function e(){(0,Vt.Z)(this,e),(0,R.Z)(this,"viewport",void 0)}return(0,Wt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new fx({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),PM=function(){function e(i){(0,Vt.Z)(this,e),(0,R.Z)(this,"size",1e4),this.size=i||1e4}return(0,Wt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),px={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},IM=["id","attributionControl","style","token","rotation","mapInstance"],hx,dx,vx,mx,gx,yx,Ed,_x,xx,bx,Ex;function Sx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function OM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sx(Object(r),!0).forEach(function(n){(0,R.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}RM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=f0();var Cx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},kM=0,LM=12,Ax="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",DM=(hx=(0,Nr.b2)(),dx=(0,Nr.f3)(Zt.MapConfig),vx=(0,Nr.f3)(Zt.IGlobalConfigService),mx=(0,Nr.f3)(Zt.ICoordinateSystemService),gx=(0,Nr.f3)(Zt.IEventEmitter),hx(yx=(Ed=function(){function e(){var i=this;(0,Vt.Z)(this,e),(0,R.Z)(this,"version",js.MAPBOX),(0,R.Z)(this,"map",void 0),(0,R.Z)(this,"simpleMapCoord",new PM),(0,R.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Jt(this,"config",_x,this),Jt(this,"configService",xx,this),Jt(this,"coordinateSystemService",bx,this),Jt(this,"eventEmitter",Ex,this),(0,R.Z)(this,"viewport",void 0),(0,R.Z)(this,"markerContainer",void 0),(0,R.Z)(this,"cameraChangedCallback",void 0),(0,R.Z)(this,"$mapContainer",void 0),(0,R.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?LM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Z.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Z.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Wt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=mi("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){b2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Cx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Cx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=hc();return Er(x,x,qa.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Ar(x,x,qa.fromValues(g*s[0],-g*s[1],g*s[2])),yr(x,x,a[0]),wr(x,x,a[1]),it(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,nn.Z)(En().mark(function n(){var a,s,p,v,g,x,C,w,O,F,j,Y,ee;return En().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,w=a.token,O=w===void 0?Ax:w,F=a.rotation,j=F===void 0?0:F,Y=a.mapInstance,ee=(0,Zu.Z)(a,IM),this.viewport=new MM,!Y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Ax&&C!=="blank"&&!window.mapboxgl.accessToken&&!Y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),Y?(this.map=Y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(OM({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:j},ee))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Fe.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(f0()).LngLat(r[0],r[1]),s=new(f0()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=f0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=f0().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,w=g.x,O=g.y,F=Math.sqrt(Math.pow(x-w,2)+Math.pow(C-O,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+kM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:px[r]?px[r]:r}}]),e}(),_x=$t(Ed.prototype,"config",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=$t(Ed.prototype,"configService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=$t(Ed.prototype,"coordinateSystemService",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=$t(Ed.prototype,"eventEmitter",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed))||yx);function FM(e){var i=BM();return function(){var n=(0,Tt.Z)(e),a;if(i){var s=(0,Tt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,Sn.Z)(this,a)}}function BM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function NM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}NM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var zM=function(e){(0,ln.Z)(r,e);var i=FM(r);function r(){return(0,Vt.Z)(this,r),i.apply(this,arguments)}return(0,Wt.Z)(r,[{key:"getServiceConstructor",value:function(){return DM}}]),r}(yM);function Tx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Tx(Object(r),!0).forEach(function(n){UM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function ZM(e,i){return HM(e)||GM(e,i)||VM(e,i)||jM()}function jM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VM(e,i){if(!!e){if(typeof e=="string")return Px(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Px(e,i)}}function Px(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function GM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function HM(e){if(Array.isArray(e))return e}var WM=He.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,He.createRef)(),v=(0,He.useState)(),g=ZM(v,2),x=g[0],C=g[1];return(0,He.useEffect)(function(){var w=new $E(Mx(Mx({id:p.current},a),{},{map:new zM(n)}));return w.on("loaded",function(){C(w),s&&s(w)}),function(){w.destroy()}},[]),(0,He.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,He.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,He.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,He.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,He.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),He.createElement($e.Provider,{value:x},(0,He.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),XM=WM;function Ix(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function D4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ix(Object(r),!0).forEach(function(n){YM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function F4(e,i){return QM(e)||$M(e,i)||KM(e,i)||qM()}function qM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KM(e,i){if(!!e){if(typeof e=="string")return Ox(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ox(e,i)}}function Ox(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $M(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function QM(e){if(Array.isArray(e))return e}var B4=null,N4=null;function Rx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function z4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rx(Object(r),!0).forEach(function(n){JM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function U4(e,i){return n3(e)||r3(e,i)||t3(e,i)||e3()}function e3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t3(e,i){if(!!e){if(typeof e=="string")return kx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kx(e,i)}}function kx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function r3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function n3(e){if(Array.isArray(e))return e}var Z4=null,j4=null;function V4(e,i){return s3(e)||o3(e,i)||a3(e,i)||i3()}function i3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a3(e,i){if(!!e){if(typeof e=="string")return Lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lx(e,i)}}function Lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function o3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function s3(e){if(Array.isArray(e))return e}var G4=null,H4=null;function Dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function W4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dx(Object(r),!0).forEach(function(n){u3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function X4(e,i){if(e==null)return{};var r=l3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function l3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var Y4=null,Fx=Q(73935);function Bx(e,i){return h3(e)||p3(e,i)||f3(e,i)||c3()}function c3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f3(e,i){if(!!e){if(typeof e=="string")return Nx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nx(e,i)}}function Nx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function p3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function h3(e){if(Array.isArray(e))return e}var zx=He.useEffect,Ux=He.useState,d3=/\B([A-Z])/g,v3=function(i){return i.replace(d3,"-$1").toLowerCase()};function q4(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Ux(),p=Bx(s,2),v=p[0],g=p[1],x=useSceneValue(),C=Ux(function(){return document.createElement("div")}),w=Bx(C,1),O=w[0];return zx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(O.className=i),r){var j=Object.keys(r).map(function(Y){return"".concat(v3(Y),":").concat(r[Y])}).join(";");O.style.cssText=j}return O},F.onRemove=function(){},g(F),x.addControl(F),function(){x.removeControl(F)}},[]),zx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var Zx=(0,He.createContext)({});function K4(){return useContext(Zx)}var Df=Q(96486),$4=He.useEffect,m3=He.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Df.isEqual),Q4=He.useEffect,g3=He.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Df.isEqual),J4=He.useEffect,y3=He.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Df.isEqual),_3=He.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Df.isEqual),x3=He.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Df.isEqual),eI=He.useEffect,b3=He.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Df.isEqual),E3=He.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Df.isEqual),S3=He.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Df.isEqual),C3=["data"];function A3(e,i){if(e==null)return{};var r=w3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function w3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var T3=He.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=A3(n,C3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Df.isEqual),tI=He.useEffect,M3=He.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Df.isEqual);function P3(e,i){return k3(e)||R3(e,i)||O3(e,i)||I3()}function I3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O3(e,i){if(!!e){if(typeof e=="string")return jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jx(e,i)}}function jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function R3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function k3(e){if(Array.isArray(e))return e}var h0=He.useEffect,L3=He.useState;function Vx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,w=i.animate,O=i.options,F=i.onLayerLoaded,j=bt(),Y=L3(function(){var Fe;switch(e){case"polygonLayer":Fe=new Vy(O);break;case"lineLayer":Fe=new WC(O);break;case"pointLayer":Fe=new YA(O);break;case"heatmapLayer":Fe=new LS(O);break;case"rasterLayer":Fe=new kw(O);break;case"imageLayer":Fe=new GS(O);break;case"citybuildingLayer":Fe=new aS(O);break;default:Fe=new Vy(O)}return Fe.on("inited",function(){F&&F(Fe,j)}),Fe}),ee=P3(Y,1),ye=ee[0];return h0(function(){return j.addLayer(ye),function(){j.removeLayer(ye)}},[]),h0(function(){ye.inited&&O&&ye.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),h0(function(){ye.inited&&(O==null?void 0:O.zIndex)&&ye.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),h0(function(){ye.inited&&(O==null?void 0:O.blend)&&ye.setBlend(O.blend)},[O==null?void 0:O.blend]),h0(function(){j.render()}),He.createElement(Zx.Provider,{value:ye},He.createElement(T3,{layer:ye,source:r}),v&&He.createElement(x3,{layer:ye,scale:v}),n&&He.createElement(y3,{layer:ye,color:n}),p&&He.createElement(S3,{layer:ye,size:p}),a&&He.createElement(E3,{layer:ye,shape:a}),s&&He.createElement(M3,{layer:ye,style:s}),g&&He.createElement(m3,{layer:ye,active:g}),x&&He.createElement(b3,{layer:ye,select:x}),C&&He.createElement(_3,{layer:ye,filter:C}),w&&He.createElement(g3,{layer:ye,animate:w}),i.children)}var rI=null,nI=null,Gx=He.memo(function(i){return Vx("pointLayer",i)}),D3=He.memo(function(i){return Vx("heatmapLayer",i)}),iI=null,aI=null,oI=null,sI=He.useEffect,uI=null,lI=null;function gv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gv=function(r){return typeof r}:gv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},gv(e)}function Hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hx(Object(r),!0).forEach(function(n){F3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function B3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Wx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N3(e,i,r){return i&&Wx(e.prototype,i),r&&Wx(e,r),e}function z3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&hm(e,i)}function hm(e,i){return hm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},hm(e,i)}function U3(e){var i=V3();return function(){var n=_v(e),a;if(i){var s=_v(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return Z3(this,a)}}function Z3(e,i){if(i&&(gv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j3(e)}function j3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _v(e){return _v=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_v(e)}var cI=function(e){z3(r,e);var i=U3(r);function r(n){var a;return B3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return N3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new Pg(yv(yv({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,g,x,C,w=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=w.toString()!==O.toString();if(F){var j;this.popup.remove(),this.popup=new Pg(yv(yv({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return He.createElement($e.Consumer,{},function(s){return s&&(a.scene=s),(0,Fx.createPortal)(a.props.children,a.el)})}}]),r}(He.PureComponent);function xv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xv=function(r){return typeof r}:xv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},xv(e)}function G3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Xx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function H3(e,i,r){return i&&Xx(e.prototype,i),r&&Xx(e,r),e}function W3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&dm(e,i)}function dm(e,i){return dm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},dm(e,i)}function X3(e){var i=K3();return function(){var n=bv(e),a;if(i){var s=bv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return Y3(this,a)}}function Y3(e,i){if(i&&(xv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q3(e)}function q3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function bv(e){return bv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},bv(e)}var fI=function(e){W3(r,e);var i=X3(r);function r(n){var a;return G3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return H3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,g=a.onMarkerLoaded,x=new Cg(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return He.createElement($e.Consumer,{},function(s){return s&&(a.scene=s),(0,Fx.createPortal)(a.props.children,a.el)})}}]),r}(He.PureComponent),pI=He.useEffect,hI=null,dI=null,vI=He.useEffect,mI=null,$3=Q(83832),di=Q(85893),Q3=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],J3=function(e){(0,St.Z)(r,e);var i=(0,or.Z)(r);function r(){var n;(0,Ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,ht.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,nr.Z)(Gt().mark(function s(){var p,v,g,x;return Gt().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(O){return O.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(O){return O.json()})]);case 2:p=w.sent,v=(0,kt.Z)(p,2),g=v[0],x=v[1],this.setState({data:g,grid:x,loading:!0});case 7:case"end":return w.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,p=a.grid,v=a.loading;return v===!1?(0,di.jsx)($3.Z,{}):(0,di.jsxs)(XM,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[p&&(0,di.jsx)(D3,{source:{data:p,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,di.jsx)(Gx,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:Q3},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,di.jsx)(Gx,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(He.Component),Yx=Q(86582),eP=Q(70499),zh=Q.n(eP);function tP(e){return e*1<10?"0".concat(e):e}function qx(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(tP(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var rP=function(e){(0,St.Z)(r,e);var i=(0,or.Z)(r);function r(){var n;(0,Ut.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:qx()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:qx()},function(){n.loopData()})},1e3)})},n}return(0,ht.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,di.jsxs)("div",{className:zh().activeChart,children:[(0,di.jsx)(ge.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,di.jsx)("div",{style:{marginTop:32},children:(0,di.jsx)(ct.m,{data:s,xField:"x",forceFit:!0,yField:"y",height:84})}),s&&(0,di.jsxs)("div",{children:[(0,di.jsxs)("div",{className:zh().activeChartGrid,children:[(0,di.jsxs)("p",{children:[(0,Yx.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,di.jsxs)("p",{children:[(0,Yx.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,di.jsx)("div",{className:zh().dashedLine,children:(0,di.jsx)("div",{className:zh().line})}),(0,di.jsx)("div",{className:zh().dashedLine,children:(0,di.jsx)("div",{className:zh().line})})]}),s&&(0,di.jsxs)("div",{className:zh().activeChartLegend,children:[(0,di.jsx)("span",{children:"00:00"}),(0,di.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,di.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(He.Component);function nP(){return vm.apply(this,arguments)}function vm(){return vm=(0,nr.Z)(Gt().mark(function e(){return Gt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,nt.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),vm.apply(this,arguments)}var iP=Q(19134),Kx=Q.n(iP),aP=ge.Z.Countdown,oP=Date.now()+1e3*60*60*24*2+1e3*30,sP=function(){var i=(0,nt.QT)(nP),r=i.loading,n=i.data,a=((n==null?void 0:n.list)||[]).map(function(s){return{id:+Date.now(),word:s.name,weight:s.value}});return(0,di.jsx)(Et.Z,{children:(0,di.jsxs)(di.Fragment,{children:[(0,di.jsxs)(X.Z,{gutter:24,children:[(0,di.jsx)(ce.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsxs)(m.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,di.jsxs)(X.Z,{children:[(0,di.jsx)(ce.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(ge.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:dr()(124543233).format("0,0")})}),(0,di.jsx)(ce.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(ge.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,di.jsx)(ce.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(aP,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:oP,format:"HH:mm:ss:SSS"})}),(0,di.jsx)(ce.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(ge.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:dr()(234).format("0,0")})})]}),(0,di.jsx)("div",{className:Kx().mapChart,children:(0,di.jsx)(J3,{})})]})}),(0,di.jsxs)(ce.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,di.jsx)(m.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,di.jsx)(rP,{})}),(0,di.jsx)(m.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,di.jsx)(ct.aC,{height:180,min:0,max:100,forceFit:!0,value:87,range:[0,25,50,75,100],statistic:{visible:!0,text:"\u4F18",color:"#30bf78"}})})]})]}),(0,di.jsxs)(X.Z,{gutter:24,children:[(0,di.jsx)(ce.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(m.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Kx().pieCard,children:(0,di.jsxs)(X.Z,{style:{padding:"16px 0"},children:[(0,di.jsx)(ce.Z,{span:8,children:(0,di.jsx)(ct.TZ,{forceFit:!0,height:128,percent:.28})}),(0,di.jsx)(ce.Z,{span:8,children:(0,di.jsx)(ct.TZ,{color:"#5DDECF",forceFit:!0,height:128,percent:.22})}),(0,di.jsx)(ce.Z,{span:8,children:(0,di.jsx)(ct.TZ,{color:"#2FC25B",forceFit:!0,height:128,percent:.32})})]})})}),(0,di.jsx)(ce.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(m.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,di.jsx)(ct.kB,{data:a,forceFit:!0,height:162,wordStyle:{fontSize:[10,20]},shape:"triangle"})})}),(0,di.jsx)(ce.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(m.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,di.jsx)(ct.Kj,{height:161,min:0,max:1e4,value:5639,forceFit:!0,padding:[0,0,0,0],statistic:{formatter:function(p){return"".concat((100*p/1e4).toFixed(1),"%")}}})})})]})]})})},uP=sP},9187:function(Cr){"use strict";Cr.exports=oe,Cr.exports.default=oe;function oe(Ee,We,Re){Re=Re||2;var _t=We&&We.length,ft=_t?We[0]*Re:Ee.length,Lt=Q(Ee,0,ft,Re,!0),Ht=[];if(!Lt||Lt.next===Lt.prev)return Ht;var Mr,Kn,Wr,na,Yn,ai,oi;if(_t&&(Lt=ce(Ee,We,Lt,Re)),Ee.length>80*Re){Mr=Wr=Ee[0],Kn=na=Ee[1];for(var ci=Re;ci<ft;ci+=Re)Yn=Ee[ci],ai=Ee[ci+1],Yn<Mr&&(Mr=Yn),ai<Kn&&(Kn=ai),Yn>Wr&&(Wr=Yn),ai>na&&(na=ai);oi=Math.max(Wr-Mr,na-Kn),oi=oi!==0?1/oi:0}return De(Lt,Ht,Re,Mr,Kn,oi),Ht}function Q(Ee,We,Re,_t,ft){var Lt,Ht;if(ft===rn(Ee,We,Re,_t)>0)for(Lt=We;Lt<Re;Lt+=_t)Ht=qt(Lt,Ee[Lt],Ee[Lt+1],Ht);else for(Lt=Re-_t;Lt>=We;Lt-=_t)Ht=qt(Lt,Ee[Lt],Ee[Lt+1],Ht);return Ht&&St(Ht,Ht.next)&&(Tr(Ht),Ht=Ht.next),Ht}function Pe(Ee,We){if(!Ee)return Ee;We||(We=Ee);var Re=Ee,_t;do if(_t=!1,!Re.steiner&&(St(Re,Re.next)||ht(Re.prev,Re,Re.next)===0)){if(Tr(Re),Re=We=Re.prev,Re===Re.next)break;_t=!0}else Re=Re.next;while(_t||Re!==We);return We}function De(Ee,We,Re,_t,ft,Lt,Ht){if(!!Ee){!Ht&&Lt&&Et(Ee,_t,ft,Lt);for(var Mr=Ee,Kn,Wr;Ee.prev!==Ee.next;){if(Kn=Ee.prev,Wr=Ee.next,Lt?Ie(Ee,_t,ft,Lt):m(Ee)){We.push(Kn.i/Re),We.push(Ee.i/Re),We.push(Wr.i/Re),Tr(Ee),Ee=Wr.next,Mr=Wr.next;continue}if(Ee=Wr,Ee===Mr){Ht?Ht===1?(Ee=X(Pe(Ee),We,Re),De(Ee,We,Re,_t,ft,Lt,2)):Ht===2&&de(Ee,We,Re,_t,ft,Lt):De(Pe(Ee),We,Re,_t,ft,Lt,1);break}}}}function m(Ee){var We=Ee.prev,Re=Ee,_t=Ee.next;if(ht(We,Re,_t)>=0)return!1;for(var ft=Ee.next.next;ft!==Ee.prev;){if(nr(We.x,We.y,Re.x,Re.y,_t.x,_t.y,ft.x,ft.y)&&ht(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0}function Ie(Ee,We,Re,_t){var ft=Ee.prev,Lt=Ee,Ht=Ee.next;if(ht(ft,Lt,Ht)>=0)return!1;for(var Mr=ft.x<Lt.x?ft.x<Ht.x?ft.x:Ht.x:Lt.x<Ht.x?Lt.x:Ht.x,Kn=ft.y<Lt.y?ft.y<Ht.y?ft.y:Ht.y:Lt.y<Ht.y?Lt.y:Ht.y,Wr=ft.x>Lt.x?ft.x>Ht.x?ft.x:Ht.x:Lt.x>Ht.x?Lt.x:Ht.x,na=ft.y>Lt.y?ft.y>Ht.y?ft.y:Ht.y:Lt.y>Ht.y?Lt.y:Ht.y,Yn=dr(Mr,Kn,We,Re,_t),ai=dr(Wr,na,We,Re,_t),oi=Ee.prevZ,ci=Ee.nextZ;oi&&oi.z>=Yn&&ci&&ci.z<=ai;){if(oi!==Ee.prev&&oi!==Ee.next&&nr(ft.x,ft.y,Lt.x,Lt.y,Ht.x,Ht.y,oi.x,oi.y)&&ht(oi.prev,oi,oi.next)>=0||(oi=oi.prevZ,ci!==Ee.prev&&ci!==Ee.next&&nr(ft.x,ft.y,Lt.x,Lt.y,Ht.x,Ht.y,ci.x,ci.y)&&ht(ci.prev,ci,ci.next)>=0))return!1;ci=ci.nextZ}for(;oi&&oi.z>=Yn;){if(oi!==Ee.prev&&oi!==Ee.next&&nr(ft.x,ft.y,Lt.x,Lt.y,Ht.x,Ht.y,oi.x,oi.y)&&ht(oi.prev,oi,oi.next)>=0)return!1;oi=oi.prevZ}for(;ci&&ci.z<=ai;){if(ci!==Ee.prev&&ci!==Ee.next&&nr(ft.x,ft.y,Lt.x,Lt.y,Ht.x,Ht.y,ci.x,ci.y)&&ht(ci.prev,ci,ci.next)>=0)return!1;ci=ci.nextZ}return!0}function X(Ee,We,Re){var _t=Ee;do{var ft=_t.prev,Lt=_t.next.next;!St(ft,Lt)&&or(ft,_t,_t.next,Lt)&&$e(ft,Lt)&&$e(Lt,ft)&&(We.push(ft.i/Re),We.push(_t.i/Re),We.push(Lt.i/Re),Tr(_t),Tr(_t.next),_t=Ee=Lt),_t=_t.next}while(_t!==Ee);return Pe(_t)}function de(Ee,We,Re,_t,ft,Lt){var Ht=Ee;do{for(var Mr=Ht.next.next;Mr!==Ht.prev;){if(Ht.i!==Mr.i&&Ut(Ht,Mr)){var Kn=et(Ht,Mr);Ht=Pe(Ht,Ht.next),Kn=Pe(Kn,Kn.next),De(Ht,We,Re,_t,ft,Lt),De(Kn,We,Re,_t,ft,Lt);return}Mr=Mr.next}Ht=Ht.next}while(Ht!==Ee)}function ce(Ee,We,Re,_t){var ft=[],Lt,Ht,Mr,Kn,Wr;for(Lt=0,Ht=We.length;Lt<Ht;Lt++)Mr=We[Lt]*_t,Kn=Lt<Ht-1?We[Lt+1]*_t:Ee.length,Wr=Q(Ee,Mr,Kn,_t,!1),Wr===Wr.next&&(Wr.steiner=!0),ft.push(kt(Wr));for(ft.sort(ze),Lt=0;Lt<ft.length;Lt++)Re=ge(ft[Lt],Re),Re=Pe(Re,Re.next);return Re}function ze(Ee,We){return Ee.x-We.x}function ge(Ee,We){var Re=nt(Ee,We);if(!Re)return We;var _t=et(Re,Ee),ft=Pe(Re,Re.next);return Pe(_t,_t.next),We===Re?ft:We}function nt(Ee,We){var Re=We,_t=Ee.x,ft=Ee.y,Lt=-Infinity,Ht;do{if(ft<=Re.y&&ft>=Re.next.y&&Re.next.y!==Re.y){var Mr=Re.x+(ft-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(Mr<=_t&&Mr>Lt){if(Lt=Mr,Mr===_t){if(ft===Re.y)return Re;if(ft===Re.next.y)return Re.next}Ht=Re.x<Re.next.x?Re:Re.next}}Re=Re.next}while(Re!==We);if(!Ht)return null;if(_t===Lt)return Ht;var Kn=Ht,Wr=Ht.x,na=Ht.y,Yn=Infinity,ai;Re=Ht;do _t>=Re.x&&Re.x>=Wr&&_t!==Re.x&&nr(ft<na?_t:Lt,ft,Wr,na,ft<na?Lt:_t,ft,Re.x,Re.y)&&(ai=Math.abs(ft-Re.y)/(_t-Re.x),$e(Re,Ee)&&(ai<Yn||ai===Yn&&(Re.x>Ht.x||Re.x===Ht.x&&ct(Ht,Re)))&&(Ht=Re,Yn=ai)),Re=Re.next;while(Re!==Kn);return Ht}function ct(Ee,We){return ht(Ee.prev,Ee,We.prev)<0&&ht(We.next,Ee,Ee.next)<0}function Et(Ee,We,Re,_t){var ft=Ee;do ft.z===null&&(ft.z=dr(ft.x,ft.y,We,Re,_t)),ft.prevZ=ft.prev,ft.nextZ=ft.next,ft=ft.next;while(ft!==Ee);ft.prevZ.nextZ=null,ft.prevZ=null,ar(ft)}function ar(Ee){var We,Re,_t,ft,Lt,Ht,Mr,Kn,Wr=1;do{for(Re=Ee,Ee=null,Lt=null,Ht=0;Re;){for(Ht++,_t=Re,Mr=0,We=0;We<Wr&&(Mr++,_t=_t.nextZ,!!_t);We++);for(Kn=Wr;Mr>0||Kn>0&&_t;)Mr!==0&&(Kn===0||!_t||Re.z<=_t.z)?(ft=Re,Re=Re.nextZ,Mr--):(ft=_t,_t=_t.nextZ,Kn--),Lt?Lt.nextZ=ft:Ee=ft,ft.prevZ=Lt,Lt=ft;Re=_t}Lt.nextZ=null,Wr*=2}while(Ht>1);return Ee}function dr(Ee,We,Re,_t,ft){return Ee=32767*(Ee-Re)*ft,We=32767*(We-_t)*ft,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,We=(We|We<<8)&16711935,We=(We|We<<4)&252645135,We=(We|We<<2)&858993459,We=(We|We<<1)&1431655765,Ee|We<<1}function kt(Ee){var We=Ee,Re=Ee;do(We.x<Re.x||We.x===Re.x&&We.y<Re.y)&&(Re=We),We=We.next;while(We!==Ee);return Re}function nr(Ee,We,Re,_t,ft,Lt,Ht,Mr){return(ft-Ht)*(We-Mr)-(Ee-Ht)*(Lt-Mr)>=0&&(Ee-Ht)*(_t-Mr)-(Re-Ht)*(We-Mr)>=0&&(Re-Ht)*(Lt-Mr)-(ft-Ht)*(_t-Mr)>=0}function Ut(Ee,We){return Ee.next.i!==We.i&&Ee.prev.i!==We.i&&!He(Ee,We)&&($e(Ee,We)&&$e(We,Ee)&&bt(Ee,We)&&(ht(Ee.prev,Ee,We.prev)||ht(Ee,We.prev,We))||St(Ee,We)&&ht(Ee.prev,Ee,Ee.next)>0&&ht(We.prev,We,We.next)>0)}function ht(Ee,We,Re){return(We.y-Ee.y)*(Re.x-We.x)-(We.x-Ee.x)*(Re.y-We.y)}function St(Ee,We){return Ee.x===We.x&&Ee.y===We.y}function or(Ee,We,Re,_t){var ft=Gt(ht(Ee,We,Re)),Lt=Gt(ht(Ee,We,_t)),Ht=Gt(ht(Re,_t,Ee)),Mr=Gt(ht(Re,_t,We));return!!(ft!==Lt&&Ht!==Mr||ft===0&&q(Ee,Re,We)||Lt===0&&q(Ee,_t,We)||Ht===0&&q(Re,Ee,_t)||Mr===0&&q(Re,We,_t))}function q(Ee,We,Re){return We.x<=Math.max(Ee.x,Re.x)&&We.x>=Math.min(Ee.x,Re.x)&&We.y<=Math.max(Ee.y,Re.y)&&We.y>=Math.min(Ee.y,Re.y)}function Gt(Ee){return Ee>0?1:Ee<0?-1:0}function He(Ee,We){var Re=Ee;do{if(Re.i!==Ee.i&&Re.next.i!==Ee.i&&Re.i!==We.i&&Re.next.i!==We.i&&or(Re,Re.next,Ee,We))return!0;Re=Re.next}while(Re!==Ee);return!1}function $e(Ee,We){return ht(Ee.prev,Ee,Ee.next)<0?ht(Ee,We,Ee.next)>=0&&ht(Ee,Ee.prev,We)>=0:ht(Ee,We,Ee.prev)<0||ht(Ee,Ee.next,We)<0}function bt(Ee,We){var Re=Ee,_t=!1,ft=(Ee.x+We.x)/2,Lt=(Ee.y+We.y)/2;do Re.y>Lt!=Re.next.y>Lt&&Re.next.y!==Re.y&&ft<(Re.next.x-Re.x)*(Lt-Re.y)/(Re.next.y-Re.y)+Re.x&&(_t=!_t),Re=Re.next;while(Re!==Ee);return _t}function et(Ee,We){var Re=new Br(Ee.i,Ee.x,Ee.y),_t=new Br(We.i,We.x,We.y),ft=Ee.next,Lt=We.prev;return Ee.next=We,We.prev=Ee,Re.next=ft,ft.prev=Re,_t.next=Re,Re.prev=_t,Lt.next=_t,_t.prev=Lt,_t}function qt(Ee,We,Re,_t){var ft=new Br(Ee,We,Re);return _t?(ft.next=_t.next,ft.prev=_t,_t.next.prev=ft,_t.next=ft):(ft.prev=ft,ft.next=ft),ft}function Tr(Ee){Ee.next.prev=Ee.prev,Ee.prev.next=Ee.next,Ee.prevZ&&(Ee.prevZ.nextZ=Ee.nextZ),Ee.nextZ&&(Ee.nextZ.prevZ=Ee.prevZ)}function Br(Ee,We,Re){this.i=Ee,this.x=We,this.y=Re,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}oe.deviation=function(Ee,We,Re,_t){var ft=We&&We.length,Lt=ft?We[0]*Re:Ee.length,Ht=Math.abs(rn(Ee,0,Lt,Re));if(ft)for(var Mr=0,Kn=We.length;Mr<Kn;Mr++){var Wr=We[Mr]*Re,na=Mr<Kn-1?We[Mr+1]*Re:Ee.length;Ht-=Math.abs(rn(Ee,Wr,na,Re))}var Yn=0;for(Mr=0;Mr<_t.length;Mr+=3){var ai=_t[Mr]*Re,oi=_t[Mr+1]*Re,ci=_t[Mr+2]*Re;Yn+=Math.abs((Ee[ai]-Ee[ci])*(Ee[oi+1]-Ee[ai+1])-(Ee[ai]-Ee[oi])*(Ee[ci+1]-Ee[ai+1]))}return Ht===0&&Yn===0?0:Math.abs((Yn-Ht)/Ht)};function rn(Ee,We,Re,_t){for(var ft=0,Lt=We,Ht=Re-_t;Lt<Re;Lt+=_t)ft+=(Ee[Ht]-Ee[Lt])*(Ee[Lt+1]+Ee[Ht+1]),Ht=Lt;return ft}oe.flatten=function(Ee){for(var We=Ee[0][0].length,Re={vertices:[],holes:[],dimensions:We},_t=0,ft=0;ft<Ee.length;ft++){for(var Lt=0;Lt<Ee[ft].length;Lt++)for(var Ht=0;Ht<We;Ht++)Re.vertices.push(Ee[ft][Lt][Ht]);ft>0&&(_t+=Ee[ft-1].length,Re.holes.push(_t))}return Re}},67709:function(Cr){function oe(Pe){var De=Pe.target||Pe.srcElement;De.__resizeRAF__&&cancelAnimationFrame(De.__resizeRAF__),De.__resizeRAF__=requestAnimationFrame(function(){var m=De.__resizeTrigger__,Ie=m&&m.__resizeListeners__;Ie&&Ie.forEach(function(X){X.call(m,Pe)})})}var Q=function(De,m){var Ie=this,X=Ie.document,de,ce=X.attachEvent;typeof navigator!="undefined"&&(de=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ze(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",oe)}if(!De.__resizeListeners__)if(De.__resizeListeners__=[],ce)De.__resizeTrigger__=De,De.attachEvent("onresize",oe);else{getComputedStyle(De).position==="static"&&(De.style.position="relative");var ge=De.__resizeTrigger__=X.createElement("object");ge.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ge.setAttribute("class","resize-sensor"),ge.setAttribute("tabindex","-1"),ge.setAttribute("title",""),ge.__resizeElement__=De,ge.onload=ze,ge.type="text/html",de&&De.appendChild(ge),ge.data="about:blank",de||De.appendChild(ge)}De.__resizeListeners__.push(m)};Cr.exports=typeof window=="undefined"?Q:Q.bind(window),Cr.exports.unbind=function(Pe,De){var m=document.attachEvent,Ie=Pe.__resizeListeners__||[];if(De){var X=Ie.indexOf(De);X!==-1&&Ie.splice(X,1)}else Ie=Pe.__resizeListeners__=[];if(!Ie.length){if(m)Pe.detachEvent("onresize",oe);else if(Pe.__resizeTrigger__){var de=Pe.__resizeTrigger__.contentDocument,ce=de&&de.defaultView;ce&&(ce.removeEventListener("resize",oe),delete ce.__resizeTrigger__),Pe.__resizeTrigger__=!Pe.removeChild(Pe.__resizeTrigger__)}delete Pe.__resizeListeners__}}},26729:function(Cr){"use strict";var oe=Object.prototype.hasOwnProperty,Q="~";function Pe(){}Object.create&&(Pe.prototype=Object.create(null),new Pe().__proto__||(Q=!1));function De(de,ce,ze){this.fn=de,this.context=ce,this.once=ze||!1}function m(de,ce,ze,ge,nt){if(typeof ze!="function")throw new TypeError("The listener must be a function");var ct=new De(ze,ge||de,nt),Et=Q?Q+ce:ce;return de._events[Et]?de._events[Et].fn?de._events[Et]=[de._events[Et],ct]:de._events[Et].push(ct):(de._events[Et]=ct,de._eventsCount++),de}function Ie(de,ce){--de._eventsCount==0?de._events=new Pe:delete de._events[ce]}function X(){this._events=new Pe,this._eventsCount=0}X.prototype.eventNames=function(){var ce=[],ze,ge;if(this._eventsCount===0)return ce;for(ge in ze=this._events)oe.call(ze,ge)&&ce.push(Q?ge.slice(1):ge);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(ze)):ce},X.prototype.listeners=function(ce){var ze=Q?Q+ce:ce,ge=this._events[ze];if(!ge)return[];if(ge.fn)return[ge.fn];for(var nt=0,ct=ge.length,Et=new Array(ct);nt<ct;nt++)Et[nt]=ge[nt].fn;return Et},X.prototype.listenerCount=function(ce){var ze=Q?Q+ce:ce,ge=this._events[ze];return ge?ge.fn?1:ge.length:0},X.prototype.emit=function(ce,ze,ge,nt,ct,Et){var ar=Q?Q+ce:ce;if(!this._events[ar])return!1;var dr=this._events[ar],kt=arguments.length,nr,Ut;if(dr.fn){switch(dr.once&&this.removeListener(ce,dr.fn,void 0,!0),kt){case 1:return dr.fn.call(dr.context),!0;case 2:return dr.fn.call(dr.context,ze),!0;case 3:return dr.fn.call(dr.context,ze,ge),!0;case 4:return dr.fn.call(dr.context,ze,ge,nt),!0;case 5:return dr.fn.call(dr.context,ze,ge,nt,ct),!0;case 6:return dr.fn.call(dr.context,ze,ge,nt,ct,Et),!0}for(Ut=1,nr=new Array(kt-1);Ut<kt;Ut++)nr[Ut-1]=arguments[Ut];dr.fn.apply(dr.context,nr)}else{var ht=dr.length,St;for(Ut=0;Ut<ht;Ut++)switch(dr[Ut].once&&this.removeListener(ce,dr[Ut].fn,void 0,!0),kt){case 1:dr[Ut].fn.call(dr[Ut].context);break;case 2:dr[Ut].fn.call(dr[Ut].context,ze);break;case 3:dr[Ut].fn.call(dr[Ut].context,ze,ge);break;case 4:dr[Ut].fn.call(dr[Ut].context,ze,ge,nt);break;default:if(!nr)for(St=1,nr=new Array(kt-1);St<kt;St++)nr[St-1]=arguments[St];dr[Ut].fn.apply(dr[Ut].context,nr)}}return!0},X.prototype.on=function(ce,ze,ge){return m(this,ce,ze,ge,!1)},X.prototype.once=function(ce,ze,ge){return m(this,ce,ze,ge,!0)},X.prototype.removeListener=function(ce,ze,ge,nt){var ct=Q?Q+ce:ce;if(!this._events[ct])return this;if(!ze)return Ie(this,ct),this;var Et=this._events[ct];if(Et.fn)Et.fn===ze&&(!nt||Et.once)&&(!ge||Et.context===ge)&&Ie(this,ct);else{for(var ar=0,dr=[],kt=Et.length;ar<kt;ar++)(Et[ar].fn!==ze||nt&&!Et[ar].once||ge&&Et[ar].context!==ge)&&dr.push(Et[ar]);dr.length?this._events[ct]=dr.length===1?dr[0]:dr:Ie(this,ct)}return this},X.prototype.removeAllListeners=function(ce){var ze;return ce?(ze=Q?Q+ce:ce,this._events[ze]&&Ie(this,ze)):(this._events=new Pe,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=Q,X.EventEmitter=X,Cr.exports=X},7375:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0});var Q=Symbol.for("INJECTION");function Pe(de,ce,ze,ge){function nt(){return ge&&!Reflect.hasMetadata(Q,this,ce)&&Reflect.defineMetadata(Q,ze(),this,ce),Reflect.hasMetadata(Q,this,ce)?Reflect.getMetadata(Q,this,ce):ze()}function ct(Et){Reflect.defineMetadata(Q,Et,this,ce)}Object.defineProperty(de,ce,{configurable:!0,enumerable:!0,get:nt,set:ct})}function De(de,ce){return function(ze){return function(ge,nt){var ct=function(){return de.get(ze)};Pe(ge,nt,ct,ce)}}}oe.makePropertyInjectDecorator=De;function m(de,ce){return function(ze,ge){return function(nt,ct){var Et=function(){return de.getNamed(ze,ge)};Pe(nt,ct,Et,ce)}}}oe.makePropertyInjectNamedDecorator=m;function Ie(de,ce){return function(ze,ge,nt){return function(ct,Et){var ar=function(){return de.getTagged(ze,ge,nt)};Pe(ct,Et,ar,ce)}}}oe.makePropertyInjectTaggedDecorator=Ie;function X(de,ce){return function(ze){return function(ge,nt){var ct=function(){return de.getAll(ze)};Pe(ge,nt,ct,ce)}}}oe.makePropertyMultiInjectDecorator=X},84879:function(Cr,oe,Q){"use strict";var Pe;Pe={value:!0};var De=Q(7375);function m(Ie,X){X===void 0&&(X=!0);var de=De.makePropertyInjectDecorator(Ie,X),ce=De.makePropertyInjectNamedDecorator(Ie,X),ze=De.makePropertyInjectTaggedDecorator(Ie,X),ge=De.makePropertyMultiInjectDecorator(Ie,X);return{lazyInject:de,lazyInjectNamed:ce,lazyInjectTagged:ze,lazyMultiInject:ge}}oe.Z=m},99934:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.tagProperty=oe.tagParameter=oe.decorate=void 0;var Pe=Q(16674),De=Q(6867);function m(ge,nt,ct,Et){var ar=De.TAGGED;X(ar,ge,nt,Et,ct)}oe.tagParameter=m;function Ie(ge,nt,ct){var Et=De.TAGGED_PROP;X(Et,ge.constructor,nt,ct)}oe.tagProperty=Ie;function X(ge,nt,ct,Et,ar){var dr={},kt=typeof ar=="number",nr=ar!==void 0&&kt?ar.toString():ct;if(kt&&ct!==void 0)throw new Error(Pe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ge,nt)&&(dr=Reflect.getMetadata(ge,nt));var Ut=dr[nr];if(!Array.isArray(Ut))Ut=[];else for(var ht=0,St=Ut;ht<St.length;ht++){var or=St[ht];if(or.key===Et.key)throw new Error(Pe.DUPLICATED_METADATA+" "+or.key.toString())}Ut.push(Et),dr[nr]=Ut,Reflect.defineMetadata(ge,dr,nt)}function de(ge,nt){Reflect.decorate(ge,nt)}function ce(ge,nt){return function(ct,Et){nt(ct,Et,ge)}}function ze(ge,nt,ct){typeof ct=="number"?de([ce(ct,ge)],nt):typeof ct=="string"?Reflect.decorate([ge],nt,ct):de([ge],nt)}oe.decorate=ze},5744:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.inject=oe.LazyServiceIdentifer=void 0;var Pe=Q(16674),De=Q(6867),m=Q(47738),Ie=Q(99934),X=function(){function ce(ze){this._cb=ze}return ce.prototype.unwrap=function(){return this._cb()},ce}();oe.LazyServiceIdentifer=X;function de(ce){return function(ze,ge,nt){if(ce===void 0)throw new Error(Pe.UNDEFINED_INJECT_ANNOTATION(ze.name));var ct=new m.Metadata(De.INJECT_TAG,ce);typeof nt=="number"?Ie.tagParameter(ze,ge,nt,ct):Ie.tagProperty(ze,ge,ct)}}oe.inject=de},64315:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.injectable=void 0;var Pe=Q(16674),De=Q(6867);function m(){return function(Ie){if(Reflect.hasOwnMetadata(De.PARAM_TYPES,Ie))throw new Error(Pe.DUPLICATED_INJECTABLE_DECORATOR);var X=Reflect.getMetadata(De.DESIGN_PARAM_TYPES,Ie)||[];return Reflect.defineMetadata(De.PARAM_TYPES,X,Ie),Ie}}oe.injectable=m},71693:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.multiInject=void 0;var Pe=Q(6867),De=Q(47738),m=Q(99934);function Ie(X){return function(de,ce,ze){var ge=new De.Metadata(Pe.MULTI_INJECT_TAG,X);typeof ze=="number"?m.tagParameter(de,ce,ze,ge):m.tagProperty(de,ce,ge)}}oe.multiInject=Ie},38085:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.named=void 0;var Pe=Q(6867),De=Q(47738),m=Q(99934);function Ie(X){return function(de,ce,ze){var ge=new De.Metadata(Pe.NAMED_TAG,X);typeof ze=="number"?m.tagParameter(de,ce,ze,ge):m.tagProperty(de,ce,ge)}}oe.named=Ie},6515:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.optional=void 0;var Pe=Q(6867),De=Q(47738),m=Q(99934);function Ie(){return function(X,de,ce){var ze=new De.Metadata(Pe.OPTIONAL_TAG,!0);typeof ce=="number"?m.tagParameter(X,de,ce,ze):m.tagProperty(X,de,ze)}}oe.optional=Ie},7014:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.postConstruct=void 0;var Pe=Q(16674),De=Q(6867),m=Q(47738);function Ie(){return function(X,de,ce){var ze=new m.Metadata(De.POST_CONSTRUCT,de);if(Reflect.hasOwnMetadata(De.POST_CONSTRUCT,X.constructor))throw new Error(Pe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(De.POST_CONSTRUCT,ze,X.constructor)}}oe.postConstruct=Ie},32052:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.tagged=void 0;var Pe=Q(47738),De=Q(99934);function m(Ie,X){return function(de,ce,ze){var ge=new Pe.Metadata(Ie,X);typeof ze=="number"?De.tagParameter(de,ce,ze,ge):De.tagProperty(de,ce,ge)}}oe.tagged=m},55638:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.targetName=void 0;var Pe=Q(6867),De=Q(47738),m=Q(99934);function Ie(X){return function(de,ce,ze){var ge=new De.Metadata(Pe.NAME_TAG,X);m.tagParameter(de,ce,ze,ge)}}oe.targetName=Ie},86757:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.unmanaged=void 0;var Pe=Q(6867),De=Q(47738),m=Q(99934);function Ie(){return function(X,de,ce){var ze=new De.Metadata(Pe.UNMANAGED_TAG,!0);m.tagParameter(X,de,ce,ze)}}oe.unmanaged=Ie},44290:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Binding=void 0;var Pe=Q(28421),De=Q(37791),m=function(){function Ie(X,de){this.id=De.id(),this.activated=!1,this.serviceIdentifier=X,this.scope=de,this.type=Pe.BindingTypeEnum.Invalid,this.constraint=function(ce){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ie.prototype.clone=function(){var X=new Ie(this.serviceIdentifier,this.scope);return X.activated=X.scope===Pe.BindingScopeEnum.Singleton?this.activated:!1,X.implementationType=this.implementationType,X.dynamicValue=this.dynamicValue,X.scope=this.scope,X.type=this.type,X.factory=this.factory,X.provider=this.provider,X.constraint=this.constraint,X.onActivation=this.onActivation,X.cache=this.cache,X},Ie}();oe.Binding=m},23184:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingCount=void 0;var Q={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};oe.BindingCount=Q},16674:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.STACK_OVERFLOW=oe.CIRCULAR_DEPENDENCY_IN_FACTORY=oe.POST_CONSTRUCT_ERROR=oe.MULTIPLE_POST_CONSTRUCT_METHODS=oe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=oe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=oe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=oe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=oe.ARGUMENTS_LENGTH_MISMATCH=oe.INVALID_DECORATOR_OPERATION=oe.INVALID_TO_SELF_VALUE=oe.INVALID_FUNCTION_BINDING=oe.INVALID_MIDDLEWARE_RETURN=oe.NO_MORE_SNAPSHOTS_AVAILABLE=oe.INVALID_BINDING_TYPE=oe.NOT_IMPLEMENTED=oe.CIRCULAR_DEPENDENCY=oe.UNDEFINED_INJECT_ANNOTATION=oe.MISSING_INJECT_ANNOTATION=oe.MISSING_INJECTABLE_ANNOTATION=oe.NOT_REGISTERED=oe.CANNOT_UNBIND=oe.AMBIGUOUS_MATCH=oe.KEY_NOT_FOUND=oe.NULL_ARGUMENT=oe.DUPLICATED_METADATA=oe.DUPLICATED_INJECTABLE_DECORATOR=void 0,oe.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",oe.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",oe.NULL_ARGUMENT="NULL argument",oe.KEY_NOT_FOUND="Key Not Found",oe.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",oe.CANNOT_UNBIND="Could not unbind serviceIdentifier:",oe.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",oe.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",oe.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Q=function(Ie){return"@inject called with undefined this could mean that the class "+Ie+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};oe.UNDEFINED_INJECT_ANNOTATION=Q,oe.CIRCULAR_DEPENDENCY="Circular dependency found:",oe.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",oe.INVALID_BINDING_TYPE="Invalid binding type:",oe.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",oe.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",oe.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",oe.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",oe.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Pe=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"The number of constructor arguments in the derived class "+(Ie[0]+" must be >= than the number of constructor arguments of its base class.")};oe.ARGUMENTS_LENGTH_MISMATCH=Pe,oe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",oe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",oe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",oe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",oe.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var De=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"@postConstruct error in class "+Ie[0]+": "+Ie[1]};oe.POST_CONSTRUCT_ERROR=De;var m=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"It looks like there is a circular dependency "+("in one of the '"+Ie[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ie[1]+"'.")};oe.CIRCULAR_DEPENDENCY_IN_FACTORY=m,oe.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.TargetTypeEnum=oe.BindingTypeEnum=oe.BindingScopeEnum=void 0;var Q={Request:"Request",Singleton:"Singleton",Transient:"Transient"};oe.BindingScopeEnum=Q;var Pe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};oe.BindingTypeEnum=Pe;var De={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};oe.TargetTypeEnum=De},6867:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.NON_CUSTOM_TAG_KEYS=oe.POST_CONSTRUCT=oe.DESIGN_PARAM_TYPES=oe.PARAM_TYPES=oe.TAGGED_PROP=oe.TAGGED=oe.MULTI_INJECT_TAG=oe.INJECT_TAG=oe.OPTIONAL_TAG=oe.UNMANAGED_TAG=oe.NAME_TAG=oe.NAMED_TAG=void 0,oe.NAMED_TAG="named",oe.NAME_TAG="name",oe.UNMANAGED_TAG="unmanaged",oe.OPTIONAL_TAG="optional",oe.INJECT_TAG="inject",oe.MULTI_INJECT_TAG="multi_inject",oe.TAGGED="inversify:tagged",oe.TAGGED_PROP="inversify:tagged_props",oe.PARAM_TYPES="inversify:paramtypes",oe.DESIGN_PARAM_TYPES="design:paramtypes",oe.POST_CONSTRUCT="post_construct";function Q(){return[oe.INJECT_TAG,oe.MULTI_INJECT_TAG,oe.NAME_TAG,oe.UNMANAGED_TAG,oe.NAMED_TAG,oe.OPTIONAL_TAG]}oe.NON_CUSTOM_TAG_KEYS=Q()},51389:function(Cr,oe,Q){"use strict";var Pe=this&&this.__awaiter||function(Ut,ht,St,or){function q(Gt){return Gt instanceof St?Gt:new St(function(He){He(Gt)})}return new(St||(St=Promise))(function(Gt,He){function $e(qt){try{et(or.next(qt))}catch(Tr){He(Tr)}}function bt(qt){try{et(or.throw(qt))}catch(Tr){He(Tr)}}function et(qt){qt.done?Gt(qt.value):q(qt.value).then($e,bt)}et((or=or.apply(Ut,ht||[])).next())})},De=this&&this.__generator||function(Ut,ht){var St={label:0,sent:function(){if(Gt[0]&1)throw Gt[1];return Gt[1]},trys:[],ops:[]},or,q,Gt,He;return He={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(He[Symbol.iterator]=function(){return this}),He;function $e(et){return function(qt){return bt([et,qt])}}function bt(et){if(or)throw new TypeError("Generator is already executing.");for(;St;)try{if(or=1,q&&(Gt=et[0]&2?q.return:et[0]?q.throw||((Gt=q.return)&&Gt.call(q),0):q.next)&&!(Gt=Gt.call(q,et[1])).done)return Gt;switch(q=0,Gt&&(et=[et[0]&2,Gt.value]),et[0]){case 0:case 1:Gt=et;break;case 4:return St.label++,{value:et[1],done:!1};case 5:St.label++,q=et[1],et=[0];continue;case 7:et=St.ops.pop(),St.trys.pop();continue;default:if(Gt=St.trys,!(Gt=Gt.length>0&&Gt[Gt.length-1])&&(et[0]===6||et[0]===2)){St=0;continue}if(et[0]===3&&(!Gt||et[1]>Gt[0]&&et[1]<Gt[3])){St.label=et[1];break}if(et[0]===6&&St.label<Gt[1]){St.label=Gt[1],Gt=et;break}if(Gt&&St.label<Gt[2]){St.label=Gt[2],St.ops.push(et);break}Gt[2]&&St.ops.pop(),St.trys.pop();continue}et=ht.call(Ut,St)}catch(qt){et=[6,qt],q=0}finally{or=Gt=0}if(et[0]&5)throw et[1];return{value:et[0]?et[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Ut,ht){for(var St=0,or=ht.length,q=Ut.length;St<or;St++,q++)Ut[q]=ht[St];return Ut};Object.defineProperty(oe,"__esModule",{value:!0}),oe.Container=void 0;var Ie=Q(44290),X=Q(16674),de=Q(28421),ce=Q(6867),ze=Q(51377),ge=Q(86311),nt=Q(31927),ct=Q(15451),Et=Q(37791),ar=Q(55800),dr=Q(85700),kt=Q(80175),nr=function(){function Ut(ht){this._appliedMiddleware=[];var St=ht||{};if(typeof St!="object")throw new Error(""+X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(St.defaultScope===void 0)St.defaultScope=de.BindingScopeEnum.Transient;else if(St.defaultScope!==de.BindingScopeEnum.Singleton&&St.defaultScope!==de.BindingScopeEnum.Transient&&St.defaultScope!==de.BindingScopeEnum.Request)throw new Error(""+X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(St.autoBindInjectable===void 0)St.autoBindInjectable=!1;else if(typeof St.autoBindInjectable!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(St.skipBaseClassChecks===void 0)St.skipBaseClassChecks=!1;else if(typeof St.skipBaseClassChecks!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:St.autoBindInjectable,defaultScope:St.defaultScope,skipBaseClassChecks:St.skipBaseClassChecks},this.id=Et.id(),this._bindingDictionary=new kt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ze.MetadataReader}return Ut.merge=function(ht,St){for(var or=[],q=2;q<arguments.length;q++)or[q-2]=arguments[q];var Gt=new Ut,He=m([ht,St],or).map(function(et){return ge.getBindingDictionary(et)}),$e=ge.getBindingDictionary(Gt);function bt(et,qt){et.traverse(function(Tr,Br){Br.forEach(function(rn){qt.add(rn.serviceIdentifier,rn.clone())})})}return He.forEach(function(et){bt(et,$e)}),Gt},Ut.prototype.load=function(){for(var ht=[],St=0;St<arguments.length;St++)ht[St]=arguments[St];for(var or=this._getContainerModuleHelpersFactory(),q=0,Gt=ht;q<Gt.length;q++){var He=Gt[q],$e=or(He.id);He.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var ht=[],St=0;St<arguments.length;St++)ht[St]=arguments[St];return Pe(this,void 0,void 0,function(){var or,q,Gt,He,$e;return De(this,function(bt){switch(bt.label){case 0:or=this._getContainerModuleHelpersFactory(),q=0,Gt=ht,bt.label=1;case 1:return q<Gt.length?(He=Gt[q],$e=or(He.id),[4,He.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)]):[3,4];case 2:bt.sent(),bt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var ht=this,St=[],or=0;or<arguments.length;or++)St[or]=arguments[or];var q=function(Gt){return function(He){return He.moduleId===Gt}};St.forEach(function(Gt){var He=q(Gt.id);ht._bindingDictionary.removeByCondition(He)})},Ut.prototype.bind=function(ht){var St=this.options.defaultScope||de.BindingScopeEnum.Transient,or=new Ie.Binding(ht,St);return this._bindingDictionary.add(ht,or),new ct.BindingToSyntax(or)},Ut.prototype.rebind=function(ht){return this.unbind(ht),this.bind(ht)},Ut.prototype.unbind=function(ht){try{this._bindingDictionary.remove(ht)}catch(St){throw new Error(X.CANNOT_UNBIND+" "+ar.getServiceIdentifierAsString(ht))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new kt.Lookup},Ut.prototype.isBound=function(ht){var St=this._bindingDictionary.hasKey(ht);return!St&&this.parent&&(St=this.parent.isBound(ht)),St},Ut.prototype.isBoundNamed=function(ht,St){return this.isBoundTagged(ht,ce.NAMED_TAG,St)},Ut.prototype.isBoundTagged=function(ht,St,or){var q=!1;if(this._bindingDictionary.hasKey(ht)){var Gt=this._bindingDictionary.get(ht),He=ge.createMockRequest(this,ht,St,or);q=Gt.some(function($e){return $e.constraint(He)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(ht,St,or)),q},Ut.prototype.snapshot=function(){this._snapshots.push(dr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var ht=this._snapshots.pop();if(ht===void 0)throw new Error(X.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ht.bindings,this._middleware=ht.middleware},Ut.prototype.createChild=function(ht){var St=new Ut(ht||this.options);return St.parent=this,St},Ut.prototype.applyMiddleware=function(){for(var ht=[],St=0;St<arguments.length;St++)ht[St]=arguments[St];this._appliedMiddleware=this._appliedMiddleware.concat(ht);var or=this._middleware?this._middleware:this._planAndResolve();this._middleware=ht.reduce(function(q,Gt){return Gt(q)},or)},Ut.prototype.applyCustomMetadataReader=function(ht){this._metadataReader=ht},Ut.prototype.get=function(ht){return this._get(!1,!1,de.TargetTypeEnum.Variable,ht)},Ut.prototype.getTagged=function(ht,St,or){return this._get(!1,!1,de.TargetTypeEnum.Variable,ht,St,or)},Ut.prototype.getNamed=function(ht,St){return this.getTagged(ht,ce.NAMED_TAG,St)},Ut.prototype.getAll=function(ht){return this._get(!0,!0,de.TargetTypeEnum.Variable,ht)},Ut.prototype.getAllTagged=function(ht,St,or){return this._get(!1,!0,de.TargetTypeEnum.Variable,ht,St,or)},Ut.prototype.getAllNamed=function(ht,St){return this.getAllTagged(ht,ce.NAMED_TAG,St)},Ut.prototype.resolve=function(ht){var St=this.createChild();return St.bind(ht).toSelf(),this._appliedMiddleware.forEach(function(or){St.applyMiddleware(or)}),St.get(ht)},Ut.prototype._getContainerModuleHelpersFactory=function(){var ht=this,St=function($e,bt){$e._binding.moduleId=bt},or=function($e){return function(bt){var et=ht.bind.bind(ht),qt=et(bt);return St(qt,$e),qt}},q=function($e){return function(bt){var et=ht.unbind.bind(ht);et(bt)}},Gt=function($e){return function(bt){var et=ht.isBound.bind(ht);return et(bt)}},He=function($e){return function(bt){var et=ht.rebind.bind(ht),qt=et(bt);return St(qt,$e),qt}};return function($e){return{bindFunction:or($e),isboundFunction:Gt($e),rebindFunction:He($e),unbindFunction:q($e)}}},Ut.prototype._get=function(ht,St,or,q,Gt,He){var $e=null,bt={avoidConstraints:ht,contextInterceptor:function(et){return et},isMultiInject:St,key:Gt,serviceIdentifier:q,targetType:or,value:He};if(this._middleware){if($e=this._middleware(bt),$e==null)throw new Error(X.INVALID_MIDDLEWARE_RETURN)}else $e=this._planAndResolve()(bt);return $e},Ut.prototype._planAndResolve=function(){var ht=this;return function(St){var or=ge.plan(ht._metadataReader,ht,St.isMultiInject,St.targetType,St.serviceIdentifier,St.key,St.value,St.avoidConstraints);or=St.contextInterceptor(or);var q=nt.resolve(or);return q}},Ut}();oe.Container=nr},33244:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.AsyncContainerModule=oe.ContainerModule=void 0;var Pe=Q(37791),De=function(){function Ie(X){this.id=Pe.id(),this.registry=X}return Ie}();oe.ContainerModule=De;var m=function(){function Ie(X){this.id=Pe.id(),this.registry=X}return Ie}();oe.AsyncContainerModule=m},85700:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.ContainerSnapshot=void 0;var Q=function(){function Pe(){}return Pe.of=function(De,m){var Ie=new Pe;return Ie.bindings=De,Ie.middleware=m,Ie},Pe}();oe.ContainerSnapshot=Q},80175:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Lookup=void 0;var Pe=Q(16674),De=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(Ie,X){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(X==null)throw new Error(Pe.NULL_ARGUMENT);var de=this._map.get(Ie);de!==void 0?(de.push(X),this._map.set(Ie,de)):this._map.set(Ie,[X])},m.prototype.get=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);var X=this._map.get(Ie);if(X!==void 0)return X;throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.remove=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);if(!this._map.delete(Ie))throw new Error(Pe.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(Ie){var X=this;this._map.forEach(function(de,ce){var ze=de.filter(function(ge){return!Ie(ge)});ze.length>0?X._map.set(ce,ze):X._map.delete(ce)})},m.prototype.hasKey=function(Ie){if(Ie==null)throw new Error(Pe.NULL_ARGUMENT);return this._map.has(Ie)},m.prototype.clone=function(){var Ie=new m;return this._map.forEach(function(X,de){X.forEach(function(ce){return Ie.add(de,ce.clone())})}),Ie},m.prototype.traverse=function(Ie){this._map.forEach(function(X,de){Ie(de,X)})},m}();oe.Lookup=De},86700:function(Cr,oe,Q){"use strict";var Pe;Pe={value:!0},Pe=Pe=Pe=Pe=Pe=Pe=oe.GW=Pe=Pe=oe.zY=Pe=Pe=Pe=Pe=Pe=oe.f3=Pe=Pe=oe.b2=Pe=Pe=Pe=Pe=Pe=oe.W2=Pe=void 0;var De=Q(6867);Pe=De;var m=Q(51389);Object.defineProperty(oe,"W2",{enumerable:!0,get:function(){return m.Container}});var Ie=Q(28421);Pe={enumerable:!0,get:function(){return Ie.BindingScopeEnum}},Pe={enumerable:!0,get:function(){return Ie.BindingTypeEnum}},Pe={enumerable:!0,get:function(){return Ie.TargetTypeEnum}};var X=Q(33244);Pe={enumerable:!0,get:function(){return X.AsyncContainerModule}},Pe={enumerable:!0,get:function(){return X.ContainerModule}};var de=Q(64315);Object.defineProperty(oe,"b2",{enumerable:!0,get:function(){return de.injectable}});var ce=Q(32052);Pe={enumerable:!0,get:function(){return ce.tagged}};var ze=Q(38085);Pe={enumerable:!0,get:function(){return ze.named}};var ge=Q(5744);Object.defineProperty(oe,"f3",{enumerable:!0,get:function(){return ge.inject}}),Pe={enumerable:!0,get:function(){return ge.LazyServiceIdentifer}};var nt=Q(6515);Pe={enumerable:!0,get:function(){return nt.optional}};var ct=Q(86757);Pe={enumerable:!0,get:function(){return ct.unmanaged}};var Et=Q(71693);Pe={enumerable:!0,get:function(){return Et.multiInject}};var ar=Q(55638);Pe={enumerable:!0,get:function(){return ar.targetName}};var dr=Q(7014);Object.defineProperty(oe,"zY",{enumerable:!0,get:function(){return dr.postConstruct}});var kt=Q(51377);Pe={enumerable:!0,get:function(){return kt.MetadataReader}};var nr=Q(37791);Pe={enumerable:!0,get:function(){return nr.id}};var Ut=Q(99934);Object.defineProperty(oe,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var ht=Q(80758);Pe={enumerable:!0,get:function(){return ht.traverseAncerstors}},Pe={enumerable:!0,get:function(){return ht.taggedConstraint}},Pe={enumerable:!0,get:function(){return ht.namedConstraint}},Pe={enumerable:!0,get:function(){return ht.typeConstraint}};var St=Q(55800);Pe={enumerable:!0,get:function(){return St.getServiceIdentifierAsString}};var or=Q(70600);Pe={enumerable:!0,get:function(){return or.multiBindToService}}},95228:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Context=void 0;var Pe=Q(37791),De=function(){function m(Ie){this.id=Pe.id(),this.container=Ie}return m.prototype.addPlan=function(Ie){this.plan=Ie},m.prototype.setCurrentRequest=function(Ie){this.currentRequest=Ie},m}();oe.Context=De},47738:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Metadata=void 0;var Pe=Q(6867),De=function(){function m(Ie,X){this.key=Ie,this.value=X}return m.prototype.toString=function(){return this.key===Pe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();oe.Metadata=De},51377:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.MetadataReader=void 0;var Pe=Q(6867),De=function(){function m(){}return m.prototype.getConstructorMetadata=function(Ie){var X=Reflect.getMetadata(Pe.PARAM_TYPES,Ie),de=Reflect.getMetadata(Pe.TAGGED,Ie);return{compilerGeneratedMetadata:X,userGeneratedMetadata:de||{}}},m.prototype.getPropertiesMetadata=function(Ie){var X=Reflect.getMetadata(Pe.TAGGED_PROP,Ie)||[];return X},m}();oe.MetadataReader=De},55314:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Plan=void 0;var Q=function(){function Pe(De,m){this.parentContext=De,this.rootRequest=m}return Pe}();oe.Plan=Q},86311:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.getBindingDictionary=oe.createMockRequest=oe.plan=void 0;var Pe=Q(23184),De=Q(16674),m=Q(28421),Ie=Q(6867),X=Q(85265),de=Q(55800),ce=Q(95228),ze=Q(47738),ge=Q(55314),nt=Q(6e3),ct=Q(6748),Et=Q(18924);function ar(q){return q._bindingDictionary}oe.getBindingDictionary=ar;function dr(q,Gt,He,$e,bt,et){var qt=q?Ie.MULTI_INJECT_TAG:Ie.INJECT_TAG,Tr=new ze.Metadata(qt,He),Br=new Et.Target(Gt,$e,He,Tr);if(bt!==void 0){var rn=new ze.Metadata(bt,et);Br.metadata.push(rn)}return Br}function kt(q,Gt,He,$e,bt){var et=ht(He.container,bt.serviceIdentifier),qt=[];return et.length===Pe.BindingCount.NoBindingsAvailable&&He.container.options.autoBindInjectable&&typeof bt.serviceIdentifier=="function"&&q.getConstructorMetadata(bt.serviceIdentifier).compilerGeneratedMetadata&&(He.container.bind(bt.serviceIdentifier).toSelf(),et=ht(He.container,bt.serviceIdentifier)),Gt?qt=et:qt=et.filter(function(Tr){var Br=new ct.Request(Tr.serviceIdentifier,He,$e,Tr,bt);return Tr.constraint(Br)}),nr(bt.serviceIdentifier,qt,bt,He.container),qt}function nr(q,Gt,He,$e){switch(Gt.length){case Pe.BindingCount.NoBindingsAvailable:if(He.isOptional())return Gt;var bt=de.getServiceIdentifierAsString(q),et=De.NOT_REGISTERED;throw et+=de.listMetadataForTarget(bt,He),et+=de.listRegisteredBindingsForServiceIdentifier($e,bt,ht),new Error(et);case Pe.BindingCount.OnlyOneBindingAvailable:if(!He.isArray())return Gt;case Pe.BindingCount.MultipleBindingsAvailable:default:if(He.isArray())return Gt;var bt=de.getServiceIdentifierAsString(q),et=De.AMBIGUOUS_MATCH+" "+bt;throw et+=de.listRegisteredBindingsForServiceIdentifier($e,bt,ht),new Error(et)}}function Ut(q,Gt,He,$e,bt,et){var qt,Tr;if(bt===null){qt=kt(q,Gt,$e,null,et),Tr=new ct.Request(He,$e,null,qt,et);var Br=new ge.Plan($e,Tr);$e.addPlan(Br)}else qt=kt(q,Gt,$e,bt,et),Tr=bt.addChildRequest(et.serviceIdentifier,qt,et);qt.forEach(function(rn){var Ee=null;if(et.isArray())Ee=Tr.addChildRequest(rn.serviceIdentifier,rn,et);else{if(rn.cache)return;Ee=Tr}if(rn.type===m.BindingTypeEnum.Instance&&rn.implementationType!==null){var We=nt.getDependencies(q,rn.implementationType);if(!$e.container.options.skipBaseClassChecks){var Re=nt.getBaseClassDependencyCount(q,rn.implementationType);if(We.length<Re){var _t=De.ARGUMENTS_LENGTH_MISMATCH(nt.getFunctionName(rn.implementationType));throw new Error(_t)}}We.forEach(function(ft){Ut(q,!1,ft.serviceIdentifier,$e,Ee,ft)})}})}function ht(q,Gt){var He=[],$e=ar(q);return $e.hasKey(Gt)?He=$e.get(Gt):q.parent!==null&&(He=ht(q.parent,Gt)),He}function St(q,Gt,He,$e,bt,et,qt,Tr){Tr===void 0&&(Tr=!1);var Br=new ce.Context(Gt),rn=dr(He,$e,bt,"",et,qt);try{return Ut(q,Tr,bt,Br,null,rn),Br}catch(Ee){throw X.isStackOverflowExeption(Ee)&&Br.plan&&de.circularDependencyToException(Br.plan.rootRequest),Ee}}oe.plan=St;function or(q,Gt,He,$e){var bt=new Et.Target(m.TargetTypeEnum.Variable,"",Gt,new ze.Metadata(He,$e)),et=new ce.Context(q),qt=new ct.Request(Gt,et,null,[],bt);return qt}oe.createMockRequest=or},88460:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.QueryableString=void 0;var Q=function(){function Pe(De){this.str=De}return Pe.prototype.startsWith=function(De){return this.str.indexOf(De)===0},Pe.prototype.endsWith=function(De){var m="",Ie=De.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},Ie)},Pe.prototype.contains=function(De){return this.str.indexOf(De)!==-1},Pe.prototype.equals=function(De){return this.str===De},Pe.prototype.value=function(){return this.str},Pe}();oe.QueryableString=Q},6e3:function(Cr,oe,Q){"use strict";var Pe=this&&this.__spreadArray||function(kt,nr){for(var Ut=0,ht=nr.length,St=kt.length;Ut<ht;Ut++,St++)kt[St]=nr[Ut];return kt};Object.defineProperty(oe,"__esModule",{value:!0}),oe.getFunctionName=oe.getBaseClassDependencyCount=oe.getDependencies=void 0;var De=Q(5744),m=Q(16674),Ie=Q(28421),X=Q(6867),de=Q(55800);Object.defineProperty(oe,"getFunctionName",{enumerable:!0,get:function(){return de.getFunctionName}});var ce=Q(18924);function ze(kt,nr){var Ut=de.getFunctionName(nr),ht=ge(kt,Ut,nr,!1);return ht}oe.getDependencies=ze;function ge(kt,nr,Ut,ht){var St=kt.getConstructorMetadata(Ut),or=St.compilerGeneratedMetadata;if(or===void 0){var q=m.MISSING_INJECTABLE_ANNOTATION+" "+nr+".";throw new Error(q)}var Gt=St.userGeneratedMetadata,He=Object.keys(Gt),$e=Ut.length===0&&He.length>0,bt=He.length>Ut.length,et=$e||bt?He.length:Ut.length,qt=ct(ht,nr,or,Gt,et),Tr=Et(kt,Ut),Br=Pe(Pe([],qt),Tr);return Br}function nt(kt,nr,Ut,ht,St){var or=St[kt.toString()]||[],q=dr(or),Gt=q.unmanaged!==!0,He=ht[kt],$e=q.inject||q.multiInject;if(He=$e||He,He instanceof De.LazyServiceIdentifer&&(He=He.unwrap()),Gt){var bt=He===Object,et=He===Function,qt=He===void 0,Tr=bt||et||qt;if(!nr&&Tr){var Br=m.MISSING_INJECT_ANNOTATION+" argument "+kt+" in class "+Ut+".";throw new Error(Br)}var rn=new ce.Target(Ie.TargetTypeEnum.ConstructorArgument,q.targetName,He);return rn.metadata=or,rn}return null}function ct(kt,nr,Ut,ht,St){for(var or=[],q=0;q<St;q++){var Gt=q,He=nt(Gt,kt,nr,Ut,ht);He!==null&&or.push(He)}return or}function Et(kt,nr){for(var Ut=kt.getPropertiesMetadata(nr),ht=[],St=Object.keys(Ut),or=0,q=St;or<q.length;or++){var Gt=q[or],He=Ut[Gt],$e=dr(Ut[Gt]),bt=$e.targetName||Gt,et=$e.inject||$e.multiInject,qt=new ce.Target(Ie.TargetTypeEnum.ClassProperty,bt,et);qt.metadata=He,ht.push(qt)}var Tr=Object.getPrototypeOf(nr.prototype).constructor;if(Tr!==Object){var Br=Et(kt,Tr);ht=Pe(Pe([],ht),Br)}return ht}function ar(kt,nr){var Ut=Object.getPrototypeOf(nr.prototype).constructor;if(Ut!==Object){var ht=de.getFunctionName(Ut),St=ge(kt,ht,Ut,!0),or=St.map(function(He){return He.metadata.filter(function($e){return $e.key===X.UNMANAGED_TAG})}),q=[].concat.apply([],or).length,Gt=St.length-q;return Gt>0?Gt:ar(kt,Ut)}else return 0}oe.getBaseClassDependencyCount=ar;function dr(kt){var nr={};return kt.forEach(function(Ut){nr[Ut.key.toString()]=Ut.value}),{inject:nr[X.INJECT_TAG],multiInject:nr[X.MULTI_INJECT_TAG],targetName:nr[X.NAME_TAG],unmanaged:nr[X.UNMANAGED_TAG]}}},6748:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Request=void 0;var Pe=Q(37791),De=function(){function m(Ie,X,de,ce,ze){this.id=Pe.id(),this.serviceIdentifier=Ie,this.parentContext=X,this.parentRequest=de,this.target=ze,this.childRequests=[],this.bindings=Array.isArray(ce)?ce:[ce],this.requestScope=de===null?new Map:null}return m.prototype.addChildRequest=function(Ie,X,de){var ce=new m(Ie,this.parentContext,this,X,de);return this.childRequests.push(ce),ce},m}();oe.Request=De},18924:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.Target=void 0;var Pe=Q(6867),De=Q(37791),m=Q(47738),Ie=Q(88460),X=function(){function de(ce,ze,ge,nt){this.id=De.id(),this.type=ce,this.serviceIdentifier=ge,this.name=new Ie.QueryableString(ze||""),this.metadata=new Array;var ct=null;typeof nt=="string"?ct=new m.Metadata(Pe.NAMED_TAG,nt):nt instanceof m.Metadata&&(ct=nt),ct!==null&&this.metadata.push(ct)}return de.prototype.hasTag=function(ce){for(var ze=0,ge=this.metadata;ze<ge.length;ze++){var nt=ge[ze];if(nt.key===ce)return!0}return!1},de.prototype.isArray=function(){return this.hasTag(Pe.MULTI_INJECT_TAG)},de.prototype.matchesArray=function(ce){return this.matchesTag(Pe.MULTI_INJECT_TAG)(ce)},de.prototype.isNamed=function(){return this.hasTag(Pe.NAMED_TAG)},de.prototype.isTagged=function(){return this.metadata.some(function(ce){return Pe.NON_CUSTOM_TAG_KEYS.every(function(ze){return ce.key!==ze})})},de.prototype.isOptional=function(){return this.matchesTag(Pe.OPTIONAL_TAG)(!0)},de.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ce){return ce.key===Pe.NAMED_TAG})[0]:null},de.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ce){return Pe.NON_CUSTOM_TAG_KEYS.every(function(ze){return ce.key!==ze})}):null},de.prototype.matchesNamedTag=function(ce){return this.matchesTag(Pe.NAMED_TAG)(ce)},de.prototype.matchesTag=function(ce){var ze=this;return function(ge){for(var nt=0,ct=ze.metadata;nt<ct.length;nt++){var Et=ct[nt];if(Et.key===ce&&Et.value===ge)return!0}return!1}},de}();oe.Target=X},52279:function(Cr,oe,Q){"use strict";var Pe=this&&this.__spreadArray||function(ge,nt){for(var ct=0,Et=nt.length,ar=ge.length;ct<Et;ct++,ar++)ge[ar]=nt[ct];return ge};Object.defineProperty(oe,"__esModule",{value:!0}),oe.resolveInstance=void 0;var De=Q(16674),m=Q(28421),Ie=Q(6867);function X(ge,nt,ct){var Et=nt.filter(function(dr){return dr.target!==null&&dr.target.type===m.TargetTypeEnum.ClassProperty}),ar=Et.map(ct);return Et.forEach(function(dr,kt){var nr="";nr=dr.target.name.value();var Ut=ar[kt];ge[nr]=Ut}),ge}function de(ge,nt){return new(ge.bind.apply(ge,Pe([void 0],nt)))}function ce(ge,nt){if(Reflect.hasMetadata(Ie.POST_CONSTRUCT,ge)){var ct=Reflect.getMetadata(Ie.POST_CONSTRUCT,ge);try{nt[ct.value]()}catch(Et){throw new Error(De.POST_CONSTRUCT_ERROR(ge.name,Et.message))}}}function ze(ge,nt,ct){var Et=null;if(nt.length>0){var ar=nt.filter(function(kt){return kt.target!==null&&kt.target.type===m.TargetTypeEnum.ConstructorArgument}),dr=ar.map(ct);Et=de(ge,dr),Et=X(Et,nt,ct)}else Et=new ge;return ce(ge,Et),Et}oe.resolveInstance=ze},31927:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.resolve=void 0;var Pe=Q(16674),De=Q(28421),m=Q(85265),Ie=Q(55800),X=Q(52279),de=function(ge,nt,ct){try{return ct()}catch(Et){throw m.isStackOverflowExeption(Et)?new Error(Pe.CIRCULAR_DEPENDENCY_IN_FACTORY(ge,nt.toString())):Et}},ce=function(ge){return function(nt){nt.parentContext.setCurrentRequest(nt);var ct=nt.bindings,Et=nt.childRequests,ar=nt.target&&nt.target.isArray(),dr=!nt.parentRequest||!nt.parentRequest.target||!nt.target||!nt.parentRequest.target.matchesArray(nt.target.serviceIdentifier);if(ar&&dr)return Et.map(function(or){var q=ce(ge);return q(or)});var kt=null;if(nt.target.isOptional()&&ct.length===0)return;var nr=ct[0],Ut=nr.scope===De.BindingScopeEnum.Singleton,ht=nr.scope===De.BindingScopeEnum.Request;if(Ut&&nr.activated)return nr.cache;if(ht&&ge!==null&&ge.has(nr.id))return ge.get(nr.id);if(nr.type===De.BindingTypeEnum.ConstantValue)kt=nr.cache,nr.activated=!0;else if(nr.type===De.BindingTypeEnum.Function)kt=nr.cache,nr.activated=!0;else if(nr.type===De.BindingTypeEnum.Constructor)kt=nr.implementationType;else if(nr.type===De.BindingTypeEnum.DynamicValue&&nr.dynamicValue!==null)kt=de("toDynamicValue",nr.serviceIdentifier,function(){return nr.dynamicValue(nt.parentContext)});else if(nr.type===De.BindingTypeEnum.Factory&&nr.factory!==null)kt=de("toFactory",nr.serviceIdentifier,function(){return nr.factory(nt.parentContext)});else if(nr.type===De.BindingTypeEnum.Provider&&nr.provider!==null)kt=de("toProvider",nr.serviceIdentifier,function(){return nr.provider(nt.parentContext)});else if(nr.type===De.BindingTypeEnum.Instance&&nr.implementationType!==null)kt=X.resolveInstance(nr.implementationType,Et,ce(ge));else{var St=Ie.getServiceIdentifierAsString(nt.serviceIdentifier);throw new Error(Pe.INVALID_BINDING_TYPE+" "+St)}return typeof nr.onActivation=="function"&&(kt=nr.onActivation(nt.parentContext,kt)),Ut&&(nr.cache=kt,nr.activated=!0),ht&&ge!==null&&!ge.has(nr.id)&&ge.set(nr.id,kt),kt}};function ze(ge){var nt=ce(ge.plan.rootRequest.requestScope);return nt(ge.plan.rootRequest)}oe.resolve=ze},83366:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingInSyntax=void 0;var Pe=Q(28421),De=Q(71325),m=function(){function Ie(X){this._binding=X}return Ie.prototype.inRequestScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Request,new De.BindingWhenOnSyntax(this._binding)},Ie.prototype.inSingletonScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Singleton,new De.BindingWhenOnSyntax(this._binding)},Ie.prototype.inTransientScope=function(){return this._binding.scope=Pe.BindingScopeEnum.Transient,new De.BindingWhenOnSyntax(this._binding)},Ie}();oe.BindingInSyntax=m},74889:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingInWhenOnSyntax=void 0;var Pe=Q(83366),De=Q(51811),m=Q(98370),Ie=function(){function X(de){this._binding=de,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new De.BindingOnSyntax(this._binding),this._bindingInSyntax=new Pe.BindingInSyntax(de)}return X.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},X.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},X.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},X.prototype.when=function(de){return this._bindingWhenSyntax.when(de)},X.prototype.whenTargetNamed=function(de){return this._bindingWhenSyntax.whenTargetNamed(de)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(de,ce){return this._bindingWhenSyntax.whenTargetTagged(de,ce)},X.prototype.whenInjectedInto=function(de){return this._bindingWhenSyntax.whenInjectedInto(de)},X.prototype.whenParentNamed=function(de){return this._bindingWhenSyntax.whenParentNamed(de)},X.prototype.whenParentTagged=function(de,ce){return this._bindingWhenSyntax.whenParentTagged(de,ce)},X.prototype.whenAnyAncestorIs=function(de){return this._bindingWhenSyntax.whenAnyAncestorIs(de)},X.prototype.whenNoAncestorIs=function(de){return this._bindingWhenSyntax.whenNoAncestorIs(de)},X.prototype.whenAnyAncestorNamed=function(de){return this._bindingWhenSyntax.whenAnyAncestorNamed(de)},X.prototype.whenAnyAncestorTagged=function(de,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(de,ce)},X.prototype.whenNoAncestorNamed=function(de){return this._bindingWhenSyntax.whenNoAncestorNamed(de)},X.prototype.whenNoAncestorTagged=function(de,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(de,ce)},X.prototype.whenAnyAncestorMatches=function(de){return this._bindingWhenSyntax.whenAnyAncestorMatches(de)},X.prototype.whenNoAncestorMatches=function(de){return this._bindingWhenSyntax.whenNoAncestorMatches(de)},X.prototype.onActivation=function(de){return this._bindingOnSyntax.onActivation(de)},X}();oe.BindingInWhenOnSyntax=Ie},51811:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingOnSyntax=void 0;var Pe=Q(98370),De=function(){function m(Ie){this._binding=Ie}return m.prototype.onActivation=function(Ie){return this._binding.onActivation=Ie,new Pe.BindingWhenSyntax(this._binding)},m}();oe.BindingOnSyntax=De},15451:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingToSyntax=void 0;var Pe=Q(16674),De=Q(28421),m=Q(74889),Ie=Q(71325),X=function(){function de(ce){this._binding=ce}return de.prototype.to=function(ce){return this._binding.type=De.BindingTypeEnum.Instance,this._binding.implementationType=ce,new m.BindingInWhenOnSyntax(this._binding)},de.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Pe.INVALID_TO_SELF_VALUE);var ce=this._binding.serviceIdentifier;return this.to(ce)},de.prototype.toConstantValue=function(ce){return this._binding.type=De.BindingTypeEnum.ConstantValue,this._binding.cache=ce,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=De.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},de.prototype.toDynamicValue=function(ce){return this._binding.type=De.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ce,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},de.prototype.toConstructor=function(ce){return this._binding.type=De.BindingTypeEnum.Constructor,this._binding.implementationType=ce,this._binding.scope=De.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},de.prototype.toFactory=function(ce){return this._binding.type=De.BindingTypeEnum.Factory,this._binding.factory=ce,this._binding.scope=De.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},de.prototype.toFunction=function(ce){if(typeof ce!="function")throw new Error(Pe.INVALID_FUNCTION_BINDING);var ze=this.toConstantValue(ce);return this._binding.type=De.BindingTypeEnum.Function,this._binding.scope=De.BindingScopeEnum.Singleton,ze},de.prototype.toAutoFactory=function(ce){return this._binding.type=De.BindingTypeEnum.Factory,this._binding.factory=function(ze){var ge=function(){return ze.container.get(ce)};return ge},this._binding.scope=De.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},de.prototype.toProvider=function(ce){return this._binding.type=De.BindingTypeEnum.Provider,this._binding.provider=ce,this._binding.scope=De.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},de.prototype.toService=function(ce){this.toDynamicValue(function(ze){return ze.container.get(ce)})},de}();oe.BindingToSyntax=X},71325:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingWhenOnSyntax=void 0;var Pe=Q(51811),De=Q(98370),m=function(){function Ie(X){this._binding=X,this._bindingWhenSyntax=new De.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Pe.BindingOnSyntax(this._binding)}return Ie.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},Ie.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},Ie.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ie.prototype.whenTargetTagged=function(X,de){return this._bindingWhenSyntax.whenTargetTagged(X,de)},Ie.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},Ie.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},Ie.prototype.whenParentTagged=function(X,de){return this._bindingWhenSyntax.whenParentTagged(X,de)},Ie.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},Ie.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},Ie.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},Ie.prototype.whenAnyAncestorTagged=function(X,de){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,de)},Ie.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},Ie.prototype.whenNoAncestorTagged=function(X,de){return this._bindingWhenSyntax.whenNoAncestorTagged(X,de)},Ie.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},Ie.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},Ie.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},Ie}();oe.BindingWhenOnSyntax=m},98370:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.BindingWhenSyntax=void 0;var Pe=Q(51811),De=Q(80758),m=function(){function Ie(X){this._binding=X}return Ie.prototype.when=function(X){return this._binding.constraint=X,new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetNamed=function(X){return this._binding.constraint=De.namedConstraint(X),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(X){var de=X.target!==null&&!X.target.isNamed()&&!X.target.isTagged();return de},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetTagged=function(X,de){return this._binding.constraint=De.taggedConstraint(X)(de),new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenInjectedInto=function(X){return this._binding.constraint=function(de){return De.typeConstraint(X)(de.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentNamed=function(X){return this._binding.constraint=function(de){return De.namedConstraint(X)(de.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenParentTagged=function(X,de){return this._binding.constraint=function(ce){return De.taggedConstraint(X)(de)(ce.parentRequest)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorIs=function(X){return this._binding.constraint=function(de){return De.traverseAncerstors(de,De.typeConstraint(X))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorIs=function(X){return this._binding.constraint=function(de){return!De.traverseAncerstors(de,De.typeConstraint(X))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorNamed=function(X){return this._binding.constraint=function(de){return De.traverseAncerstors(de,De.namedConstraint(X))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorNamed=function(X){return this._binding.constraint=function(de){return!De.traverseAncerstors(de,De.namedConstraint(X))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorTagged=function(X,de){return this._binding.constraint=function(ce){return De.traverseAncerstors(ce,De.taggedConstraint(X)(de))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorTagged=function(X,de){return this._binding.constraint=function(ce){return!De.traverseAncerstors(ce,De.taggedConstraint(X)(de))},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorMatches=function(X){return this._binding.constraint=function(de){return De.traverseAncerstors(de,X)},new Pe.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorMatches=function(X){return this._binding.constraint=function(de){return!De.traverseAncerstors(de,X)},new Pe.BindingOnSyntax(this._binding)},Ie}();oe.BindingWhenSyntax=m},80758:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.typeConstraint=oe.namedConstraint=oe.taggedConstraint=oe.traverseAncerstors=void 0;var Pe=Q(6867),De=Q(47738),m=function(ce,ze){var ge=ce.parentRequest;return ge!==null?ze(ge)?!0:m(ge,ze):!1};oe.traverseAncerstors=m;var Ie=function(ce){return function(ze){var ge=function(nt){return nt!==null&&nt.target!==null&&nt.target.matchesTag(ce)(ze)};return ge.metaData=new De.Metadata(ce,ze),ge}};oe.taggedConstraint=Ie;var X=Ie(Pe.NAMED_TAG);oe.namedConstraint=X;var de=function(ce){return function(ze){var ge=null;if(ze!==null)if(ge=ze.bindings[0],typeof ce=="string"){var nt=ge.serviceIdentifier;return nt===ce}else{var ct=ze.bindings[0].implementationType;return ce===ct}return!1}};oe.typeConstraint=de},70600:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.multiBindToService=void 0;var Q=function(Pe){return function(De){return function(){for(var m=[],Ie=0;Ie<arguments.length;Ie++)m[Ie]=arguments[Ie];return m.forEach(function(X){return Pe.bind(X).toService(De)})}}};oe.multiBindToService=Q},85265:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.isStackOverflowExeption=void 0;var Pe=Q(16674);function De(m){return m instanceof RangeError||m.message===Pe.STACK_OVERFLOW}oe.isStackOverflowExeption=De},37791:function(Cr,oe){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.id=void 0;var Q=0;function Pe(){return Q++}oe.id=Pe},55800:function(Cr,oe,Q){"use strict";Object.defineProperty(oe,"__esModule",{value:!0}),oe.circularDependencyToException=oe.listMetadataForTarget=oe.listRegisteredBindingsForServiceIdentifier=oe.getServiceIdentifierAsString=oe.getFunctionName=void 0;var Pe=Q(16674);function De(ge){if(typeof ge=="function"){var nt=ge;return nt.name}else{if(typeof ge=="symbol")return ge.toString();var nt=ge;return nt}}oe.getServiceIdentifierAsString=De;function m(ge,nt,ct){var Et="",ar=ct(ge,nt);return ar.length!==0&&(Et=`
Registered bindings:`,ar.forEach(function(dr){var kt="Object";dr.implementationType!==null&&(kt=ze(dr.implementationType)),Et=Et+`
 `+kt,dr.constraint.metaData&&(Et=Et+" - "+dr.constraint.metaData)})),Et}oe.listRegisteredBindingsForServiceIdentifier=m;function Ie(ge,nt){return ge.parentRequest===null?!1:ge.parentRequest.serviceIdentifier===nt?!0:Ie(ge.parentRequest,nt)}function X(ge){function nt(Et,ar){ar===void 0&&(ar=[]);var dr=De(Et.serviceIdentifier);return ar.push(dr),Et.parentRequest!==null?nt(Et.parentRequest,ar):ar}var ct=nt(ge);return ct.reverse().join(" --> ")}function de(ge){ge.childRequests.forEach(function(nt){if(Ie(nt,nt.serviceIdentifier)){var ct=X(nt);throw new Error(Pe.CIRCULAR_DEPENDENCY+" "+ct)}else de(nt)})}oe.circularDependencyToException=de;function ce(ge,nt){if(nt.isTagged()||nt.isNamed()){var ct="",Et=nt.getNamedTag(),ar=nt.getCustomTags();return Et!==null&&(ct+=Et.toString()+`
`),ar!==null&&ar.forEach(function(dr){ct+=dr.toString()+`
`})," "+ge+`
 `+ge+" - "+ct}else return" "+ge}oe.listMetadataForTarget=ce;function ze(ge){if(ge.name)return ge.name;var nt=ge.toString(),ct=nt.match(/^function\s*([^\s(]+)/);return ct?ct[1]:"Anonymous function: "+nt}oe.getFunctionName=ze},31745:function(Cr){"use strict";Cr.exports=Q,Cr.exports.default=Q;var oe=1e20;function Q(X,de,ce,ze,ge,nt){this.fontSize=X||24,this.buffer=de===void 0?3:de,this.cutoff=ze||.25,this.fontFamily=ge||"sans-serif",this.fontWeight=nt||"normal",this.radius=ce||8;var ct=this.size=this.fontSize+this.buffer*2,Et=ct+this.buffer*2,ar=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;ar?this.canvas=my.createOffscreenCanvas(ct,ct,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ct),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Et*Et),this.gridInner=new Float64Array(Et*Et),this.f=new Float64Array(Et),this.z=new Float64Array(Et+1),this.v=new Uint16Array(Et),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,ar?this.middle=Math.round(ct/2*1):this.middle=Math.round(ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pe(X,de,ce,ze,ge,nt,ct){nt.fill(oe,0,de*ce),ct.fill(0,0,de*ce);for(var Et=(de-ze)/2,ar=0;ar<ge;ar++)for(var dr=0;dr<ze;dr++){var kt=(ar+Et)*de+dr+Et,nr=X.data[4*(ar*ze+dr)+3]/255;if(nr===1)nt[kt]=0,ct[kt]=oe;else if(nr===0)nt[kt]=oe,ct[kt]=0;else{var Ut=Math.max(0,.5-nr),ht=Math.max(0,nr-.5);nt[kt]=Ut*Ut,ct[kt]=ht*ht}}}function De(X,de,ce,ze,ge,nt,ct){for(var Et=0;Et<de*ce;Et++){var ar=Math.sqrt(ze[Et])-Math.sqrt(ge[Et]);X[Et]=Math.round(255-255*(ar/nt+ct))}}Q.prototype._draw=function(X,de){var ce=this.ctx.measureText(X),ze=ce.width,ge=2*this.buffer,nt,ct,Et,ar,dr,kt,nr,Ut;de&&this.useMetrics?(dr=Math.floor(ce.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(ce.actualBoundingBoxAscent),kt=this.buffer,nr=this.buffer,ct=Math.min(this.size,Math.ceil(ce.actualBoundingBoxRight-ce.actualBoundingBoxLeft)),ar=Math.min(this.size-kt,Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent)),nt=ct+ge,Et=ar+ge,this.ctx.textBaseline="alphabetic"):(nt=ct=this.size,Et=ar=this.size,dr=19*this.fontSize/24,kt=nr=0,Ut=this.middle,this.ctx.textBaseline="middle");var ht;ct&&ar&&(this.ctx.clearRect(nr,kt,ct,ar),this.ctx.fillText(X,this.buffer,Ut),ht=this.ctx.getImageData(nr,kt,ct,ar));var St=new Uint8ClampedArray(nt*Et);return Pe(ht,nt,Et,ct,ar,this.gridOuter,this.gridInner),m(this.gridOuter,nt,Et,this.f,this.v,this.z),m(this.gridInner,nt,Et,this.f,this.v,this.z),De(St,nt,Et,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:St,metrics:{width:ct,height:ar,sdfWidth:nt,sdfHeight:Et,top:dr,left:0,advance:ze}}},Q.prototype.draw=function(X){return this._draw(X,!1).data},Q.prototype.drawWithMetrics=function(X){return this._draw(X,!0)};function m(X,de,ce,ze,ge,nt){for(var ct=0;ct<de;ct++)Ie(X,ct,de,ce,ze,ge,nt);for(var Et=0;Et<ce;Et++)Ie(X,Et*de,1,de,ze,ge,nt)}function Ie(X,de,ce,ze,ge,nt,ct){var Et,ar,dr,kt;for(nt[0]=0,ct[0]=-oe,ct[1]=oe,Et=0;Et<ze;Et++)ge[Et]=X[de+Et*ce];for(Et=1,ar=0,dr=0;Et<ze;Et++){do kt=nt[ar],dr=(ge[Et]-ge[kt]+Et*Et-kt*kt)/(Et-kt)/2;while(dr<=ct[ar]&&--ar>-1);ar++,nt[ar]=Et,ct[ar]=dr,ct[ar+1]=oe}for(Et=0,ar=0;Et<ze;Et++){for(;ct[ar+1]<Et;)ar++;kt=nt[ar],X[de+Et*ce]=ge[kt]+(Et-kt)*(Et-kt)}}},18857:function(Cr,oe,Q){"use strict";Q.r(oe),Q.d(oe,{Function:function(){return uu},Interpreter:function(){return Eo},default:function(){return Il},evaluate:function(){return il},vm:function(){return Pe}});var Pe={};Q.r(Pe),Q.d(Pe,{Script:function(){return nl},compileFunction:function(){return rl},createContext:function(){return Iu},runInContext:function(){return mu},runInNewContext:function(){return ic}});var De={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ie={5:m,"5module":m+" export import",6:m+" const class extends export import super"},X=/^in(stanceof)?$/,de="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ce="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ze=new RegExp("["+de+"]"),ge=new RegExp("["+de+ce+"]");de=ce=null;var nt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ct=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Et(_,T){for(var B=65536,I=0;I<T.length;I+=2){if(B+=T[I],B>_)return!1;if(B+=T[I+1],B>=_)return!0}}function ar(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ze.test(String.fromCharCode(_)):T===!1?!1:Et(_,nt)}function dr(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ge.test(String.fromCharCode(_)):T===!1?!1:Et(_,nt)||Et(_,ct)}var kt=function(T,B){B===void 0&&(B={}),this.label=T,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function nr(_,T){return new kt(_,{beforeExpr:!0,binop:T})}var Ut={beforeExpr:!0},ht={startsExpr:!0},St={};function or(_,T){return T===void 0&&(T={}),T.keyword=_,St[_]=new kt(_,T)}var q={num:new kt("num",ht),regexp:new kt("regexp",ht),string:new kt("string",ht),name:new kt("name",ht),eof:new kt("eof"),bracketL:new kt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new kt("]"),braceL:new kt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new kt("}"),parenL:new kt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new kt(")"),comma:new kt(",",Ut),semi:new kt(";",Ut),colon:new kt(":",Ut),dot:new kt("."),question:new kt("?",Ut),questionDot:new kt("?."),arrow:new kt("=>",Ut),template:new kt("template"),invalidTemplate:new kt("invalidTemplate"),ellipsis:new kt("...",Ut),backQuote:new kt("`",ht),dollarBraceL:new kt("${",{beforeExpr:!0,startsExpr:!0}),eq:new kt("=",{beforeExpr:!0,isAssign:!0}),assign:new kt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new kt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new kt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:nr("||",1),logicalAND:nr("&&",2),bitwiseOR:nr("|",3),bitwiseXOR:nr("^",4),bitwiseAND:nr("&",5),equality:nr("==/!=/===/!==",6),relational:nr("</>/<=/>=",7),bitShift:nr("<</>>/>>>",8),plusMin:new kt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:nr("%",10),star:nr("*",10),slash:nr("/",10),starstar:new kt("**",{beforeExpr:!0}),coalesce:nr("??",1),_break:or("break"),_case:or("case",Ut),_catch:or("catch"),_continue:or("continue"),_debugger:or("debugger"),_default:or("default",Ut),_do:or("do",{isLoop:!0,beforeExpr:!0}),_else:or("else",Ut),_finally:or("finally"),_for:or("for",{isLoop:!0}),_function:or("function",ht),_if:or("if"),_return:or("return",Ut),_switch:or("switch"),_throw:or("throw",Ut),_try:or("try"),_var:or("var"),_const:or("const"),_while:or("while",{isLoop:!0}),_with:or("with"),_new:or("new",{beforeExpr:!0,startsExpr:!0}),_this:or("this",ht),_super:or("super",ht),_class:or("class",ht),_extends:or("extends",Ut),_export:or("export"),_import:or("import",ht),_null:or("null",ht),_true:or("true",ht),_false:or("false",ht),_in:or("in",{beforeExpr:!0,binop:7}),_instanceof:or("instanceof",{beforeExpr:!0,binop:7}),_typeof:or("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:or("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:or("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Gt=/\r\n?|\n|\u2028|\u2029/,He=new RegExp(Gt.source,"g");function $e(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var bt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,et=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,qt=Object.prototype,Tr=qt.hasOwnProperty,Br=qt.toString;function rn(_,T){return Tr.call(_,T)}var Ee=Array.isArray||function(_){return Br.call(_)==="[object Array]"};function We(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var Re=function(T,B){this.line=T,this.column=B};Re.prototype.offset=function(T){return new Re(this.line,this.column+T)};var _t=function(T,B,I){this.start=B,this.end=I,T.sourceFile!==null&&(this.source=T.sourceFile)};function ft(_,T){for(var B=1,I=0;;){He.lastIndex=I;var K=He.exec(_);if(K&&K.index<T)++B,I=K.index+K[0].length;else return new Re(B,T-I)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ht(_){var T={};for(var B in Lt)T[B]=_&&rn(_,B)?_[B]:Lt[B];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),Ee(T.onToken)){var I=T.onToken;T.onToken=function(K){return I.push(K)}}return Ee(T.onComment)&&(T.onComment=Mr(T,T.onComment)),T}function Mr(_,T){return function(B,I,K,ve,Ge,ut){var lt={type:B?"Block":"Line",value:I,start:K,end:ve};_.locations&&(lt.loc=new _t(this,Ge,ut)),_.ranges&&(lt.range=[K,ve]),T.push(lt)}}var Kn=1,Wr=2,na=Kn|Wr,Yn=4,ai=8,oi=16,ci=32,gi=64,xa=128;function qi(_,T){return Wr|(_?Yn:0)|(T?ai:0)}var Gi=0,ia=1,ba=2,R=3,sn=4,Ea=5,Bi=function(T,B,I){this.options=T=Ht(T),this.sourceFile=T.sourceFile,this.keywords=We(Ie[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var K="";if(T.allowReserved!==!0){for(var ve=T.ecmaVersion;!(K=De[ve]);ve--);T.sourceType==="module"&&(K+=" await")}this.reservedWords=We(K);var Ge=(K?K+" ":"")+De.strict;this.reservedWordsStrict=We(Ge),this.reservedWordsStrictBind=We(Ge+" "+De.strictBind),this.input=String(B),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`
`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Gt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Kn),this.regexpState=null},aa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Bi.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},aa.inFunction.get=function(){return(this.currentVarScope().flags&Wr)>0},aa.inGenerator.get=function(){return(this.currentVarScope().flags&ai)>0},aa.inAsync.get=function(){return(this.currentVarScope().flags&Yn)>0},aa.allowSuper.get=function(){return(this.currentThisScope().flags&gi)>0},aa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&xa)>0},aa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Bi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Wr)>0},Bi.extend=function(){for(var T=[],B=arguments.length;B--;)T[B]=arguments[B];for(var I=this,K=0;K<T.length;K++)I=T[K](I);return I},Bi.parse=function(T,B){return new this(B,T).parse()},Bi.parseExpressionAt=function(T,B,I){var K=new this(I,T,B);return K.nextToken(),K.parseExpression()},Bi.tokenizer=function(T,B){return new this(B,T)},Object.defineProperties(Bi.prototype,aa);var Qi=Bi.prototype,cs=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Qi.strictDirective=function(_){for(;;){et.lastIndex=_,_+=et.exec(this.input)[0].length;var T=cs.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){et.lastIndex=_+T[0].length;var B=et.exec(this.input),I=B.index+B[0].length,K=this.input.charAt(I);return K===";"||K==="}"||Gt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(I+1)==="=")}_+=T[0].length,et.lastIndex=_,_+=et.exec(this.input)[0].length,this.input[_]===";"&&_++}},Qi.eat=function(_){return this.type===_?(this.next(),!0):!1},Qi.isContextual=function(_){return this.type===q.name&&this.value===_&&!this.containsEsc},Qi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Qi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Qi.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||Gt.test(this.input.slice(this.lastTokEnd,this.start))},Qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Qi.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},Qi.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Qi.expect=function(_){this.eat(_)||this.unexpected()},Qi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function pe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Qi.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=T?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Qi.checkExpressionErrors=function(_,T){if(!_)return!1;var B=_.shorthandAssign,I=_.doubleProto;if(!T)return B>=0||I>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},Qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Qi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var fi=Bi.prototype;fi.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==q.eof;){var B=this.parseStatement(null,!0,T);_.body.push(B)}if(this.inModule)for(var I=0,K=Object.keys(this.undefinedExports);I<K.length;I+=1){var ve=K[I];this.raiseRecoverable(this.undefinedExports[ve].start,"Export '"+ve+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var lo={kind:"loop"},Va={kind:"switch"};fi.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;et.lastIndex=this.pos;var T=et.exec(this.input),B=this.pos+T[0].length,I=this.input.charCodeAt(B);if(I===91)return!0;if(_)return!1;if(I===123)return!0;if(ar(I,!0)){for(var K=B+1;dr(this.input.charCodeAt(K),!0);)++K;var ve=this.input.slice(B,K);if(!X.test(ve))return!0}return!1},fi.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;et.lastIndex=this.pos;var _=et.exec(this.input),T=this.pos+_[0].length;return!Gt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!dr(this.input.charAt(T+8)))},fi.parseStatement=function(_,T,B){var I=this.type,K=this.startNode(),ve;switch(this.isLet(_)&&(I=q._var,ve="let"),I){case q._break:case q._continue:return this.parseBreakContinueStatement(K,I.keyword);case q._debugger:return this.parseDebuggerStatement(K);case q._do:return this.parseDoStatement(K);case q._for:return this.parseForStatement(K);case q._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case q._class:return _&&this.unexpected(),this.parseClass(K,!0);case q._if:return this.parseIfStatement(K);case q._return:return this.parseReturnStatement(K);case q._switch:return this.parseSwitchStatement(K);case q._throw:return this.parseThrowStatement(K);case q._try:return this.parseTryStatement(K);case q._const:case q._var:return ve=ve||this.value,_&&ve!=="var"&&this.unexpected(),this.parseVarStatement(K,ve);case q._while:return this.parseWhileStatement(K);case q._with:return this.parseWithStatement(K);case q.braceL:return this.parseBlock(!0,K);case q.semi:return this.parseEmptyStatement(K);case q._export:case q._import:if(this.options.ecmaVersion>10&&I===q._import){et.lastIndex=this.pos;var Ge=et.exec(this.input),ut=this.pos+Ge[0].length,lt=this.input.charCodeAt(ut);if(lt===40||lt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),I===q._import?this.parseImport(K):this.parseExport(K,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var sr=this.value,_r=this.parseExpression();return I===q.name&&_r.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(K,sr,_r,_):this.parseExpressionStatement(K,_r)}},fi.parseBreakContinueStatement=function(_,T){var B=T==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?_.label=null:this.type!==q.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var K=this.labels[I];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(B||K.kind==="loop")||_.label&&B))break}return I===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},fi.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},fi.parseDoStatement=function(_){return this.next(),this.labels.push(lo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},fi.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(lo),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var B=this.isLet();if(this.type===q._var||this.type===q._const||B){var I=this.startNode(),K=B?"let":this.value;return this.next(),this.parseVar(I,!0,K),this.finishNode(I,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,I)):(T>-1&&this.unexpected(T),this.parseFor(_,I))}var ve=new pe,Ge=this.parseExpression(!0,ve);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(Ge,!1,ve),this.checkLVal(Ge),this.parseForIn(_,Ge)):(this.checkExpressionErrors(ve,!0),T>-1&&this.unexpected(T),this.parseFor(_,Ge))},fi.parseFunctionStatement=function(_,T,B){return this.next(),this.parseFunction(_,tr|(B?0:Or),!1,T)},fi.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},fi.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},fi.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(q.braceL),this.labels.push(Va),this.enterScope(0);for(var T,B=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var I=this.type===q._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),I?T.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,T.test=null),this.expect(q.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},fi.parseThrowStatement=function(_){return this.next(),Gt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Bt=[];fi.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===q._catch){var T=this.startNode();if(this.next(),this.eat(q.parenL)){T.param=this.parseBindingAtom();var B=T.param.type==="Identifier";this.enterScope(B?ci:0),this.checkLVal(T.param,B?sn:ba),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(q._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},fi.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},fi.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(lo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},fi.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},fi.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},fi.parseLabeledStatement=function(_,T,B,I){for(var K=0,ve=this.labels;K<ve.length;K+=1){var Ge=ve[K];Ge.name===T&&this.raise(B.start,"Label '"+T+"' is already declared")}for(var ut=this.type.isLoop?"loop":this.type===q._switch?"switch":null,lt=this.labels.length-1;lt>=0;lt--){var sr=this.labels[lt];if(sr.statementStart===_.start)sr.statementStart=this.start,sr.kind=ut;else break}return this.labels.push({name:T,kind:ut,statementStart:this.start}),_.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},fi.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},fi.parseBlock=function(_,T,B){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(q.braceL),_&&this.enterScope(0);this.type!==q.braceR;){var I=this.parseStatement(null);T.body.push(I)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},fi.parseFor=function(_,T){return _.init=T,this.expect(q.semi),_.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),_.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},fi.parseForIn=function(_,T){var B=this.type===q._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},fi.parseVar=function(_,T,B){for(_.declarations=[],_.kind=B;;){var I=this.startNode();if(this.parseVarId(I,B),this.eat(q.eq)?I.init=this.parseMaybeAssign(T):B==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(T&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,_.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(q.comma))break}return _},fi.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?ia:ba,!1)};var tr=1,Or=2,Vr=4;fi.parseFunction=function(_,T,B,I){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===q.star&&T&Or&&this.unexpected(),_.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(_.async=!!I),T&tr&&(_.id=T&Vr&&this.type!==q.name?null:this.parseIdent(),_.id&&!(T&Or)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?ia:ba:R));var K=this.yieldPos,ve=this.awaitPos,Ge=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(qi(_.async,_.generator)),T&tr||(_.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=K,this.awaitPos=ve,this.awaitIdentPos=Ge,this.finishNode(_,T&tr?"FunctionDeclaration":"FunctionExpression")},fi.parseFunctionParams=function(_){this.expect(q.parenL),_.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},fi.parseClass=function(_,T){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var I=this.startNode(),K=!1;for(I.body=[],this.expect(q.braceL);this.type!==q.braceR;){var ve=this.parseClassElement(_.superClass!==null);ve&&(I.body.push(ve),ve.type==="MethodDefinition"&&ve.kind==="constructor"&&(K&&this.raise(ve.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=B,this.next(),_.body=this.finishNode(I,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},fi.parseClassElement=function(_){var T=this;if(this.eat(q.semi))return null;var B=this.startNode(),I=function(lt,sr){sr===void 0&&(sr=!1);var _r=T.start,Rn=T.startLoc;return T.eatContextual(lt)?T.type!==q.parenL&&(!sr||!T.canInsertSemicolon())?!0:(B.key&&T.unexpected(),B.computed=!1,B.key=T.startNodeAt(_r,Rn),B.key.name=lt,T.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=I("static");var K=this.eat(q.star),ve=!1;K||(this.options.ecmaVersion>=8&&I("async",!0)?(ve=!0,K=this.options.ecmaVersion>=9&&this.eat(q.star)):I("get")?B.kind="get":I("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var Ge=B.key,ut=!1;return!B.computed&&!B.static&&(Ge.type==="Identifier"&&Ge.name==="constructor"||Ge.type==="Literal"&&Ge.value==="constructor")?(B.kind!=="method"&&this.raise(Ge.start,"Constructor can't have get/set modifier"),K&&this.raise(Ge.start,"Constructor can't be a generator"),ve&&this.raise(Ge.start,"Constructor can't be an async method"),B.kind="constructor",ut=_):B.static&&Ge.type==="Identifier"&&Ge.name==="prototype"&&this.raise(Ge.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,K,ve,ut),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},fi.parseClassMethod=function(_,T,B,I){return _.value=this.parseMethod(T,B,I),this.finishNode(_,"MethodDefinition")},fi.parseClassId=function(_,T){this.type===q.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,ba,!1)):(T===!0&&this.unexpected(),_.id=null)},fi.parseClassSuper=function(_){_.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},fi.parseExport=function(_,T){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(T,"default",this.lastTokStart);var B;if(this.type===q._function||(B=this.isAsyncFunction())){var I=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(I,tr|Vr,!1,B)}else if(this.type===q._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var ve=0,Ge=_.specifiers;ve<Ge.length;ve+=1){var ut=Ge[ve];this.checkUnreserved(ut.local),this.checkLocalExport(ut.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},fi.checkExport=function(_,T,B){!_||(rn(_,T)&&this.raiseRecoverable(B,"Duplicate export '"+T+"'"),_[T]=!0)},fi.checkPatternExport=function(_,T){var B=T.type;if(B==="Identifier")this.checkExport(_,T.name,T.start);else if(B==="ObjectPattern")for(var I=0,K=T.properties;I<K.length;I+=1){var ve=K[I];this.checkPatternExport(_,ve)}else if(B==="ArrayPattern")for(var Ge=0,ut=T.elements;Ge<ut.length;Ge+=1){var lt=ut[Ge];lt&&this.checkPatternExport(_,lt)}else B==="Property"?this.checkPatternExport(_,T.value):B==="AssignmentPattern"?this.checkPatternExport(_,T.left):B==="RestElement"?this.checkPatternExport(_,T.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},fi.checkVariableExport=function(_,T){if(!!_)for(var B=0,I=T;B<I.length;B+=1){var K=I[B];this.checkPatternExport(_,K.id)}},fi.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},fi.parseExportSpecifiers=function(_){var T=[],B=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(B)B=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(_,I.exported.name,I.exported.start),T.push(this.finishNode(I,"ExportSpecifier"))}return T},fi.parseImport=function(_){return this.next(),this.type===q.string?(_.specifiers=Bt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},fi.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===q.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,ba),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(q.comma))return _}if(this.type===q.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,ba),_.push(this.finishNode(I,"ImportNamespaceSpecifier")),_}for(this.expect(q.braceL);!this.eat(q.braceR);){if(T)T=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,ba),_.push(this.finishNode(K,"ImportSpecifier"))}return _},fi.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},fi.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var Ln=Bi.prototype;Ln.toAssignable=function(_,T,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var I=0,K=_.properties;I<K.length;I+=1){var ve=K[I];this.toAssignable(ve,T),ve.type==="RestElement"&&(ve.argument.type==="ArrayPattern"||ve.argument.type==="ObjectPattern")&&this.raise(ve.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},Ln.toAssignableList=function(_,T){for(var B=_.length,I=0;I<B;I++){var K=_[I];K&&this.toAssignable(K,T)}if(B){var ve=_[B-1];this.options.ecmaVersion===6&&T&&ve&&ve.type==="RestElement"&&ve.argument.type!=="Identifier"&&this.unexpected(ve.argument.start)}return _},Ln.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},Ln.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},Ln.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},Ln.parseBindingList=function(_,T,B){for(var I=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(q.comma),T&&this.type===q.comma)I.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===q.ellipsis){var ve=this.parseRestBinding();this.parseBindingListItem(ve),I.push(ve),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var Ge=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Ge),I.push(Ge)}}return I},Ln.parseBindingListItem=function(_){return _},Ln.parseMaybeDefault=function(_,T,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return B;var I=this.startNodeAt(_,T);return I.left=B,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},Ln.checkLVal=function(_,T,B){switch(T===void 0&&(T=Gi),_.type){case"Identifier":T===ba&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(rn(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),T!==Gi&&T!==Ea&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,K=_.properties;I<K.length;I+=1){var ve=K[I];this.checkLVal(ve,T,B)}break;case"Property":this.checkLVal(_.value,T,B);break;case"ArrayPattern":for(var Ge=0,ut=_.elements;Ge<ut.length;Ge+=1){var lt=ut[Ge];lt&&this.checkLVal(lt,T,B)}break;case"AssignmentPattern":this.checkLVal(_.left,T,B);break;case"RestElement":this.checkLVal(_.argument,T,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,B);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var zn=Bi.prototype;zn.checkPropClash=function(_,T,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var I=_.key,K;switch(I.type){case"Identifier":K=I.name;break;case"Literal":K=String(I.value);break;default:return}var ve=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&ve==="init"&&(T.proto&&(B?B.doubleProto<0&&(B.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),T.proto=!0);return}K="$"+K;var Ge=T[K];if(Ge){var ut;ve==="init"?ut=this.strict&&Ge.init||Ge.get||Ge.set:ut=Ge.init||Ge[ve],ut&&this.raiseRecoverable(I.start,"Redefinition of property")}else Ge=T[K]={init:!1,get:!1,set:!1};Ge[ve]=!0}},zn.parseExpression=function(_,T){var B=this.start,I=this.startLoc,K=this.parseMaybeAssign(_,T);if(this.type===q.comma){var ve=this.startNodeAt(B,I);for(ve.expressions=[K];this.eat(q.comma);)ve.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(ve,"SequenceExpression")}return K},zn.parseMaybeAssign=function(_,T,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var I=!1,K=-1,ve=-1;T?(K=T.parenthesizedAssign,ve=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new pe,I=!0);var Ge=this.start,ut=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var lt=this.parseMaybeConditional(_,T);if(B&&(lt=B.call(this,lt,Ge,ut)),this.type.isAssign){var sr=this.startNodeAt(Ge,ut);return sr.operator=this.value,sr.left=this.type===q.eq?this.toAssignable(lt,!1,T):lt,I||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=sr.left.start&&(T.shorthandAssign=-1),this.checkLVal(lt),this.next(),sr.right=this.parseMaybeAssign(_),this.finishNode(sr,"AssignmentExpression")}else I&&this.checkExpressionErrors(T,!0);return K>-1&&(T.parenthesizedAssign=K),ve>-1&&(T.trailingComma=ve),lt},zn.parseMaybeConditional=function(_,T){var B=this.start,I=this.startLoc,K=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return K;if(this.eat(q.question)){var ve=this.startNodeAt(B,I);return ve.test=K,ve.consequent=this.parseMaybeAssign(),this.expect(q.colon),ve.alternate=this.parseMaybeAssign(_),this.finishNode(ve,"ConditionalExpression")}return K},zn.parseExprOps=function(_,T){var B=this.start,I=this.startLoc,K=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||K.start===B&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,B,I,-1,_)},zn.parseExprOp=function(_,T,B,I,K){var ve=this.type.binop;if(ve!=null&&(!K||this.type!==q._in)&&ve>I){var Ge=this.type===q.logicalOR||this.type===q.logicalAND,ut=this.type===q.coalesce;ut&&(ve=q.logicalAND.binop);var lt=this.value;this.next();var sr=this.start,_r=this.startLoc,Rn=this.parseExprOp(this.parseMaybeUnary(null,!1),sr,_r,ve,K),jn=this.buildBinary(T,B,_,Rn,lt,Ge||ut);return(Ge&&this.type===q.coalesce||ut&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(jn,T,B,I,K)}return _},zn.buildBinary=function(_,T,B,I,K,ve){var Ge=this.startNodeAt(_,T);return Ge.left=B,Ge.operator=K,Ge.right=I,this.finishNode(Ge,ve?"LogicalExpression":"BinaryExpression")},zn.parseMaybeUnary=function(_,T){var B=this.start,I=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),T=!0;else if(this.type.prefix){var ve=this.startNode(),Ge=this.type===q.incDec;ve.operator=this.value,ve.prefix=!0,this.next(),ve.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),Ge?this.checkLVal(ve.argument):this.strict&&ve.operator==="delete"&&ve.argument.type==="Identifier"?this.raiseRecoverable(ve.start,"Deleting local variable in strict mode"):T=!0,K=this.finishNode(ve,Ge?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var ut=this.startNodeAt(B,I);ut.operator=this.value,ut.prefix=!1,ut.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(ut,"UpdateExpression")}}return!T&&this.eat(q.starstar)?this.buildBinary(B,I,K,this.parseMaybeUnary(null,!1),"**",!1):K},zn.parseExprSubscripts=function(_){var T=this.start,B=this.startLoc,I=this.parseExprAtom(_);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var K=this.parseSubscripts(I,T,B);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},zn.parseSubscripts=function(_,T,B,I){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,ve=!1;;){var Ge=this.parseSubscript(_,T,B,I,K,ve);if(Ge.optional&&(ve=!0),Ge===_||Ge.type==="ArrowFunctionExpression"){if(ve){var ut=this.startNodeAt(T,B);ut.expression=Ge,Ge=this.finishNode(ut,"ChainExpression")}return Ge}_=Ge}},zn.parseSubscript=function(_,T,B,I,K,ve){var Ge=this.options.ecmaVersion>=11,ut=Ge&&this.eat(q.questionDot);I&&ut&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var lt=this.eat(q.bracketL);if(lt||ut&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var sr=this.startNodeAt(T,B);sr.object=_,sr.property=lt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),sr.computed=!!lt,lt&&this.expect(q.bracketR),Ge&&(sr.optional=ut),_=this.finishNode(sr,"MemberExpression")}else if(!I&&this.eat(q.parenL)){var _r=new pe,Rn=this.yieldPos,jn=this.awaitPos,Nn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Ki=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,_r);if(K&&!ut&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(_r,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Rn,this.awaitPos=jn,this.awaitIdentPos=Nn,this.parseArrowExpression(this.startNodeAt(T,B),Ki,!0);this.checkExpressionErrors(_r,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=jn||this.awaitPos,this.awaitIdentPos=Nn||this.awaitIdentPos;var ya=this.startNodeAt(T,B);ya.callee=_,ya.arguments=Ki,Ge&&(ya.optional=ut),_=this.finishNode(ya,"CallExpression")}else if(this.type===q.backQuote){(ut||ve)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ea=this.startNodeAt(T,B);ea.tag=_,ea.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(ea,"TaggedTemplateExpression")}return _},zn.parseExprAtom=function(_){this.type===q.slash&&this.readRegexp();var T,B=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(T,"Super");case q._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case q.name:var I=this.start,K=this.startLoc,ve=this.containsEsc,Ge=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ve&&Ge.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(I,K),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(I,K),[Ge],!1);if(this.options.ecmaVersion>=8&&Ge.name==="async"&&this.type===q.name&&!ve)return Ge=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,K),[Ge],!0)}return Ge;case q.regexp:var ut=this.value;return T=this.parseLiteral(ut.value),T.regex={pattern:ut.pattern,flags:ut.flags},T;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return T=this.startNode(),T.value=this.type===q._null?null:this.type===q._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case q.parenL:var lt=this.start,sr=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(sr)&&(_.parenthesizedAssign=lt),_.parenthesizedBind<0&&(_.parenthesizedBind=lt)),sr;case q.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(q.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case q.braceL:return this.parseObj(!1,_);case q._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},zn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(_);case q.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},zn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var T=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},zn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},zn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},zn.parseParenExpression=function(){this.expect(q.parenL);var _=this.parseExpression();return this.expect(q.parenR),_},zn.parseParenAndDistinguishExpression=function(_){var T=this.start,B=this.startLoc,I,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ve=this.start,Ge=this.startLoc,ut=[],lt=!0,sr=!1,_r=new pe,Rn=this.yieldPos,jn=this.awaitPos,Nn;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(lt?lt=!1:this.expect(q.comma),K&&this.afterTrailingComma(q.parenR,!0)){sr=!0;break}else if(this.type===q.ellipsis){Nn=this.start,ut.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ut.push(this.parseMaybeAssign(!1,_r,this.parseParenItem));var Ki=this.start,ya=this.startLoc;if(this.expect(q.parenR),_&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(_r,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Rn,this.awaitPos=jn,this.parseParenArrowList(T,B,ut);(!ut.length||sr)&&this.unexpected(this.lastTokStart),Nn&&this.unexpected(Nn),this.checkExpressionErrors(_r,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=jn||this.awaitPos,ut.length>1?(I=this.startNodeAt(ve,Ge),I.expressions=ut,this.finishNodeAt(I,"SequenceExpression",Ki,ya)):I=ut[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var ea=this.startNodeAt(T,B);return ea.expression=I,this.finishNode(ea,"ParenthesizedExpression")}else return I},zn.parseParenItem=function(_){return _},zn.parseParenArrowList=function(_,T,B){return this.parseArrowExpression(this.startNodeAt(_,T),B)};var bi=[];zn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){_.meta=T;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var I=this.start,K=this.startLoc,ve=this.type===q._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),I,K,!0),ve&&_.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(q.parenL)?_.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):_.arguments=bi,this.finishNode(_,"NewExpression")},zn.parseTemplateElement=function(_){var T=_.isTagged,B=this.startNode();return this.type===q.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===q.backQuote,this.finishNode(B,"TemplateElement")},zn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var B=this.startNode();this.next(),B.expressions=[];var I=this.parseTemplateElement({isTagged:T});for(B.quasis=[I];!I.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(q.braceR),B.quasis.push(I=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(B,"TemplateLiteral")},zn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!Gt.test(this.input.slice(this.lastTokEnd,this.start))},zn.parseObj=function(_,T){var B=this.startNode(),I=!0,K={};for(B.properties=[],this.next();!this.eat(q.braceR);){if(I)I=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var ve=this.parseProperty(_,T);_||this.checkPropClash(ve,K,T),B.properties.push(ve)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},zn.parseProperty=function(_,T){var B=this.startNode(),I,K,ve,Ge;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===q.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,T),this.type===q.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||T)&&(ve=this.start,Ge=this.startLoc),_||(I=this.eat(q.star)));var ut=this.containsEsc;return this.parsePropertyName(B),!_&&!ut&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(B)?(K=!0,I=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(B,T)):K=!1,this.parsePropertyValue(B,_,I,K,ve,Ge,T,ut),this.finishNode(B,"Property")},zn.parsePropertyValue=function(_,T,B,I,K,ve,Ge,ut){if((B||I)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Ge),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,I);else if(!T&&!ut&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(B||I)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var lt=_.kind==="get"?0:1;if(_.value.params.length!==lt){var sr=_.value.start;_.kind==="get"?this.raiseRecoverable(sr,"getter should have no params"):this.raiseRecoverable(sr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||I)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",T?_.value=this.parseMaybeDefault(K,ve,_.key):this.type===q.eq&&Ge?(Ge.shorthandAssign<0&&(Ge.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,ve,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},zn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(q.bracketR),_.key;_.computed=!1}return _.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},zn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},zn.parseMethod=function(_,T,B){var I=this.startNode(),K=this.yieldPos,ve=this.awaitPos,Ge=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=_),this.options.ecmaVersion>=8&&(I.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(qi(T,I.generator)|gi|(B?xa:0)),this.expect(q.parenL),I.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=K,this.awaitPos=ve,this.awaitIdentPos=Ge,this.finishNode(I,"FunctionExpression")},zn.parseArrowExpression=function(_,T,B){var I=this.yieldPos,K=this.awaitPos,ve=this.awaitIdentPos;return this.enterScope(qi(B,!1)|oi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=I,this.awaitPos=K,this.awaitIdentPos=ve,this.finishNode(_,"ArrowFunctionExpression")},zn.parseFunctionBody=function(_,T,B){var I=T&&this.type!==q.braceL,K=this.strict,ve=!1;if(I)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var Ge=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||Ge)&&(ve=this.strictDirective(this.end),ve&&Ge&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ut=this.labels;this.labels=[],ve&&(this.strict=!0),this.checkParams(_,!K&&!ve&&!T&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,Ea),_.body=this.parseBlock(!1,void 0,ve&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ut}this.exitScope()},zn.isSimpleParamList=function(_){for(var T=0,B=_;T<B.length;T+=1){var I=B[T];if(I.type!=="Identifier")return!1}return!0},zn.checkParams=function(_,T){for(var B={},I=0,K=_.params;I<K.length;I+=1){var ve=K[I];this.checkLVal(ve,ia,T?null:B)}},zn.parseExprList=function(_,T,B,I){for(var K=[],ve=!0;!this.eat(_);){if(ve)ve=!1;else if(this.expect(q.comma),T&&this.afterTrailingComma(_))break;var Ge=void 0;B&&this.type===q.comma?Ge=null:this.type===q.ellipsis?(Ge=this.parseSpread(I),I&&this.type===q.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):Ge=this.parseMaybeAssign(!1,I),K.push(Ge)}return K},zn.checkUnreserved=function(_){var T=_.start,B=_.end,I=_.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(I)&&this.raise(T,"Unexpected keyword '"+I+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,B).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+I+"' is reserved"))}},zn.parseIdent=function(_,T){var B=this.startNode();return this.type===q.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},zn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(q.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},zn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var pi=Bi.prototype;pi.raise=function(_,T){var B=ft(this.input,_);T+=" ("+B.line+":"+B.column+")";var I=new SyntaxError(T);throw I.pos=_,I.loc=B,I.raisedAt=this.pos,I},pi.raiseRecoverable=pi.raise,pi.curPosition=function(){if(this.options.locations)return new Re(this.curLine,this.pos-this.lineStart)};var An=Bi.prototype,Mi=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};An.enterScope=function(_){this.scopeStack.push(new Mi(_))},An.exitScope=function(){this.scopeStack.pop()},An.treatFunctionsAsVarInScope=function(_){return _.flags&Wr||!this.inModule&&_.flags&Kn},An.declareName=function(_,T,B){var I=!1;if(T===ba){var K=this.currentScope();I=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Kn&&delete this.undefinedExports[_]}else if(T===sn){var ve=this.currentScope();ve.lexical.push(_)}else if(T===R){var Ge=this.currentScope();this.treatFunctionsAsVar?I=Ge.lexical.indexOf(_)>-1:I=Ge.lexical.indexOf(_)>-1||Ge.var.indexOf(_)>-1,Ge.functions.push(_)}else for(var ut=this.scopeStack.length-1;ut>=0;--ut){var lt=this.scopeStack[ut];if(lt.lexical.indexOf(_)>-1&&!(lt.flags&ci&&lt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(lt)&&lt.functions.indexOf(_)>-1){I=!0;break}if(lt.var.push(_),this.inModule&&lt.flags&Kn&&delete this.undefinedExports[_],lt.flags&na)break}I&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},An.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},An.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},An.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&na)return T}},An.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&na&&!(T.flags&oi))return T}};var Li=function(T,B,I){this.type="",this.start=B,this.end=0,T.options.locations&&(this.loc=new _t(T,I)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[B,0])},Na=Bi.prototype;Na.startNode=function(){return new Li(this,this.start,this.startLoc)},Na.startNodeAt=function(_,T){return new Li(this,_,T)};function fs(_,T,B,I){return _.type=T,_.end=B,this.options.locations&&(_.loc.end=I),this.options.ranges&&(_.range[1]=B),_}Na.finishNode=function(_,T){return fs.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},Na.finishNodeAt=function(_,T,B,I){return fs.call(this,_,T,B,I)};var Lo=function(T,B,I,K,ve){this.token=T,this.isExpr=!!B,this.preserveSpace=!!I,this.override=K,this.generator=!!ve},ka={b_stat:new Lo("{",!1),b_expr:new Lo("{",!0),b_tmpl:new Lo("${",!1),p_stat:new Lo("(",!1),p_expr:new Lo("(",!0),q_tmpl:new Lo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Lo("function",!1),f_expr:new Lo("function",!0),f_expr_gen:new Lo("function",!0,!1,null,!0),f_gen:new Lo("function",!1,!1,null,!0)},Sa=Bi.prototype;Sa.initialContext=function(){return[ka.b_stat]},Sa.braceIsBlock=function(_){var T=this.curContext();return T===ka.f_expr||T===ka.f_stat?!0:_===q.colon&&(T===ka.b_stat||T===ka.b_expr)?!T.isExpr:_===q._return||_===q.name&&this.exprAllowed?Gt.test(this.input.slice(this.lastTokEnd,this.start)):_===q._else||_===q.semi||_===q.eof||_===q.parenR||_===q.arrow?!0:_===q.braceL?T===ka.b_stat:_===q._var||_===q._const||_===q.name?!1:!this.exprAllowed},Sa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},Sa.updateContext=function(_){var T,B=this.type;B.keyword&&_===q.dot?this.exprAllowed=!1:(T=B.updateContext)?T.call(this,_):this.exprAllowed=B.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===ka.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},q.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?ka.b_stat:ka.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(ka.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(_){var T=_===q._if||_===q._for||_===q._with||_===q._while;this.context.push(T?ka.p_stat:ka.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(_){_.beforeExpr&&_!==q.semi&&_!==q._else&&!(_===q._return&&Gt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===q.colon||_===q.braceL)&&this.curContext()===ka.b_stat)?this.context.push(ka.f_expr):this.context.push(ka.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===ka.q_tmpl?this.context.pop():this.context.push(ka.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(_){if(_===q._function){var T=this.context.length-1;this.context[T]===ka.f_expr?this.context[T]=ka.f_expr_gen:this.context[T]=ka.f_gen}this.exprAllowed=!0},q.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var W="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=W+" Extended_Pictographic",re=$,he={9:W,10:$,11:re},Ae="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",je="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Je=je+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ue=Je+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Oe={9:je,10:Je,11:ue},pt={};function pr(_){var T=pt[_]={binary:We(he[_]+" "+Ae),nonBinary:{General_Category:We(Ae),Script:We(Oe[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}pr(9),pr(10),pr(11);var Ot=Bi.prototype,Dt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=pt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Dt.prototype.reset=function(T,B,I){var K=I.indexOf("u")!==-1;this.start=T|0,this.source=B+"",this.flags=I,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},Dt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Dt.prototype.at=function(T,B){B===void 0&&(B=!1);var I=this.source,K=I.length;if(T>=K)return-1;var ve=I.charCodeAt(T);if(!(B||this.switchU)||ve<=55295||ve>=57344||T+1>=K)return ve;var Ge=I.charCodeAt(T+1);return Ge>=56320&&Ge<=57343?(ve<<10)+Ge-56613888:ve},Dt.prototype.nextIndex=function(T,B){B===void 0&&(B=!1);var I=this.source,K=I.length;if(T>=K)return K;var ve=I.charCodeAt(T),Ge;return!(B||this.switchU)||ve<=55295||ve>=57344||T+1>=K||(Ge=I.charCodeAt(T+1))<56320||Ge>57343?T+1:T+2},Dt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Dt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Dt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Dt.prototype.eat=function(T,B){return B===void 0&&(B=!1),this.current(B)===T?(this.advance(B),!0):!1};function mr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Ot.validateRegExpFlags=function(_){for(var T=_.validFlags,B=_.flags,I=0;I<B.length;I++){var K=B.charAt(I);T.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf(K,I+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Ot.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Ot.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,B=_.backReferenceNames;T<B.length;T+=1){var I=B[T];_.groupNames.indexOf(I)===-1&&_.raise("Invalid named capture referenced")}},Ot.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Ot.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Ot.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Ot.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=T,!1},Ot.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Ot.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Ot.regexp_eatBracedQuantifier=function(_,T){var B=_.pos;if(_.eat(123)){var I=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(I=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<I&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=B}return!1},Ot.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Ot.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Ot.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Ot.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Ot.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Ot.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Ot.regexp_eatSyntaxCharacter=function(_){var T=_.current();return _n(T)?(_.lastIntValue=T,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Ot.regexp_eatPatternCharacters=function(_){for(var T=_.pos,B=0;(B=_.current())!==-1&&!_n(B);)_.advance();return _.pos!==T},Ot.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Ot.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Ot.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Ot.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=mr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=mr(_.lastIntValue);return!0}return!1},Ot.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,B=this.options.ecmaVersion>=11,I=_.current(B);return _.advance(B),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(I=_.lastIntValue),cn(I)?(_.lastIntValue=I,!0):(_.pos=T,!1)};function cn(_){return ar(_,!0)||_===36||_===95}Ot.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,B=this.options.ecmaVersion>=11,I=_.current(B);return _.advance(B),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(I=_.lastIntValue),Ct(I)?(_.lastIntValue=I,!0):(_.pos=T,!1)};function Ct(_){return dr(_,!0)||_===36||_===95||_===8204||_===8205}Ot.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Ot.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=T}return!1},Ot.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Ot.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Ot.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Ot.regexp_eatZero=function(_){return _.current()===48&&!wi(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Ot.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Ot.regexp_eatControlLetter=function(_){var T=_.current();return un(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function un(_){return _>=65&&_<=90||_>=97&&_<=122}Ot.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var B=_.pos,I=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(I&&K>=55296&&K<=56319){var ve=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var Ge=_.lastIntValue;if(Ge>=56320&&Ge<=57343)return _.lastIntValue=(K-55296)*1024+(Ge-56320)+65536,!0}_.pos=ve,_.lastIntValue=K}return!0}if(I&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Zr(_.lastIntValue))return!0;I&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Zr(_){return _>=0&&_<=1114111}Ot.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Ot.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Ot.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Yr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Yr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Ot.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var I=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,I),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Ot.regexp_validateUnicodePropertyNameAndValue=function(_,T,B){rn(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(B)||_.raise("Invalid property value")},Ot.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Ot.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";vi(T=_.current());)_.lastStringValue+=mr(T),_.advance();return _.lastStringValue!==""};function vi(_){return un(_)||_===95}Ot.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";qr(T=_.current());)_.lastStringValue+=mr(T),_.advance();return _.lastStringValue!==""};function qr(_){return vi(_)||wi(_)}Ot.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Ot.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Ot.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(T===-1||B===-1)&&_.raise("Invalid character class"),T!==-1&&B!==-1&&T>B&&_.raise("Range out of order in character class")}}},Ot.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||Ti(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var I=_.current();return I!==93?(_.lastIntValue=I,_.advance(),!0):!1},Ot.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Ot.regexp_eatClassControlLetter=function(_){var T=_.current();return wi(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Ot.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Ot.regexp_eatDecimalDigits=function(_){var T=_.pos,B=0;for(_.lastIntValue=0;wi(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==T};function wi(_){return _>=48&&_<=57}Ot.regexp_eatHexDigits=function(_){var T=_.pos,B=0;for(_.lastIntValue=0;oa(B=_.current());)_.lastIntValue=16*_.lastIntValue+Ei(B),_.advance();return _.pos!==T};function oa(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function Ei(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Ot.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+B*8+_.lastIntValue:_.lastIntValue=T*8+B}else _.lastIntValue=T;return!0}return!1},Ot.regexp_eatOctalDigit=function(_){var T=_.current();return Ti(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ti(_){return _>=48&&_<=55}Ot.regexp_eatFixedHexDigits=function(_,T){var B=_.pos;_.lastIntValue=0;for(var I=0;I<T;++I){var K=_.current();if(!oa(K))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+Ei(K),_.advance()}return!0};var Si=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new _t(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},ei=Bi.prototype;ei.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Si(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ei.getToken=function(){return this.next(),new Si(this)},typeof Symbol!="undefined"&&(ei[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===q.eof,value:T}}}}),ei.curContext=function(){return this.context[this.context.length-1]},ei.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ei.readToken=function(_){return ar(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ei.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},ei.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){He.lastIndex=T;for(var I;(I=He.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,B),T,this.pos,_,this.curPosition())},ei.skipLineComment=function(_){for(var T=this.pos,B=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!$e(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,B,this.curPosition())},ei.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&bt.test(String.fromCharCode(_)))++this.pos;else break e}}},ei.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=T,this.updateContext(B)},ei.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},ei.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},ei.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),B=1,I=_===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++B,I=q.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(q.assign,B+1):this.finishOp(I,B)},ei.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(q.assign,3)}return this.finishOp(_===124?q.logicalOR:q.logicalAND,2)}return T===61?this.finishOp(q.assign,2):this.finishOp(_===124?q.bitwiseOR:q.bitwiseAND,1)},ei.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},ei.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Gt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):T===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},ei.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),B=1;return T===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(q.assign,B+1):this.finishOp(q.bitShift,B)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(B=2),this.finishOp(q.relational,B))},ei.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(_===61?q.eq:q.prefix,1)},ei.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(q.questionDot,2)}if(T===63){if(_>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},ei.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+Hi(_)+"'")},ei.finishOp=function(_,T){var B=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,B)},ei.readRegexp=function(){for(var _,T,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(Gt.test(I)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(I==="[")T=!0;else if(I==="]"&&T)T=!1;else if(I==="/"&&!T)break;_=I==="\\"}++this.pos}var K=this.input.slice(B,this.pos);++this.pos;var ve=this.pos,Ge=this.readWord1();this.containsEsc&&this.unexpected(ve);var ut=this.regexpState||(this.regexpState=new Dt(this));ut.reset(B,K,Ge),this.validateRegExpFlags(ut),this.validateRegExpPattern(ut);var lt=null;try{lt=new RegExp(K,Ge)}catch(sr){}return this.finishToken(q.regexp,{pattern:K,flags:Ge,value:lt})},ei.readInt=function(_,T,B){for(var I=this.options.ecmaVersion>=12&&T===void 0,K=B&&this.input.charCodeAt(this.pos)===48,ve=this.pos,Ge=0,ut=0,lt=0,sr=T==null?Infinity:T;lt<sr;++lt,++this.pos){var _r=this.input.charCodeAt(this.pos),Rn=void 0;if(I&&_r===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ut===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),lt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ut=_r;continue}if(_r>=97?Rn=_r-97+10:_r>=65?Rn=_r-65+10:_r>=48&&_r<=57?Rn=_r-48:Rn=Infinity,Rn>=_)break;ut=_r,Ge=Ge*_+Rn}return I&&ut===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ve||T!=null&&this.pos-ve!==T?null:Ge};function ji(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function La(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ei.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=La(this.input.slice(T,this.pos)),++this.pos):ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,B)},ei.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var B=this.pos-T>=2&&this.input.charCodeAt(T)===48;B&&this.strict&&this.raise(T,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&I===110){var K=La(this.input.slice(T,this.pos));return++this.pos,ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,K)}B&&/[89]/.test(this.input.slice(T,this.pos))&&(B=!1),I===46&&!B&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!B&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ve=ji(this.input.slice(T,this.pos),B);return this.finishToken(q.num,ve)},ei.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else T=this.readHexChar(4);return T};function Hi(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ei.readString=function(_){for(var T="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===_)break;I===92?(T+=this.input.slice(B,this.pos),T+=this.readEscapedChar(!1),B=this.pos):($e(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(B,this.pos++),this.finishToken(q.string,T)};var Pi={};ei.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Pi)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ei.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Pi;this.raise(_,T)},ei.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(q.template,_));if(B===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if($e(B)){switch(_+=this.input.slice(T,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},ei.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ei.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Hi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(I,8);return K>255&&(I=I.slice(0,-1),K=parseInt(I,8)),this.pos+=I.length-1,T=this.input.charCodeAt(this.pos),(I!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-I.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return $e(T)?"":String.fromCharCode(T)}},ei.readHexChar=function(_){var T=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(T,"Bad character escape sequence"),B},ei.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,B=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(dr(K,I))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var ve=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Ge=this.readCodePoint();(T?ar:dr)(Ge,I)||this.invalidStringToken(ve,"Invalid Unicode escape"),_+=Hi(Ge),B=this.pos}else break;T=!1}return _+this.input.slice(B,this.pos)},ei.readWord=function(){var _=this.readWord1(),T=q.name;return this.keywords.test(_)&&(T=St[_]),this.finishToken(T,_)};var Ni="7.4.1";Bi.acorn={Parser:Bi,version:Ni,defaultOptions:Lt,Position:Re,SourceLocation:_t,getLineInfo:ft,Node:Li,TokenType:kt,tokTypes:q,keywordTypes:St,TokContext:Lo,tokContexts:ka,isIdentifierChar:dr,isIdentifierStart:ar,Token:Si,isNewLine:$e,lineBreak:Gt,lineBreakG:He,nonASCIIwhitespace:bt};function Da(_,T){return Bi.parse(_,T)}function Js(_,T,B){return Bi.parseExpressionAt(_,T,B)}function za(_,T){return Bi.tokenizer(_,T)}function Ca(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function Ps(_){var T=typeof Map=="function"?new Map:void 0;return Ps=function(I){if(I===null||!Pu(I))return I;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(I))return T.get(I);T.set(I,K)}function K(){return Ji(I,arguments,Ga(this).constructor)}return K.prototype=Object.create(I.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),co(K,I)},Ps(_)}function Vo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Ji(_,T,B){return Vo()?Ji=Reflect.construct:Ji=function(K,ve,Ge){var ut=[null];ut.push.apply(ut,ve);var lt=Function.bind.apply(K,ut),sr=new lt;return Ge&&co(sr,Ge.prototype),sr},Ji.apply(null,arguments)}function Pu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function co(_,T){return co=Object.setPrototypeOf||function(I,K){return I.__proto__=K,I},co(_,T)}function Ga(_){return Ga=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ga(_)}var $n=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ps(Error)),Wi=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ps(SyntaxError)),bo=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ps(ReferenceError)),Go=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ps(TypeError)),vu=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}($n),Vt=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(Wi),Wt=function(_){Ca(T,_);function T(){return _.apply(this,arguments)||this}return T}(bo),fa={UnknownError:[3001,"%0",vu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",vu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Wt],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Wt],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Wt],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Wt],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Wt],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Wt],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Wt],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Wt],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Wt],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Wt],FunctionUndefinedReferenceError:[2001,"%0 is not a function",bo],VariableUndefinedReferenceError:[2002,"%0 is not defined",bo],IsNotConstructor:[2003,"%0 is not a constructor",Go]};function pa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ns(_,T,B){return pa()?ns=Reflect.construct:ns=function(K,ve,Ge){var ut=[null];ut.push.apply(ut,ve);var lt=Function.bind.apply(K,ut),sr=new lt;return Ge&&ao(sr,Ge.prototype),sr},ns.apply(null,arguments)}function ao(_,T){return ao=Object.setPrototypeOf||function(I,K){return I.__proto__=K,I},ao(_,T)}var ln="0.0.3";function Sn(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var Tt=Object.prototype.hasOwnProperty,te=Symbol("Break"),D=Symbol("Continue"),Ke=Symbol("DefaultCase"),Mt=Symbol("EmptyStatementReturn"),Rr=Symbol("WithScopeName"),Mn=Symbol("SuperScopeName"),Ci=Symbol("RootScopeName"),eo=Symbol("GlobalScopeName");function Fa(_){return typeof _=="function"}var Ua=function(){function _(B){this.interpreter=B}var T=_.prototype;return T.generator=function(){var I=this.interpreter;function K(){return this.getCurrentScope()}function ve(){return this.getGlobalScope()}function Ge(){return this.getCurrentContext()}return{getOptions:I.getOptions.bind(I),getCurrentScope:K.bind(I),getGlobalScope:ve.bind(I),getCurrentContext:Ge.bind(I),getExecStartTime:I.getExecStartTime.bind(I)}},_}();function Ho(_,T,B){if(B===void 0&&(B=!0),!(_ instanceof Ua))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var I=_.generator(),K=I.getOptions(),ve={timeout:K.timeout,_initEnv:function(){B||this.setCurrentContext(I.getCurrentContext()),this.execStartTime=I.getExecStartTime(),this.execEndTime=this.execStartTime}},Ge=B?I.getGlobalScope():I.getCurrentScope(),ut=new Eo(Ge,ve);return ut.evaluate(T)}}Object.defineProperty(Ho,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function _s(_){if(!(_ instanceof Ua))throw new Error("Illegal call");for(var T=_.generator(),B=arguments.length,I=new Array(B>1?B-1:0),K=1;K<B;K++)I[K-1]=arguments[K];var ve=I.pop(),Ge=new Eo(T.getGlobalScope(),T.getOptions()),ut=`
		    (function anonymous(`+I.join(",")+`){
		        `+ve+`
		    });
		    `;return Ge.evaluate(ut)}Object.defineProperty(_s,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Do=function(T){this.value=T},xs=function(T){this.value=T},is=function(T){this.value=T},ps=function(T,B,I){B===void 0&&(B=null),this.name=I,this.parent=B,this.data=T,this.labelStack=[]};function Is(){}function Hs(_,T){return _===void 0&&(_=null),new ps(Object.create(null),_,T)}function Wo(_){return Object.create(_)}var da={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Ho,Function:_s};typeof JSON!="undefined"&&(da.JSON=JSON),typeof Promise!="undefined"&&(da.Promise=Promise),typeof Set!="undefined"&&(da.Set=Set),typeof Map!="undefined"&&(da.Map=Map),typeof Symbol!="undefined"&&(da.Symbol=Symbol),typeof Proxy!="undefined"&&(da.Proxy=Proxy),typeof WeakMap!="undefined"&&(da.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(da.WeakSet=WeakSet),typeof Reflect!="undefined"&&(da.Reflect=Reflect);var Eo=function(){function _(B,I){B===void 0&&(B=_.global),I===void 0&&(I={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:I.ecmaVersion||_.ecmaVersion,timeout:I.timeout||0,rootContext:I.rootContext,globalContextInFunction:I.globalContextInFunction===void 0?_.globalContextInFunction:I.globalContextInFunction,_initEnv:I._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(I){var K;if(I instanceof ps)K=I;else{var ve=null,Ge=this.createSuperScope(I);this.options.rootContext&&(ve=new ps(Wo(this.options.rootContext),Ge,Ci)),K=new ps(I,ve||Ge,eo)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ut=this.options._initEnv;ut&&ut.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(I){I===void 0&&(I=0),this.options.timeout=I},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(I){return I instanceof vu||I instanceof Wt||I instanceof Vt},T.createSuperScope=function(I){var K=Object.assign({},da),ve=Object.keys(K);return ve.forEach(function(Ge){Ge in I&&delete K[Ge]}),new ps(K,null,Mn)},T.setCurrentContext=function(I){this.currentContext=I},T.setCurrentScope=function(I){this.currentScope=I},T.evaluate=function(I){I===void 0&&(I="");var K;if(!!I)return K=Da(I,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,I)},T.appendCode=function(I){return this.evaluate(I)},T.evaluateNode=function(I,K){var ve=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ge=this.getCurrentScope(),ut=this.getCurrentContext(),lt=Ge.labelStack.concat([]),sr=this.callStack.concat([]),_r=function(){ve.setCurrentScope(Ge),ve.setCurrentContext(ut),Ge.labelStack=lt,ve.callStack=sr};try{var Rn=this.createClosure(I);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Rn()}catch(jn){throw jn}finally{_r(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(I,K,ve){var Ge=I[1].replace("%0",String(K));return ve!==null&&(Ge+=this.getNodePosition(ve||this.lastExecNode)),Ge},T.createError=function(I,K){return new K(I)},T.createThrowError=function(I,K){return this.createError(I,K)},T.createInternalThrowError=function(I,K,ve){return this.createError(this.createErrorMessage(I,K,ve),I[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var I=this.options.timeout||0,K=Date.now();return K-this.execStartTime>I},T.getNodePosition=function(I){if(I){var K="";return I.loc?" ["+I.loc.start.line+":"+I.loc.start.column+"]"+K:""}return""},T.createClosure=function(I){var K=this,ve;switch(I.type){case"BinaryExpression":ve=this.binaryExpressionHandler(I);break;case"LogicalExpression":ve=this.logicalExpressionHandler(I);break;case"UnaryExpression":ve=this.unaryExpressionHandler(I);break;case"UpdateExpression":ve=this.updateExpressionHandler(I);break;case"ObjectExpression":ve=this.objectExpressionHandler(I);break;case"ArrayExpression":ve=this.arrayExpressionHandler(I);break;case"CallExpression":ve=this.callExpressionHandler(I);break;case"NewExpression":ve=this.newExpressionHandler(I);break;case"MemberExpression":ve=this.memberExpressionHandler(I);break;case"ThisExpression":ve=this.thisExpressionHandler(I);break;case"SequenceExpression":ve=this.sequenceExpressionHandler(I);break;case"Literal":ve=this.literalHandler(I);break;case"Identifier":ve=this.identifierHandler(I);break;case"AssignmentExpression":ve=this.assignmentExpressionHandler(I);break;case"FunctionDeclaration":ve=this.functionDeclarationHandler(I);break;case"VariableDeclaration":ve=this.variableDeclarationHandler(I);break;case"BlockStatement":case"Program":ve=this.programHandler(I);break;case"ExpressionStatement":ve=this.expressionStatementHandler(I);break;case"EmptyStatement":ve=this.emptyStatementHandler(I);break;case"ReturnStatement":ve=this.returnStatementHandler(I);break;case"FunctionExpression":ve=this.functionExpressionHandler(I);break;case"IfStatement":ve=this.ifStatementHandler(I);break;case"ConditionalExpression":ve=this.conditionalExpressionHandler(I);break;case"ForStatement":ve=this.forStatementHandler(I);break;case"WhileStatement":ve=this.whileStatementHandler(I);break;case"DoWhileStatement":ve=this.doWhileStatementHandler(I);break;case"ForInStatement":ve=this.forInStatementHandler(I);break;case"WithStatement":ve=this.withStatementHandler(I);break;case"ThrowStatement":ve=this.throwStatementHandler(I);break;case"TryStatement":ve=this.tryStatementHandler(I);break;case"ContinueStatement":ve=this.continueStatementHandler(I);break;case"BreakStatement":ve=this.breakStatementHandler(I);break;case"SwitchStatement":ve=this.switchStatementHandler(I);break;case"LabeledStatement":ve=this.labeledStatementHandler(I);break;case"DebuggerStatement":ve=this.debuggerStatementHandler(I);break;default:throw this.createInternalThrowError(fa.NodeTypeSyntaxError,I.type,I)}return function(){var Ge=K.options.timeout;if(Ge&&Ge>0&&K.checkTimeout())throw K.createInternalThrowError(fa.ExecutionTimeOutError,Ge,null);return K.lastExecNode=I,ve.apply(void 0,arguments)}},T.binaryExpressionHandler=function(I){var K=this,ve=this.createClosure(I.left),Ge=this.createClosure(I.right);return function(){var ut=ve(),lt=Ge();switch(I.operator){case"==":return ut==lt;case"!=":return ut!=lt;case"===":return ut===lt;case"!==":return ut!==lt;case"<":return ut<lt;case"<=":return ut<=lt;case">":return ut>lt;case">=":return ut>=lt;case"<<":return ut<<lt;case">>":return ut>>lt;case">>>":return ut>>>lt;case"+":return ut+lt;case"-":return ut-lt;case"*":return ut*lt;case"**":return Math.pow(ut,lt);case"/":return ut/lt;case"%":return ut%lt;case"|":return ut|lt;case"^":return ut^lt;case"&":return ut&lt;case"in":return ut in lt;case"instanceof":return ut instanceof lt;default:throw K.createInternalThrowError(fa.BinaryOperatorSyntaxError,I.operator,I)}}},T.logicalExpressionHandler=function(I){var K=this,ve=this.createClosure(I.left),Ge=this.createClosure(I.right);return function(){switch(I.operator){case"||":return ve()||Ge();case"&&":return ve()&&Ge();default:throw K.createInternalThrowError(fa.LogicalOperatorSyntaxError,I.operator,I)}}},T.unaryExpressionHandler=function(I){var K=this;switch(I.operator){case"delete":var ve=this.createObjectGetter(I.argument),Ge=this.createNameGetter(I.argument);return function(){var _r=ve(),Rn=Ge();return delete _r[Rn]};default:var ut;if(I.operator==="typeof"&&I.argument.type==="Identifier"){var lt=this.createObjectGetter(I.argument),sr=this.createNameGetter(I.argument);ut=function(){return lt()[sr()]}}else ut=this.createClosure(I.argument);return function(){var _r=ut();switch(I.operator){case"-":return-_r;case"+":return+_r;case"!":return!_r;case"~":return~_r;case"void":return;case"typeof":return typeof _r;default:throw K.createInternalThrowError(fa.UnaryOperatorSyntaxError,I.operator,I)}}}},T.updateExpressionHandler=function(I){var K=this,ve=this.createObjectGetter(I.argument),Ge=this.createNameGetter(I.argument);return function(){var ut=ve(),lt=Ge();switch(K.assertVariable(ut,lt,I),I.operator){case"++":return I.prefix?++ut[lt]:ut[lt]++;case"--":return I.prefix?--ut[lt]:ut[lt]--;default:throw K.createInternalThrowError(fa.UpdateOperatorSyntaxError,I.operator,I)}}},T.objectExpressionHandler=function(I){var K=this,ve=[];function Ge(lt){return lt.type==="Identifier"?lt.name:lt.type==="Literal"?lt.value:this.throwError(fa.ObjectStructureSyntaxError,lt.type,lt)}var ut=Object.create(null);return I.properties.forEach(function(lt){var sr=lt.kind,_r=Ge(lt.key);(!ut[_r]||sr==="init")&&(ut[_r]={}),ut[_r][sr]=K.createClosure(lt.value),ve.push({key:_r,property:lt})}),function(){for(var lt={},sr=ve.length,_r=0;_r<sr;_r++){var Rn=ve[_r],jn=Rn.key,Nn=ut[jn],Ki=Nn.init?Nn.init():void 0,ya=Nn.get?Nn.get():function(){},ea=Nn.set?Nn.set():function(Hu){};if("set"in Nn||"get"in Nn){var Xi={configurable:!0,enumerable:!0,get:ya,set:ea};Object.defineProperty(lt,jn,Xi)}else{var hs=Rn.property,lu=hs.kind;hs.key.type==="Identifier"&&hs.value.type==="FunctionExpression"&&lu==="init"&&!hs.value.id&&Sn(Ki,hs.key.name),lt[jn]=Ki}}return lt}},T.arrayExpressionHandler=function(I){var K=this,ve=I.elements.map(function(Ge){return Ge&&K.createClosure(Ge)});return function(){for(var Ge=ve.length,ut=Array(Ge),lt=0;lt<Ge;lt++){var sr=ve[lt];sr&&(ut[lt]=sr())}return ut}},T.safeObjectGet=function(I,K,ve){return I[K]},T.createCallFunctionGetter=function(I){var K=this;switch(I.type){case"MemberExpression":var ve=this.createClosure(I.object),Ge=this.createMemberKeyGetter(I),ut=this.source;return function(){var sr=ve(),_r=Ge(),Rn=K.safeObjectGet(sr,_r,I);if(!Rn||!Fa(Rn)){var jn=ut.slice(I.start,I.end);throw K.createInternalThrowError(fa.FunctionUndefinedReferenceError,jn,I)}return Rn.__IS_EVAL_FUNC?function(Nn){return Rn(new Ua(K),Nn,!0)}:Rn.__IS_FUNCTION_FUNC?function(){for(var Nn=arguments.length,Ki=new Array(Nn),ya=0;ya<Nn;ya++)Ki[ya]=arguments[ya];return Rn.apply(void 0,[new Ua(K)].concat(Ki))}:Rn.bind(sr)};default:var lt=this.createClosure(I);return function(){var sr="";I.type==="Identifier"&&(sr=I.name);var _r=lt();if(!_r||!Fa(_r))throw K.createInternalThrowError(fa.FunctionUndefinedReferenceError,sr,I);if(I.type==="Identifier"&&_r.__IS_EVAL_FUNC&&sr==="eval")return function(Nn){var Ki=K.getScopeFromName(sr,K.getCurrentScope()),ya=Ki.name===Mn||Ki.name===eo||Ki.name===Ci;return _r(new Ua(K),Nn,!ya)};if(_r.__IS_EVAL_FUNC)return function(Nn){return _r(new Ua(K),Nn,!0)};if(_r.__IS_FUNCTION_FUNC)return function(){for(var Nn=arguments.length,Ki=new Array(Nn),ya=0;ya<Nn;ya++)Ki[ya]=arguments[ya];return _r.apply(void 0,[new Ua(K)].concat(Ki))};var Rn=K.options.globalContextInFunction;if(I.type==="Identifier"){var jn=K.getIdentifierScope(I);jn.name===Rr&&(Rn=jn.data)}return _r.bind(Rn)}}},T.callExpressionHandler=function(I){var K=this,ve=this.createCallFunctionGetter(I.callee),Ge=I.arguments.map(function(ut){return K.createClosure(ut)});return function(){return ve().apply(void 0,Ge.map(function(ut){return ut()}))}},T.functionExpressionHandler=function(I){var K=this,ve=this,Ge=this.source,ut=this.collectDeclVars,lt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var sr=I.id?I.id.name:"",_r=I.params.length,Rn=I.params.map(function(ya){return K.createParamNameGetter(ya)}),jn=this.createClosure(I.body),Nn=this.collectDeclVars,Ki=this.collectDeclFuncs;return this.collectDeclVars=ut,this.collectDeclFuncs=lt,function(){var ya=ve.getCurrentScope(),ea=function Xi(){for(var hs=arguments.length,lu=new Array(hs),Hu=0;Hu<hs;Hu++)lu[Hu]=arguments[Hu];ve.callStack.push(""+sr);var Qc=ve.getCurrentScope(),al=Hs(ya,"FunctionScope("+sr+")");ve.setCurrentScope(al),ve.addDeclarationsToScope(Nn,Ki,al),sr&&(al.data[sr]=Xi),al.data.arguments=arguments,Rn.forEach(function(Fo,Ou){al.data[Fo()]=lu[Ou]});var Cc=ve.getCurrentContext();ve.setCurrentContext(this);var Ws=jn();if(ve.setCurrentContext(Cc),ve.setCurrentScope(Qc),ve.callStack.pop(),Ws instanceof Do)return Ws.value};return Sn(ea,sr),Object.defineProperty(ea,"length",{value:_r,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ea,"toString",{value:function(){return Ge.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ea,"valueOf",{value:function(){return Ge.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),ea}},T.newExpressionHandler=function(I){var K=this,ve=this.source,Ge=this.createClosure(I.callee),ut=I.arguments.map(function(lt){return K.createClosure(lt)});return function(){var lt=Ge();if(!Fa(lt)||lt.__IS_EVAL_FUNC){var sr=I.callee,_r=ve.slice(sr.start,sr.end);throw K.createInternalThrowError(fa.IsNotConstructor,_r,I)}return lt.__IS_FUNCTION_FUNC?lt.apply(void 0,[new Ua(K)].concat(ut.map(function(Rn){return Rn()}))):ns(lt,ut.map(function(Rn){return Rn()}))}},T.memberExpressionHandler=function(I){var K=this.createClosure(I.object),ve=this.createMemberKeyGetter(I);return function(){var Ge=K(),ut=ve();return Ge[ut]}},T.thisExpressionHandler=function(I){var K=this;return function(){return K.getCurrentContext()}},T.sequenceExpressionHandler=function(I){var K=this,ve=I.expressions.map(function(Ge){return K.createClosure(Ge)});return function(){for(var Ge,ut=ve.length,lt=0;lt<ut;lt++){var sr=ve[lt];Ge=sr()}return Ge}},T.literalHandler=function(I){return function(){return I.regex?new RegExp(I.regex.pattern,I.regex.flags):I.value}},T.identifierHandler=function(I){var K=this;return function(){var ve=K.getCurrentScope(),Ge=K.getScopeDataFromName(I.name,ve);return K.assertVariable(Ge,I.name,I),Ge[I.name]}},T.getIdentifierScope=function(I){var K=this.getCurrentScope(),ve=this.getScopeFromName(I.name,K);return ve},T.assignmentExpressionHandler=function(I){var K=this;I.left.type==="Identifier"&&I.right.type==="FunctionExpression"&&!I.right.id&&(I.right.id={type:"Identifier",name:I.left.name});var ve=this.createObjectGetter(I.left),Ge=this.createNameGetter(I.left),ut=this.createClosure(I.right);return function(){var lt=ve(),sr=Ge(),_r=ut();switch(I.operator!=="="&&K.assertVariable(lt,sr,I),I.operator){case"=":return lt[sr]=_r;case"+=":return lt[sr]+=_r;case"-=":return lt[sr]-=_r;case"*=":return lt[sr]*=_r;case"**=":return lt[sr]=Math.pow(lt[sr],_r);case"/=":return lt[sr]/=_r;case"%=":return lt[sr]%=_r;case"<<=":return lt[sr]<<=_r;case">>=":return lt[sr]>>=_r;case">>>=":return lt[sr]>>>=_r;case"&=":return lt[sr]&=_r;case"^=":return lt[sr]^=_r;case"|=":return lt[sr]|=_r;default:throw K.createInternalThrowError(fa.AssignmentExpressionSyntaxError,I.type,I)}}},T.functionDeclarationHandler=function(I){if(I.id){var K=this.functionExpressionHandler(I);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(I.id.name,K)}return function(){return Mt}},T.getVariableName=function(I){if(I.type==="Identifier")return I.name;throw this.createInternalThrowError(fa.VariableTypeSyntaxError,I.type,I)},T.variableDeclarationHandler=function(I){for(var K=this,ve,Ge=[],ut=0;ut<I.declarations.length;ut++){var lt=I.declarations[ut];this.varDeclaration(this.getVariableName(lt.id)),lt.init&&Ge.push({type:"AssignmentExpression",operator:"=",left:lt.id,right:lt.init})}return Ge.length&&(ve=this.createClosure({type:"BlockStatement",body:Ge})),function(){if(ve){var sr=K.isVarDeclMode;K.isVarDeclMode=!0,ve(),K.isVarDeclMode=sr}return Mt}},T.assertVariable=function(I,K,ve){if(I===this.globalScope.data&&!(K in I))throw this.createInternalThrowError(fa.VariableUndefinedReferenceError,K,ve)},T.programHandler=function(I){var K=this,ve=I.body.map(function(Ge){return K.createClosure(Ge)});return function(){for(var Ge=Mt,ut=0;ut<ve.length;ut++){var lt=ve[ut],sr=K.setValue(lt());if(sr!==Mt&&(Ge=sr,Ge instanceof Do||Ge instanceof xs||Ge instanceof is||Ge===te||Ge===D))break}return Ge}},T.expressionStatementHandler=function(I){return this.createClosure(I.expression)},T.emptyStatementHandler=function(I){return function(){return Mt}},T.returnStatementHandler=function(I){var K=I.argument?this.createClosure(I.argument):Is;return function(){return new Do(K())}},T.ifStatementHandler=function(I){var K=this.createClosure(I.test),ve=this.createClosure(I.consequent),Ge=I.alternate?this.createClosure(I.alternate):function(){return Mt};return function(){return K()?ve():Ge()}},T.conditionalExpressionHandler=function(I){return this.ifStatementHandler(I)},T.forStatementHandler=function(I){var K=this,ve=Is,Ge=I.test?this.createClosure(I.test):function(){return!0},ut=Is,lt=this.createClosure(I.body);return I.type==="ForStatement"&&(ve=I.init?this.createClosure(I.init):ve,ut=I.update?this.createClosure(I.update):Is),function(sr){var _r,Rn=Mt,jn=I.type==="DoWhileStatement";for(sr&&sr.type==="LabeledStatement"&&(_r=sr.label.name),ve();jn||Ge();ut()){jn=!1;var Nn=K.setValue(lt());if(!(Nn===Mt||Nn===D)){if(Nn===te)break;if(Rn=Nn,Rn instanceof is&&Rn.value===_r){Rn=Mt;continue}if(Rn instanceof Do||Rn instanceof xs||Rn instanceof is)break}}return Rn}},T.whileStatementHandler=function(I){return this.forStatementHandler(I)},T.doWhileStatementHandler=function(I){return this.forStatementHandler(I)},T.forInStatementHandler=function(I){var K=this,ve=I.left,Ge=this.createClosure(I.right),ut=this.createClosure(I.body);return I.left.type==="VariableDeclaration"&&(this.createClosure(I.left)(),ve=I.left.declarations[0].id),function(lt){var sr,_r=Mt,Rn;lt&&lt.type==="LabeledStatement"&&(sr=lt.label.name);var jn=Ge();for(Rn in jn){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ve,right:{type:"Literal",value:Rn}})();var Nn=K.setValue(ut());if(!(Nn===Mt||Nn===D)){if(Nn===te)break;if(_r=Nn,_r instanceof is&&_r.value===sr){_r=Mt;continue}if(_r instanceof Do||_r instanceof xs||_r instanceof is)break}}return _r}},T.withStatementHandler=function(I){var K=this,ve=this.createClosure(I.object),Ge=this.createClosure(I.body);return function(){var ut=ve(),lt=K.getCurrentScope(),sr=new ps(ut,lt,Rr);K.setCurrentScope(sr);var _r=K.setValue(Ge());return K.setCurrentScope(lt),_r}},T.throwStatementHandler=function(I){var K=this,ve=this.createClosure(I.argument);return function(){throw K.setValue(void 0),ve()}},T.tryStatementHandler=function(I){var K=this,ve=this.createClosure(I.block),Ge=I.handler?this.catchClauseHandler(I.handler):null,ut=I.finalizer?this.createClosure(I.finalizer):null;return function(){var lt=K.getCurrentScope(),sr=K.getCurrentContext(),_r=lt.labelStack.concat([]),Rn=K.callStack.concat([]),jn=Mt,Nn,Ki,ya=function(){K.setCurrentScope(lt),K.setCurrentContext(sr),lt.labelStack=_r,K.callStack=Rn};try{jn=K.setValue(ve()),jn instanceof Do&&(Nn=jn)}catch(ea){if(ya(),K.isInterruptThrow(ea))throw ea;if(Ge)try{jn=K.setValue(Ge(ea)),jn instanceof Do&&(Nn=jn)}catch(Xi){if(ya(),K.isInterruptThrow(Xi))throw Xi;Ki=Xi}}if(ut)try{jn=ut(),jn instanceof Do&&(Nn=jn)}catch(ea){if(ya(),K.isInterruptThrow(ea))throw ea;Ki=ea}if(Ki)throw Ki;return Nn||jn}},T.catchClauseHandler=function(I){var K=this,ve=this.createParamNameGetter(I.param),Ge=this.createClosure(I.body);return function(ut){var lt,sr=K.getCurrentScope(),_r=sr.data,Rn=ve(),jn=Tt.call(_r,Rn),Nn=_r[Rn];return _r[Rn]=ut,lt=Ge(),jn?_r[Rn]=Nn:delete _r[Rn],lt}},T.continueStatementHandler=function(I){return function(){return I.label?new is(I.label.name):D}},T.breakStatementHandler=function(I){return function(){return I.label?new xs(I.label.name):te}},T.switchStatementHandler=function(I){var K=this,ve=this.createClosure(I.discriminant),Ge=I.cases.map(function(ut){return K.switchCaseHandler(ut)});return function(){for(var ut=ve(),lt=!1,sr,_r,Rn,jn=0;jn<Ge.length;jn++){var Nn=Ge[jn](),Ki=Nn.testClosure();if(Ki===Ke){Rn=Nn;continue}if(lt||Ki===ut){if(lt=!0,_r=K.setValue(Nn.bodyClosure()),_r===Mt)continue;if(_r===te||(sr=_r,sr instanceof Do||sr instanceof xs||sr instanceof is||sr===D))break}}if(!lt&&Rn){_r=K.setValue(Rn.bodyClosure());var ya=_r===Mt||_r===te||_r===D;ya||(sr=_r)}return sr}},T.switchCaseHandler=function(I){var K=I.test?this.createClosure(I.test):function(){return Ke},ve=this.createClosure({type:"BlockStatement",body:I.consequent});return function(){return{testClosure:K,bodyClosure:ve}}},T.labeledStatementHandler=function(I){var K=this,ve=I.label.name,Ge=this.createClosure(I.body);return function(){var ut,lt=K.getCurrentScope();return lt.labelStack.push(ve),ut=Ge(I),ut instanceof xs&&ut.value===ve&&(ut=Mt),lt.labelStack.pop(),ut}},T.debuggerStatementHandler=function(I){return function(){debugger;return Mt}},T.createParamNameGetter=function(I){if(I.type==="Identifier")return function(){return I.name};throw this.createInternalThrowError(fa.ParamTypeSyntaxError,I.type,I)},T.createObjectKeyGetter=function(I){var K;return I.type==="Identifier"?K=function(){return I.name}:K=this.createClosure(I),function(){return K()}},T.createMemberKeyGetter=function(I){return I.computed?this.createClosure(I.property):this.createObjectKeyGetter(I.property)},T.createObjectGetter=function(I){var K=this;switch(I.type){case"Identifier":return function(){return K.getScopeDataFromName(I.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(I.object);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,I.type,I)}},T.createNameGetter=function(I){switch(I.type){case"Identifier":return function(){return I.name};case"MemberExpression":return this.createMemberKeyGetter(I);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,I.type,I)}},T.varDeclaration=function(I){var K=this.collectDeclVars;K[I]=void 0},T.funcDeclaration=function(I,K){var ve=this.collectDeclFuncs;ve[I]=K},T.addDeclarationsToScope=function(I,K,ve){var Ge=ve.data;for(var ut in K){var lt=K[ut];Ge[ut]=lt&&lt()}for(var sr in I)sr in Ge||(Ge[sr]=void 0)},T.getScopeValue=function(I,K){var ve=this.getScopeFromName(I,K);return ve.data[I]},T.getScopeDataFromName=function(I,K){return this.getScopeFromName(I,K).data},T.getScopeFromName=function(I,K){var ve=K;do if(I in ve.data)return ve;while(ve=ve.parent);return this.globalScope},T.setValue=function(I){var K=this.callStack.length;return this.isVarDeclMode||K||I===Mt||I===te||I===D||I instanceof xs||I instanceof is||(this.value=I instanceof Do?I.value:I),I},T.getValue=function(){return this.value},_}();Eo.version=ln,Eo.eval=Ho,Eo.Function=_s,Eo.ecmaVersion=5,Eo.globalContextInFunction=void 0,Eo.global=Object.create(null);function Iu(_){return _===void 0&&(_=Object.create(null)),_}function rl(_,T,B){T===void 0&&(T=[]),B===void 0&&(B={});var I=B.parsingContext,K=B.timeout===void 0?0:B.timeout,ve=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,Ge=new Eo(I,{ecmaVersion:B.ecmaVersion,timeout:K,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return Ge.evaluate(ve)}function mu(_,T,B){var I=new Eo(T,B);return I.evaluate(_)}var ic=mu,nl=function(){function _(B){this._code=B}var T=_.prototype;return T.runInContext=function(I){return mu(this._code,I)},T.runInNewContext=function(I){return mu(this._code,I)},_}(),il=function(_,T,B){return mu(_,T,B)};function uu(){for(var _=arguments.length,T=new Array(_),B=0;B<_;B++)T[B]=arguments[B];var I=T.pop();return rl(I||"",T)}var Il=il},20396:function(Cr,oe,Q){var Pe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(De,m,Ie,X){"use strict";var de=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ce=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ze=de||ce,ge=["","webkit","Moz","MS","ms","o"],nt=ze?"":m.createElement("div"),ct="function",Et=Math.round,ar=Math.abs,dr=Date.now;function kt(te,D,Ke){return setTimeout(He(te,Ke),D)}function nr(te,D,Ke){return Array.isArray(te)?(Ut(te,Ke[D],Ke),!0):!1}function Ut(te,D,Ke){var Mt;if(!!te)if(te.forEach)te.forEach(D,Ke);else if(te.length!==X)for(Mt=0;Mt<te.length;)D.call(Ke,te[Mt],Mt,te),Mt++;else for(Mt in te)te.hasOwnProperty(Mt)&&D.call(Ke,te[Mt],Mt,te)}function ht(te,D,Ke){var Mt="DEPRECATED METHOD: "+D+`
`+Ke+` AT 
`;return function(){var Rr=new Error("get-stack-trace"),Mn=Rr&&Rr.stack?Rr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=De.console&&(De.console.warn||De.console.log);return Ci&&Ci.call(De.console,Mt,Mn),te.apply(this,arguments)}}var St;typeof Object.assign!="function"?St=function(D){if(D===X||D===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(D),Mt=1;Mt<arguments.length;Mt++){var Rr=arguments[Mt];if(Rr!==X&&Rr!==null)for(var Mn in Rr)Rr.hasOwnProperty(Mn)&&(Ke[Mn]=Rr[Mn])}return Ke}:St=Object.assign;var or=ht(function(D,Ke,Mt){for(var Rr=Object.keys(Ke),Mn=0;Mn<Rr.length;)(!Mt||Mt&&D[Rr[Mn]]===X)&&(D[Rr[Mn]]=Ke[Rr[Mn]]),Mn++;return D},"extend","Use `assign`."),q=ht(function(D,Ke){return or(D,Ke,!0)},"merge","Use `assign`.");function Gt(te,D,Ke){var Mt=D.prototype,Rr;Rr=te.prototype=Object.create(Mt),Rr.constructor=te,Rr._super=Mt,Ke&&St(Rr,Ke)}function He(te,D){return function(){return te.apply(D,arguments)}}function $e(te,D){return typeof te==ct?te.apply(D&&D[0]||X,D):te}function bt(te,D){return te===X?D:te}function et(te,D,Ke){Ut(rn(D),function(Mt){te.addEventListener(Mt,Ke,!1)})}function qt(te,D,Ke){Ut(rn(D),function(Mt){te.removeEventListener(Mt,Ke,!1)})}function Tr(te,D){for(;te;){if(te==D)return!0;te=te.parentNode}return!1}function Br(te,D){return te.indexOf(D)>-1}function rn(te){return te.trim().split(/\s+/g)}function Ee(te,D,Ke){if(te.indexOf&&!Ke)return te.indexOf(D);for(var Mt=0;Mt<te.length;){if(Ke&&te[Mt][Ke]==D||!Ke&&te[Mt]===D)return Mt;Mt++}return-1}function We(te){return Array.prototype.slice.call(te,0)}function Re(te,D,Ke){for(var Mt=[],Rr=[],Mn=0;Mn<te.length;){var Ci=D?te[Mn][D]:te[Mn];Ee(Rr,Ci)<0&&Mt.push(te[Mn]),Rr[Mn]=Ci,Mn++}return Ke&&(D?Mt=Mt.sort(function(Fa,Ua){return Fa[D]>Ua[D]}):Mt=Mt.sort()),Mt}function _t(te,D){for(var Ke,Mt,Rr=D[0].toUpperCase()+D.slice(1),Mn=0;Mn<ge.length;){if(Ke=ge[Mn],Mt=Ke?Ke+Rr:D,Mt in te)return Mt;Mn++}return X}var ft=1;function Lt(){return ft++}function Ht(te){var D=te.ownerDocument||te;return D.defaultView||D.parentWindow||De}var Mr=/mobile|tablet|ip(ad|hone|od)|android/i,Kn="ontouchstart"in De,Wr=_t(De,"PointerEvent")!==X,na=Kn&&Mr.test(navigator.userAgent),Yn="touch",ai="pen",oi="mouse",ci="kinect",gi=25,xa=1,qi=2,Gi=4,ia=8,ba=1,R=2,sn=4,Ea=8,Bi=16,aa=R|sn,Qi=Ea|Bi,cs=aa|Qi,pe=["x","y"],fi=["clientX","clientY"];function lo(te,D){var Ke=this;this.manager=te,this.callback=D,this.element=te.element,this.target=te.options.inputTarget,this.domHandler=function(Mt){$e(te.options.enable,[te])&&Ke.handler(Mt)},this.init()}lo.prototype={handler:function(){},init:function(){this.evEl&&et(this.element,this.evEl,this.domHandler),this.evTarget&&et(this.target,this.evTarget,this.domHandler),this.evWin&&et(Ht(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&qt(this.element,this.evEl,this.domHandler),this.evTarget&&qt(this.target,this.evTarget,this.domHandler),this.evWin&&qt(Ht(this.element),this.evWin,this.domHandler)}};function Va(te){var D,Ke=te.options.inputClass;return Ke?D=Ke:Wr?D=Ae:na?D=Dt:Kn?D=Ct:D=Sa,new D(te,Bt)}function Bt(te,D,Ke){var Mt=Ke.pointers.length,Rr=Ke.changedPointers.length,Mn=D&xa&&Mt-Rr==0,Ci=D&(Gi|ia)&&Mt-Rr==0;Ke.isFirst=!!Mn,Ke.isFinal=!!Ci,Mn&&(te.session={}),Ke.eventType=D,tr(te,Ke),te.emit("hammer.input",Ke),te.recognize(Ke),te.session.prevInput=Ke}function tr(te,D){var Ke=te.session,Mt=D.pointers,Rr=Mt.length;Ke.firstInput||(Ke.firstInput=Ln(D)),Rr>1&&!Ke.firstMultiple?Ke.firstMultiple=Ln(D):Rr===1&&(Ke.firstMultiple=!1);var Mn=Ke.firstInput,Ci=Ke.firstMultiple,eo=Ci?Ci.center:Mn.center,Fa=D.center=zn(Mt);D.timeStamp=dr(),D.deltaTime=D.timeStamp-Mn.timeStamp,D.angle=Mi(eo,Fa),D.distance=An(eo,Fa),Or(Ke,D),D.offsetDirection=pi(D.deltaX,D.deltaY);var Ua=bi(D.deltaTime,D.deltaX,D.deltaY);D.overallVelocityX=Ua.x,D.overallVelocityY=Ua.y,D.overallVelocity=ar(Ua.x)>ar(Ua.y)?Ua.x:Ua.y,D.scale=Ci?Na(Ci.pointers,Mt):1,D.rotation=Ci?Li(Ci.pointers,Mt):0,D.maxPointers=Ke.prevInput?D.pointers.length>Ke.prevInput.maxPointers?D.pointers.length:Ke.prevInput.maxPointers:D.pointers.length,Vr(Ke,D);var Ho=te.element;Tr(D.srcEvent.target,Ho)&&(Ho=D.srcEvent.target),D.target=Ho}function Or(te,D){var Ke=D.center,Mt=te.offsetDelta||{},Rr=te.prevDelta||{},Mn=te.prevInput||{};(D.eventType===xa||Mn.eventType===Gi)&&(Rr=te.prevDelta={x:Mn.deltaX||0,y:Mn.deltaY||0},Mt=te.offsetDelta={x:Ke.x,y:Ke.y}),D.deltaX=Rr.x+(Ke.x-Mt.x),D.deltaY=Rr.y+(Ke.y-Mt.y)}function Vr(te,D){var Ke=te.lastInterval||D,Mt=D.timeStamp-Ke.timeStamp,Rr,Mn,Ci,eo;if(D.eventType!=ia&&(Mt>gi||Ke.velocity===X)){var Fa=D.deltaX-Ke.deltaX,Ua=D.deltaY-Ke.deltaY,Ho=bi(Mt,Fa,Ua);Mn=Ho.x,Ci=Ho.y,Rr=ar(Ho.x)>ar(Ho.y)?Ho.x:Ho.y,eo=pi(Fa,Ua),te.lastInterval=D}else Rr=Ke.velocity,Mn=Ke.velocityX,Ci=Ke.velocityY,eo=Ke.direction;D.velocity=Rr,D.velocityX=Mn,D.velocityY=Ci,D.direction=eo}function Ln(te){for(var D=[],Ke=0;Ke<te.pointers.length;)D[Ke]={clientX:Et(te.pointers[Ke].clientX),clientY:Et(te.pointers[Ke].clientY)},Ke++;return{timeStamp:dr(),pointers:D,center:zn(D),deltaX:te.deltaX,deltaY:te.deltaY}}function zn(te){var D=te.length;if(D===1)return{x:Et(te[0].clientX),y:Et(te[0].clientY)};for(var Ke=0,Mt=0,Rr=0;Rr<D;)Ke+=te[Rr].clientX,Mt+=te[Rr].clientY,Rr++;return{x:Et(Ke/D),y:Et(Mt/D)}}function bi(te,D,Ke){return{x:D/te||0,y:Ke/te||0}}function pi(te,D){return te===D?ba:ar(te)>=ar(D)?te<0?R:sn:D<0?Ea:Bi}function An(te,D,Ke){Ke||(Ke=pe);var Mt=D[Ke[0]]-te[Ke[0]],Rr=D[Ke[1]]-te[Ke[1]];return Math.sqrt(Mt*Mt+Rr*Rr)}function Mi(te,D,Ke){Ke||(Ke=pe);var Mt=D[Ke[0]]-te[Ke[0]],Rr=D[Ke[1]]-te[Ke[1]];return Math.atan2(Rr,Mt)*180/Math.PI}function Li(te,D){return Mi(D[1],D[0],fi)+Mi(te[1],te[0],fi)}function Na(te,D){return An(D[0],D[1],fi)/An(te[0],te[1],fi)}var fs={mousedown:xa,mousemove:qi,mouseup:Gi},Lo="mousedown",ka="mousemove mouseup";function Sa(){this.evEl=Lo,this.evWin=ka,this.pressed=!1,lo.apply(this,arguments)}Gt(Sa,lo,{handler:function(D){var Ke=fs[D.type];Ke&xa&&D.button===0&&(this.pressed=!0),Ke&qi&&D.which!==1&&(Ke=Gi),!!this.pressed&&(Ke&Gi&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[D],changedPointers:[D],pointerType:oi,srcEvent:D}))}});var W={pointerdown:xa,pointermove:qi,pointerup:Gi,pointercancel:ia,pointerout:ia},$={2:Yn,3:ai,4:oi,5:ci},re="pointerdown",he="pointermove pointerup pointercancel";!ze&&De.MSPointerEvent&&!De.PointerEvent&&(re="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Ae(){this.evEl=re,this.evWin=he,lo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Gt(Ae,lo,{handler:function(D){var Ke=this.store,Mt=!1,Rr=D.type.toLowerCase().replace("ms",""),Mn=W[Rr],Ci=$[D.pointerType]||D.pointerType,eo=Ci==Yn,Fa=Ee(Ke,D.pointerId,"pointerId");Mn&xa&&(D.button===0||eo)?Fa<0&&(Ke.push(D),Fa=Ke.length-1):Mn&(Gi|ia)&&(Mt=!0),!(Fa<0)&&(Ke[Fa]=D,this.callback(this.manager,Mn,{pointers:Ke,changedPointers:[D],pointerType:Ci,srcEvent:D}),Mt&&Ke.splice(Fa,1))}});var je={touchstart:xa,touchmove:qi,touchend:Gi,touchcancel:ia},Je="touchstart",ue="touchstart touchmove touchend touchcancel";function Oe(){this.evTarget=Je,this.evWin=ue,this.started=!1,lo.apply(this,arguments)}Gt(Oe,lo,{handler:function(D){var Ke=je[D.type];if(Ke===xa&&(this.started=!0),!!this.started){var Mt=pt.call(this,D,Ke);Ke&(Gi|ia)&&Mt[0].length-Mt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Yn,srcEvent:D})}}});function pt(te,D){var Ke=We(te.touches),Mt=We(te.changedTouches);return D&(Gi|ia)&&(Ke=Re(Ke.concat(Mt),"identifier",!0)),[Ke,Mt]}var pr={touchstart:xa,touchmove:qi,touchend:Gi,touchcancel:ia},Ot="touchstart touchmove touchend touchcancel";function Dt(){this.evTarget=Ot,this.targetIds={},lo.apply(this,arguments)}Gt(Dt,lo,{handler:function(D){var Ke=pr[D.type],Mt=mr.call(this,D,Ke);!Mt||this.callback(this.manager,Ke,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Yn,srcEvent:D})}});function mr(te,D){var Ke=We(te.touches),Mt=this.targetIds;if(D&(xa|qi)&&Ke.length===1)return Mt[Ke[0].identifier]=!0,[Ke,Ke];var Rr,Mn,Ci=We(te.changedTouches),eo=[],Fa=this.target;if(Mn=Ke.filter(function(Ua){return Tr(Ua.target,Fa)}),D===xa)for(Rr=0;Rr<Mn.length;)Mt[Mn[Rr].identifier]=!0,Rr++;for(Rr=0;Rr<Ci.length;)Mt[Ci[Rr].identifier]&&eo.push(Ci[Rr]),D&(Gi|ia)&&delete Mt[Ci[Rr].identifier],Rr++;if(!!eo.length)return[Re(Mn.concat(eo),"identifier",!0),eo]}var _n=2500,cn=25;function Ct(){lo.apply(this,arguments);var te=He(this.handler,this);this.touch=new Dt(this.manager,te),this.mouse=new Sa(this.manager,te),this.primaryTouch=null,this.lastTouches=[]}Gt(Ct,lo,{handler:function(D,Ke,Mt){var Rr=Mt.pointerType==Yn,Mn=Mt.pointerType==oi;if(!(Mn&&Mt.sourceCapabilities&&Mt.sourceCapabilities.firesTouchEvents)){if(Rr)un.call(this,Ke,Mt);else if(Mn&&Yr.call(this,Mt))return;this.callback(D,Ke,Mt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function un(te,D){te&xa?(this.primaryTouch=D.changedPointers[0].identifier,Zr.call(this,D)):te&(Gi|ia)&&Zr.call(this,D)}function Zr(te){var D=te.changedPointers[0];if(D.identifier===this.primaryTouch){var Ke={x:D.clientX,y:D.clientY};this.lastTouches.push(Ke);var Mt=this.lastTouches,Rr=function(){var Mn=Mt.indexOf(Ke);Mn>-1&&Mt.splice(Mn,1)};setTimeout(Rr,_n)}}function Yr(te){for(var D=te.srcEvent.clientX,Ke=te.srcEvent.clientY,Mt=0;Mt<this.lastTouches.length;Mt++){var Rr=this.lastTouches[Mt],Mn=Math.abs(D-Rr.x),Ci=Math.abs(Ke-Rr.y);if(Mn<=cn&&Ci<=cn)return!0}return!1}var vi=ze?X:_t(nt.style,"touchAction"),qr=vi!==X,wi="compute",oa="auto",Ei="manipulation",Ti="none",Si="pan-x",ei="pan-y",ji=Pi();function La(te,D){this.manager=te,this.set(D)}La.prototype={set:function(te){te==wi&&(te=this.compute()),qr&&this.manager.element.style&&ji[te]&&(this.manager.element.style[vi]=te),this.actions=te.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var te=[];return Ut(this.manager.recognizers,function(D){$e(D.options.enable,[D])&&(te=te.concat(D.getTouchAction()))}),Hi(te.join(" "))},preventDefaults:function(te){var D=te.srcEvent,Ke=te.offsetDirection;if(this.manager.session.prevented){D.preventDefault();return}var Mt=this.actions,Rr=Br(Mt,Ti)&&!ji[Ti],Mn=Br(Mt,ei)&&!ji[ei],Ci=Br(Mt,Si)&&!ji[Si];if(Rr){var eo=te.pointers.length===1,Fa=te.distance<2,Ua=te.deltaTime<250;if(eo&&Fa&&Ua)return}if(!(Ci&&Mn)&&(Rr||Mn&&Ke&aa||Ci&&Ke&Qi))return this.preventSrc(D)},preventSrc:function(te){this.manager.session.prevented=!0,te.preventDefault()}};function Hi(te){if(Br(te,Ti))return Ti;var D=Br(te,Si),Ke=Br(te,ei);return D&&Ke?Ti:D||Ke?D?Si:ei:Br(te,Ei)?Ei:oa}function Pi(){if(!qr)return!1;var te={};if(ze)return te;var D=De.CSS&&De.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){te[Ke]=D?De.CSS.supports("touch-action",Ke):!0}),te}var Ni=1,Da=2,Js=4,za=8,Ca=za,Ps=16,Vo=32;function Ji(te){this.options=St({},this.defaults,te||{}),this.id=Lt(),this.manager=null,this.options.enable=bt(this.options.enable,!0),this.state=Ni,this.simultaneous={},this.requireFail=[]}Ji.prototype={defaults:{},set:function(te){return St(this.options,te),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(te){if(nr(te,"recognizeWith",this))return this;var D=this.simultaneous;return te=Ga(te,this),D[te.id]||(D[te.id]=te,te.recognizeWith(this)),this},dropRecognizeWith:function(te){return nr(te,"dropRecognizeWith",this)?this:(te=Ga(te,this),delete this.simultaneous[te.id],this)},requireFailure:function(te){if(nr(te,"requireFailure",this))return this;var D=this.requireFail;return te=Ga(te,this),Ee(D,te)===-1&&(D.push(te),te.requireFailure(this)),this},dropRequireFailure:function(te){if(nr(te,"dropRequireFailure",this))return this;te=Ga(te,this);var D=Ee(this.requireFail,te);return D>-1&&this.requireFail.splice(D,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(te){return!!this.simultaneous[te.id]},emit:function(te){var D=this,Ke=this.state;function Mt(Rr){D.manager.emit(Rr,te)}Ke<za&&Mt(D.options.event+Pu(Ke)),Mt(D.options.event),te.additionalEvent&&Mt(te.additionalEvent),Ke>=za&&Mt(D.options.event+Pu(Ke))},tryEmit:function(te){if(this.canEmit())return this.emit(te);this.state=Vo},canEmit:function(){for(var te=0;te<this.requireFail.length;){if(!(this.requireFail[te].state&(Vo|Ni)))return!1;te++}return!0},recognize:function(te){var D=St({},te);if(!$e(this.options.enable,[this,D])){this.reset(),this.state=Vo;return}this.state&(Ca|Ps|Vo)&&(this.state=Ni),this.state=this.process(D),this.state&(Da|Js|za|Ps)&&this.tryEmit(D)},process:function(te){},getTouchAction:function(){},reset:function(){}};function Pu(te){return te&Ps?"cancel":te&za?"end":te&Js?"move":te&Da?"start":""}function co(te){return te==Bi?"down":te==Ea?"up":te==R?"left":te==sn?"right":""}function Ga(te,D){var Ke=D.manager;return Ke?Ke.get(te):te}function $n(){Ji.apply(this,arguments)}Gt($n,Ji,{defaults:{pointers:1},attrTest:function(te){var D=this.options.pointers;return D===0||te.pointers.length===D},process:function(te){var D=this.state,Ke=te.eventType,Mt=D&(Da|Js),Rr=this.attrTest(te);return Mt&&(Ke&ia||!Rr)?D|Ps:Mt||Rr?Ke&Gi?D|za:D&Da?D|Js:Da:Vo}});function Wi(){$n.apply(this,arguments),this.pX=null,this.pY=null}Gt(Wi,$n,{defaults:{event:"pan",threshold:10,pointers:1,direction:cs},getTouchAction:function(){var te=this.options.direction,D=[];return te&aa&&D.push(ei),te&Qi&&D.push(Si),D},directionTest:function(te){var D=this.options,Ke=!0,Mt=te.distance,Rr=te.direction,Mn=te.deltaX,Ci=te.deltaY;return Rr&D.direction||(D.direction&aa?(Rr=Mn===0?ba:Mn<0?R:sn,Ke=Mn!=this.pX,Mt=Math.abs(te.deltaX)):(Rr=Ci===0?ba:Ci<0?Ea:Bi,Ke=Ci!=this.pY,Mt=Math.abs(te.deltaY))),te.direction=Rr,Ke&&Mt>D.threshold&&Rr&D.direction},attrTest:function(te){return $n.prototype.attrTest.call(this,te)&&(this.state&Da||!(this.state&Da)&&this.directionTest(te))},emit:function(te){this.pX=te.deltaX,this.pY=te.deltaY;var D=co(te.direction);D&&(te.additionalEvent=this.options.event+D),this._super.emit.call(this,te)}});function bo(){$n.apply(this,arguments)}Gt(bo,$n,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.scale-1)>this.options.threshold||this.state&Da)},emit:function(te){if(te.scale!==1){var D=te.scale<1?"in":"out";te.additionalEvent=this.options.event+D}this._super.emit.call(this,te)}});function Go(){Ji.apply(this,arguments),this._timer=null,this._input=null}Gt(Go,Ji,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[oa]},process:function(te){var D=this.options,Ke=te.pointers.length===D.pointers,Mt=te.distance<D.threshold,Rr=te.deltaTime>D.time;if(this._input=te,!Mt||!Ke||te.eventType&(Gi|ia)&&!Rr)this.reset();else if(te.eventType&xa)this.reset(),this._timer=kt(function(){this.state=Ca,this.tryEmit()},D.time,this);else if(te.eventType&Gi)return Ca;return Vo},reset:function(){clearTimeout(this._timer)},emit:function(te){this.state===Ca&&(te&&te.eventType&Gi?this.manager.emit(this.options.event+"up",te):(this._input.timeStamp=dr(),this.manager.emit(this.options.event,this._input)))}});function vu(){$n.apply(this,arguments)}Gt(vu,$n,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(te){return this._super.attrTest.call(this,te)&&(Math.abs(te.rotation)>this.options.threshold||this.state&Da)}});function Vt(){$n.apply(this,arguments)}Gt(Vt,$n,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:aa|Qi,pointers:1},getTouchAction:function(){return Wi.prototype.getTouchAction.call(this)},attrTest:function(te){var D=this.options.direction,Ke;return D&(aa|Qi)?Ke=te.overallVelocity:D&aa?Ke=te.overallVelocityX:D&Qi&&(Ke=te.overallVelocityY),this._super.attrTest.call(this,te)&&D&te.offsetDirection&&te.distance>this.options.threshold&&te.maxPointers==this.options.pointers&&ar(Ke)>this.options.velocity&&te.eventType&Gi},emit:function(te){var D=co(te.offsetDirection);D&&this.manager.emit(this.options.event+D,te),this.manager.emit(this.options.event,te)}});function Wt(){Ji.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Gt(Wt,Ji,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ei]},process:function(te){var D=this.options,Ke=te.pointers.length===D.pointers,Mt=te.distance<D.threshold,Rr=te.deltaTime<D.time;if(this.reset(),te.eventType&xa&&this.count===0)return this.failTimeout();if(Mt&&Rr&&Ke){if(te.eventType!=Gi)return this.failTimeout();var Mn=this.pTime?te.timeStamp-this.pTime<D.interval:!0,Ci=!this.pCenter||An(this.pCenter,te.center)<D.posThreshold;this.pTime=te.timeStamp,this.pCenter=te.center,!Ci||!Mn?this.count=1:this.count+=1,this._input=te;var eo=this.count%D.taps;if(eo===0)return this.hasRequireFailures()?(this._timer=kt(function(){this.state=Ca,this.tryEmit()},D.interval,this),Da):Ca}return Vo},failTimeout:function(){return this._timer=kt(function(){this.state=Vo},this.options.interval,this),Vo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ca&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function fa(te,D){return D=D||{},D.recognizers=bt(D.recognizers,fa.defaults.preset),new ao(te,D)}fa.VERSION="2.0.7",fa.defaults={domEvents:!1,touchAction:wi,enable:!0,inputTarget:null,inputClass:null,preset:[[vu,{enable:!1}],[bo,{enable:!1},["rotate"]],[Vt,{direction:aa}],[Wi,{direction:aa},["swipe"]],[Wt],[Wt,{event:"doubletap",taps:2},["tap"]],[Go]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var pa=1,ns=2;function ao(te,D){this.options=St({},fa.defaults,D||{}),this.options.inputTarget=this.options.inputTarget||te,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=te,this.input=Va(this),this.touchAction=new La(this,this.options.touchAction),ln(this,!0),Ut(this.options.recognizers,function(Ke){var Mt=this.add(new Ke[0](Ke[1]));Ke[2]&&Mt.recognizeWith(Ke[2]),Ke[3]&&Mt.requireFailure(Ke[3])},this)}ao.prototype={set:function(te){return St(this.options,te),te.touchAction&&this.touchAction.update(),te.inputTarget&&(this.input.destroy(),this.input.target=te.inputTarget,this.input.init()),this},stop:function(te){this.session.stopped=te?ns:pa},recognize:function(te){var D=this.session;if(!D.stopped){this.touchAction.preventDefaults(te);var Ke,Mt=this.recognizers,Rr=D.curRecognizer;(!Rr||Rr&&Rr.state&Ca)&&(Rr=D.curRecognizer=null);for(var Mn=0;Mn<Mt.length;)Ke=Mt[Mn],D.stopped!==ns&&(!Rr||Ke==Rr||Ke.canRecognizeWith(Rr))?Ke.recognize(te):Ke.reset(),!Rr&&Ke.state&(Da|Js|za)&&(Rr=D.curRecognizer=Ke),Mn++}},get:function(te){if(te instanceof Ji)return te;for(var D=this.recognizers,Ke=0;Ke<D.length;Ke++)if(D[Ke].options.event==te)return D[Ke];return null},add:function(te){if(nr(te,"add",this))return this;var D=this.get(te.options.event);return D&&this.remove(D),this.recognizers.push(te),te.manager=this,this.touchAction.update(),te},remove:function(te){if(nr(te,"remove",this))return this;if(te=this.get(te),te){var D=this.recognizers,Ke=Ee(D,te);Ke!==-1&&(D.splice(Ke,1),this.touchAction.update())}return this},on:function(te,D){if(te!==X&&D!==X){var Ke=this.handlers;return Ut(rn(te),function(Mt){Ke[Mt]=Ke[Mt]||[],Ke[Mt].push(D)}),this}},off:function(te,D){if(te!==X){var Ke=this.handlers;return Ut(rn(te),function(Mt){D?Ke[Mt]&&Ke[Mt].splice(Ee(Ke[Mt],D),1):delete Ke[Mt]}),this}},emit:function(te,D){this.options.domEvents&&Sn(te,D);var Ke=this.handlers[te]&&this.handlers[te].slice();if(!(!Ke||!Ke.length)){D.type=te,D.preventDefault=function(){D.srcEvent.preventDefault()};for(var Mt=0;Mt<Ke.length;)Ke[Mt](D),Mt++}},destroy:function(){this.element&&ln(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ln(te,D){var Ke=te.element;if(!!Ke.style){var Mt;Ut(te.options.cssProps,function(Rr,Mn){Mt=_t(Ke.style,Mn),D?(te.oldCssProps[Mt]=Ke.style[Mt],Ke.style[Mt]=Rr):Ke.style[Mt]=te.oldCssProps[Mt]||""}),D||(te.oldCssProps={})}}function Sn(te,D){if(!ze){var Ke=m.createEvent("Event");Ke.initEvent(te,!0,!0),Ke.gesture=D,D.target.dispatchEvent(Ke)}}if(!ze){St(fa,{INPUT_START:xa,INPUT_MOVE:qi,INPUT_END:Gi,INPUT_CANCEL:ia,STATE_POSSIBLE:Ni,STATE_BEGAN:Da,STATE_CHANGED:Js,STATE_ENDED:za,STATE_RECOGNIZED:Ca,STATE_CANCELLED:Ps,STATE_FAILED:Vo,DIRECTION_NONE:ba,DIRECTION_LEFT:R,DIRECTION_RIGHT:sn,DIRECTION_UP:Ea,DIRECTION_DOWN:Bi,DIRECTION_HORIZONTAL:aa,DIRECTION_VERTICAL:Qi,DIRECTION_ALL:cs,Manager:ao,Input:lo,TouchAction:La,TouchInput:Dt,MouseInput:Sa,PointerEventInput:Ae,TouchMouseInput:Ct,SingleTouchInput:Oe,Recognizer:Ji,AttrRecognizer:$n,Tap:Wt,Pan:Wi,Swipe:Vt,Pinch:bo,Rotate:vu,Press:Go,on:et,off:qt,each:Ut,merge:q,extend:or,assign:St,inherit:Gt,bindFn:He,prefixed:_t});var Tt=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Tt.Hammer=fa,Pe=function(){return fa}.call(oe,Q,oe,Cr),Pe!==X&&(Cr.exports=Pe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Cr,oe,Q){(function(Pe,De){Cr.exports=De(Q(18857))})(this,function(Pe){"use strict";var De=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},m=function(N,fe){for(var Le=Object.keys(fe),It=0;It<Le.length;++It)N[Le[It]]=fe[Le[It]];return N},Ie=`
`;function X(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function de(N){var fe=new Error("(regl) "+N);throw console.error(fe),fe}function ce(N,fe){N||de(fe)}function ze(N){return N?": "+N:""}function ge(N,fe,Le){N in fe||de("unknown parameter ("+N+")"+ze(Le)+". possible values: "+Object.keys(fe).join())}function nt(N,fe){De(N)||de("invalid parameter type"+ze(fe)+". must be a typed array")}function ct(N,fe){switch(fe){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function Et(N,fe,Le){ct(N,fe)||de("invalid parameter type"+ze(Le)+". expected "+fe+", got "+typeof N)}function ar(N,fe){N>=0&&(N|0)===N||de("invalid parameter type, ("+N+")"+ze(fe)+". must be a nonnegative integer")}function dr(N,fe,Le){fe.indexOf(N)<0&&de("invalid value"+ze(Le)+". must be one of: "+fe)}var kt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function nr(N){Object.keys(N).forEach(function(fe){kt.indexOf(fe)<0&&de('invalid regl constructor argument "'+fe+'". must be one of '+kt)})}function Ut(N,fe){for(N=N+"";N.length<fe;)N=" "+N;return N}function ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function St(N,fe){this.number=N,this.line=fe,this.errors=[]}function or(N,fe,Le){this.file=N,this.line=fe,this.message=Le}function q(){var N=new Error,fe=(N.stack||N).toString(),Le=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(fe);if(Le)return Le[1];var It=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(fe);return It?It[1]:"unknown"}function Gt(){var N=new Error,fe=(N.stack||N).toString(),Le=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(fe);if(Le)return Le[1];var It=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(fe);return It?It[1]:"unknown"}function He(N,fe){var Le=N.split(`
`),It=1,rr=0,Pt={unknown:new ht,0:new ht};Pt.unknown.name=Pt[0].name=fe||q(),Pt.unknown.lines.push(new St(0,""));for(var Kt=0;Kt<Le.length;++Kt){var cr=Le[Kt],gr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(cr);if(gr)switch(gr[1]){case"line":var hr=/(\d+)(\s+\d+)?/.exec(gr[2]);hr&&(It=hr[1]|0,hr[2]&&(rr=hr[2]|0,rr in Pt||(Pt[rr]=new ht)));break;case"define":var Er=/SHADER_NAME(_B64)?\s+(.*)$/.exec(gr[2]);Er&&(Pt[rr].name=Er[1]?X(Er[2]):Er[2]);break}Pt[rr].lines.push(new St(It++,cr))}return Object.keys(Pt).forEach(function(Ar){var jr=Pt[Ar];jr.lines.forEach(function(yr){jr.index[yr.number]=yr})}),Pt}function $e(N){var fe=[];return N.split(`
`).forEach(function(Le){if(!(Le.length<5)){var It=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Le);It?fe.push(new or(It[1]|0,It[2]|0,It[3].trim())):Le.length>0&&fe.push(new or("unknown",0,Le))}}),fe}function bt(N,fe){fe.forEach(function(Le){var It=N[Le.file];if(It){var rr=It.index[Le.line];if(rr){rr.errors.push(Le),It.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Le)})}function et(N,fe,Le,It,rr){if(!N.getShaderParameter(fe,N.COMPILE_STATUS)){var Pt=N.getShaderInfoLog(fe),Kt=It===N.FRAGMENT_SHADER?"fragment":"vertex";Re(Le,"string",Kt+" shader source must be a string",rr);var cr=He(Le,rr),gr=$e(Pt);bt(cr,gr),Object.keys(cr).forEach(function(hr){var Er=cr[hr];if(!Er.hasErrors)return;var Ar=[""],jr=[""];function yr(wr,it){Ar.push(wr),jr.push(it||"")}yr("file number "+hr+": "+Er.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Er.lines.forEach(function(wr){if(wr.errors.length>0){yr(Ut(wr.number,4)+"|  ","background-color:yellow; font-weight:bold"),yr(wr.line+Ie,"color:red; background-color:yellow; font-weight:bold");var it=0;wr.errors.forEach(function(zt){var xr=zt.message,zr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(xr);if(zr){var lr=zr[1];switch(xr=zr[2],lr){case"assign":lr="=";break}it=Math.max(wr.line.indexOf(lr,it),0)}else it=0;yr(Ut("| ",6)),yr(Ut("^^^",it+3)+Ie,"font-weight:bold"),yr(Ut("| ",6)),yr(xr+Ie,"font-weight:bold")}),yr(Ut("| ",6)+Ie)}else yr(Ut(wr.number,4)+"|  "),yr(wr.line+Ie,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=Ar.join("%c"),console.log.apply(console,jr)):console.log(Ar.join(""))}),ce.raise("Error compiling "+Kt+" shader, "+cr[0].name)}}function qt(N,fe,Le,It,rr){if(!N.getProgramParameter(fe,N.LINK_STATUS)){var Pt=N.getProgramInfoLog(fe),Kt=He(Le,rr),cr=He(It,rr),gr='Error linking program with vertex shader, "'+cr[0].name+'", and fragment shader "'+Kt[0].name+'"';typeof document!="undefined"?console.log("%c"+gr+Ie+"%c"+Pt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(gr+Ie+Pt),ce.raise(gr)}}function Tr(N){N._commandRef=q()}function Br(N,fe,Le,It){Tr(N);function rr(gr){return gr?It.id(gr):0}N._fragId=rr(N.static.frag),N._vertId=rr(N.static.vert);function Pt(gr,hr){Object.keys(hr).forEach(function(Er){gr[It.id(Er)]=!0})}var Kt=N._uniformSet={};Pt(Kt,fe.static),Pt(Kt,fe.dynamic);var cr=N._attributeSet={};Pt(cr,Le.static),Pt(cr,Le.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function rn(N,fe){var Le=Gt();de(N+" in command "+(fe||q())+(Le==="unknown"?"":" called from "+Le))}function Ee(N,fe,Le){N||rn(fe,Le||q())}function We(N,fe,Le,It){N in fe||rn("unknown parameter ("+N+")"+ze(Le)+". possible values: "+Object.keys(fe).join(),It||q())}function Re(N,fe,Le,It){ct(N,fe)||rn("invalid parameter type"+ze(Le)+". expected "+fe+", got "+typeof N,It||q())}function _t(N){N()}function ft(N,fe,Le){N.texture?dr(N.texture._texture.internalformat,fe,"unsupported texture format for attachment"):dr(N.renderbuffer._renderbuffer.format,Le,"unsupported renderbuffer format for attachment")}var Lt=33071,Ht=9728,Mr=9984,Kn=9985,Wr=9986,na=9987,Yn=5120,ai=5121,oi=5122,ci=5123,gi=5124,xa=5125,qi=5126,Gi=32819,ia=32820,ba=33635,R=34042,sn=36193,Ea={};Ea[Yn]=Ea[ai]=1,Ea[oi]=Ea[ci]=Ea[sn]=Ea[ba]=Ea[Gi]=Ea[ia]=2,Ea[gi]=Ea[xa]=Ea[qi]=Ea[R]=4;function Bi(N,fe){return N===ia||N===Gi||N===ba?2:N===R?4:Ea[N]*fe}function aa(N){return!(N&N-1)&&!!N}function Qi(N,fe,Le){var It,rr=fe.width,Pt=fe.height,Kt=fe.channels;ce(rr>0&&rr<=Le.maxTextureSize&&Pt>0&&Pt<=Le.maxTextureSize,"invalid texture shape"),(N.wrapS!==Lt||N.wrapT!==Lt)&&ce(aa(rr)&&aa(Pt),"incompatible wrap mode for texture, both width and height must be power of 2"),fe.mipmask===1?rr!==1&&Pt!==1&&ce(N.minFilter!==Mr&&N.minFilter!==Wr&&N.minFilter!==Kn&&N.minFilter!==na,"min filter requires mipmap"):(ce(aa(rr)&&aa(Pt),"texture must be a square power of 2 to support mipmapping"),ce(fe.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),fe.type===qi&&(Le.extensions.indexOf("oes_texture_float_linear")<0&&ce(N.minFilter===Ht&&N.magFilter===Ht,"filter not supported, must enable oes_texture_float_linear"),ce(!N.genMipmaps,"mipmap generation not supported with float textures"));var cr=fe.images;for(It=0;It<16;++It)if(cr[It]){var gr=rr>>It,hr=Pt>>It;ce(fe.mipmask&1<<It,"missing mipmap data");var Er=cr[It];if(ce(Er.width===gr&&Er.height===hr,"invalid shape for mip images"),ce(Er.format===fe.format&&Er.internalformat===fe.internalformat&&Er.type===fe.type,"incompatible type for mip image"),!Er.compressed)if(Er.data){var Ar=Math.ceil(Bi(Er.type,Kt)*gr/Er.unpackAlignment)*Er.unpackAlignment;ce(Er.data.byteLength===Ar*hr,"invalid data for image, buffer size is inconsistent with image format")}else Er.element||Er.copy}else N.genMipmaps||ce((fe.mipmask&1<<It)==0,"extra mipmap data");fe.compressed&&ce(!N.genMipmaps,"mipmap generation for compressed images not supported")}function cs(N,fe,Le,It){var rr=N.width,Pt=N.height,Kt=N.channels;ce(rr>0&&rr<=It.maxTextureSize&&Pt>0&&Pt<=It.maxTextureSize,"invalid texture shape"),ce(rr===Pt,"cube map must be square"),ce(fe.wrapS===Lt&&fe.wrapT===Lt,"wrap mode not supported by cube map");for(var cr=0;cr<Le.length;++cr){var gr=Le[cr];ce(gr.width===rr&&gr.height===Pt,"inconsistent cube map face shape"),fe.genMipmaps&&(ce(!gr.compressed,"can not generate mipmap for compressed textures"),ce(gr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var hr=gr.images,Er=0;Er<16;++Er){var Ar=hr[Er];if(Ar){var jr=rr>>Er,yr=Pt>>Er;ce(gr.mipmask&1<<Er,"missing mipmap data"),ce(Ar.width===jr&&Ar.height===yr,"invalid shape for mip images"),ce(Ar.format===N.format&&Ar.internalformat===N.internalformat&&Ar.type===N.type,"incompatible type for mip image"),Ar.compressed||(Ar.data?ce(Ar.data.byteLength===jr*yr*Math.max(Bi(Ar.type,Kt),Ar.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ar.element||Ar.copy)}}}}var pe=m(ce,{optional:_t,raise:de,commandRaise:rn,command:Ee,parameter:ge,commandParameter:We,constructor:nr,type:Et,commandType:Re,isTypedArray:nt,nni:ar,oneOf:dr,shaderError:et,linkError:qt,callSite:Gt,saveCommandRef:Tr,saveDrawInfo:Br,framebufferFormat:ft,guessCommand:q,texture2D:Qi,textureCube:cs}),fi=0,lo=0,Va=5,Bt=6;function tr(N,fe){this.id=fi++,this.type=N,this.data=fe}function Or(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Vr(N){if(N.length===0)return[];var fe=N.charAt(0),Le=N.charAt(N.length-1);if(N.length>1&&fe===Le&&(fe==='"'||fe==="'"))return['"'+Or(N.substr(1,N.length-2))+'"'];var It=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(It)return Vr(N.substr(0,It.index)).concat(Vr(It[1])).concat(Vr(N.substr(It.index+It[0].length)));var rr=N.split(".");if(rr.length===1)return['"'+Or(N)+'"'];for(var Pt=[],Kt=0;Kt<rr.length;++Kt)Pt=Pt.concat(Vr(rr[Kt]));return Pt}function Ln(N){return"["+Vr(N).join("][")+"]"}function zn(N,fe){return new tr(N,Ln(fe+""))}function bi(N){return typeof N=="function"&&!N._reglType||N instanceof tr}function pi(N,fe){if(typeof N=="function")return new tr(lo,N);if(typeof N=="number"||typeof N=="boolean")return new tr(Va,N);if(Array.isArray(N))return new tr(Bt,N.map(function(Le,It){return pi(Le,fe+"["+It+"]")}));if(N instanceof tr)return N;pe(!1,"invalid option type in uniform "+fe)}var An={DynamicVariable:tr,define:zn,isDynamic:bi,unbox:pi,accessor:Ln},Mi={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Li=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Na=Li?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function fs(){var N={"":0},fe=[""];return{id:function(Le){var It=N[Le];return It||(It=N[Le]=fe.length,fe.push(Le),It)},str:function(Le){return fe[Le]}}}function Lo(N,fe,Le){var It=document.createElement("canvas");m(It.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(It),N===document.body&&(It.style.position="absolute",m(N.style,{margin:0,padding:0}));function rr(){var cr=window.innerWidth,gr=window.innerHeight;if(N!==document.body){var hr=It.getBoundingClientRect();cr=hr.right-hr.left,gr=hr.bottom-hr.top}It.width=Le*cr,It.height=Le*gr}var Pt;N!==document.body&&typeof ResizeObserver=="function"?(Pt=new ResizeObserver(function(){setTimeout(rr)}),Pt.observe(N)):window.addEventListener("resize",rr,!1);function Kt(){Pt?Pt.disconnect():window.removeEventListener("resize",rr),N.removeChild(It)}return rr(),{canvas:It,onDestroy:Kt}}function ka(N,fe){function Le(It){try{return N.getContext(It,fe)}catch(rr){return null}}return Le("webgl")||Le("experimental-webgl")||Le("webgl-experimental")}function Sa(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function W(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function $(N){return typeof N=="string"?N.split():(pe(Array.isArray(N),"invalid extension array"),N)}function re(N){return typeof N=="string"?(pe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function he(N){var fe=N||{},Le,It,rr,Pt,Kt={},cr=[],gr=[],hr=typeof window=="undefined"?1:window.devicePixelRatio,Er=!1,Ar=function(wr){wr&&pe.raise(wr)},jr=function(){};if(typeof fe=="string"?(pe(typeof document!="undefined","selector queries only supported in DOM environments"),Le=document.querySelector(fe),pe(Le,"invalid query string for element")):typeof fe=="object"?Sa(fe)?Le=fe:W(fe)?(Pt=fe,rr=Pt.canvas):(pe.constructor(fe),"gl"in fe?Pt=fe.gl:"canvas"in fe?rr=re(fe.canvas):"container"in fe&&(It=re(fe.container)),"attributes"in fe&&(Kt=fe.attributes,pe.type(Kt,"object","invalid context attributes")),"extensions"in fe&&(cr=$(fe.extensions)),"optionalExtensions"in fe&&(gr=$(fe.optionalExtensions)),"onDone"in fe&&(pe.type(fe.onDone,"function","invalid or missing onDone callback"),Ar=fe.onDone),"profile"in fe&&(Er=!!fe.profile),"pixelRatio"in fe&&(hr=+fe.pixelRatio,pe(hr>0,"invalid pixel ratio"))):pe.raise("invalid arguments to regl"),Le&&(Le.nodeName.toLowerCase()==="canvas"?rr=Le:It=Le),!Pt){if(!rr){pe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var yr=Lo(It||document.body,Ar,hr);if(!yr)return null;rr=yr.canvas,jr=yr.onDestroy}Kt.premultipliedAlpha===void 0&&(Kt.premultipliedAlpha=!0),Pt=ka(rr,Kt)}return Pt?{gl:Pt,canvas:rr,container:It,extensions:cr,optionalExtensions:gr,pixelRatio:hr,profile:Er,onDone:Ar,onDestroy:jr}:(jr(),Ar("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ae(N,fe){var Le={};function It(cr){pe.type(cr,"string","extension name must be string");var gr=cr.toLowerCase(),hr;try{hr=Le[gr]=rr(cr)}catch(Er){}return!!hr}function rr(cr){return N.getExtension(cr)?N.getExtension(cr):N.getExtension(cr.toLowerCase())?N.getExtension(cr.toLowerCase()):null}for(var Pt=0;Pt<fe.extensions.length;++Pt){var Kt=fe.extensions[Pt];if(!It(Kt))return fe.onDestroy(),fe.onDone('"'+Kt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return fe.optionalExtensions.forEach(It),{extensions:Le,restore:function(){Object.keys(Le).forEach(function(cr){if(Le[cr]&&!It(cr))throw new Error("(regl): error restoring extension "+cr)})}}}function je(N,fe){for(var Le=Array(N),It=0;It<N;++It)Le[It]=fe(It);return Le}var Je=5120,ue=5121,Oe=5122,pt=5123,pr=5124,Ot=5125,Dt=5126;function mr(N){for(var fe=16;fe<=1<<28;fe*=16)if(N<=fe)return fe;return 0}function _n(N){var fe,Le;return fe=(N>65535)<<4,N>>>=fe,Le=(N>255)<<3,N>>>=Le,fe|=Le,Le=(N>15)<<2,N>>>=Le,fe|=Le,Le=(N>3)<<1,N>>>=Le,fe|=Le,fe|N>>1}function cn(){var N=je(8,function(){return[]});function fe(Pt){var Kt=mr(Pt),cr=N[_n(Kt)>>2];return cr.length>0?cr.pop():new ArrayBuffer(Kt)}function Le(Pt){N[_n(Pt.byteLength)>>2].push(Pt)}function It(Pt,Kt){var cr=null;switch(Pt){case Je:cr=new Int8Array(fe(Kt),0,Kt);break;case ue:cr=new Uint8Array(fe(Kt),0,Kt);break;case Oe:cr=new Int16Array(fe(2*Kt),0,Kt);break;case pt:cr=new Uint16Array(fe(2*Kt),0,Kt);break;case pr:cr=new Int32Array(fe(4*Kt),0,Kt);break;case Ot:cr=new Uint32Array(fe(4*Kt),0,Kt);break;case Dt:cr=new Float32Array(fe(4*Kt),0,Kt);break;default:return null}return cr.length!==Kt?cr.subarray(0,Kt):cr}function rr(Pt){Le(Pt.buffer)}return{alloc:fe,free:Le,allocType:It,freeType:rr}}var Ct=cn();Ct.zero=cn();var un=3408,Zr=3410,Yr=3411,vi=3412,qr=3413,wi=3414,oa=3415,Ei=33901,Ti=33902,Si=3379,ei=3386,ji=34921,La=36347,Hi=36348,Pi=35661,Ni=35660,Da=34930,Js=36349,za=34076,Ca=34024,Ps=7936,Vo=7937,Ji=7938,Pu=35724,co=34047,Ga=36063,$n=34852,Wi=3553,bo=34067,Go=34069,vu=33984,Vt=6408,Wt=5126,fa=5121,pa=36160,ns=36053,ao=36064,ln=16384,Sn=function(N,fe){var Le=1;fe.ext_texture_filter_anisotropic&&(Le=N.getParameter(co));var It=1,rr=1;fe.webgl_draw_buffers&&(It=N.getParameter($n),rr=N.getParameter(Ga));var Pt=!!fe.oes_texture_float;if(Pt){var Kt=N.createTexture();N.bindTexture(Wi,Kt),N.texImage2D(Wi,0,Vt,1,1,0,Vt,Wt,null);var cr=N.createFramebuffer();if(N.bindFramebuffer(pa,cr),N.framebufferTexture2D(pa,ao,Wi,Kt,0),N.bindTexture(Wi,null),N.checkFramebufferStatus(pa)!==ns)Pt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(ln);var gr=Ct.allocType(Wt,4);N.readPixels(0,0,1,1,Vt,Wt,gr),N.getError()?Pt=!1:(N.deleteFramebuffer(cr),N.deleteTexture(Kt),Pt=gr[0]===1),Ct.freeType(gr)}}var hr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Er=!0;if(!hr){var Ar=N.createTexture(),jr=Ct.allocType(fa,36);N.activeTexture(vu),N.bindTexture(bo,Ar),N.texImage2D(Go,0,Vt,3,3,0,Vt,fa,jr),Ct.freeType(jr),N.bindTexture(bo,null),N.deleteTexture(Ar),Er=!N.getError()}return{colorBits:[N.getParameter(Zr),N.getParameter(Yr),N.getParameter(vi),N.getParameter(qr)],depthBits:N.getParameter(wi),stencilBits:N.getParameter(oa),subpixelBits:N.getParameter(un),extensions:Object.keys(fe).filter(function(yr){return!!fe[yr]}),maxAnisotropic:Le,maxDrawbuffers:It,maxColorAttachments:rr,pointSizeDims:N.getParameter(Ei),lineWidthDims:N.getParameter(Ti),maxViewportDims:N.getParameter(ei),maxCombinedTextureUnits:N.getParameter(Pi),maxCubeMapSize:N.getParameter(za),maxRenderbufferSize:N.getParameter(Ca),maxTextureUnits:N.getParameter(Da),maxTextureSize:N.getParameter(Si),maxAttributes:N.getParameter(ji),maxVertexUniforms:N.getParameter(La),maxVertexTextureUnits:N.getParameter(Ni),maxVaryingVectors:N.getParameter(Hi),maxFragmentUniforms:N.getParameter(Js),glsl:N.getParameter(Pu),renderer:N.getParameter(Vo),vendor:N.getParameter(Ps),version:N.getParameter(Ji),readFloat:Pt,npotTextureCube:Er}};function Tt(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||De(N.data))}var te=function(N){return Object.keys(N).map(function(fe){return N[fe]})},D={shape:eo,flatten:Ci};function Ke(N,fe,Le){for(var It=0;It<fe;++It)Le[It]=N[It]}function Mt(N,fe,Le,It){for(var rr=0,Pt=0;Pt<fe;++Pt)for(var Kt=N[Pt],cr=0;cr<Le;++cr)It[rr++]=Kt[cr]}function Rr(N,fe,Le,It,rr,Pt){for(var Kt=Pt,cr=0;cr<fe;++cr)for(var gr=N[cr],hr=0;hr<Le;++hr)for(var Er=gr[hr],Ar=0;Ar<It;++Ar)rr[Kt++]=Er[Ar]}function Mn(N,fe,Le,It,rr){for(var Pt=1,Kt=Le+1;Kt<fe.length;++Kt)Pt*=fe[Kt];var cr=fe[Le];if(fe.length-Le==4){var gr=fe[Le+1],hr=fe[Le+2],Er=fe[Le+3];for(Kt=0;Kt<cr;++Kt)Rr(N[Kt],gr,hr,Er,It,rr),rr+=Pt}else for(Kt=0;Kt<cr;++Kt)Mn(N[Kt],fe,Le+1,It,rr),rr+=Pt}function Ci(N,fe,Le,It){var rr=1;if(fe.length)for(var Pt=0;Pt<fe.length;++Pt)rr*=fe[Pt];else rr=0;var Kt=It||Ct.allocType(Le,rr);switch(fe.length){case 0:break;case 1:Ke(N,fe[0],Kt);break;case 2:Mt(N,fe[0],fe[1],Kt);break;case 3:Rr(N,fe[0],fe[1],fe[2],Kt,0);break;default:Mn(N,fe,0,Kt,0)}return Kt}function eo(N){for(var fe=[],Le=N;Le.length;Le=Le[0])fe.push(Le.length);return fe}var Fa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ua=5120,Ho=5122,_s=5124,Do=5121,xs=5123,is=5125,ps=5126,Is=5126,Hs={int8:Ua,int16:Ho,int32:_s,uint8:Do,uint16:xs,uint32:is,float:ps,float32:Is},Wo=35048,da=35040,Eo={dynamic:Wo,stream:da,static:35044},Iu=D.flatten,rl=D.shape,mu=35044,ic=35040,nl=5121,il=5126,uu=[];uu[5120]=1,uu[5122]=2,uu[5124]=4,uu[5121]=1,uu[5123]=2,uu[5125]=4,uu[5126]=4;function Il(N){return Fa[Object.prototype.toString.call(N)]|0}function _(N,fe){for(var Le=0;Le<fe.length;++Le)N[Le]=fe[Le]}function T(N,fe,Le,It,rr,Pt,Kt){for(var cr=0,gr=0;gr<Le;++gr)for(var hr=0;hr<It;++hr)N[cr++]=fe[rr*gr+Pt*hr+Kt]}function B(N,fe,Le,It){var rr=0,Pt={};function Kt(it){this.id=rr++,this.buffer=N.createBuffer(),this.type=it,this.usage=mu,this.byteLength=0,this.dimension=1,this.dtype=nl,this.persistentData=null,Le.profile&&(this.stats={size:0})}Kt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},Kt.prototype.destroy=function(){jr(this)};var cr=[];function gr(it,zt){var xr=cr.pop();return xr||(xr=new Kt(it)),xr.bind(),Ar(xr,zt,ic,0,1,!1),xr}function hr(it){cr.push(it)}function Er(it,zt,xr){it.byteLength=zt.byteLength,N.bufferData(it.type,zt,xr)}function Ar(it,zt,xr,zr,lr,kr){var Qr;if(it.usage=xr,Array.isArray(zt)){if(it.dtype=zr||il,zt.length>0){var Un;if(Array.isArray(zt[0])){Qr=rl(zt);for(var Qt=1,er=1;er<Qr.length;++er)Qt*=Qr[er];it.dimension=Qt,Un=Iu(zt,Qr,it.dtype),Er(it,Un,xr),kr?it.persistentData=Un:Ct.freeType(Un)}else if(typeof zt[0]=="number"){it.dimension=lr;var xn=Ct.allocType(it.dtype,zt.length);_(xn,zt),Er(it,xn,xr),kr?it.persistentData=xn:Ct.freeType(xn)}else De(zt[0])?(it.dimension=zt[0].length,it.dtype=zr||Il(zt[0])||il,Un=Iu(zt,[zt.length,zt[0].length],it.dtype),Er(it,Un,xr),kr?it.persistentData=Un:Ct.freeType(Un)):pe.raise("invalid buffer data")}}else if(De(zt))it.dtype=zr||Il(zt),it.dimension=lr,Er(it,zt,xr),kr&&(it.persistentData=new Uint8Array(new Uint8Array(zt.buffer)));else if(Tt(zt)){Qr=zt.shape;var Xr=zt.stride,Sr=zt.offset,$r=0,Jr=0,yi=0,ri=0;Qr.length===1?($r=Qr[0],Jr=1,yi=Xr[0],ri=0):Qr.length===2?($r=Qr[0],Jr=Qr[1],yi=Xr[0],ri=Xr[1]):pe.raise("invalid shape"),it.dtype=zr||Il(zt.data)||il,it.dimension=Jr;var Gr=Ct.allocType(it.dtype,$r*Jr);T(Gr,zt.data,$r,Jr,yi,ri,Sr),Er(it,Gr,xr),kr?it.persistentData=Gr:Ct.freeType(Gr)}else zt instanceof ArrayBuffer?(it.dtype=nl,it.dimension=lr,Er(it,zt,xr),kr&&(it.persistentData=new Uint8Array(new Uint8Array(zt)))):pe.raise("invalid buffer data")}function jr(it){fe.bufferCount--,It(it);var zt=it.buffer;pe(zt,"buffer must not be deleted already"),N.deleteBuffer(zt),it.buffer=null,delete Pt[it.id]}function yr(it,zt,xr,zr){fe.bufferCount++;var lr=new Kt(zt);Pt[lr.id]=lr;function kr(Qt){var er=mu,xn=null,Xr=0,Sr=0,$r=1;return Array.isArray(Qt)||De(Qt)||Tt(Qt)||Qt instanceof ArrayBuffer?xn=Qt:typeof Qt=="number"?Xr=Qt|0:Qt&&(pe.type(Qt,"object","buffer arguments must be an object, a number or an array"),"data"in Qt&&(pe(xn===null||Array.isArray(xn)||De(xn)||Tt(xn),"invalid data for buffer"),xn=Qt.data),"usage"in Qt&&(pe.parameter(Qt.usage,Eo,"invalid buffer usage"),er=Eo[Qt.usage]),"type"in Qt&&(pe.parameter(Qt.type,Hs,"invalid buffer type"),Sr=Hs[Qt.type]),"dimension"in Qt&&(pe.type(Qt.dimension,"number","invalid dimension"),$r=Qt.dimension|0),"length"in Qt&&(pe.nni(Xr,"buffer length must be a nonnegative integer"),Xr=Qt.length|0)),lr.bind(),xn?Ar(lr,xn,er,Sr,$r,zr):(Xr&&N.bufferData(lr.type,Xr,er),lr.dtype=Sr||nl,lr.usage=er,lr.dimension=$r,lr.byteLength=Xr),Le.profile&&(lr.stats.size=lr.byteLength*uu[lr.dtype]),kr}function Qr(Qt,er){pe(er+Qt.byteLength<=lr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Qt.byteLength+" starting from offset "+er+" to a buffer of size "+lr.byteLength),N.bufferSubData(lr.type,er,Qt)}function Un(Qt,er){var xn=(er||0)|0,Xr;if(lr.bind(),De(Qt)||Qt instanceof ArrayBuffer)Qr(Qt,xn);else if(Array.isArray(Qt)){if(Qt.length>0)if(typeof Qt[0]=="number"){var Sr=Ct.allocType(lr.dtype,Qt.length);_(Sr,Qt),Qr(Sr,xn),Ct.freeType(Sr)}else if(Array.isArray(Qt[0])||De(Qt[0])){Xr=rl(Qt);var $r=Iu(Qt,Xr,lr.dtype);Qr($r,xn),Ct.freeType($r)}else pe.raise("invalid buffer data")}else if(Tt(Qt)){Xr=Qt.shape;var Jr=Qt.stride,yi=0,ri=0,Gr=0,on=0;Xr.length===1?(yi=Xr[0],ri=1,Gr=Jr[0],on=0):Xr.length===2?(yi=Xr[0],ri=Xr[1],Gr=Jr[0],on=Jr[1]):pe.raise("invalid shape");var Qn=Array.isArray(Qt.data)?lr.dtype:Il(Qt.data),li=Ct.allocType(Qn,yi*ri);T(li,Qt.data,yi,ri,Gr,on,Qt.offset),Qr(li,xn),Ct.freeType(li)}else pe.raise("invalid data for buffer subdata");return kr}return xr||kr(it),kr._reglType="buffer",kr._buffer=lr,kr.subdata=Un,Le.profile&&(kr.stats=lr.stats),kr.destroy=function(){jr(lr)},kr}function wr(){te(Pt).forEach(function(it){it.buffer=N.createBuffer(),N.bindBuffer(it.type,it.buffer),N.bufferData(it.type,it.persistentData||it.byteLength,it.usage)})}return Le.profile&&(fe.getTotalBufferSize=function(){var it=0;return Object.keys(Pt).forEach(function(zt){it+=Pt[zt].stats.size}),it}),{create:yr,createStream:gr,destroyStream:hr,clear:function(){te(Pt).forEach(jr),cr.forEach(jr)},getBuffer:function(it){return it&&it._buffer instanceof Kt?it._buffer:null},restore:wr,_initBuffer:Ar}}var I=0,K=0,ve=1,Ge=1,ut=4,lt=4,sr={points:I,point:K,lines:ve,line:Ge,triangles:ut,triangle:lt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},_r=0,Rn=1,jn=4,Nn=5120,Ki=5121,ya=5122,ea=5123,Xi=5124,hs=5125,lu=34963,Hu=35040,Qc=35044;function al(N,fe,Le,It){var rr={},Pt=0,Kt={uint8:Ki,uint16:ea};fe.oes_element_index_uint&&(Kt.uint32=hs);function cr(wr){this.id=Pt++,rr[this.id]=this,this.buffer=wr,this.primType=jn,this.vertCount=0,this.type=0}cr.prototype.bind=function(){this.buffer.bind()};var gr=[];function hr(wr){var it=gr.pop();return it||(it=new cr(Le.create(null,lu,!0,!1)._buffer)),Ar(it,wr,Hu,-1,-1,0,0),it}function Er(wr){gr.push(wr)}function Ar(wr,it,zt,xr,zr,lr,kr){wr.buffer.bind();var Qr;if(it){var Un=kr;!kr&&(!De(it)||Tt(it)&&!De(it.data))&&(Un=fe.oes_element_index_uint?hs:ea),Le._initBuffer(wr.buffer,it,zt,Un,3)}else N.bufferData(lu,lr,zt),wr.buffer.dtype=Qr||Ki,wr.buffer.usage=zt,wr.buffer.dimension=3,wr.buffer.byteLength=lr;if(Qr=kr,!kr){switch(wr.buffer.dtype){case Ki:case Nn:Qr=Ki;break;case ea:case ya:Qr=ea;break;case hs:case Xi:Qr=hs;break;default:pe.raise("unsupported type for element array")}wr.buffer.dtype=Qr}wr.type=Qr,pe(Qr!==hs||!!fe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Qt=zr;Qt<0&&(Qt=wr.buffer.byteLength,Qr===ea?Qt>>=1:Qr===hs&&(Qt>>=2)),wr.vertCount=Qt;var er=xr;if(xr<0){er=jn;var xn=wr.buffer.dimension;xn===1&&(er=_r),xn===2&&(er=Rn),xn===3&&(er=jn)}wr.primType=er}function jr(wr){It.elementsCount--,pe(wr.buffer!==null,"must not double destroy elements"),delete rr[wr.id],wr.buffer.destroy(),wr.buffer=null}function yr(wr,it){var zt=Le.create(null,lu,!0),xr=new cr(zt._buffer);It.elementsCount++;function zr(lr){if(!lr)zt(),xr.primType=jn,xr.vertCount=0,xr.type=Ki;else if(typeof lr=="number")zt(lr),xr.primType=jn,xr.vertCount=lr|0,xr.type=Ki;else{var kr=null,Qr=Qc,Un=-1,Qt=-1,er=0,xn=0;Array.isArray(lr)||De(lr)||Tt(lr)?kr=lr:(pe.type(lr,"object","invalid arguments for elements"),"data"in lr&&(kr=lr.data,pe(Array.isArray(kr)||De(kr)||Tt(kr),"invalid data for element buffer")),"usage"in lr&&(pe.parameter(lr.usage,Eo,"invalid element buffer usage"),Qr=Eo[lr.usage]),"primitive"in lr&&(pe.parameter(lr.primitive,sr,"invalid element buffer primitive"),Un=sr[lr.primitive]),"count"in lr&&(pe(typeof lr.count=="number"&&lr.count>=0,"invalid vertex count for elements"),Qt=lr.count|0),"type"in lr&&(pe.parameter(lr.type,Kt,"invalid buffer type"),xn=Kt[lr.type]),"length"in lr?er=lr.length|0:(er=Qt,xn===ea||xn===ya?er*=2:(xn===hs||xn===Xi)&&(er*=4))),Ar(xr,kr,Qr,Un,Qt,er,xn)}return zr}return zr(wr),zr._reglType="elements",zr._elements=xr,zr.subdata=function(lr,kr){return zt.subdata(lr,kr),zr},zr.destroy=function(){jr(xr)},zr}return{create:yr,createStream:hr,destroyStream:Er,getElements:function(wr){return typeof wr=="function"&&wr._elements instanceof cr?wr._elements:null},clear:function(){te(rr).forEach(jr)}}}var Cc=new Float32Array(1),Ws=new Uint32Array(Cc.buffer),Fo=5123;function Ou(N){for(var fe=Ct.allocType(Fo,N.length),Le=0;Le<N.length;++Le)if(isNaN(N[Le]))fe[Le]=65535;else if(N[Le]===Infinity)fe[Le]=31744;else if(N[Le]===-Infinity)fe[Le]=64512;else{Cc[0]=N[Le];var It=Ws[0],rr=It>>>31<<15,Pt=(It<<1>>>24)-127,Kt=It>>13&(1<<10)-1;if(Pt<-24)fe[Le]=rr;else if(Pt<-14){var cr=-14-Pt;fe[Le]=rr+(Kt+(1<<10)>>cr)}else Pt>15?fe[Le]=rr+31744:fe[Le]=rr+(Pt+15<<10)+Kt}return fe}function to(N){return Array.isArray(N)||De(N)}var Ff=function(N){return!(N&N-1)&&!!N},Bf=34467,as=3553,ds=34067,eu=34069,Os=6408,bs=6406,ol=6407,va=6409,Ol=6410,dp=32854,sl=32855,Jc=36194,vp=32819,mp=32820,ef=33635,ac=34042,Rl=6402,kl=34041,Ll=35904,ul=35906,Dl=36193,ll=33776,Rs=33777,Ac=33778,tf=33779,gp=35986,cl=35987,wc=34798,Es=35840,rf=35841,Tc=35842,yp=35843,Fl=36196,Ru=5121,nf=5123,Nf=5125,Bl=5126,_p=10242,xp=10243,zf=10497,Nl=33071,bp=33648,fl=10240,Ha=10241,oc=9728,zl=9729,ku=9984,Ii=9985,Ma=9986,ks=9987,Mc=33170,gu=4352,af=4353,Zh=4354,jh=34046,Pc=3317,Ic=37440,pl=37441,fo=37443,Oc=37444,Rc=33984,Mo=[ku,Ma,Ii,ks],vn=[0,va,Ol,ol,Os],ro={};ro[va]=ro[bs]=ro[Rl]=1,ro[kl]=ro[Ol]=2,ro[ol]=ro[Ll]=3,ro[Os]=ro[ul]=4;function Po(N){return"[object "+N+"]"}var Ul=Po("HTMLCanvasElement"),Yi=Po("OffscreenCanvas"),Ls=Po("CanvasRenderingContext2D"),Uf=Po("ImageBitmap"),Kr=Po("HTMLImageElement"),kc=Po("HTMLVideoElement"),of=Object.keys(Fa).concat([Ul,Yi,Ls,Uf,Kr,kc]),hl=[];hl[Ru]=1,hl[Bl]=4,hl[Dl]=2,hl[nf]=2,hl[Nf]=4;var mi=[];mi[dp]=2,mi[sl]=2,mi[Jc]=2,mi[kl]=4,mi[ll]=.5,mi[Rs]=.5,mi[Ac]=1,mi[tf]=1,mi[gp]=.5,mi[cl]=1,mi[wc]=1,mi[Es]=.5,mi[rf]=.25,mi[Tc]=.5,mi[yp]=.25,mi[Fl]=.5;function Bo(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function yu(N){if(!Array.isArray(N))return!1;var fe=N.length;return!(fe===0||!to(N[0]))}function Xs(N){return Object.prototype.toString.call(N)}function Ds(N){return Xs(N)===Ul}function _u(N){return Xs(N)===Yi}function sf(N){return Xs(N)===Ls}function sc(N){return Xs(N)===Uf}function Zf(N){return Xs(N)===Kr}function uf(N){return Xs(N)===kc}function tu(N){var fe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(fe&&N&&N.getContext)}function ru(N){var fe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(fe&&N&&"src"in N&&"crossOrigin"in N)}function Oi(N){if(!N)return!1;if(tu(N)||ru(N))return!0;var fe=Xs(N);return of.indexOf(fe)>=0?!0:Bo(N)||yu(N)||Tt(N)}function _a(N){return Fa[Object.prototype.toString.call(N)]|0}function nu(N,fe){var Le=fe.length;switch(N.type){case Ru:case nf:case Nf:case Bl:var It=Ct.allocType(N.type,Le);It.set(fe),N.data=It;break;case Dl:N.data=Ou(fe);break;default:pe.raise("unsupported texture type, must specify a typed array")}}function Xo(N,fe){return Ct.allocType(N.type===Dl?Bl:N.type,fe)}function dl(N,fe){N.type===Dl?(N.data=Ou(fe),Ct.freeType(fe)):N.data=fe}function xu(N,fe,Le,It,rr,Pt){for(var Kt=N.width,cr=N.height,gr=N.channels,hr=Kt*cr*gr,Er=Xo(N,hr),Ar=0,jr=0;jr<cr;++jr)for(var yr=0;yr<Kt;++yr)for(var wr=0;wr<gr;++wr)Er[Ar++]=fe[Le*yr+It*jr+rr*wr+Pt];dl(N,Er)}function Ss(N,fe,Le,It,rr,Pt){var Kt;if(typeof mi[N]!="undefined"?Kt=mi[N]:Kt=ro[N]*hl[fe],Pt&&(Kt*=6),rr){for(var cr=0,gr=Le;gr>=1;)cr+=Kt*gr*gr,gr/=2;return cr}else return Kt*Le*It}function Cs(N,fe,Le,It,rr,Pt,Kt){var cr={"don't care":gu,"dont care":gu,nice:Zh,fast:af},gr={repeat:zf,clamp:Nl,mirror:bp},hr={nearest:oc,linear:zl},Er=m({mipmap:ks,"nearest mipmap nearest":ku,"linear mipmap nearest":Ii,"nearest mipmap linear":Ma,"linear mipmap linear":ks},hr),Ar={none:0,browser:Oc},jr={uint8:Ru,rgba4:vp,rgb565:ef,"rgb5 a1":mp},yr={alpha:bs,luminance:va,"luminance alpha":Ol,rgb:ol,rgba:Os,rgba4:dp,"rgb5 a1":sl,rgb565:Jc},wr={};fe.ext_srgb&&(yr.srgb=Ll,yr.srgba=ul),fe.oes_texture_float&&(jr.float32=jr.float=Bl),fe.oes_texture_half_float&&(jr.float16=jr["half float"]=Dl),fe.webgl_depth_texture&&(m(yr,{depth:Rl,"depth stencil":kl}),m(jr,{uint16:nf,uint32:Nf,"depth stencil":ac})),fe.webgl_compressed_texture_s3tc&&m(wr,{"rgb s3tc dxt1":ll,"rgba s3tc dxt1":Rs,"rgba s3tc dxt3":Ac,"rgba s3tc dxt5":tf}),fe.webgl_compressed_texture_atc&&m(wr,{"rgb atc":gp,"rgba atc explicit alpha":cl,"rgba atc interpolated alpha":wc}),fe.webgl_compressed_texture_pvrtc&&m(wr,{"rgb pvrtc 4bppv1":Es,"rgb pvrtc 2bppv1":rf,"rgba pvrtc 4bppv1":Tc,"rgba pvrtc 2bppv1":yp}),fe.webgl_compressed_texture_etc1&&(wr["rgb etc1"]=Fl);var it=Array.prototype.slice.call(N.getParameter(Bf)||new Uint32Array(0));Object.keys(wr).forEach(function(Se){var Ft=wr[Se];it.indexOf(Ft)>=0&&(yr[Se]=Ft)});var zt=Object.keys(yr);Le.textureFormats=zt;var xr=[];Object.keys(yr).forEach(function(Se){var Ft=yr[Se];xr[Ft]=Se});var zr=[];Object.keys(jr).forEach(function(Se){var Ft=jr[Se];zr[Ft]=Se});var lr=[];Object.keys(hr).forEach(function(Se){var Ft=hr[Se];lr[Ft]=Se});var kr=[];Object.keys(Er).forEach(function(Se){var Ft=Er[Se];kr[Ft]=Se});var Qr=[];Object.keys(gr).forEach(function(Se){var Ft=gr[Se];Qr[Ft]=Se});var Un=zt.reduce(function(Se,Ft){var vt=yr[Ft];return vt===va||vt===bs||vt===va||vt===Ol||vt===Rl||vt===kl||fe.ext_srgb&&(vt===Ll||vt===ul)?Se[vt]=vt:vt===sl||Ft.indexOf("rgba")>=0?Se[vt]=Os:Se[vt]=ol,Se},{});function Qt(){this.internalformat=Os,this.format=Os,this.type=Ru,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Oc,this.width=0,this.height=0,this.channels=0}function er(Se,Ft){Se.internalformat=Ft.internalformat,Se.format=Ft.format,Se.type=Ft.type,Se.compressed=Ft.compressed,Se.premultiplyAlpha=Ft.premultiplyAlpha,Se.flipY=Ft.flipY,Se.unpackAlignment=Ft.unpackAlignment,Se.colorSpace=Ft.colorSpace,Se.width=Ft.width,Se.height=Ft.height,Se.channels=Ft.channels}function xn(Se,Ft){if(!(typeof Ft!="object"||!Ft)){if("premultiplyAlpha"in Ft&&(pe.type(Ft.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Se.premultiplyAlpha=Ft.premultiplyAlpha),"flipY"in Ft&&(pe.type(Ft.flipY,"boolean","invalid texture flip"),Se.flipY=Ft.flipY),"alignment"in Ft&&(pe.oneOf(Ft.alignment,[1,2,4,8],"invalid texture unpack alignment"),Se.unpackAlignment=Ft.alignment),"colorSpace"in Ft&&(pe.parameter(Ft.colorSpace,Ar,"invalid colorSpace"),Se.colorSpace=Ar[Ft.colorSpace]),"type"in Ft){var vt=Ft.type;pe(fe.oes_texture_float||!(vt==="float"||vt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),pe(fe.oes_texture_half_float||!(vt==="half float"||vt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),pe(fe.webgl_depth_texture||!(vt==="uint16"||vt==="uint32"||vt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),pe.parameter(vt,jr,"invalid texture type"),Se.type=jr[vt]}var hn=Se.width,Ui=Se.height,_e=Se.channels,ae=!1;"shape"in Ft?(pe(Array.isArray(Ft.shape)&&Ft.shape.length>=2,"shape must be an array"),hn=Ft.shape[0],Ui=Ft.shape[1],Ft.shape.length===3&&(_e=Ft.shape[2],pe(_e>0&&_e<=4,"invalid number of channels"),ae=!0),pe(hn>=0&&hn<=Le.maxTextureSize,"invalid width"),pe(Ui>=0&&Ui<=Le.maxTextureSize,"invalid height")):("radius"in Ft&&(hn=Ui=Ft.radius,pe(hn>=0&&hn<=Le.maxTextureSize,"invalid radius")),"width"in Ft&&(hn=Ft.width,pe(hn>=0&&hn<=Le.maxTextureSize,"invalid width")),"height"in Ft&&(Ui=Ft.height,pe(Ui>=0&&Ui<=Le.maxTextureSize,"invalid height")),"channels"in Ft&&(_e=Ft.channels,pe(_e>0&&_e<=4,"invalid number of channels"),ae=!0)),Se.width=hn|0,Se.height=Ui|0,Se.channels=_e|0;var Ze=!1;if("format"in Ft){var ot=Ft.format;pe(fe.webgl_depth_texture||!(ot==="depth"||ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),pe.parameter(ot,yr,"invalid texture format");var At=Se.internalformat=yr[ot];Se.format=Un[At],ot in jr&&("type"in Ft||(Se.type=jr[ot])),ot in wr&&(Se.compressed=!0),Ze=!0}!ae&&Ze?Se.channels=ro[Se.format]:ae&&!Ze?Se.channels!==vn[Se.format]&&(Se.format=Se.internalformat=vn[Se.channels]):Ze&&ae&&pe(Se.channels===ro[Se.format],"number of channels inconsistent with specified format")}}function Xr(Se){N.pixelStorei(Ic,Se.flipY),N.pixelStorei(pl,Se.premultiplyAlpha),N.pixelStorei(fo,Se.colorSpace),N.pixelStorei(Pc,Se.unpackAlignment)}function Sr(){Qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function $r(Se,Ft){var vt=null;if(Oi(Ft)?vt=Ft:Ft&&(pe.type(Ft,"object","invalid pixel data type"),xn(Se,Ft),"x"in Ft&&(Se.xOffset=Ft.x|0),"y"in Ft&&(Se.yOffset=Ft.y|0),Oi(Ft.data)&&(vt=Ft.data)),pe(!Se.compressed||vt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ft.copy){pe(!vt,"can not specify copy and data field for the same texture");var hn=rr.viewportWidth,Ui=rr.viewportHeight;Se.width=Se.width||hn-Se.xOffset,Se.height=Se.height||Ui-Se.yOffset,Se.needsCopy=!0,pe(Se.xOffset>=0&&Se.xOffset<hn&&Se.yOffset>=0&&Se.yOffset<Ui&&Se.width>0&&Se.width<=hn&&Se.height>0&&Se.height<=Ui,"copy texture read out of bounds")}else if(!vt)Se.width=Se.width||1,Se.height=Se.height||1,Se.channels=Se.channels||4;else if(De(vt))Se.channels=Se.channels||4,Se.data=vt,!("type"in Ft)&&Se.type===Ru&&(Se.type=_a(vt));else if(Bo(vt))Se.channels=Se.channels||4,nu(Se,vt),Se.alignment=1,Se.needsFree=!0;else if(Tt(vt)){var _e=vt.data;!Array.isArray(_e)&&Se.type===Ru&&(Se.type=_a(_e));var ae=vt.shape,Ze=vt.stride,ot,At,Ye,ke,tt,me;ae.length===3?(Ye=ae[2],me=Ze[2]):(pe(ae.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ye=1,me=1),ot=ae[0],At=ae[1],ke=Ze[0],tt=Ze[1],Se.alignment=1,Se.width=ot,Se.height=At,Se.channels=Ye,Se.format=Se.internalformat=vn[Ye],Se.needsFree=!0,xu(Se,_e,ke,tt,me,vt.offset)}else if(tu(vt)||Ds(vt)||_u(vt)||sf(vt))tu(vt)||Ds(vt)||_u(vt)?Se.element=vt:Se.element=vt.canvas,Se.width=Se.element.width,Se.height=Se.element.height,Se.channels=4;else if(sc(vt))Se.element=vt,Se.width=vt.width,Se.height=vt.height,Se.channels=4;else if(Zf(vt))Se.element=vt,Se.width=vt.naturalWidth,Se.height=vt.naturalHeight,Se.channels=4;else if(ru(vt))Se.element=vt,Se.width=vt.width,Se.height=vt.height,Se.channels=4;else if(uf(vt))Se.element=vt,Se.width=vt.videoWidth,Se.height=vt.videoHeight,Se.channels=4;else if(yu(vt)){var Ne=Se.width||vt[0].length,xe=Se.height||vt.length,st=Se.channels;to(vt[0][0])?st=st||vt[0][0].length:st=st||1;for(var mt=D.shape(vt),fr=1,Jt=0;Jt<mt.length;++Jt)fr*=mt[Jt];var $t=Xo(Se,fr);D.flatten(vt,mt,"",$t),dl(Se,$t),Se.alignment=1,Se.width=Ne,Se.height=xe,Se.channels=st,Se.format=Se.internalformat=vn[st],Se.needsFree=!0}Se.type===Bl?pe(Le.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Se.type===Dl&&pe(Le.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Jr(Se,Ft,vt){var hn=Se.element,Ui=Se.data,_e=Se.internalformat,ae=Se.format,Ze=Se.type,ot=Se.width,At=Se.height;Xr(Se),hn?N.texImage2D(Ft,vt,ae,ae,Ze,hn):Se.compressed?N.compressedTexImage2D(Ft,vt,_e,ot,At,0,Ui):Se.needsCopy?(It(),N.copyTexImage2D(Ft,vt,ae,Se.xOffset,Se.yOffset,ot,At,0)):N.texImage2D(Ft,vt,ae,ot,At,0,ae,Ze,Ui||null)}function yi(Se,Ft,vt,hn,Ui){var _e=Se.element,ae=Se.data,Ze=Se.internalformat,ot=Se.format,At=Se.type,Ye=Se.width,ke=Se.height;Xr(Se),_e?N.texSubImage2D(Ft,Ui,vt,hn,ot,At,_e):Se.compressed?N.compressedTexSubImage2D(Ft,Ui,vt,hn,Ze,Ye,ke,ae):Se.needsCopy?(It(),N.copyTexSubImage2D(Ft,Ui,vt,hn,Se.xOffset,Se.yOffset,Ye,ke)):N.texSubImage2D(Ft,Ui,vt,hn,Ye,ke,ot,At,ae)}var ri=[];function Gr(){return ri.pop()||new Sr}function on(Se){Se.needsFree&&Ct.freeType(Se.data),Sr.call(Se),ri.push(Se)}function Qn(){Qt.call(this),this.genMipmaps=!1,this.mipmapHint=gu,this.mipmask=0,this.images=Array(16)}function li(Se,Ft,vt){var hn=Se.images[0]=Gr();Se.mipmask=1,hn.width=Se.width=Ft,hn.height=Se.height=vt,hn.channels=Se.channels=4}function zi(Se,Ft){var vt=null;if(Oi(Ft))vt=Se.images[0]=Gr(),er(vt,Se),$r(vt,Ft),Se.mipmask=1;else if(xn(Se,Ft),Array.isArray(Ft.mipmap))for(var hn=Ft.mipmap,Ui=0;Ui<hn.length;++Ui)vt=Se.images[Ui]=Gr(),er(vt,Se),vt.width>>=Ui,vt.height>>=Ui,$r(vt,hn[Ui]),Se.mipmask|=1<<Ui;else vt=Se.images[0]=Gr(),er(vt,Se),$r(vt,Ft),Se.mipmask=1;er(Se,Se.images[0]),Se.compressed&&(Se.internalformat===ll||Se.internalformat===Rs||Se.internalformat===Ac||Se.internalformat===tf)&&pe(Se.width%4==0&&Se.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function io(Se,Ft){for(var vt=Se.images,hn=0;hn<vt.length;++hn){if(!vt[hn])return;Jr(vt[hn],Ft,hn)}}var so=[];function Fi(){var Se=so.pop()||new Qn;Qt.call(Se),Se.mipmask=0;for(var Ft=0;Ft<16;++Ft)Se.images[Ft]=null;return Se}function ss(Se){for(var Ft=Se.images,vt=0;vt<Ft.length;++vt)Ft[vt]&&on(Ft[vt]),Ft[vt]=null;so.push(Se)}function Xa(){this.minFilter=oc,this.magFilter=oc,this.wrapS=Nl,this.wrapT=Nl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=gu}function $o(Se,Ft){if("min"in Ft){var vt=Ft.min;pe.parameter(vt,Er),Se.minFilter=Er[vt],Mo.indexOf(Se.minFilter)>=0&&!("faces"in Ft)&&(Se.genMipmaps=!0)}if("mag"in Ft){var hn=Ft.mag;pe.parameter(hn,hr),Se.magFilter=hr[hn]}var Ui=Se.wrapS,_e=Se.wrapT;if("wrap"in Ft){var ae=Ft.wrap;typeof ae=="string"?(pe.parameter(ae,gr),Ui=_e=gr[ae]):Array.isArray(ae)&&(pe.parameter(ae[0],gr),pe.parameter(ae[1],gr),Ui=gr[ae[0]],_e=gr[ae[1]])}else{if("wrapS"in Ft){var Ze=Ft.wrapS;pe.parameter(Ze,gr),Ui=gr[Ze]}if("wrapT"in Ft){var ot=Ft.wrapT;pe.parameter(ot,gr),_e=gr[ot]}}if(Se.wrapS=Ui,Se.wrapT=_e,"anisotropic"in Ft){var At=Ft.anisotropic;pe(typeof At=="number"&&At>=1&&At<=Le.maxAnisotropic,"aniso samples must be between 1 and "),Se.anisotropic=Ft.anisotropic}if("mipmap"in Ft){var Ye=!1;switch(typeof Ft.mipmap){case"string":pe.parameter(Ft.mipmap,cr,"invalid mipmap hint"),Se.mipmapHint=cr[Ft.mipmap],Se.genMipmaps=!0,Ye=!0;break;case"boolean":Ye=Se.genMipmaps=Ft.mipmap;break;case"object":pe(Array.isArray(Ft.mipmap),"invalid mipmap type"),Se.genMipmaps=!1,Ye=!0;break;default:pe.raise("invalid mipmap type")}Ye&&!("min"in Ft)&&(Se.minFilter=ku)}}function vo(Se,Ft){N.texParameteri(Ft,Ha,Se.minFilter),N.texParameteri(Ft,fl,Se.magFilter),N.texParameteri(Ft,_p,Se.wrapS),N.texParameteri(Ft,xp,Se.wrapT),fe.ext_texture_filter_anisotropic&&N.texParameteri(Ft,jh,Se.anisotropic),Se.genMipmaps&&(N.hint(Mc,Se.mipmapHint),N.generateMipmap(Ft))}var Qo=0,Uo={},gs=Le.maxTextureUnits,Ka=Array(gs).map(function(){return null});function _i(Se){Qt.call(this),this.mipmask=0,this.internalformat=Os,this.id=Qo++,this.refCount=1,this.target=Se,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Xa,Kt.profile&&(this.stats={size:0})}function Zo(Se){N.activeTexture(Rc),N.bindTexture(Se.target,Se.texture)}function ta(){var Se=Ka[0];Se?N.bindTexture(Se.target,Se.texture):N.bindTexture(as,null)}function Jo(Se){var Ft=Se.texture;pe(Ft,"must not double destroy texture");var vt=Se.unit,hn=Se.target;vt>=0&&(N.activeTexture(Rc+vt),N.bindTexture(hn,null),Ka[vt]=null),N.deleteTexture(Ft),Se.texture=null,Se.params=null,Se.pixels=null,Se.refCount=0,delete Uo[Se.id],Pt.textureCount--}m(_i.prototype,{bind:function(){var Se=this;Se.bindCount+=1;var Ft=Se.unit;if(Ft<0){for(var vt=0;vt<gs;++vt){var hn=Ka[vt];if(hn){if(hn.bindCount>0)continue;hn.unit=-1}Ka[vt]=Se,Ft=vt;break}Ft>=gs&&pe.raise("insufficient number of texture units"),Kt.profile&&Pt.maxTextureUnits<Ft+1&&(Pt.maxTextureUnits=Ft+1),Se.unit=Ft,N.activeTexture(Rc+Ft),N.bindTexture(Se.target,Se.texture)}return Ft},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Jo(this)}});function ni(Se,Ft){var vt=new _i(as);Uo[vt.id]=vt,Pt.textureCount++;function hn(ae,Ze){var ot=vt.texInfo;Xa.call(ot);var At=Fi();return typeof ae=="number"?typeof Ze=="number"?li(At,ae|0,Ze|0):li(At,ae|0,ae|0):ae?(pe.type(ae,"object","invalid arguments to regl.texture"),$o(ot,ae),zi(At,ae)):li(At,1,1),ot.genMipmaps&&(At.mipmask=(At.width<<1)-1),vt.mipmask=At.mipmask,er(vt,At),pe.texture2D(ot,At,Le),vt.internalformat=At.internalformat,hn.width=At.width,hn.height=At.height,Zo(vt),io(At,as),vo(ot,as),ta(),ss(At),Kt.profile&&(vt.stats.size=Ss(vt.internalformat,vt.type,At.width,At.height,ot.genMipmaps,!1)),hn.format=xr[vt.internalformat],hn.type=zr[vt.type],hn.mag=lr[ot.magFilter],hn.min=kr[ot.minFilter],hn.wrapS=Qr[ot.wrapS],hn.wrapT=Qr[ot.wrapT],hn}function Ui(ae,Ze,ot,At){pe(!!ae,"must specify image data");var Ye=Ze|0,ke=ot|0,tt=At|0,me=Gr();return er(me,vt),me.width=0,me.height=0,$r(me,ae),me.width=me.width||(vt.width>>tt)-Ye,me.height=me.height||(vt.height>>tt)-ke,pe(vt.type===me.type&&vt.format===me.format&&vt.internalformat===me.internalformat,"incompatible format for texture.subimage"),pe(Ye>=0&&ke>=0&&Ye+me.width<=vt.width&&ke+me.height<=vt.height,"texture.subimage write out of bounds"),pe(vt.mipmask&1<<tt,"missing mipmap data"),pe(me.data||me.element||me.needsCopy,"missing image data"),Zo(vt),yi(me,as,Ye,ke,tt),ta(),on(me),hn}function _e(ae,Ze){var ot=ae|0,At=Ze|0||ot;if(ot===vt.width&&At===vt.height)return hn;hn.width=vt.width=ot,hn.height=vt.height=At,Zo(vt);for(var Ye=0;vt.mipmask>>Ye;++Ye){var ke=ot>>Ye,tt=At>>Ye;if(!ke||!tt)break;N.texImage2D(as,Ye,vt.format,ke,tt,0,vt.format,vt.type,null)}return ta(),Kt.profile&&(vt.stats.size=Ss(vt.internalformat,vt.type,ot,At,!1,!1)),hn}return hn(Se,Ft),hn.subimage=Ui,hn.resize=_e,hn._reglType="texture2d",hn._texture=vt,Kt.profile&&(hn.stats=vt.stats),hn.destroy=function(){vt.decRef()},hn}function Di(Se,Ft,vt,hn,Ui,_e){var ae=new _i(ds);Uo[ae.id]=ae,Pt.cubeCount++;var Ze=new Array(6);function ot(ke,tt,me,Ne,xe,st){var mt,fr=ae.texInfo;for(Xa.call(fr),mt=0;mt<6;++mt)Ze[mt]=Fi();if(typeof ke=="number"||!ke){var Jt=ke|0||1;for(mt=0;mt<6;++mt)li(Ze[mt],Jt,Jt)}else if(typeof ke=="object")if(tt)zi(Ze[0],ke),zi(Ze[1],tt),zi(Ze[2],me),zi(Ze[3],Ne),zi(Ze[4],xe),zi(Ze[5],st);else if($o(fr,ke),xn(ae,ke),"faces"in ke){var $t=ke.faces;for(pe(Array.isArray($t)&&$t.length===6,"cube faces must be a length 6 array"),mt=0;mt<6;++mt)pe(typeof $t[mt]=="object"&&!!$t[mt],"invalid input for cube map face"),er(Ze[mt],ae),zi(Ze[mt],$t[mt])}else for(mt=0;mt<6;++mt)zi(Ze[mt],ke);else pe.raise("invalid arguments to cube map");for(er(ae,Ze[0]),pe.optional(function(){Le.npotTextureCube||pe(Ff(ae.width)&&Ff(ae.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?ae.mipmask=(Ze[0].width<<1)-1:ae.mipmask=Ze[0].mipmask,pe.textureCube(ae,fr,Ze,Le),ae.internalformat=Ze[0].internalformat,ot.width=Ze[0].width,ot.height=Ze[0].height,Zo(ae),mt=0;mt<6;++mt)io(Ze[mt],eu+mt);for(vo(fr,ds),ta(),Kt.profile&&(ae.stats.size=Ss(ae.internalformat,ae.type,ot.width,ot.height,fr.genMipmaps,!0)),ot.format=xr[ae.internalformat],ot.type=zr[ae.type],ot.mag=lr[fr.magFilter],ot.min=kr[fr.minFilter],ot.wrapS=Qr[fr.wrapS],ot.wrapT=Qr[fr.wrapT],mt=0;mt<6;++mt)ss(Ze[mt]);return ot}function At(ke,tt,me,Ne,xe){pe(!!tt,"must specify image data"),pe(typeof ke=="number"&&ke===(ke|0)&&ke>=0&&ke<6,"invalid face");var st=me|0,mt=Ne|0,fr=xe|0,Jt=Gr();return er(Jt,ae),Jt.width=0,Jt.height=0,$r(Jt,tt),Jt.width=Jt.width||(ae.width>>fr)-st,Jt.height=Jt.height||(ae.height>>fr)-mt,pe(ae.type===Jt.type&&ae.format===Jt.format&&ae.internalformat===Jt.internalformat,"incompatible format for texture.subimage"),pe(st>=0&&mt>=0&&st+Jt.width<=ae.width&&mt+Jt.height<=ae.height,"texture.subimage write out of bounds"),pe(ae.mipmask&1<<fr,"missing mipmap data"),pe(Jt.data||Jt.element||Jt.needsCopy,"missing image data"),Zo(ae),yi(Jt,eu+ke,st,mt,fr),ta(),on(Jt),ot}function Ye(ke){var tt=ke|0;if(tt!==ae.width){ot.width=ae.width=tt,ot.height=ae.height=tt,Zo(ae);for(var me=0;me<6;++me)for(var Ne=0;ae.mipmask>>Ne;++Ne)N.texImage2D(eu+me,Ne,ae.format,tt>>Ne,tt>>Ne,0,ae.format,ae.type,null);return ta(),Kt.profile&&(ae.stats.size=Ss(ae.internalformat,ae.type,ot.width,ot.height,!1,!0)),ot}}return ot(Se,Ft,vt,hn,Ui,_e),ot.subimage=At,ot.resize=Ye,ot._reglType="textureCube",ot._texture=ae,Kt.profile&&(ot.stats=ae.stats),ot.destroy=function(){ae.decRef()},ot}function ua(){for(var Se=0;Se<gs;++Se)N.activeTexture(Rc+Se),N.bindTexture(as,null),Ka[Se]=null;te(Uo).forEach(Jo),Pt.cubeCount=0,Pt.textureCount=0}Kt.profile&&(Pt.getTotalTextureSize=function(){var Se=0;return Object.keys(Uo).forEach(function(Ft){Se+=Uo[Ft].stats.size}),Se});function Co(){for(var Se=0;Se<gs;++Se){var Ft=Ka[Se];Ft&&(Ft.bindCount=0,Ft.unit=-1,Ka[Se]=null)}te(Uo).forEach(function(vt){vt.texture=N.createTexture(),N.bindTexture(vt.target,vt.texture);for(var hn=0;hn<32;++hn)if((vt.mipmask&1<<hn)!=0)if(vt.target===as)N.texImage2D(as,hn,vt.internalformat,vt.width>>hn,vt.height>>hn,0,vt.internalformat,vt.type,null);else for(var Ui=0;Ui<6;++Ui)N.texImage2D(eu+Ui,hn,vt.internalformat,vt.width>>hn,vt.height>>hn,0,vt.internalformat,vt.type,null);vo(vt.texInfo,vt.target)})}function Al(){for(var Se=0;Se<gs;++Se){var Ft=Ka[Se];Ft&&(Ft.bindCount=0,Ft.unit=-1,Ka[Se]=null),N.activeTexture(Rc+Se),N.bindTexture(as,null),N.bindTexture(ds,null)}}return{create2D:ni,createCube:Di,clear:ua,getTexture:function(Se){return null},restore:Co,refresh:Al}}var cu=36161,Dn=32854,Pn=32855,lf=36194,vs=33189,bu=36168,Yo=34041,fu=35907,Zl=34836,Lc=34842,sa=34843,Za=[];Za[Dn]=2,Za[Pn]=2,Za[lf]=2,Za[vs]=2,Za[bu]=1,Za[Yo]=4,Za[fu]=4,Za[Zl]=16,Za[Lc]=8,Za[sa]=6;function cf(N,fe,Le){return Za[N]*fe*Le}var Wu=function(N,fe,Le,It,rr){var Pt={rgba4:Dn,rgb565:lf,"rgb5 a1":Pn,depth:vs,stencil:bu,"depth stencil":Yo};fe.ext_srgb&&(Pt.srgba=fu),fe.ext_color_buffer_half_float&&(Pt.rgba16f=Lc,Pt.rgb16f=sa),fe.webgl_color_buffer_float&&(Pt.rgba32f=Zl);var Kt=[];Object.keys(Pt).forEach(function(yr){var wr=Pt[yr];Kt[wr]=yr});var cr=0,gr={};function hr(yr){this.id=cr++,this.refCount=1,this.renderbuffer=yr,this.format=Dn,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}hr.prototype.decRef=function(){--this.refCount<=0&&Er(this)};function Er(yr){var wr=yr.renderbuffer;pe(wr,"must not double destroy renderbuffer"),N.bindRenderbuffer(cu,null),N.deleteRenderbuffer(wr),yr.renderbuffer=null,yr.refCount=0,delete gr[yr.id],It.renderbufferCount--}function Ar(yr,wr){var it=new hr(N.createRenderbuffer());gr[it.id]=it,It.renderbufferCount++;function zt(zr,lr){var kr=0,Qr=0,Un=Dn;if(typeof zr=="object"&&zr){var Qt=zr;if("shape"in Qt){var er=Qt.shape;pe(Array.isArray(er)&&er.length>=2,"invalid renderbuffer shape"),kr=er[0]|0,Qr=er[1]|0}else"radius"in Qt&&(kr=Qr=Qt.radius|0),"width"in Qt&&(kr=Qt.width|0),"height"in Qt&&(Qr=Qt.height|0);"format"in Qt&&(pe.parameter(Qt.format,Pt,"invalid renderbuffer format"),Un=Pt[Qt.format])}else typeof zr=="number"?(kr=zr|0,typeof lr=="number"?Qr=lr|0:Qr=kr):zr?pe.raise("invalid arguments to renderbuffer constructor"):kr=Qr=1;if(pe(kr>0&&Qr>0&&kr<=Le.maxRenderbufferSize&&Qr<=Le.maxRenderbufferSize,"invalid renderbuffer size"),!(kr===it.width&&Qr===it.height&&Un===it.format))return zt.width=it.width=kr,zt.height=it.height=Qr,it.format=Un,N.bindRenderbuffer(cu,it.renderbuffer),N.renderbufferStorage(cu,Un,kr,Qr),pe(N.getError()===0,"invalid render buffer format"),rr.profile&&(it.stats.size=cf(it.format,it.width,it.height)),zt.format=Kt[it.format],zt}function xr(zr,lr){var kr=zr|0,Qr=lr|0||kr;return kr===it.width&&Qr===it.height||(pe(kr>0&&Qr>0&&kr<=Le.maxRenderbufferSize&&Qr<=Le.maxRenderbufferSize,"invalid renderbuffer size"),zt.width=it.width=kr,zt.height=it.height=Qr,N.bindRenderbuffer(cu,it.renderbuffer),N.renderbufferStorage(cu,it.format,kr,Qr),pe(N.getError()===0,"invalid render buffer format"),rr.profile&&(it.stats.size=cf(it.format,it.width,it.height))),zt}return zt(yr,wr),zt.resize=xr,zt._reglType="renderbuffer",zt._renderbuffer=it,rr.profile&&(zt.stats=it.stats),zt.destroy=function(){it.decRef()},zt}rr.profile&&(It.getTotalRenderbufferSize=function(){var yr=0;return Object.keys(gr).forEach(function(wr){yr+=gr[wr].stats.size}),yr});function jr(){te(gr).forEach(function(yr){yr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(cu,yr.renderbuffer),N.renderbufferStorage(cu,yr.format,yr.width,yr.height)}),N.bindRenderbuffer(cu,null)}return{create:Ar,clear:function(){te(gr).forEach(Er)},restore:jr}},Lu=36160,Eu=36161,No=3553,Xu=34069,zo=36064,ff=36096,jl=36128,Dc=33306,Vl=36053,Gl=36054,Hl=36055,pf=36057,Yu=36061,vl=36193,Fc=5121,Wl=5126,iu=6407,jf=6408,Bc=6402,ml=[iu,jf],Nc=[];Nc[jf]=4,Nc[iu]=3;var l=[];l[Fc]=1,l[Wl]=4,l[vl]=2;var f=32854,c=32855,d=36194,E=33189,A=36168,M=34041,k=35907,U=34836,H=34842,ie=34843,se=[f,c,d,k,H,ie,U],le={};le[Vl]="complete",le[Gl]="incomplete attachment",le[pf]="incomplete dimensions",le[Hl]="incomplete, missing attachment",le[Yu]="unsupported";function Me(N,fe,Le,It,rr,Pt){var Kt={cur:null,next:null,dirty:!1,setFBO:null},cr=["rgba"],gr=["rgba4","rgb565","rgb5 a1"];fe.ext_srgb&&gr.push("srgba"),fe.ext_color_buffer_half_float&&gr.push("rgba16f","rgb16f"),fe.webgl_color_buffer_float&&gr.push("rgba32f");var hr=["uint8"];fe.oes_texture_half_float&&hr.push("half float","float16"),fe.oes_texture_float&&hr.push("float","float32");function Er(Sr,$r,Jr){this.target=Sr,this.texture=$r,this.renderbuffer=Jr;var yi=0,ri=0;$r?(yi=$r.width,ri=$r.height):Jr&&(yi=Jr.width,ri=Jr.height),this.width=yi,this.height=ri}function Ar(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function jr(Sr,$r,Jr){if(!!Sr)if(Sr.texture){var yi=Sr.texture._texture,ri=Math.max(1,yi.width),Gr=Math.max(1,yi.height);pe(ri===$r&&Gr===Jr,"inconsistent width/height for supplied texture"),yi.refCount+=1}else{var on=Sr.renderbuffer._renderbuffer;pe(on.width===$r&&on.height===Jr,"inconsistent width/height for renderbuffer"),on.refCount+=1}}function yr(Sr,$r){$r&&($r.texture?N.framebufferTexture2D(Lu,Sr,$r.target,$r.texture._texture.texture,0):N.framebufferRenderbuffer(Lu,Sr,Eu,$r.renderbuffer._renderbuffer.renderbuffer))}function wr(Sr){var $r=No,Jr=null,yi=null,ri=Sr;typeof Sr=="object"&&(ri=Sr.data,"target"in Sr&&($r=Sr.target|0)),pe.type(ri,"function","invalid attachment data");var Gr=ri._reglType;return Gr==="texture2d"?(Jr=ri,pe($r===No)):Gr==="textureCube"?(Jr=ri,pe($r>=Xu&&$r<Xu+6,"invalid cube map target")):Gr==="renderbuffer"?(yi=ri,$r=Eu):pe.raise("invalid regl object for attachment"),new Er($r,Jr,yi)}function it(Sr,$r,Jr,yi,ri){if(Jr){var Gr=It.create2D({width:Sr,height:$r,format:yi,type:ri});return Gr._texture.refCount=0,new Er(No,Gr,null)}else{var on=rr.create({width:Sr,height:$r,format:yi});return on._renderbuffer.refCount=0,new Er(Eu,null,on)}}function zt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function xr(Sr,$r,Jr){Sr&&(Sr.texture?Sr.texture.resize($r,Jr):Sr.renderbuffer&&Sr.renderbuffer.resize($r,Jr),Sr.width=$r,Sr.height=Jr)}var zr=0,lr={};function kr(){this.id=zr++,lr[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qr(Sr){Sr.colorAttachments.forEach(Ar),Ar(Sr.depthAttachment),Ar(Sr.stencilAttachment),Ar(Sr.depthStencilAttachment)}function Un(Sr){var $r=Sr.framebuffer;pe($r,"must not double destroy framebuffer"),N.deleteFramebuffer($r),Sr.framebuffer=null,Pt.framebufferCount--,delete lr[Sr.id]}function Qt(Sr){var $r;N.bindFramebuffer(Lu,Sr.framebuffer);var Jr=Sr.colorAttachments;for($r=0;$r<Jr.length;++$r)yr(zo+$r,Jr[$r]);for($r=Jr.length;$r<Le.maxColorAttachments;++$r)N.framebufferTexture2D(Lu,zo+$r,No,null,0);N.framebufferTexture2D(Lu,Dc,No,null,0),N.framebufferTexture2D(Lu,ff,No,null,0),N.framebufferTexture2D(Lu,jl,No,null,0),yr(ff,Sr.depthAttachment),yr(jl,Sr.stencilAttachment),yr(Dc,Sr.depthStencilAttachment);var yi=N.checkFramebufferStatus(Lu);!N.isContextLost()&&yi!==Vl&&pe.raise("framebuffer configuration not supported, status = "+le[yi]),N.bindFramebuffer(Lu,Kt.next?Kt.next.framebuffer:null),Kt.cur=Kt.next,N.getError()}function er(Sr,$r){var Jr=new kr;Pt.framebufferCount++;function yi(Gr,on){var Qn;pe(Kt.next!==Jr,"can not update framebuffer which is currently in use");var li=0,zi=0,io=!0,so=!0,Fi=null,ss=!0,Xa="rgba",$o="uint8",vo=1,Qo=null,Uo=null,gs=null,Ka=!1;if(typeof Gr=="number")li=Gr|0,zi=on|0||li;else if(!Gr)li=zi=1;else{pe.type(Gr,"object","invalid arguments for framebuffer");var _i=Gr;if("shape"in _i){var Zo=_i.shape;pe(Array.isArray(Zo)&&Zo.length>=2,"invalid shape for framebuffer"),li=Zo[0],zi=Zo[1]}else"radius"in _i&&(li=zi=_i.radius),"width"in _i&&(li=_i.width),"height"in _i&&(zi=_i.height);("color"in _i||"colors"in _i)&&(Fi=_i.color||_i.colors,Array.isArray(Fi)&&pe(Fi.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),Fi||("colorCount"in _i&&(vo=_i.colorCount|0,pe(vo>0,"invalid color buffer count")),"colorTexture"in _i&&(ss=!!_i.colorTexture,Xa="rgba4"),"colorType"in _i&&($o=_i.colorType,ss?(pe(fe.oes_texture_float||!($o==="float"||$o==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),pe(fe.oes_texture_half_float||!($o==="half float"||$o==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):$o==="half float"||$o==="float16"?(pe(fe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Xa="rgba16f"):($o==="float"||$o==="float32")&&(pe(fe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Xa="rgba32f"),pe.oneOf($o,hr,"invalid color type")),"colorFormat"in _i&&(Xa=_i.colorFormat,cr.indexOf(Xa)>=0?ss=!0:gr.indexOf(Xa)>=0?ss=!1:pe.optional(function(){ss?pe.oneOf(_i.colorFormat,cr,"invalid color format for texture"):pe.oneOf(_i.colorFormat,gr,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(Ka=!!(_i.depthTexture||_i.depthStencilTexture),pe(!Ka||fe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?io=_i.depth:(Qo=_i.depth,so=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?so=_i.stencil:(Uo=_i.stencil,io=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?io=so=_i.depthStencil:(gs=_i.depthStencil,io=!1,so=!1))}var ta=null,Jo=null,ni=null,Di=null;if(Array.isArray(Fi))ta=Fi.map(wr);else if(Fi)ta=[wr(Fi)];else for(ta=new Array(vo),Qn=0;Qn<vo;++Qn)ta[Qn]=it(li,zi,ss,Xa,$o);pe(fe.webgl_draw_buffers||ta.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),pe(ta.length<=Le.maxColorAttachments,"too many color attachments, not supported"),li=li||ta[0].width,zi=zi||ta[0].height,Qo?Jo=wr(Qo):io&&!so&&(Jo=it(li,zi,Ka,"depth","uint32")),Uo?ni=wr(Uo):so&&!io&&(ni=it(li,zi,!1,"stencil","uint8")),gs?Di=wr(gs):!Qo&&!Uo&&so&&io&&(Di=it(li,zi,Ka,"depth stencil","depth stencil")),pe(!!Qo+!!Uo+!!gs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ua=null;for(Qn=0;Qn<ta.length;++Qn)if(jr(ta[Qn],li,zi),pe(!ta[Qn]||ta[Qn].texture&&ml.indexOf(ta[Qn].texture._texture.format)>=0||ta[Qn].renderbuffer&&se.indexOf(ta[Qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Qn+" is invalid"),ta[Qn]&&ta[Qn].texture){var Co=Nc[ta[Qn].texture._texture.format]*l[ta[Qn].texture._texture.type];ua===null?ua=Co:pe(ua===Co,"all color attachments much have the same number of bits per pixel.")}return jr(Jo,li,zi),pe(!Jo||Jo.texture&&Jo.texture._texture.format===Bc||Jo.renderbuffer&&Jo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),jr(ni,li,zi),pe(!ni||ni.renderbuffer&&ni.renderbuffer._renderbuffer.format===A,"invalid stencil attachment for framebuffer object"),jr(Di,li,zi),pe(!Di||Di.texture&&Di.texture._texture.format===M||Di.renderbuffer&&Di.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),Qr(Jr),Jr.width=li,Jr.height=zi,Jr.colorAttachments=ta,Jr.depthAttachment=Jo,Jr.stencilAttachment=ni,Jr.depthStencilAttachment=Di,yi.color=ta.map(zt),yi.depth=zt(Jo),yi.stencil=zt(ni),yi.depthStencil=zt(Di),yi.width=Jr.width,yi.height=Jr.height,Qt(Jr),yi}function ri(Gr,on){pe(Kt.next!==Jr,"can not resize a framebuffer which is currently in use");var Qn=Math.max(Gr|0,1),li=Math.max(on|0||Qn,1);if(Qn===Jr.width&&li===Jr.height)return yi;for(var zi=Jr.colorAttachments,io=0;io<zi.length;++io)xr(zi[io],Qn,li);return xr(Jr.depthAttachment,Qn,li),xr(Jr.stencilAttachment,Qn,li),xr(Jr.depthStencilAttachment,Qn,li),Jr.width=yi.width=Qn,Jr.height=yi.height=li,Qt(Jr),yi}return yi(Sr,$r),m(yi,{resize:ri,_reglType:"framebuffer",_framebuffer:Jr,destroy:function(){Un(Jr),Qr(Jr)},use:function(Gr){Kt.setFBO({framebuffer:yi},Gr)}})}function xn(Sr){var $r=Array(6);function Jr(ri){var Gr;pe($r.indexOf(Kt.next)<0,"can not update framebuffer which is currently in use");var on={color:null},Qn=0,li=null,zi="rgba",io="uint8",so=1;if(typeof ri=="number")Qn=ri|0;else if(!ri)Qn=1;else{pe.type(ri,"object","invalid arguments for framebuffer");var Fi=ri;if("shape"in Fi){var ss=Fi.shape;pe(Array.isArray(ss)&&ss.length>=2,"invalid shape for framebuffer"),pe(ss[0]===ss[1],"cube framebuffer must be square"),Qn=ss[0]}else"radius"in Fi&&(Qn=Fi.radius|0),"width"in Fi?(Qn=Fi.width|0,"height"in Fi&&pe(Fi.height===Qn,"must be square")):"height"in Fi&&(Qn=Fi.height|0);("color"in Fi||"colors"in Fi)&&(li=Fi.color||Fi.colors,Array.isArray(li)&&pe(li.length===1||fe.webgl_draw_buffers,"multiple render targets not supported")),li||("colorCount"in Fi&&(so=Fi.colorCount|0,pe(so>0,"invalid color buffer count")),"colorType"in Fi&&(pe.oneOf(Fi.colorType,hr,"invalid color type"),io=Fi.colorType),"colorFormat"in Fi&&(zi=Fi.colorFormat,pe.oneOf(Fi.colorFormat,cr,"invalid color format for texture"))),"depth"in Fi&&(on.depth=Fi.depth),"stencil"in Fi&&(on.stencil=Fi.stencil),"depthStencil"in Fi&&(on.depthStencil=Fi.depthStencil)}var Xa;if(li)if(Array.isArray(li))for(Xa=[],Gr=0;Gr<li.length;++Gr)Xa[Gr]=li[Gr];else Xa=[li];else{Xa=Array(so);var $o={radius:Qn,format:zi,type:io};for(Gr=0;Gr<so;++Gr)Xa[Gr]=It.createCube($o)}for(on.color=Array(Xa.length),Gr=0;Gr<Xa.length;++Gr){var vo=Xa[Gr];pe(typeof vo=="function"&&vo._reglType==="textureCube","invalid cube map"),Qn=Qn||vo.width,pe(vo.width===Qn&&vo.height===Qn,"invalid cube map shape"),on.color[Gr]={target:Xu,data:Xa[Gr]}}for(Gr=0;Gr<6;++Gr){for(var Qo=0;Qo<Xa.length;++Qo)on.color[Qo].target=Xu+Gr;Gr>0&&(on.depth=$r[0].depth,on.stencil=$r[0].stencil,on.depthStencil=$r[0].depthStencil),$r[Gr]?$r[Gr](on):$r[Gr]=er(on)}return m(Jr,{width:Qn,height:Qn,color:Xa})}function yi(ri){var Gr,on=ri|0;if(pe(on>0&&on<=Le.maxCubeMapSize,"invalid radius for cube fbo"),on===Jr.width)return Jr;var Qn=Jr.color;for(Gr=0;Gr<Qn.length;++Gr)Qn[Gr].resize(on);for(Gr=0;Gr<6;++Gr)$r[Gr].resize(on);return Jr.width=Jr.height=on,Jr}return Jr(Sr),m(Jr,{faces:$r,resize:yi,_reglType:"framebufferCube",destroy:function(){$r.forEach(function(ri){ri.destroy()})}})}function Xr(){Kt.cur=null,Kt.next=null,Kt.dirty=!0,te(lr).forEach(function(Sr){Sr.framebuffer=N.createFramebuffer(),Qt(Sr)})}return m(Kt,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var $r=Sr._framebuffer;if($r instanceof kr)return $r}return null},create:er,createCube:xn,clear:function(){te(lr).forEach(Un)},restore:Xr})}var we=5126,Ve=34962,be=34963,Ue=["attributes","elements","offset","count","primitive","instances"];function Qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=we,this.offset=0,this.stride=0,this.divisor=0}function dt(N,fe,Le,It,rr,Pt,Kt){for(var cr=Le.maxAttributes,gr=new Array(cr),hr=0;hr<cr;++hr)gr[hr]=new Qe;var Er=0,Ar={},jr={Record:Qe,scope:{},state:gr,currentVAO:null,targetVAO:null,restore:wr()?Qr:function(){},createVAO:Un,getVAO:zt,destroyBuffer:yr,setVAO:wr()?xr:zr,clear:wr()?lr:function(){}};function yr(Qt){for(var er=0;er<gr.length;++er){var xn=gr[er];xn.buffer===Qt&&(N.disableVertexAttribArray(er),xn.buffer=null)}}function wr(){return fe.oes_vertex_array_object}function it(){return fe.angle_instanced_arrays}function zt(Qt){return typeof Qt=="function"&&Qt._vao?Qt._vao:null}function xr(Qt){if(Qt!==jr.currentVAO){var er=wr();Qt?er.bindVertexArrayOES(Qt.vao):er.bindVertexArrayOES(null),jr.currentVAO=Qt}}function zr(Qt){if(Qt!==jr.currentVAO){if(Qt)Qt.bindAttrs();else{for(var er=it(),xn=0;xn<gr.length;++xn){var Xr=gr[xn];Xr.buffer?(N.enableVertexAttribArray(xn),Xr.buffer.bind(),N.vertexAttribPointer(xn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),er&&Xr.divisor&&er.vertexAttribDivisorANGLE(xn,Xr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Xr.x,Xr.y,Xr.z,Xr.w))}Kt.elements?N.bindBuffer(be,Kt.elements.buffer.buffer):N.bindBuffer(be,null)}jr.currentVAO=Qt}}function lr(){te(Ar).forEach(function(Qt){Qt.destroy()})}function kr(){this.id=++Er,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Qt=wr();Qt?this.vao=Qt.createVertexArrayOES():this.vao=null,Ar[this.id]=this,this.buffers=[]}kr.prototype.bindAttrs=function(){for(var Qt=it(),er=this.attributes,xn=0;xn<er.length;++xn){var Xr=er[xn];Xr.buffer?(N.enableVertexAttribArray(xn),N.bindBuffer(Ve,Xr.buffer.buffer),N.vertexAttribPointer(xn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),Qt&&Xr.divisor&&Qt.vertexAttribDivisorANGLE(xn,Xr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Sr=er.length;Sr<cr;++Sr)N.disableVertexAttribArray(Sr);var $r=Pt.getElements(this.elements);$r?N.bindBuffer(be,$r.buffer.buffer):N.bindBuffer(be,null)},kr.prototype.refresh=function(){var Qt=wr();Qt&&(Qt.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,Qt.bindVertexArrayOES(null))},kr.prototype.destroy=function(){if(this.vao){var Qt=wr();this===jr.currentVAO&&(jr.currentVAO=null,Qt.bindVertexArrayOES(null)),Qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ar[this.id]&&(delete Ar[this.id],It.vaoCount-=1)};function Qr(){var Qt=wr();Qt&&te(Ar).forEach(function(er){er.refresh()})}function Un(Qt){var er=new kr;It.vaoCount+=1;function xn(Xr){var Sr;if(Array.isArray(Xr))Sr=Xr,er.elements&&er.ownsElements&&er.elements.destroy(),er.elements=null,er.ownsElements=!1,er.offset=0,er.count=0,er.instances=-1,er.primitive=4;else{if(pe(typeof Xr=="object","invalid arguments for create vao"),pe("attributes"in Xr,"must specify attributes for vao"),Xr.elements){var $r=Xr.elements;er.ownsElements?typeof $r=="function"&&$r._reglType==="elements"?(er.elements.destroy(),er.ownsElements=!1):(er.elements($r),er.ownsElements=!1):Pt.getElements(Xr.elements)?(er.elements=Xr.elements,er.ownsElements=!1):(er.elements=Pt.create(Xr.elements),er.ownsElements=!0)}else er.elements=null,er.ownsElements=!1;Sr=Xr.attributes,er.offset=0,er.count=-1,er.instances=-1,er.primitive=4,er.elements&&(er.count=er.elements._elements.vertCount,er.primitive=er.elements._elements.primType),"offset"in Xr&&(er.offset=Xr.offset|0),"count"in Xr&&(er.count=Xr.count|0),"instances"in Xr&&(er.instances=Xr.instances|0),"primitive"in Xr&&(pe(Xr.primitive in sr,"bad primitive type: "+Xr.primitive),er.primitive=sr[Xr.primitive]),pe.optional(function(){for(var io=Object.keys(Xr),so=0;so<io.length;++so)pe(Ue.indexOf(io[so])>=0,'invalid option for vao: "'+io[so]+'" valid options are '+Ue)}),pe(Array.isArray(Sr),"attributes must be an array")}pe(Sr.length<cr,"too many attributes"),pe(Sr.length>0,"must specify at least one attribute");var Jr={},yi=er.attributes;yi.length=Sr.length;for(var ri=0;ri<Sr.length;++ri){var Gr=Sr[ri],on=yi[ri]=new Qe,Qn=Gr.data||Gr;if(Array.isArray(Qn)||De(Qn)||Tt(Qn)){var li;er.buffers[ri]&&(li=er.buffers[ri],De(Qn)&&li._buffer.byteLength>=Qn.byteLength?li.subdata(Qn):(li.destroy(),er.buffers[ri]=null)),er.buffers[ri]||(li=er.buffers[ri]=rr.create(Gr,Ve,!1,!0)),on.buffer=rr.getBuffer(li),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1,Jr[ri]=1}else rr.getBuffer(Gr)?(on.buffer=rr.getBuffer(Gr),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1):rr.getBuffer(Gr.buffer)?(on.buffer=rr.getBuffer(Gr.buffer),on.size=(+Gr.size||on.buffer.dimension)|0,on.normalized=!!Gr.normalized||!1,"type"in Gr?(pe.parameter(Gr.type,Hs,"invalid buffer type"),on.type=Hs[Gr.type]):on.type=on.buffer.dtype,on.offset=(Gr.offset||0)|0,on.stride=(Gr.stride||0)|0,on.divisor=(Gr.divisor||0)|0,on.state=1,pe(on.size>=1&&on.size<=4,"size must be between 1 and 4"),pe(on.offset>=0,"invalid offset"),pe(on.stride>=0&&on.stride<=255,"stride must be between 0 and 255"),pe(on.divisor>=0,"divisor must be positive"),pe(!on.divisor||!!fe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gr?(pe(ri>0,"first attribute must not be a constant"),on.x=+Gr.x||0,on.y=+Gr.y||0,on.z=+Gr.z||0,on.w=+Gr.w||0,on.state=2):pe(!1,"invalid attribute spec for location "+ri)}for(var zi=0;zi<er.buffers.length;++zi)!Jr[zi]&&er.buffers[zi]&&(er.buffers[zi].destroy(),er.buffers[zi]=null);return er.refresh(),xn}return xn.destroy=function(){for(var Xr=0;Xr<er.buffers.length;++Xr)er.buffers[Xr]&&er.buffers[Xr].destroy();er.buffers.length=0,er.ownsElements&&(er.elements.destroy(),er.elements=null,er.ownsElements=!1),er.destroy()},xn._vao=er,xn._reglType="vao",xn(Qt)}return jr}var jt=35632,Nt=35633,Xt=35718,vr=35721;function Dr(N,fe,Le,It){var rr={},Pt={};function Kt(it,zt,xr,zr){this.name=it,this.id=zt,this.location=xr,this.info=zr}function cr(it,zt){for(var xr=0;xr<it.length;++xr)if(it[xr].id===zt.id){it[xr].location=zt.location;return}it.push(zt)}function gr(it,zt,xr){var zr=it===jt?rr:Pt,lr=zr[zt];if(!lr){var kr=fe.str(zt);lr=N.createShader(it),N.shaderSource(lr,kr),N.compileShader(lr),pe.shaderError(N,lr,kr,it,xr),zr[zt]=lr}return lr}var hr={},Er=[],Ar=0;function jr(it,zt){this.id=Ar++,this.fragId=it,this.vertId=zt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,It.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function yr(it,zt,xr){var zr,lr,kr=gr(jt,it.fragId),Qr=gr(Nt,it.vertId),Un=it.program=N.createProgram();if(N.attachShader(Un,kr),N.attachShader(Un,Qr),xr)for(zr=0;zr<xr.length;++zr){var Qt=xr[zr];N.bindAttribLocation(Un,Qt[0],Qt[1])}N.linkProgram(Un),pe.linkError(N,Un,fe.str(it.fragId),fe.str(it.vertId),zt);var er=N.getProgramParameter(Un,Xt);It.profile&&(it.stats.uniformsCount=er);var xn=it.uniforms;for(zr=0;zr<er;++zr)if(lr=N.getActiveUniform(Un,zr),lr)if(lr.size>1)for(var Xr=0;Xr<lr.size;++Xr){var Sr=lr.name.replace("[0]","["+Xr+"]");cr(xn,new Kt(Sr,fe.id(Sr),N.getUniformLocation(Un,Sr),lr))}else cr(xn,new Kt(lr.name,fe.id(lr.name),N.getUniformLocation(Un,lr.name),lr));var $r=N.getProgramParameter(Un,vr);It.profile&&(it.stats.attributesCount=$r);var Jr=it.attributes;for(zr=0;zr<$r;++zr)lr=N.getActiveAttrib(Un,zr),lr&&cr(Jr,new Kt(lr.name,fe.id(lr.name),N.getAttribLocation(Un,lr.name),lr))}It.profile&&(Le.getMaxUniformsCount=function(){var it=0;return Er.forEach(function(zt){zt.stats.uniformsCount>it&&(it=zt.stats.uniformsCount)}),it},Le.getMaxAttributesCount=function(){var it=0;return Er.forEach(function(zt){zt.stats.attributesCount>it&&(it=zt.stats.attributesCount)}),it});function wr(){rr={},Pt={};for(var it=0;it<Er.length;++it)yr(Er[it],null,Er[it].attributes.map(function(zt){return[zt.location,zt.name]}))}return{clear:function(){var it=N.deleteShader.bind(N);te(rr).forEach(it),rr={},te(Pt).forEach(it),Pt={},Er.forEach(function(zt){N.deleteProgram(zt.program)}),Er.length=0,hr={},Le.shaderCount=0},program:function(it,zt,xr,zr){pe.command(it>=0,"missing vertex shader",xr),pe.command(zt>=0,"missing fragment shader",xr);var lr=hr[zt];lr||(lr=hr[zt]={});var kr=lr[it];if(kr&&(kr.refCount++,!zr))return kr;var Qr=new jr(zt,it);return Le.shaderCount++,yr(Qr,xr,zr),kr||(lr[it]=Qr),Er.push(Qr),m(Qr,{destroy:function(){if(Qr.refCount--,Qr.refCount<=0){N.deleteProgram(Qr.program);var Un=Er.indexOf(Qr);Er.splice(Un,1),Le.shaderCount--}lr[Qr.vertId].refCount<=0&&(N.deleteShader(Pt[Qr.vertId]),delete Pt[Qr.vertId],delete hr[Qr.fragId][Qr.vertId]),Object.keys(hr[Qr.fragId]).length||(N.deleteShader(rr[Qr.fragId]),delete rr[Qr.fragId],delete hr[Qr.fragId])}})},restore:wr,shader:gr,frag:-1,vert:-1}}var Lr=6408,Ur=5121,Zn=3333,kn=5126;function Vn(N,fe,Le,It,rr,Pt,Kt){function cr(Er){var Ar;fe.next===null?(pe(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ar=Ur):(pe(fe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ar=fe.next.colorAttachments[0].texture._texture.type,pe.optional(function(){Pt.oes_texture_float?(pe(Ar===Ur||Ar===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ar===kn&&pe(Kt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):pe(Ar===Ur,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,yr=0,wr=It.framebufferWidth,it=It.framebufferHeight,zt=null;De(Er)?zt=Er:Er&&(pe.type(Er,"object","invalid arguments to regl.read()"),jr=Er.x|0,yr=Er.y|0,pe(jr>=0&&jr<It.framebufferWidth,"invalid x offset for regl.read"),pe(yr>=0&&yr<It.framebufferHeight,"invalid y offset for regl.read"),wr=(Er.width||It.framebufferWidth-jr)|0,it=(Er.height||It.framebufferHeight-yr)|0,zt=Er.data||null),zt&&(Ar===Ur?pe(zt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ar===kn&&pe(zt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),pe(wr>0&&wr+jr<=It.framebufferWidth,"invalid width for read pixels"),pe(it>0&&it+yr<=It.framebufferHeight,"invalid height for read pixels"),Le();var xr=wr*it*4;return zt||(Ar===Ur?zt=new Uint8Array(xr):Ar===kn&&(zt=zt||new Float32Array(xr))),pe.isTypedArray(zt,"data buffer for regl.read() must be a typedarray"),pe(zt.byteLength>=xr,"data buffer for regl.read() too small"),N.pixelStorei(Zn,4),N.readPixels(jr,yr,wr,it,Lr,Ar,zt),zt}function gr(Er){var Ar;return fe.setFBO({framebuffer:Er.framebuffer},function(){Ar=cr(Er)}),Ar}function hr(Er){return!Er||!("framebuffer"in Er)?cr(Er):gr(Er)}return hr}function Ai(N){return Array.prototype.slice.call(N)}function an(N){return Ai(N).join("")}function si(){var N=0,fe=[],Le=[];function It(Ar){for(var jr=0;jr<Le.length;++jr)if(Le[jr]===Ar)return fe[jr];var yr="g"+N++;return fe.push(yr),Le.push(Ar),yr}function rr(){var Ar=[];function jr(){Ar.push.apply(Ar,Ai(arguments))}var yr=[];function wr(){var it="v"+N++;return yr.push(it),arguments.length>0&&(Ar.push(it,"="),Ar.push.apply(Ar,Ai(arguments)),Ar.push(";")),it}return m(jr,{def:wr,toString:function(){return an([yr.length>0?"var "+yr.join(",")+";":"",an(Ar)])}})}function Pt(){var Ar=rr(),jr=rr(),yr=Ar.toString,wr=jr.toString;function it(zt,xr){jr(zt,xr,"=",Ar.def(zt,xr),";")}return m(function(){Ar.apply(Ar,Ai(arguments))},{def:Ar.def,entry:Ar,exit:jr,save:it,set:function(zt,xr,zr){it(zt,xr),Ar(zt,xr,"=",zr,";")},toString:function(){return yr()+wr()}})}function Kt(){var Ar=an(arguments),jr=Pt(),yr=Pt(),wr=jr.toString,it=yr.toString;return m(jr,{then:function(){return jr.apply(jr,Ai(arguments)),this},else:function(){return yr.apply(yr,Ai(arguments)),this},toString:function(){var zt=it();return zt&&(zt="else{"+zt+"}"),an(["if(",Ar,"){",wr(),"}",zt])}})}var cr=rr(),gr={};function hr(Ar,jr){var yr=[];function wr(){var lr="a"+yr.length;return yr.push(lr),lr}jr=jr||0;for(var it=0;it<jr;++it)wr();var zt=Pt(),xr=zt.toString,zr=gr[Ar]=m(zt,{arg:wr,toString:function(){return an(["function(",yr.join(),"){",xr(),"}"])}});return zr}function Er(){var Ar=['"use strict";',cr,"return {"];Object.keys(gr).forEach(function(it){Ar.push('"',it,'":',gr[it].toString(),",")}),Ar.push("}");var jr=an(Ar).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),yr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,wr=yr?Pe.Function.apply(null,fe.concat(jr)):Function.apply(null,fe.concat(jr));return wr.apply(null,Le)}return{global:cr,link:It,block:rr,proc:hr,scope:Pt,cond:Kt,compile:Er}}var hi="xyzw".split(""),ti=5121,Xn=1,Fn=2,wn=0,Gn=1,po=2,Ta=3,qo=4,Ko=5,no=6,ho="dither",As="blend.enable",Wa="blend.color",qu="blend.equation",ws="blend.func",Su="depth.enable",os="depth.func",gl="depth.range",Du="depth.mask",Cu="colorMask",yl="cull.enable",Ku="cull.face",Fs="frontFace",_l="lineWidth",pu="polygonOffset.enable",oo="polygonOffset.offset",Au="sample.alpha",$u="sample.enable",Fu="sample.coverage",Ri="stencil.enable",Bs="stencil.mask",ms="stencil.func",Qu="stencil.opFront",zc="stencil.opBack",Uc="scissor.enable",hf="scissor.box",au="viewport",xl="profile",So="framebuffer",bl="vert",Zc="frag",hu="elements",Io="primitive",uc="count",df="offset",Ep="instances",Vf="vao",nh="Width",Sp="Height",lc=So+nh,vf=So+Sp,Cp=au+nh,ih=au+Sp,Bu="drawingBuffer",mf=Bu+nh,Vh=Bu+Sp,Sd=[ws,qu,ms,Qu,zc,Fu,au,hf,oo],gf=34962,ah=34963,Gh=35632,Cd=35633,oh=3553,Gf=34067,Ad=2884,yf=3042,wd=3024,Oo=2960,Ap=2929,Hh=3089,Xl=32823,wp=32926,Hf=32928,Tp=5126,Wf=35664,Yl=35665,jc=35666,Xf=5124,Mp=35667,ql=35668,Yf=35669,qf=35670,Pp=35671,_f=35672,xf=35673,Ns=35674,Ip=35675,Nr=35676,Kf=35678,Zt=35680,Op=4,El=1028,cc=1029,sh=2304,$f=2305,Wh=32775,Xh=32776,Qf=519,wu=7680,Yh=0,Jf=1,Vc=32774,Nu=513,uh=36160,qh=36064,Sl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Gc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],fc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Cl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Kh={frag:Gh,vert:Cd},lh={cw:sh,ccw:$f};function Rp(N){return Array.isArray(N)||De(N)||Tt(N)}function ch(N){return N.sort(function(fe,Le){return fe===au?-1:Le===au?1:fe<Le?-1:1})}function ma(N,fe,Le,It){this.thisDep=N,this.contextDep=fe,this.propDep=Le,this.append=It}function pc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Ro(N){return new ma(!1,!1,!1,N)}function Ys(N,fe){var Le=N.type;if(Le===wn){var It=N.data.length;return new ma(!0,It>=1,It>=2,fe)}else if(Le===qo){var rr=N.data;return new ma(rr.thisDep,rr.contextDep,rr.propDep,fe)}else{if(Le===Ko)return new ma(!1,!1,!1,fe);if(Le===no){for(var Pt=!1,Kt=!1,cr=!1,gr=0;gr<N.data.length;++gr){var hr=N.data[gr];if(hr.type===Gn)cr=!0;else if(hr.type===po)Kt=!0;else if(hr.type===Ta)Pt=!0;else if(hr.type===wn){Pt=!0;var Er=hr.data;Er>=1&&(Kt=!0),Er>=2&&(cr=!0)}else hr.type===qo&&(Pt=Pt||hr.data.thisDep,Kt=Kt||hr.data.contextDep,cr=cr||hr.data.propDep)}return new ma(Pt,Kt,cr,fe)}else return new ma(Le===Ta,Le===po,Le===Gn,fe)}}var $h=new ma(!1,!1,!1,function(){});function fh(N,fe,Le,It,rr,Pt,Kt,cr,gr,hr,Er,Ar,jr,yr,wr){var it=hr.Record,zt={add:32774,subtract:32778,"reverse subtract":32779};Le.ext_blend_minmax&&(zt.min=Wh,zt.max=Xh);var xr=Le.angle_instanced_arrays,zr=Le.webgl_draw_buffers,lr=Le.oes_vertex_array_object,kr={dirty:!0,profile:wr.profile},Qr={},Un=[],Qt={},er={};function xn(_e){return _e.replace(".","_")}function Xr(_e,ae,Ze){var ot=xn(_e);Un.push(_e),Qr[ot]=kr[ot]=!!Ze,Qt[ot]=ae}function Sr(_e,ae,Ze){var ot=xn(_e);Un.push(_e),Array.isArray(Ze)?(kr[ot]=Ze.slice(),Qr[ot]=Ze.slice()):kr[ot]=Qr[ot]=Ze,er[ot]=ae}Xr(ho,wd),Xr(As,yf),Sr(Wa,"blendColor",[0,0,0,0]),Sr(qu,"blendEquationSeparate",[Vc,Vc]),Sr(ws,"blendFuncSeparate",[Jf,Yh,Jf,Yh]),Xr(Su,Ap,!0),Sr(os,"depthFunc",Nu),Sr(gl,"depthRange",[0,1]),Sr(Du,"depthMask",!0),Sr(Cu,Cu,[!0,!0,!0,!0]),Xr(yl,Ad),Sr(Ku,"cullFace",cc),Sr(Fs,Fs,$f),Sr(_l,_l,1),Xr(pu,Xl),Sr(oo,"polygonOffset",[0,0]),Xr(Au,wp),Xr($u,Hf),Sr(Fu,"sampleCoverage",[1,!1]),Xr(Ri,Oo),Sr(Bs,"stencilMask",-1),Sr(ms,"stencilFunc",[Qf,0,-1]),Sr(Qu,"stencilOpSeparate",[El,wu,wu,wu]),Sr(zc,"stencilOpSeparate",[cc,wu,wu,wu]),Xr(Uc,Hh),Sr(hf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Sr(au,au,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var $r={gl:N,context:jr,strings:fe,next:Qr,current:kr,draw:Ar,elements:Pt,buffer:rr,shader:Er,attributes:hr.state,vao:hr,uniforms:gr,framebuffer:cr,extensions:Le,timer:yr,isBufferArgs:Rp},Jr={primTypes:sr,compareFuncs:fc,blendFuncs:Sl,blendEquations:zt,stencilOps:Cl,glTypes:Hs,orientationType:lh};pe.optional(function(){$r.isArrayLike=to}),zr&&(Jr.backBuffer=[cc],Jr.drawBuffer=je(It.maxDrawbuffers,function(_e){return _e===0?[0]:je(_e,function(ae){return qh+ae})}));var yi=0;function ri(){var _e=si(),ae=_e.link,Ze=_e.global;_e.id=yi++,_e.batchId="0";var ot=ae($r),At=_e.shared={props:"a0"};Object.keys($r).forEach(function(Ne){At[Ne]=Ze.def(ot,".",Ne)}),pe.optional(function(){_e.CHECK=ae(pe),_e.commandStr=pe.guessCommand(),_e.command=ae(_e.commandStr),_e.assert=function(Ne,xe,st){Ne("if(!(",xe,"))",this.CHECK,".commandRaise(",ae(st),",",this.command,");")},Jr.invalidBlendCombinations=Gc});var Ye=_e.next={},ke=_e.current={};Object.keys(er).forEach(function(Ne){Array.isArray(kr[Ne])&&(Ye[Ne]=Ze.def(At.next,".",Ne),ke[Ne]=Ze.def(At.current,".",Ne))});var tt=_e.constants={};Object.keys(Jr).forEach(function(Ne){tt[Ne]=Ze.def(JSON.stringify(Jr[Ne]))}),_e.invoke=function(Ne,xe){switch(xe.type){case wn:var st=["this",At.context,At.props,_e.batchId];return Ne.def(ae(xe.data),".call(",st.slice(0,Math.max(xe.data.length+1,4)),")");case Gn:return Ne.def(At.props,xe.data);case po:return Ne.def(At.context,xe.data);case Ta:return Ne.def("this",xe.data);case qo:return xe.data.append(_e,Ne),xe.data.ref;case Ko:return xe.data.toString();case no:return xe.data.map(function(mt){return _e.invoke(Ne,mt)})}},_e.attribCache={};var me={};return _e.scopeAttrib=function(Ne){var xe=fe.id(Ne);if(xe in me)return me[xe];var st=hr.scope[xe];st||(st=hr.scope[xe]=new it);var mt=me[xe]=ae(st);return mt},_e}function Gr(_e){var ae=_e.static,Ze=_e.dynamic,ot;if(xl in ae){var At=!!ae[xl];ot=Ro(function(ke,tt){return At}),ot.enable=At}else if(xl in Ze){var Ye=Ze[xl];ot=Ys(Ye,function(ke,tt){return ke.invoke(tt,Ye)})}return ot}function on(_e,ae){var Ze=_e.static,ot=_e.dynamic;if(So in Ze){var At=Ze[So];return At?(At=cr.getFramebuffer(At),pe.command(At,"invalid framebuffer object"),Ro(function(ke,tt){var me=ke.link(At),Ne=ke.shared;tt.set(Ne.framebuffer,".next",me);var xe=Ne.context;return tt.set(xe,"."+lc,me+".width"),tt.set(xe,"."+vf,me+".height"),me})):Ro(function(ke,tt){var me=ke.shared;tt.set(me.framebuffer,".next","null");var Ne=me.context;return tt.set(Ne,"."+lc,Ne+"."+mf),tt.set(Ne,"."+vf,Ne+"."+Vh),"null"})}else if(So in ot){var Ye=ot[So];return Ys(Ye,function(ke,tt){var me=ke.invoke(tt,Ye),Ne=ke.shared,xe=Ne.framebuffer,st=tt.def(xe,".getFramebuffer(",me,")");pe.optional(function(){ke.assert(tt,"!"+me+"||"+st,"invalid framebuffer object")}),tt.set(xe,".next",st);var mt=Ne.context;return tt.set(mt,"."+lc,st+"?"+st+".width:"+mt+"."+mf),tt.set(mt,"."+vf,st+"?"+st+".height:"+mt+"."+Vh),st})}else return null}function Qn(_e,ae,Ze){var ot=_e.static,At=_e.dynamic;function Ye(me){if(me in ot){var Ne=ot[me];pe.commandType(Ne,"object","invalid "+me,Ze.commandStr);var xe=!0,st=Ne.x|0,mt=Ne.y|0,fr,Jt;return"width"in Ne?(fr=Ne.width|0,pe.command(fr>=0,"invalid "+me,Ze.commandStr)):xe=!1,"height"in Ne?(Jt=Ne.height|0,pe.command(Jt>=0,"invalid "+me,Ze.commandStr)):xe=!1,new ma(!xe&&ae&&ae.thisDep,!xe&&ae&&ae.contextDep,!xe&&ae&&ae.propDep,function(Fr,Tn){var fn=Fr.shared.context,Cn=fr;"width"in Ne||(Cn=Tn.def(fn,".",lc,"-",st));var bn=Jt;return"height"in Ne||(bn=Tn.def(fn,".",vf,"-",mt)),[st,mt,Cn,bn]})}else if(me in At){var $t=At[me],en=Ys($t,function(Fr,Tn){var fn=Fr.invoke(Tn,$t);pe.optional(function(){Fr.assert(Tn,fn+"&&typeof "+fn+'==="object"',"invalid "+me)});var Cn=Fr.shared.context,bn=Tn.def(fn,".x|0"),mn=Tn.def(fn,".y|0"),Jn=Tn.def('"width" in ',fn,"?",fn,".width|0:","(",Cn,".",lc,"-",bn,")"),Aa=Tn.def('"height" in ',fn,"?",fn,".height|0:","(",Cn,".",vf,"-",mn,")");return pe.optional(function(){Fr.assert(Tn,Jn+">=0&&"+Aa+">=0","invalid "+me)}),[bn,mn,Jn,Aa]});return ae&&(en.thisDep=en.thisDep||ae.thisDep,en.contextDep=en.contextDep||ae.contextDep,en.propDep=en.propDep||ae.propDep),en}else return ae?new ma(ae.thisDep,ae.contextDep,ae.propDep,function(Fr,Tn){var fn=Fr.shared.context;return[0,0,Tn.def(fn,".",lc),Tn.def(fn,".",vf)]}):null}var ke=Ye(au);if(ke){var tt=ke;ke=new ma(ke.thisDep,ke.contextDep,ke.propDep,function(me,Ne){var xe=tt.append(me,Ne),st=me.shared.context;return Ne.set(st,"."+Cp,xe[2]),Ne.set(st,"."+ih,xe[3]),xe})}return{viewport:ke,scissor_box:Ye(hf)}}function li(_e,ae){var Ze=_e.static,ot=typeof Ze[Zc]=="string"&&typeof Ze[bl]=="string";if(ot){if(Object.keys(ae.dynamic).length>0)return null;var At=ae.static,Ye=Object.keys(At);if(Ye.length>0&&typeof At[Ye[0]]=="number"){for(var ke=[],tt=0;tt<Ye.length;++tt)pe(typeof At[Ye[tt]]=="number","must specify all vertex attribute locations when using vaos"),ke.push([At[Ye[tt]]|0,Ye[tt]]);return ke}}return null}function zi(_e,ae,Ze){var ot=_e.static,At=_e.dynamic;function Ye(xe){if(xe in ot){var st=fe.id(ot[xe]);pe.optional(function(){Er.shader(Kh[xe],st,pe.guessCommand())});var mt=Ro(function(){return st});return mt.id=st,mt}else if(xe in At){var fr=At[xe];return Ys(fr,function(Jt,$t){var en=Jt.invoke($t,fr),Fr=$t.def(Jt.shared.strings,".id(",en,")");return pe.optional(function(){$t(Jt.shared.shader,".shader(",Kh[xe],",",Fr,",",Jt.command,");")}),Fr})}return null}var ke=Ye(Zc),tt=Ye(bl),me=null,Ne;return pc(ke)&&pc(tt)?(me=Er.program(tt.id,ke.id,null,Ze),Ne=Ro(function(xe,st){return xe.link(me)})):Ne=new ma(ke&&ke.thisDep||tt&&tt.thisDep,ke&&ke.contextDep||tt&&tt.contextDep,ke&&ke.propDep||tt&&tt.propDep,function(xe,st){var mt=xe.shared.shader,fr;ke?fr=ke.append(xe,st):fr=st.def(mt,".",Zc);var Jt;tt?Jt=tt.append(xe,st):Jt=st.def(mt,".",bl);var $t=mt+".program("+Jt+","+fr;return pe.optional(function(){$t+=","+xe.command}),st.def($t+")")}),{frag:ke,vert:tt,progVar:Ne,program:me}}function io(_e,ae){var Ze=_e.static,ot=_e.dynamic,At={},Ye=!1;function ke(){if(Vf in Ze){var Tn=Ze[Vf];return Tn!==null&&hr.getVAO(Tn)===null&&(Tn=hr.createVAO(Tn)),Ye=!0,At.vao=Tn,Ro(function(Cn){var bn=hr.getVAO(Tn);return bn?Cn.link(bn):"null"})}else if(Vf in ot){Ye=!0;var fn=ot[Vf];return Ys(fn,function(Cn,bn){var mn=Cn.invoke(bn,fn);return bn.def(Cn.shared.vao+".getVAO("+mn+")")})}return null}var tt=ke(),me=!1;function Ne(){if(hu in Ze){var Tn=Ze[hu];if(At.elements=Tn,Rp(Tn)){var fn=At.elements=Pt.create(Tn,!0);Tn=Pt.getElements(fn),me=!0}else Tn&&(Tn=Pt.getElements(Tn),me=!0,pe.command(Tn,"invalid elements",ae.commandStr));var Cn=Ro(function(mn,Jn){if(Tn){var Aa=mn.link(Tn);return mn.ELEMENTS=Aa,Aa}return mn.ELEMENTS=null,null});return Cn.value=Tn,Cn}else if(hu in ot){me=!0;var bn=ot[hu];return Ys(bn,function(mn,Jn){var Aa=mn.shared,ys=Aa.isBufferArgs,ja=Aa.elements,ga=mn.invoke(Jn,bn),Kl=Jn.def("null"),qs=Jn.def(ys,"(",ga,")"),Ju=mn.cond(qs).then(Kl,"=",ja,".createStream(",ga,");").else(Kl,"=",ja,".getElements(",ga,");");return pe.optional(function(){mn.assert(Ju.else,"!"+ga+"||"+Kl,"invalid elements")}),Jn.entry(Ju),Jn.exit(mn.cond(qs).then(ja,".destroyStream(",Kl,");")),mn.ELEMENTS=Kl,Kl})}else if(Ye)return new ma(tt.thisDep,tt.contextDep,tt.propDep,function(mn,Jn){return Jn.def(mn.shared.vao+".currentVAO?"+mn.shared.elements+".getElements("+mn.shared.vao+".currentVAO.elements):null")});return null}var xe=Ne();function st(){if(Io in Ze){var Tn=Ze[Io];return At.primitive=Tn,pe.commandParameter(Tn,sr,"invalid primitve",ae.commandStr),Ro(function(Cn,bn){return sr[Tn]})}else if(Io in ot){var fn=ot[Io];return Ys(fn,function(Cn,bn){var mn=Cn.constants.primTypes,Jn=Cn.invoke(bn,fn);return pe.optional(function(){Cn.assert(bn,Jn+" in "+mn,"invalid primitive, must be one of "+Object.keys(sr))}),bn.def(mn,"[",Jn,"]")})}else{if(me)return pc(xe)?xe.value?Ro(function(Cn,bn){return bn.def(Cn.ELEMENTS,".primType")}):Ro(function(){return Op}):new ma(xe.thisDep,xe.contextDep,xe.propDep,function(Cn,bn){var mn=Cn.ELEMENTS;return bn.def(mn,"?",mn,".primType:",Op)});if(Ye)return new ma(tt.thisDep,tt.contextDep,tt.propDep,function(Cn,bn){return bn.def(Cn.shared.vao+".currentVAO?"+Cn.shared.vao+".currentVAO.primitive:"+Op)})}return null}function mt(Tn,fn){if(Tn in Ze){var Cn=Ze[Tn]|0;return fn?At.offset=Cn:At.instances=Cn,pe.command(!fn||Cn>=0,"invalid "+Tn,ae.commandStr),Ro(function(mn,Jn){return fn&&(mn.OFFSET=Cn),Cn})}else if(Tn in ot){var bn=ot[Tn];return Ys(bn,function(mn,Jn){var Aa=mn.invoke(Jn,bn);return fn&&(mn.OFFSET=Aa,pe.optional(function(){mn.assert(Jn,Aa+">=0","invalid "+Tn)})),Aa})}else if(fn){if(me)return Ro(function(mn,Jn){return mn.OFFSET=0,0});if(Ye)return new ma(tt.thisDep,tt.contextDep,tt.propDep,function(mn,Jn){return Jn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.offset:0")})}else if(Ye)return new ma(tt.thisDep,tt.contextDep,tt.propDep,function(mn,Jn){return Jn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.instances:-1")});return null}var fr=mt(df,!0);function Jt(){if(uc in Ze){var Tn=Ze[uc]|0;return At.count=Tn,pe.command(typeof Tn=="number"&&Tn>=0,"invalid vertex count",ae.commandStr),Ro(function(){return Tn})}else if(uc in ot){var fn=ot[uc];return Ys(fn,function(Jn,Aa){var ys=Jn.invoke(Aa,fn);return pe.optional(function(){Jn.assert(Aa,"typeof "+ys+'==="number"&&'+ys+">=0&&"+ys+"===("+ys+"|0)","invalid vertex count")}),ys})}else if(me)if(pc(xe)){if(xe)return fr?new ma(fr.thisDep,fr.contextDep,fr.propDep,function(Jn,Aa){var ys=Aa.def(Jn.ELEMENTS,".vertCount-",Jn.OFFSET);return pe.optional(function(){Jn.assert(Aa,ys+">=0","invalid vertex offset/element buffer too small")}),ys}):Ro(function(Jn,Aa){return Aa.def(Jn.ELEMENTS,".vertCount")});var Cn=Ro(function(){return-1});return pe.optional(function(){Cn.MISSING=!0}),Cn}else{var bn=new ma(xe.thisDep||fr.thisDep,xe.contextDep||fr.contextDep,xe.propDep||fr.propDep,function(Jn,Aa){var ys=Jn.ELEMENTS;return Jn.OFFSET?Aa.def(ys,"?",ys,".vertCount-",Jn.OFFSET,":-1"):Aa.def(ys,"?",ys,".vertCount:-1")});return pe.optional(function(){bn.DYNAMIC=!0}),bn}else if(Ye){var mn=new ma(tt.thisDep,tt.contextDep,tt.propDep,function(Jn,Aa){return Aa.def(Jn.shared.vao,".currentVAO?",Jn.shared.vao,".currentVAO.count:-1")});return mn}return null}var $t=st(),en=Jt(),Fr=mt(Ep,!1);return{elements:xe,primitive:$t,count:en,instances:Fr,offset:fr,vao:tt,vaoActive:Ye,elementsActive:me,static:At}}function so(_e,ae){var Ze=_e.static,ot=_e.dynamic,At={};return Un.forEach(function(Ye){var ke=xn(Ye);function tt(me,Ne){if(Ye in Ze){var xe=me(Ze[Ye]);At[ke]=Ro(function(){return xe})}else if(Ye in ot){var st=ot[Ye];At[ke]=Ys(st,function(mt,fr){return Ne(mt,fr,mt.invoke(fr,st))})}}switch(Ye){case yl:case As:case ho:case Ri:case Su:case Uc:case pu:case Au:case $u:case Du:return tt(function(me){return pe.commandType(me,"boolean",Ye,ae.commandStr),me},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,"typeof "+xe+'==="boolean"',"invalid flag "+Ye,me.commandStr)}),xe});case os:return tt(function(me){return pe.commandParameter(me,fc,"invalid "+Ye,ae.commandStr),fc[me]},function(me,Ne,xe){var st=me.constants.compareFuncs;return pe.optional(function(){me.assert(Ne,xe+" in "+st,"invalid "+Ye+", must be one of "+Object.keys(fc))}),Ne.def(st,"[",xe,"]")});case gl:return tt(function(me){return pe.command(to(me)&&me.length===2&&typeof me[0]=="number"&&typeof me[1]=="number"&&me[0]<=me[1],"depth range is 2d array",ae.commandStr),me},function(me,Ne,xe){pe.optional(function(){me.assert(Ne,me.shared.isArrayLike+"("+xe+")&&"+xe+".length===2&&typeof "+xe+'[0]==="number"&&typeof '+xe+'[1]==="number"&&'+xe+"[0]<="+xe+"[1]","depth range must be a 2d array")});var st=Ne.def("+",xe,"[0]"),mt=Ne.def("+",xe,"[1]");return[st,mt]});case ws:return tt(function(me){pe.commandType(me,"object","blend.func",ae.commandStr);var Ne="srcRGB"in me?me.srcRGB:me.src,xe="srcAlpha"in me?me.srcAlpha:me.src,st="dstRGB"in me?me.dstRGB:me.dst,mt="dstAlpha"in me?me.dstAlpha:me.dst;return pe.commandParameter(Ne,Sl,ke+".srcRGB",ae.commandStr),pe.commandParameter(xe,Sl,ke+".srcAlpha",ae.commandStr),pe.commandParameter(st,Sl,ke+".dstRGB",ae.commandStr),pe.commandParameter(mt,Sl,ke+".dstAlpha",ae.commandStr),pe.command(Gc.indexOf(Ne+", "+st)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ne+", "+st+")",ae.commandStr),[Sl[Ne],Sl[st],Sl[xe],Sl[mt]]},function(me,Ne,xe){var st=me.constants.blendFuncs;pe.optional(function(){me.assert(Ne,xe+"&&typeof "+xe+'==="object"',"invalid blend func, must be an object")});function mt(fn,Cn){var bn=Ne.def('"',fn,Cn,'" in ',xe,"?",xe,".",fn,Cn,":",xe,".",fn);return pe.optional(function(){me.assert(Ne,bn+" in "+st,"invalid "+Ye+"."+fn+Cn+", must be one of "+Object.keys(Sl))}),bn}var fr=mt("src","RGB"),Jt=mt("dst","RGB");pe.optional(function(){var fn=me.constants.invalidBlendCombinations;me.assert(Ne,fn+".indexOf("+fr+'+", "+'+Jt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var $t=Ne.def(st,"[",fr,"]"),en=Ne.def(st,"[",mt("src","Alpha"),"]"),Fr=Ne.def(st,"[",Jt,"]"),Tn=Ne.def(st,"[",mt("dst","Alpha"),"]");return[$t,Fr,en,Tn]});case qu:return tt(function(me){if(typeof me=="string")return pe.commandParameter(me,zt,"invalid "+Ye,ae.commandStr),[zt[me],zt[me]];if(typeof me=="object")return pe.commandParameter(me.rgb,zt,Ye+".rgb",ae.commandStr),pe.commandParameter(me.alpha,zt,Ye+".alpha",ae.commandStr),[zt[me.rgb],zt[me.alpha]];pe.commandRaise("invalid blend.equation",ae.commandStr)},function(me,Ne,xe){var st=me.constants.blendEquations,mt=Ne.def(),fr=Ne.def(),Jt=me.cond("typeof ",xe,'==="string"');return pe.optional(function(){function $t(en,Fr,Tn){me.assert(en,Tn+" in "+st,"invalid "+Fr+", must be one of "+Object.keys(zt))}$t(Jt.then,Ye,xe),me.assert(Jt.else,xe+"&&typeof "+xe+'==="object"',"invalid "+Ye),$t(Jt.else,Ye+".rgb",xe+".rgb"),$t(Jt.else,Ye+".alpha",xe+".alpha")}),Jt.then(mt,"=",fr,"=",st,"[",xe,"];"),Jt.else(mt,"=",st,"[",xe,".rgb];",fr,"=",st,"[",xe,".alpha];"),Ne(Jt),[mt,fr]});case Wa:return tt(function(me){return pe.command(to(me)&&me.length===4,"blend.color must be a 4d array",ae.commandStr),je(4,function(Ne){return+me[Ne]})},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,me.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","blend.color must be a 4d array")}),je(4,function(st){return Ne.def("+",xe,"[",st,"]")})});case Bs:return tt(function(me){return pe.commandType(me,"number",ke,ae.commandStr),me|0},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,"typeof "+xe+'==="number"',"invalid stencil.mask")}),Ne.def(xe,"|0")});case ms:return tt(function(me){pe.commandType(me,"object",ke,ae.commandStr);var Ne=me.cmp||"keep",xe=me.ref||0,st="mask"in me?me.mask:-1;return pe.commandParameter(Ne,fc,Ye+".cmp",ae.commandStr),pe.commandType(xe,"number",Ye+".ref",ae.commandStr),pe.commandType(st,"number",Ye+".mask",ae.commandStr),[fc[Ne],xe,st]},function(me,Ne,xe){var st=me.constants.compareFuncs;pe.optional(function(){function $t(){me.assert(Ne,Array.prototype.join.call(arguments,""),"invalid stencil.func")}$t(xe+"&&typeof ",xe,'==="object"'),$t('!("cmp" in ',xe,")||(",xe,".cmp in ",st,")")});var mt=Ne.def('"cmp" in ',xe,"?",st,"[",xe,".cmp]",":",wu),fr=Ne.def(xe,".ref|0"),Jt=Ne.def('"mask" in ',xe,"?",xe,".mask|0:-1");return[mt,fr,Jt]});case Qu:case zc:return tt(function(me){pe.commandType(me,"object",ke,ae.commandStr);var Ne=me.fail||"keep",xe=me.zfail||"keep",st=me.zpass||"keep";return pe.commandParameter(Ne,Cl,Ye+".fail",ae.commandStr),pe.commandParameter(xe,Cl,Ye+".zfail",ae.commandStr),pe.commandParameter(st,Cl,Ye+".zpass",ae.commandStr),[Ye===zc?cc:El,Cl[Ne],Cl[xe],Cl[st]]},function(me,Ne,xe){var st=me.constants.stencilOps;pe.optional(function(){me.assert(Ne,xe+"&&typeof "+xe+'==="object"',"invalid "+Ye)});function mt(fr){return pe.optional(function(){me.assert(Ne,'!("'+fr+'" in '+xe+")||("+xe+"."+fr+" in "+st+")","invalid "+Ye+"."+fr+", must be one of "+Object.keys(Cl))}),Ne.def('"',fr,'" in ',xe,"?",st,"[",xe,".",fr,"]:",wu)}return[Ye===zc?cc:El,mt("fail"),mt("zfail"),mt("zpass")]});case oo:return tt(function(me){pe.commandType(me,"object",ke,ae.commandStr);var Ne=me.factor|0,xe=me.units|0;return pe.commandType(Ne,"number",ke+".factor",ae.commandStr),pe.commandType(xe,"number",ke+".units",ae.commandStr),[Ne,xe]},function(me,Ne,xe){pe.optional(function(){me.assert(Ne,xe+"&&typeof "+xe+'==="object"',"invalid "+Ye)});var st=Ne.def(xe,".factor|0"),mt=Ne.def(xe,".units|0");return[st,mt]});case Ku:return tt(function(me){var Ne=0;return me==="front"?Ne=El:me==="back"&&(Ne=cc),pe.command(!!Ne,ke,ae.commandStr),Ne},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,xe+'==="front"||'+xe+'==="back"',"invalid cull.face")}),Ne.def(xe,'==="front"?',El,":",cc)});case _l:return tt(function(me){return pe.command(typeof me=="number"&&me>=It.lineWidthDims[0]&&me<=It.lineWidthDims[1],"invalid line width, must be a positive number between "+It.lineWidthDims[0]+" and "+It.lineWidthDims[1],ae.commandStr),me},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,"typeof "+xe+'==="number"&&'+xe+">="+It.lineWidthDims[0]+"&&"+xe+"<="+It.lineWidthDims[1],"invalid line width")}),xe});case Fs:return tt(function(me){return pe.commandParameter(me,lh,ke,ae.commandStr),lh[me]},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,xe+'==="cw"||'+xe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ne.def(xe+'==="cw"?'+sh+":"+$f)});case Cu:return tt(function(me){return pe.command(to(me)&&me.length===4,"color.mask must be length 4 array",ae.commandStr),me.map(function(Ne){return!!Ne})},function(me,Ne,xe){return pe.optional(function(){me.assert(Ne,me.shared.isArrayLike+"("+xe+")&&"+xe+".length===4","invalid color.mask")}),je(4,function(st){return"!!"+xe+"["+st+"]"})});case Fu:return tt(function(me){pe.command(typeof me=="object"&&me,ke,ae.commandStr);var Ne="value"in me?me.value:1,xe=!!me.invert;return pe.command(typeof Ne=="number"&&Ne>=0&&Ne<=1,"sample.coverage.value must be a number between 0 and 1",ae.commandStr),[Ne,xe]},function(me,Ne,xe){pe.optional(function(){me.assert(Ne,xe+"&&typeof "+xe+'==="object"',"invalid sample.coverage")});var st=Ne.def('"value" in ',xe,"?+",xe,".value:1"),mt=Ne.def("!!",xe,".invert");return[st,mt]})}}),At}function Fi(_e,ae){var Ze=_e.static,ot=_e.dynamic,At={};return Object.keys(Ze).forEach(function(Ye){var ke=Ze[Ye],tt;if(typeof ke=="number"||typeof ke=="boolean")tt=Ro(function(){return ke});else if(typeof ke=="function"){var me=ke._reglType;me==="texture2d"||me==="textureCube"?tt=Ro(function(Ne){return Ne.link(ke)}):me==="framebuffer"||me==="framebufferCube"?(pe.command(ke.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',ae.commandStr),tt=Ro(function(Ne){return Ne.link(ke.color[0])})):pe.commandRaise('invalid data for uniform "'+Ye+'"',ae.commandStr)}else to(ke)?tt=Ro(function(Ne){var xe=Ne.global.def("[",je(ke.length,function(st){return pe.command(typeof ke[st]=="number"||typeof ke[st]=="boolean","invalid uniform "+Ye,Ne.commandStr),ke[st]}),"]");return xe}):pe.commandRaise('invalid or missing data for uniform "'+Ye+'"',ae.commandStr);tt.value=ke,At[Ye]=tt}),Object.keys(ot).forEach(function(Ye){var ke=ot[Ye];At[Ye]=Ys(ke,function(tt,me){return tt.invoke(me,ke)})}),At}function ss(_e,ae){var Ze=_e.static,ot=_e.dynamic,At={};return Object.keys(Ze).forEach(function(Ye){var ke=Ze[Ye],tt=fe.id(Ye),me=new it;if(Rp(ke))me.state=Xn,me.buffer=rr.getBuffer(rr.create(ke,gf,!1,!0)),me.type=0;else{var Ne=rr.getBuffer(ke);if(Ne)me.state=Xn,me.buffer=Ne,me.type=0;else if(pe.command(typeof ke=="object"&&ke,"invalid data for attribute "+Ye,ae.commandStr),"constant"in ke){var xe=ke.constant;me.buffer="null",me.state=Fn,typeof xe=="number"?me.x=xe:(pe.command(to(xe)&&xe.length>0&&xe.length<=4,"invalid constant for attribute "+Ye,ae.commandStr),hi.forEach(function(Fr,Tn){Tn<xe.length&&(me[Fr]=xe[Tn])}))}else{Rp(ke.buffer)?Ne=rr.getBuffer(rr.create(ke.buffer,gf,!1,!0)):Ne=rr.getBuffer(ke.buffer),pe.command(!!Ne,'missing buffer for attribute "'+Ye+'"',ae.commandStr);var st=ke.offset|0;pe.command(st>=0,'invalid offset for attribute "'+Ye+'"',ae.commandStr);var mt=ke.stride|0;pe.command(mt>=0&&mt<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',ae.commandStr);var fr=ke.size|0;pe.command(!("size"in ke)||fr>0&&fr<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',ae.commandStr);var Jt=!!ke.normalized,$t=0;"type"in ke&&(pe.commandParameter(ke.type,Hs,"invalid type for attribute "+Ye,ae.commandStr),$t=Hs[ke.type]);var en=ke.divisor|0;pe.optional(function(){"divisor"in ke&&(pe.command(en===0||xr,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',ae.commandStr),pe.command(en>=0,'invalid divisor for attribute "'+Ye+'"',ae.commandStr));var Fr=ae.commandStr,Tn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ke).forEach(function(fn){pe.command(Tn.indexOf(fn)>=0,'unknown parameter "'+fn+'" for attribute pointer "'+Ye+'" (valid parameters are '+Tn+")",Fr)})}),me.buffer=Ne,me.state=Xn,me.size=fr,me.normalized=Jt,me.type=$t||Ne.dtype,me.offset=st,me.stride=mt,me.divisor=en}}At[Ye]=Ro(function(Fr,Tn){var fn=Fr.attribCache;if(tt in fn)return fn[tt];var Cn={isStream:!1};return Object.keys(me).forEach(function(bn){Cn[bn]=me[bn]}),me.buffer&&(Cn.buffer=Fr.link(me.buffer),Cn.type=Cn.type||Cn.buffer+".dtype"),fn[tt]=Cn,Cn})}),Object.keys(ot).forEach(function(Ye){var ke=ot[Ye];function tt(me,Ne){var xe=me.invoke(Ne,ke),st=me.shared,mt=me.constants,fr=st.isBufferArgs,Jt=st.buffer;pe.optional(function(){me.assert(Ne,xe+"&&(typeof "+xe+'==="object"||typeof '+xe+'==="function")&&('+fr+"("+xe+")||"+Jt+".getBuffer("+xe+")||"+Jt+".getBuffer("+xe+".buffer)||"+fr+"("+xe+'.buffer)||("constant" in '+xe+"&&(typeof "+xe+'.constant==="number"||'+st.isArrayLike+"("+xe+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var $t={isStream:Ne.def(!1)},en=new it;en.state=Xn,Object.keys(en).forEach(function(Cn){$t[Cn]=Ne.def(""+en[Cn])});var Fr=$t.buffer,Tn=$t.type;Ne("if(",fr,"(",xe,")){",$t.isStream,"=true;",Fr,"=",Jt,".createStream(",gf,",",xe,");",Tn,"=",Fr,".dtype;","}else{",Fr,"=",Jt,".getBuffer(",xe,");","if(",Fr,"){",Tn,"=",Fr,".dtype;",'}else if("constant" in ',xe,"){",$t.state,"=",Fn,";","if(typeof "+xe+'.constant === "number"){',$t[hi[0]],"=",xe,".constant;",hi.slice(1).map(function(Cn){return $t[Cn]}).join("="),"=0;","}else{",hi.map(function(Cn,bn){return $t[Cn]+"="+xe+".constant.length>"+bn+"?"+xe+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",fr,"(",xe,".buffer)){",Fr,"=",Jt,".createStream(",gf,",",xe,".buffer);","}else{",Fr,"=",Jt,".getBuffer(",xe,".buffer);","}",Tn,'="type" in ',xe,"?",mt.glTypes,"[",xe,".type]:",Fr,".dtype;",$t.normalized,"=!!",xe,".normalized;");function fn(Cn){Ne($t[Cn],"=",xe,".",Cn,"|0;")}return fn("size"),fn("offset"),fn("stride"),fn("divisor"),Ne("}}"),Ne.exit("if(",$t.isStream,"){",Jt,".destroyStream(",Fr,");","}"),$t}At[Ye]=Ys(ke,tt)}),At}function Xa(_e){var ae=_e.static,Ze=_e.dynamic,ot={};return Object.keys(ae).forEach(function(At){var Ye=ae[At];ot[At]=Ro(function(ke,tt){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:ke.link(Ye)})}),Object.keys(Ze).forEach(function(At){var Ye=Ze[At];ot[At]=Ys(Ye,function(ke,tt){return ke.invoke(tt,Ye)})}),ot}function $o(_e,ae,Ze,ot,At){var Ye=_e.static,ke=_e.dynamic;pe.optional(function(){var fn=[So,bl,Zc,hu,Io,df,uc,Ep,xl,Vf].concat(Un);function Cn(bn){Object.keys(bn).forEach(function(mn){pe.command(fn.indexOf(mn)>=0,'unknown parameter "'+mn+'"',At.commandStr)})}Cn(Ye),Cn(ke)});var tt=li(_e,ae),me=on(_e,At),Ne=Qn(_e,me,At),xe=io(_e,At),st=so(_e,At),mt=zi(_e,At,tt);function fr(fn){var Cn=Ne[fn];Cn&&(st[fn]=Cn)}fr(au),fr(xn(hf));var Jt=Object.keys(st).length>0,$t={framebuffer:me,draw:xe,shader:mt,state:st,dirty:Jt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if($t.profile=Gr(_e,At),$t.uniforms=Fi(Ze,At),$t.drawVAO=$t.scopeVAO=xe.vao,!$t.drawVAO&&mt.program&&!tt&&Le.angle_instanced_arrays&&xe.static.elements){var en=!0,Fr=mt.program.attributes.map(function(fn){var Cn=ae.static[fn];return en=en&&!!Cn,Cn});if(en&&Fr.length>0){var Tn=hr.getVAO(hr.createVAO({attributes:Fr,elements:xe.static.elements}));$t.drawVAO=new ma(null,null,null,function(fn,Cn){return fn.link(Tn)}),$t.useVAO=!0}}return tt?$t.useVAO=!0:$t.attributes=ss(ae,At),$t.context=Xa(ot,At),$t}function vo(_e,ae,Ze){var ot=_e.shared,At=ot.context,Ye=_e.scope();Object.keys(Ze).forEach(function(ke){ae.save(At,"."+ke);var tt=Ze[ke],me=tt.append(_e,ae);Array.isArray(me)?Ye(At,".",ke,"=[",me.join(),"];"):Ye(At,".",ke,"=",me,";")}),ae(Ye)}function Qo(_e,ae,Ze,ot){var At=_e.shared,Ye=At.gl,ke=At.framebuffer,tt;zr&&(tt=ae.def(At.extensions,".webgl_draw_buffers"));var me=_e.constants,Ne=me.drawBuffer,xe=me.backBuffer,st;Ze?st=Ze.append(_e,ae):st=ae.def(ke,".next"),ot||ae("if(",st,"!==",ke,".cur){"),ae("if(",st,"){",Ye,".bindFramebuffer(",uh,",",st,".framebuffer);"),zr&&ae(tt,".drawBuffersWEBGL(",Ne,"[",st,".colorAttachments.length]);"),ae("}else{",Ye,".bindFramebuffer(",uh,",null);"),zr&&ae(tt,".drawBuffersWEBGL(",xe,");"),ae("}",ke,".cur=",st,";"),ot||ae("}")}function Uo(_e,ae,Ze){var ot=_e.shared,At=ot.gl,Ye=_e.current,ke=_e.next,tt=ot.current,me=ot.next,Ne=_e.cond(tt,".dirty");Un.forEach(function(xe){var st=xn(xe);if(!(st in Ze.state)){var mt,fr;if(st in ke){mt=ke[st],fr=Ye[st];var Jt=je(kr[st].length,function(en){return Ne.def(mt,"[",en,"]")});Ne(_e.cond(Jt.map(function(en,Fr){return en+"!=="+fr+"["+Fr+"]"}).join("||")).then(At,".",er[st],"(",Jt,");",Jt.map(function(en,Fr){return fr+"["+Fr+"]="+en}).join(";"),";"))}else{mt=Ne.def(me,".",st);var $t=_e.cond(mt,"!==",tt,".",st);Ne($t),st in Qt?$t(_e.cond(mt).then(At,".enable(",Qt[st],");").else(At,".disable(",Qt[st],");"),tt,".",st,"=",mt,";"):$t(At,".",er[st],"(",mt,");",tt,".",st,"=",mt,";")}}}),Object.keys(Ze.state).length===0&&Ne(tt,".dirty=false;"),ae(Ne)}function gs(_e,ae,Ze,ot){var At=_e.shared,Ye=_e.current,ke=At.current,tt=At.gl;ch(Object.keys(Ze)).forEach(function(me){var Ne=Ze[me];if(!(ot&&!ot(Ne))){var xe=Ne.append(_e,ae);if(Qt[me]){var st=Qt[me];pc(Ne)?xe?ae(tt,".enable(",st,");"):ae(tt,".disable(",st,");"):ae(_e.cond(xe).then(tt,".enable(",st,");").else(tt,".disable(",st,");")),ae(ke,".",me,"=",xe,";")}else if(to(xe)){var mt=Ye[me];ae(tt,".",er[me],"(",xe,");",xe.map(function(fr,Jt){return mt+"["+Jt+"]="+fr}).join(";"),";")}else ae(tt,".",er[me],"(",xe,");",ke,".",me,"=",xe,";")}})}function Ka(_e,ae){xr&&(_e.instancing=ae.def(_e.shared.extensions,".angle_instanced_arrays"))}function _i(_e,ae,Ze,ot,At){var Ye=_e.shared,ke=_e.stats,tt=Ye.current,me=Ye.timer,Ne=Ze.profile;function xe(){var fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return fn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var st,mt;function fr(fn){st=ae.def(),fn(st,"=",xe(),";"),typeof At=="string"?fn(ke,".count+=",At,";"):fn(ke,".count++;"),yr&&(ot?(mt=ae.def(),fn(mt,"=",me,".getNumPendingQueries();")):fn(me,".beginQuery(",ke,");"))}function Jt(fn){fn(ke,".cpuTime+=",xe(),"-",st,";"),yr&&(ot?fn(me,".pushScopeStats(",mt,",",me,".getNumPendingQueries(),",ke,");"):fn(me,".endQuery();"))}function $t(fn){var Cn=ae.def(tt,".profile");ae(tt,".profile=",fn,";"),ae.exit(tt,".profile=",Cn,";")}var en;if(Ne){if(pc(Ne)){Ne.enable?(fr(ae),Jt(ae.exit),$t("true")):$t("false");return}en=Ne.append(_e,ae),$t(en)}else en=ae.def(tt,".profile");var Fr=_e.block();fr(Fr),ae("if(",en,"){",Fr,"}");var Tn=_e.block();Jt(Tn),ae.exit("if(",en,"){",Tn,"}")}function Zo(_e,ae,Ze,ot,At){var Ye=_e.shared;function ke(me){switch(me){case Wf:case Mp:case Pp:return 2;case Yl:case ql:case _f:return 3;case jc:case Yf:case xf:return 4;default:return 1}}function tt(me,Ne,xe){var st=Ye.gl,mt=ae.def(me,".location"),fr=ae.def(Ye.attributes,"[",mt,"]"),Jt=xe.state,$t=xe.buffer,en=[xe.x,xe.y,xe.z,xe.w],Fr=["buffer","normalized","offset","stride"];function Tn(){ae("if(!",fr,".buffer){",st,".enableVertexAttribArray(",mt,");}");var Cn=xe.type,bn;if(xe.size?bn=ae.def(xe.size,"||",Ne):bn=Ne,ae("if(",fr,".type!==",Cn,"||",fr,".size!==",bn,"||",Fr.map(function(Jn){return fr+"."+Jn+"!=="+xe[Jn]}).join("||"),"){",st,".bindBuffer(",gf,",",$t,".buffer);",st,".vertexAttribPointer(",[mt,bn,Cn,xe.normalized,xe.stride,xe.offset],");",fr,".type=",Cn,";",fr,".size=",bn,";",Fr.map(function(Jn){return fr+"."+Jn+"="+xe[Jn]+";"}).join(""),"}"),xr){var mn=xe.divisor;ae("if(",fr,".divisor!==",mn,"){",_e.instancing,".vertexAttribDivisorANGLE(",[mt,mn],");",fr,".divisor=",mn,";}")}}function fn(){ae("if(",fr,".buffer){",st,".disableVertexAttribArray(",mt,");",fr,".buffer=null;","}if(",hi.map(function(Cn,bn){return fr+"."+Cn+"!=="+en[bn]}).join("||"),"){",st,".vertexAttrib4f(",mt,",",en,");",hi.map(function(Cn,bn){return fr+"."+Cn+"="+en[bn]+";"}).join(""),"}")}Jt===Xn?Tn():Jt===Fn?fn():(ae("if(",Jt,"===",Xn,"){"),Tn(),ae("}else{"),fn(),ae("}"))}ot.forEach(function(me){var Ne=me.name,xe=Ze.attributes[Ne],st;if(xe){if(!At(xe))return;st=xe.append(_e,ae)}else{if(!At($h))return;var mt=_e.scopeAttrib(Ne);pe.optional(function(){_e.assert(ae,mt+".state","missing attribute "+Ne)}),st={},Object.keys(new it).forEach(function(fr){st[fr]=ae.def(mt,".",fr)})}tt(_e.link(me),ke(me.info.type),st)})}function ta(_e,ae,Ze,ot,At,Ye){for(var ke=_e.shared,tt=ke.gl,me,Ne=0;Ne<ot.length;++Ne){var xe=ot[Ne],st=xe.name,mt=xe.info.type,fr=Ze.uniforms[st],Jt=_e.link(xe),$t=Jt+".location",en;if(fr){if(!At(fr))continue;if(pc(fr)){var Fr=fr.value;if(pe.command(Fr!==null&&typeof Fr!="undefined",'missing uniform "'+st+'"',_e.commandStr),mt===Kf||mt===Zt){pe.command(typeof Fr=="function"&&(mt===Kf&&(Fr._reglType==="texture2d"||Fr._reglType==="framebuffer")||mt===Zt&&(Fr._reglType==="textureCube"||Fr._reglType==="framebufferCube")),"invalid texture for uniform "+st,_e.commandStr);var Tn=_e.link(Fr._texture||Fr.color[0]._texture);ae(tt,".uniform1i(",$t,",",Tn+".bind());"),ae.exit(Tn,".unbind();")}else if(mt===Ns||mt===Ip||mt===Nr){pe.optional(function(){pe.command(to(Fr),"invalid matrix for uniform "+st,_e.commandStr),pe.command(mt===Ns&&Fr.length===4||mt===Ip&&Fr.length===9||mt===Nr&&Fr.length===16,"invalid length for matrix uniform "+st,_e.commandStr)});var fn=_e.global.def("new Float32Array(["+Array.prototype.slice.call(Fr)+"])"),Cn=2;mt===Ip?Cn=3:mt===Nr&&(Cn=4),ae(tt,".uniformMatrix",Cn,"fv(",$t,",false,",fn,");")}else{switch(mt){case Tp:pe.commandType(Fr,"number","uniform "+st,_e.commandStr),me="1f";break;case Wf:pe.command(to(Fr)&&Fr.length===2,"uniform "+st,_e.commandStr),me="2f";break;case Yl:pe.command(to(Fr)&&Fr.length===3,"uniform "+st,_e.commandStr),me="3f";break;case jc:pe.command(to(Fr)&&Fr.length===4,"uniform "+st,_e.commandStr),me="4f";break;case qf:pe.commandType(Fr,"boolean","uniform "+st,_e.commandStr),me="1i";break;case Xf:pe.commandType(Fr,"number","uniform "+st,_e.commandStr),me="1i";break;case Pp:pe.command(to(Fr)&&Fr.length===2,"uniform "+st,_e.commandStr),me="2i";break;case Mp:pe.command(to(Fr)&&Fr.length===2,"uniform "+st,_e.commandStr),me="2i";break;case _f:pe.command(to(Fr)&&Fr.length===3,"uniform "+st,_e.commandStr),me="3i";break;case ql:pe.command(to(Fr)&&Fr.length===3,"uniform "+st,_e.commandStr),me="3i";break;case xf:pe.command(to(Fr)&&Fr.length===4,"uniform "+st,_e.commandStr),me="4i";break;case Yf:pe.command(to(Fr)&&Fr.length===4,"uniform "+st,_e.commandStr),me="4i";break}ae(tt,".uniform",me,"(",$t,",",to(Fr)?Array.prototype.slice.call(Fr):Fr,");")}continue}else en=fr.append(_e,ae)}else{if(!At($h))continue;en=ae.def(ke.uniforms,"[",fe.id(st),"]")}mt===Kf?(pe(!Array.isArray(en),"must specify a scalar prop for textures"),ae("if(",en,"&&",en,'._reglType==="framebuffer"){',en,"=",en,".color[0];","}")):mt===Zt&&(pe(!Array.isArray(en),"must specify a scalar prop for cube maps"),ae("if(",en,"&&",en,'._reglType==="framebufferCube"){',en,"=",en,".color[0];","}")),pe.optional(function(){function qs(Uu,Hc){_e.assert(ae,Uu,'bad data or missing for uniform "'+st+'".  '+Hc)}function Ju(Uu){pe(!Array.isArray(en),"must not specify an array type for uniform"),qs("typeof "+en+'==="'+Uu+'"',"invalid type, expected "+Uu)}function zu(Uu,Hc){Array.isArray(en)?pe(en.length===Uu,"must have length "+Uu):qs(ke.isArrayLike+"("+en+")&&"+en+".length==="+Uu,"invalid vector, should have length "+Uu,_e.commandStr)}function ed(Uu){pe(!Array.isArray(en),"must not specify a value type"),qs("typeof "+en+'==="function"&&'+en+'._reglType==="texture'+(Uu===oh?"2d":"Cube")+'"',"invalid texture type",_e.commandStr)}switch(mt){case Xf:Ju("number");break;case Mp:zu(2,"number");break;case ql:zu(3,"number");break;case Yf:zu(4,"number");break;case Tp:Ju("number");break;case Wf:zu(2,"number");break;case Yl:zu(3,"number");break;case jc:zu(4,"number");break;case qf:Ju("boolean");break;case Pp:zu(2,"boolean");break;case _f:zu(3,"boolean");break;case xf:zu(4,"boolean");break;case Ns:zu(4,"number");break;case Ip:zu(9,"number");break;case Nr:zu(16,"number");break;case Kf:ed(oh);break;case Zt:ed(Gf);break}});var bn=1;switch(mt){case Kf:case Zt:var mn=ae.def(en,"._texture");ae(tt,".uniform1i(",$t,",",mn,".bind());"),ae.exit(mn,".unbind();");continue;case Xf:case qf:me="1i";break;case Mp:case Pp:me="2i",bn=2;break;case ql:case _f:me="3i",bn=3;break;case Yf:case xf:me="4i",bn=4;break;case Tp:me="1f";break;case Wf:me="2f",bn=2;break;case Yl:me="3f",bn=3;break;case jc:me="4f",bn=4;break;case Ns:me="Matrix2fv";break;case Ip:me="Matrix3fv";break;case Nr:me="Matrix4fv";break}if(me.charAt(0)==="M"){ae(tt,".uniform",me,"(",$t,",");var Jn=Math.pow(mt-Ns+2,2),Aa=_e.global.def("new Float32Array(",Jn,")");Array.isArray(en)?ae("false,(",je(Jn,function(qs){return Aa+"["+qs+"]="+en[qs]}),",",Aa,")"):ae("false,(Array.isArray(",en,")||",en," instanceof Float32Array)?",en,":(",je(Jn,function(qs){return Aa+"["+qs+"]="+en+"["+qs+"]"}),",",Aa,")"),ae(");")}else if(bn>1){for(var ys=[],ja=[],ga=0;ga<bn;++ga)Array.isArray(en)?ja.push(en[ga]):ja.push(ae.def(en+"["+ga+"]")),Ye&&ys.push(ae.def());Ye&&ae("if(!",_e.batchId,"||",ys.map(function(qs,Ju){return qs+"!=="+ja[Ju]}).join("||"),"){",ys.map(function(qs,Ju){return qs+"="+ja[Ju]+";"}).join("")),ae(tt,".uniform",me,"(",$t,",",ja.join(","),");"),Ye&&ae("}")}else{if(pe(!Array.isArray(en),"uniform value must not be an array"),Ye){var Kl=ae.def();ae("if(!",_e.batchId,"||",Kl,"!==",en,"){",Kl,"=",en,";")}ae(tt,".uniform",me,"(",$t,",",en,");"),Ye&&ae("}")}}}function Jo(_e,ae,Ze,ot){var At=_e.shared,Ye=At.gl,ke=At.draw,tt=ot.draw;function me(){var bn=tt.elements,mn,Jn=ae;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ze),mn=bn.append(_e,Jn),tt.elementsActive&&Jn("if("+mn+")"+Ye+".bindBuffer("+ah+","+mn+".buffer.buffer);")):(mn=Jn.def(),Jn(mn,"=",ke,".",hu,";","if(",mn,"){",Ye,".bindBuffer(",ah,",",mn,".buffer.buffer);}","else if(",At.vao,".currentVAO){",mn,"=",_e.shared.elements+".getElements("+At.vao,".currentVAO.elements);",lr?"":"if("+mn+")"+Ye+".bindBuffer("+ah+","+mn+".buffer.buffer);","}")),mn}function Ne(){var bn=tt.count,mn,Jn=ae;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(Jn=Ze),mn=bn.append(_e,Jn),pe.optional(function(){bn.MISSING&&_e.assert(ae,"false","missing vertex count"),bn.DYNAMIC&&_e.assert(Jn,mn+">=0","missing vertex count")})):(mn=Jn.def(ke,".",uc),pe.optional(function(){_e.assert(Jn,mn+">=0","missing vertex count")})),mn}var xe=me();function st(bn){var mn=tt[bn];return mn?mn.contextDep&&ot.contextDynamic||mn.propDep?mn.append(_e,Ze):mn.append(_e,ae):ae.def(ke,".",bn)}var mt=st(Io),fr=st(df),Jt=Ne();if(typeof Jt=="number"){if(Jt===0)return}else Ze("if(",Jt,"){"),Ze.exit("}");var $t,en;xr&&($t=st(Ep),en=_e.instancing);var Fr=xe+".type",Tn=tt.elements&&pc(tt.elements)&&!tt.vaoActive;function fn(){function bn(){Ze(en,".drawElementsInstancedANGLE(",[mt,Jt,Fr,fr+"<<(("+Fr+"-"+ti+")>>1)",$t],");")}function mn(){Ze(en,".drawArraysInstancedANGLE(",[mt,fr,Jt,$t],");")}xe&&xe!=="null"?Tn?bn():(Ze("if(",xe,"){"),bn(),Ze("}else{"),mn(),Ze("}")):mn()}function Cn(){function bn(){Ze(Ye+".drawElements("+[mt,Jt,Fr,fr+"<<(("+Fr+"-"+ti+")>>1)"]+");")}function mn(){Ze(Ye+".drawArrays("+[mt,fr,Jt]+");")}xe&&xe!=="null"?Tn?bn():(Ze("if(",xe,"){"),bn(),Ze("}else{"),mn(),Ze("}")):mn()}xr&&(typeof $t!="number"||$t>=0)?typeof $t=="string"?(Ze("if(",$t,">0){"),fn(),Ze("}else if(",$t,"<0){"),Cn(),Ze("}")):fn():Cn()}function ni(_e,ae,Ze,ot,At){var Ye=ri(),ke=Ye.proc("body",At);return pe.optional(function(){Ye.commandStr=ae.commandStr,Ye.command=Ye.link(ae.commandStr)}),xr&&(Ye.instancing=ke.def(Ye.shared.extensions,".angle_instanced_arrays")),_e(Ye,ke,Ze,ot),Ye.compile().body}function Di(_e,ae,Ze,ot){Ka(_e,ae),Ze.useVAO?Ze.drawVAO?ae(_e.shared.vao,".setVAO(",Ze.drawVAO.append(_e,ae),");"):ae(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(ae(_e.shared.vao,".setVAO(null);"),Zo(_e,ae,Ze,ot.attributes,function(){return!0})),ta(_e,ae,Ze,ot.uniforms,function(){return!0},!1),Jo(_e,ae,ae,Ze)}function ua(_e,ae){var Ze=_e.proc("draw",1);Ka(_e,Ze),vo(_e,Ze,ae.context),Qo(_e,Ze,ae.framebuffer),Uo(_e,Ze,ae),gs(_e,Ze,ae.state),_i(_e,Ze,ae,!1,!0);var ot=ae.shader.progVar.append(_e,Ze);if(Ze(_e.shared.gl,".useProgram(",ot,".program);"),ae.shader.program)Di(_e,Ze,ae,ae.shader.program);else{Ze(_e.shared.vao,".setVAO(null);");var At=_e.global.def("{}"),Ye=Ze.def(ot,".id"),ke=Ze.def(At,"[",Ye,"]");Ze(_e.cond(ke).then(ke,".call(this,a0);").else(ke,"=",At,"[",Ye,"]=",_e.link(function(tt){return ni(Di,_e,ae,tt,1)}),"(",ot,");",ke,".call(this,a0);"))}Object.keys(ae.state).length>0&&Ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ze(_e.shared.vao,".setVAO(null);")}function Co(_e,ae,Ze,ot){_e.batchId="a1",Ka(_e,ae);function At(){return!0}Zo(_e,ae,Ze,ot.attributes,At),ta(_e,ae,Ze,ot.uniforms,At,!1),Jo(_e,ae,ae,Ze)}function Al(_e,ae,Ze,ot){Ka(_e,ae);var At=Ze.contextDep,Ye=ae.def(),ke="a0",tt="a1",me=ae.def();_e.shared.props=me,_e.batchId=Ye;var Ne=_e.scope(),xe=_e.scope();ae(Ne.entry,"for(",Ye,"=0;",Ye,"<",tt,";++",Ye,"){",me,"=",ke,"[",Ye,"];",xe,"}",Ne.exit);function st(Fr){return Fr.contextDep&&At||Fr.propDep}function mt(Fr){return!st(Fr)}if(Ze.needsContext&&vo(_e,xe,Ze.context),Ze.needsFramebuffer&&Qo(_e,xe,Ze.framebuffer),gs(_e,xe,Ze.state,st),Ze.profile&&st(Ze.profile)&&_i(_e,xe,Ze,!1,!0),ot)Ze.useVAO?Ze.drawVAO?st(Ze.drawVAO)?xe(_e.shared.vao,".setVAO(",Ze.drawVAO.append(_e,xe),");"):Ne(_e.shared.vao,".setVAO(",Ze.drawVAO.append(_e,Ne),");"):Ne(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(Ne(_e.shared.vao,".setVAO(null);"),Zo(_e,Ne,Ze,ot.attributes,mt),Zo(_e,xe,Ze,ot.attributes,st)),ta(_e,Ne,Ze,ot.uniforms,mt,!1),ta(_e,xe,Ze,ot.uniforms,st,!0),Jo(_e,Ne,xe,Ze);else{var fr=_e.global.def("{}"),Jt=Ze.shader.progVar.append(_e,xe),$t=xe.def(Jt,".id"),en=xe.def(fr,"[",$t,"]");xe(_e.shared.gl,".useProgram(",Jt,".program);","if(!",en,"){",en,"=",fr,"[",$t,"]=",_e.link(function(Fr){return ni(Co,_e,Ze,Fr,2)}),"(",Jt,");}",en,".call(this,a0[",Ye,"],",Ye,");")}}function Se(_e,ae){var Ze=_e.proc("batch",2);_e.batchId="0",Ka(_e,Ze);var ot=!1,At=!0;Object.keys(ae.context).forEach(function(fr){ot=ot||ae.context[fr].propDep}),ot||(vo(_e,Ze,ae.context),At=!1);var Ye=ae.framebuffer,ke=!1;Ye?(Ye.propDep?ot=ke=!0:Ye.contextDep&&ot&&(ke=!0),ke||Qo(_e,Ze,Ye)):Qo(_e,Ze,null),ae.state.viewport&&ae.state.viewport.propDep&&(ot=!0);function tt(fr){return fr.contextDep&&ot||fr.propDep}Uo(_e,Ze,ae),gs(_e,Ze,ae.state,function(fr){return!tt(fr)}),(!ae.profile||!tt(ae.profile))&&_i(_e,Ze,ae,!1,"a1"),ae.contextDep=ot,ae.needsContext=At,ae.needsFramebuffer=ke;var me=ae.shader.progVar;if(me.contextDep&&ot||me.propDep)Al(_e,Ze,ae,null);else{var Ne=me.append(_e,Ze);if(Ze(_e.shared.gl,".useProgram(",Ne,".program);"),ae.shader.program)Al(_e,Ze,ae,ae.shader.program);else{Ze(_e.shared.vao,".setVAO(null);");var xe=_e.global.def("{}"),st=Ze.def(Ne,".id"),mt=Ze.def(xe,"[",st,"]");Ze(_e.cond(mt).then(mt,".call(this,a0,a1);").else(mt,"=",xe,"[",st,"]=",_e.link(function(fr){return ni(Al,_e,ae,fr,2)}),"(",Ne,");",mt,".call(this,a0,a1);"))}}Object.keys(ae.state).length>0&&Ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&Ze(_e.shared.vao,".setVAO(null);")}function Ft(_e,ae){var Ze=_e.proc("scope",3);_e.batchId="a2";var ot=_e.shared,At=ot.current;vo(_e,Ze,ae.context),ae.framebuffer&&ae.framebuffer.append(_e,Ze),ch(Object.keys(ae.state)).forEach(function(ke){var tt=ae.state[ke],me=tt.append(_e,Ze);to(me)?me.forEach(function(Ne,xe){Ze.set(_e.next[ke],"["+xe+"]",Ne)}):Ze.set(ot.next,"."+ke,me)}),_i(_e,Ze,ae,!0,!0),[hu,df,uc,Ep,Io].forEach(function(ke){var tt=ae.draw[ke];!tt||Ze.set(ot.draw,"."+ke,""+tt.append(_e,Ze))}),Object.keys(ae.uniforms).forEach(function(ke){var tt=ae.uniforms[ke].append(_e,Ze);Array.isArray(tt)&&(tt="["+tt.join()+"]"),Ze.set(ot.uniforms,"["+fe.id(ke)+"]",tt)}),Object.keys(ae.attributes).forEach(function(ke){var tt=ae.attributes[ke].append(_e,Ze),me=_e.scopeAttrib(ke);Object.keys(new it).forEach(function(Ne){Ze.set(me,"."+Ne,tt[Ne])})}),ae.scopeVAO&&Ze.set(ot.vao,".targetVAO",ae.scopeVAO.append(_e,Ze));function Ye(ke){var tt=ae.shader[ke];tt&&Ze.set(ot.shader,"."+ke,tt.append(_e,Ze))}Ye(bl),Ye(Zc),Object.keys(ae.state).length>0&&(Ze(At,".dirty=true;"),Ze.exit(At,".dirty=true;")),Ze("a1(",_e.shared.context,",a0,",_e.batchId,");")}function vt(_e){if(!(typeof _e!="object"||to(_e))){for(var ae=Object.keys(_e),Ze=0;Ze<ae.length;++Ze)if(An.isDynamic(_e[ae[Ze]]))return!0;return!1}}function hn(_e,ae,Ze){var ot=ae.static[Ze];if(!ot||!vt(ot))return;var At=_e.global,Ye=Object.keys(ot),ke=!1,tt=!1,me=!1,Ne=_e.global.def("{}");Ye.forEach(function(st){var mt=ot[st];if(An.isDynamic(mt)){typeof mt=="function"&&(mt=ot[st]=An.unbox(mt));var fr=Ys(mt,null);ke=ke||fr.thisDep,me=me||fr.propDep,tt=tt||fr.contextDep}else{switch(At(Ne,".",st,"="),typeof mt){case"number":At(mt);break;case"string":At('"',mt,'"');break;case"object":Array.isArray(mt)&&At("[",mt.join(),"]");break;default:At(_e.link(mt));break}At(";")}});function xe(st,mt){Ye.forEach(function(fr){var Jt=ot[fr];if(!!An.isDynamic(Jt)){var $t=st.invoke(mt,Jt);mt(Ne,".",fr,"=",$t,";")}})}ae.dynamic[Ze]=new An.DynamicVariable(qo,{thisDep:ke,contextDep:tt,propDep:me,ref:Ne,append:xe}),delete ae.static[Ze]}function Ui(_e,ae,Ze,ot,At){var Ye=ri();Ye.stats=Ye.link(At),Object.keys(ae.static).forEach(function(tt){hn(Ye,ae,tt)}),Sd.forEach(function(tt){hn(Ye,_e,tt)});var ke=$o(_e,ae,Ze,ot,Ye);return ua(Ye,ke),Ft(Ye,ke),Se(Ye,ke),m(Ye.compile(),{destroy:function(){ke.shader.program.destroy()}})}return{next:Qr,current:kr,procs:function(){var _e=ri(),ae=_e.proc("poll"),Ze=_e.proc("refresh"),ot=_e.block();ae(ot),Ze(ot);var At=_e.shared,Ye=At.gl,ke=At.next,tt=At.current;ot(tt,".dirty=false;"),Qo(_e,ae),Qo(_e,Ze,null,!0);var me;xr&&(me=_e.link(xr)),Le.oes_vertex_array_object&&Ze(_e.link(Le.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ne=0;Ne<It.maxAttributes;++Ne){var xe=Ze.def(At.attributes,"[",Ne,"]"),st=_e.cond(xe,".buffer");st.then(Ye,".enableVertexAttribArray(",Ne,");",Ye,".bindBuffer(",gf,",",xe,".buffer.buffer);",Ye,".vertexAttribPointer(",Ne,",",xe,".size,",xe,".type,",xe,".normalized,",xe,".stride,",xe,".offset);").else(Ye,".disableVertexAttribArray(",Ne,");",Ye,".vertexAttrib4f(",Ne,",",xe,".x,",xe,".y,",xe,".z,",xe,".w);",xe,".buffer=null;"),Ze(st),xr&&Ze(me,".vertexAttribDivisorANGLE(",Ne,",",xe,".divisor);")}return Ze(_e.shared.vao,".currentVAO=null;",_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"),Object.keys(Qt).forEach(function(mt){var fr=Qt[mt],Jt=ot.def(ke,".",mt),$t=_e.block();$t("if(",Jt,"){",Ye,".enable(",fr,")}else{",Ye,".disable(",fr,")}",tt,".",mt,"=",Jt,";"),Ze($t),ae("if(",Jt,"!==",tt,".",mt,"){",$t,"}")}),Object.keys(er).forEach(function(mt){var fr=er[mt],Jt=kr[mt],$t,en,Fr=_e.block();if(Fr(Ye,".",fr,"("),to(Jt)){var Tn=Jt.length;$t=_e.global.def(ke,".",mt),en=_e.global.def(tt,".",mt),Fr(je(Tn,function(fn){return $t+"["+fn+"]"}),");",je(Tn,function(fn){return en+"["+fn+"]="+$t+"["+fn+"];"}).join("")),ae("if(",je(Tn,function(fn){return $t+"["+fn+"]!=="+en+"["+fn+"]"}).join("||"),"){",Fr,"}")}else $t=ot.def(ke,".",mt),en=ot.def(tt,".",mt),Fr($t,");",tt,".",mt,"=",$t,";"),ae("if(",$t,"!==",en,"){",Fr,"}");Ze(Fr)}),_e.compile()}(),compile:Ui}}function Td(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var d0=34918,Md=34919,kp=35007,Qh=function(N,fe){if(!fe.ext_disjoint_timer_query)return null;var Le=[];function It(){return Le.pop()||fe.ext_disjoint_timer_query.createQueryEXT()}function rr(xr){Le.push(xr)}var Pt=[];function Kt(xr){var zr=It();fe.ext_disjoint_timer_query.beginQueryEXT(kp,zr),Pt.push(zr),yr(Pt.length-1,Pt.length,xr)}function cr(){fe.ext_disjoint_timer_query.endQueryEXT(kp)}function gr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var hr=[];function Er(){return hr.pop()||new gr}function Ar(xr){hr.push(xr)}var jr=[];function yr(xr,zr,lr){var kr=Er();kr.startQueryIndex=xr,kr.endQueryIndex=zr,kr.sum=0,kr.stats=lr,jr.push(kr)}var wr=[],it=[];function zt(){var xr,zr,lr=Pt.length;if(lr!==0){it.length=Math.max(it.length,lr+1),wr.length=Math.max(wr.length,lr+1),wr[0]=0,it[0]=0;var kr=0;for(xr=0,zr=0;zr<Pt.length;++zr){var Qr=Pt[zr];fe.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Md)?(kr+=fe.ext_disjoint_timer_query.getQueryObjectEXT(Qr,d0),rr(Qr)):Pt[xr++]=Qr,wr[zr+1]=kr,it[zr+1]=xr}for(Pt.length=xr,xr=0,zr=0;zr<jr.length;++zr){var Un=jr[zr],Qt=Un.startQueryIndex,er=Un.endQueryIndex;Un.sum+=wr[er]-wr[Qt];var xn=it[Qt],Xr=it[er];Xr===xn?(Un.stats.gpuTime+=Un.sum/1e6,Ar(Un)):(Un.startQueryIndex=xn,Un.endQueryIndex=Xr,jr[xr++]=Un)}jr.length=xr}}return{beginQuery:Kt,endQuery:cr,pushScopeStats:yr,update:zt,getNumPendingQueries:function(){return Pt.length},clear:function(){Le.push.apply(Le,Pt);for(var xr=0;xr<Le.length;xr++)fe.ext_disjoint_timer_query.deleteQueryEXT(Le[xr]);Pt.length=0,Le.length=0},restore:function(){Pt.length=0,Le.length=0}}},Pd=16384,bf=256,ph=1024,Jh=34962,ep="webglcontextlost",Pa="webglcontextrestored",Lp=1,Tu=2,Ef=3;function Ia(N,fe){for(var Le=0;Le<N.length;++Le)if(N[Le]===fe)return Le;return-1}function hc(N){var fe=he(N);if(!fe)return null;var Le=fe.gl,It=Le.getContextAttributes(),rr=Le.isContextLost(),Pt=Ae(Le,fe);if(!Pt)return null;var Kt=fs(),cr=Td(),gr=Pt.extensions,hr=Qh(Le,gr),Er=Na(),Ar=Le.drawingBufferWidth,jr=Le.drawingBufferHeight,yr={tick:0,time:0,viewportWidth:Ar,viewportHeight:jr,framebufferWidth:Ar,framebufferHeight:jr,drawingBufferWidth:Ar,drawingBufferHeight:jr,pixelRatio:fe.pixelRatio},wr={},it={elements:null,primitive:4,count:-1,offset:0,instances:-1},zt=Sn(Le,gr),xr=B(Le,cr,fe,kr),zr=al(Le,gr,xr,cr),lr=dt(Le,gr,zt,cr,xr,zr,it);function kr(ni){return lr.destroyBuffer(ni)}var Qr=Dr(Le,Kt,cr,fe),Un=Cs(Le,gr,zt,function(){xn.procs.poll()},yr,cr,fe),Qt=Wu(Le,gr,zt,cr,fe),er=Me(Le,gr,zt,Un,Qt,cr),xn=fh(Le,Kt,gr,zt,xr,zr,Un,er,wr,lr,Qr,it,yr,hr,fe),Xr=Vn(Le,er,xn.procs.poll,yr,It,gr,zt),Sr=xn.next,$r=Le.canvas,Jr=[],yi=[],ri=[],Gr=[fe.onDestroy],on=null;function Qn(){if(Jr.length===0){hr&&hr.update(),on=null;return}on=Mi.next(Qn),Ka();for(var ni=Jr.length-1;ni>=0;--ni){var Di=Jr[ni];Di&&Di(yr,null,0)}Le.flush(),hr&&hr.update()}function li(){!on&&Jr.length>0&&(on=Mi.next(Qn))}function zi(){on&&(Mi.cancel(Qn),on=null)}function io(ni){ni.preventDefault(),rr=!0,zi(),yi.forEach(function(Di){Di()})}function so(ni){Le.getError(),rr=!1,Pt.restore(),Qr.restore(),xr.restore(),Un.restore(),Qt.restore(),er.restore(),lr.restore(),hr&&hr.restore(),xn.procs.refresh(),li(),ri.forEach(function(Di){Di()})}var Fi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Fi&&$r&&($r.addEventListener(ep,io,!1),$r.addEventListener(Pa,so,!1));function ss(){Jr.length=0,zi(),!Fi&&$r&&($r.removeEventListener(ep,io),$r.removeEventListener(Pa,so)),Qr.clear(),er.clear(),Qt.clear(),lr.clear(),Un.clear(),zr.clear(),xr.clear(),hr&&hr.clear(),Gr.forEach(function(ni){ni()})}function Xa(ni){pe(!!ni,"invalid args to regl({...})"),pe.type(ni,"object","invalid args to regl({...})");function Di(Ye){var ke=m({},Ye);delete ke.uniforms,delete ke.attributes,delete ke.context,delete ke.vao,"stencil"in ke&&ke.stencil.op&&(ke.stencil.opBack=ke.stencil.opFront=ke.stencil.op,delete ke.stencil.op);function tt(me){if(me in ke){var Ne=ke[me];delete ke[me],Object.keys(Ne).forEach(function(xe){ke[me+"."+xe]=Ne[xe]})}}return tt("blend"),tt("depth"),tt("cull"),tt("stencil"),tt("polygonOffset"),tt("scissor"),tt("sample"),"vao"in Ye&&(ke.vao=Ye.vao),ke}function ua(Ye,ke){var tt={},me={};return Object.keys(Ye).forEach(function(Ne){var xe=Ye[Ne];if(An.isDynamic(xe)){me[Ne]=An.unbox(xe,Ne);return}else if(ke&&Array.isArray(xe)){for(var st=0;st<xe.length;++st)if(An.isDynamic(xe[st])){me[Ne]=An.unbox(xe,Ne);return}}tt[Ne]=xe}),{dynamic:me,static:tt}}var Co=ua(ni.context||{},!0),Al=ua(ni.uniforms||{},!0),Se=ua(ni.attributes||{},!1),Ft=ua(Di(ni),!1),vt={gpuTime:0,cpuTime:0,count:0},hn=xn.compile(Ft,Se,Al,Co,vt),Ui=hn.draw,_e=hn.batch,ae=hn.scope,Ze=[];function ot(Ye){for(;Ze.length<Ye;)Ze.push(null);return Ze}function At(Ye,ke){var tt;if(rr&&pe.raise("context lost"),typeof Ye=="function")return ae.call(this,null,Ye,0);if(typeof ke=="function")if(typeof Ye=="number")for(tt=0;tt<Ye;++tt)ae.call(this,null,ke,tt);else if(Array.isArray(Ye))for(tt=0;tt<Ye.length;++tt)ae.call(this,Ye[tt],ke,tt);else return ae.call(this,Ye,ke,0);else if(typeof Ye=="number"){if(Ye>0)return _e.call(this,ot(Ye|0),Ye|0)}else if(Array.isArray(Ye)){if(Ye.length)return _e.call(this,Ye,Ye.length)}else return Ui.call(this,Ye)}return m(At,{stats:vt,destroy:function(){hn.destroy()}})}var $o=er.setFBO=Xa({framebuffer:An.define.call(null,Lp,"framebuffer")});function vo(ni,Di){var ua=0;xn.procs.poll();var Co=Di.color;Co&&(Le.clearColor(+Co[0]||0,+Co[1]||0,+Co[2]||0,+Co[3]||0),ua|=Pd),"depth"in Di&&(Le.clearDepth(+Di.depth),ua|=bf),"stencil"in Di&&(Le.clearStencil(Di.stencil|0),ua|=ph),pe(!!ua,"called regl.clear with no buffer specified"),Le.clear(ua)}function Qo(ni){if(pe(typeof ni=="object"&&ni,"regl.clear() takes an object as input"),"framebuffer"in ni)if(ni.framebuffer&&ni.framebuffer_reglType==="framebufferCube")for(var Di=0;Di<6;++Di)$o(m({framebuffer:ni.framebuffer.faces[Di]},ni),vo);else $o(ni,vo);else vo(null,ni)}function Uo(ni){pe.type(ni,"function","regl.frame() callback must be a function"),Jr.push(ni);function Di(){var ua=Ia(Jr,ni);pe(ua>=0,"cannot cancel a frame twice");function Co(){var Al=Ia(Jr,Co);Jr[Al]=Jr[Jr.length-1],Jr.length-=1,Jr.length<=0&&zi()}Jr[ua]=Co}return li(),{cancel:Di}}function gs(){var ni=Sr.viewport,Di=Sr.scissor_box;ni[0]=ni[1]=Di[0]=Di[1]=0,yr.viewportWidth=yr.framebufferWidth=yr.drawingBufferWidth=ni[2]=Di[2]=Le.drawingBufferWidth,yr.viewportHeight=yr.framebufferHeight=yr.drawingBufferHeight=ni[3]=Di[3]=Le.drawingBufferHeight}function Ka(){yr.tick+=1,yr.time=Zo(),gs(),xn.procs.poll()}function _i(){Un.refresh(),gs(),xn.procs.refresh(),hr&&hr.update()}function Zo(){return(Na()-Er)/1e3}_i();function ta(ni,Di){pe.type(Di,"function","listener callback must be a function");var ua;switch(ni){case"frame":return Uo(Di);case"lost":ua=yi;break;case"restore":ua=ri;break;case"destroy":ua=Gr;break;default:pe.raise("invalid event, must be one of frame,lost,restore,destroy")}return ua.push(Di),{cancel:function(){for(var Co=0;Co<ua.length;++Co)if(ua[Co]===Di){ua[Co]=ua[ua.length-1],ua.pop();return}}}}var Jo=m(Xa,{clear:Qo,prop:An.define.bind(null,Lp),context:An.define.bind(null,Tu),this:An.define.bind(null,Ef),draw:Xa({}),buffer:function(ni){return xr.create(ni,Jh,!1,!1)},elements:function(ni){return zr.create(ni,!1)},texture:Un.create2D,cube:Un.createCube,renderbuffer:Qt.create,framebuffer:er.create,framebufferCube:er.createCube,vao:lr.createVAO,attributes:It,frame:Uo,on:ta,limits:zt,hasExtension:function(ni){return zt.extensions.indexOf(ni.toLowerCase())>=0},read:Xr,destroy:ss,_gl:Le,_refresh:_i,poll:function(){Ka(),hr&&hr.update()},now:Zo,stats:cr});return fe.onDone(null,Jo),Jo}return hc})},49029:function(Cr){var oe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Q(Pe){return Pe.match(oe)||[]}Cr.exports=Q},29750:function(Cr){function oe(Q,Pe,De){return Q===Q&&(De!==void 0&&(Q=Q<=De?Q:De),Pe!==void 0&&(Q=Q>=Pe?Q:Pe)),Q}Cr.exports=oe},18674:function(Cr){function oe(Q){return function(Pe){return Q==null?void 0:Q[Pe]}}Cr.exports=oe},98805:function(Cr,oe,Q){var Pe=Q(40180),De=Q(62689),m=Q(83140),Ie=Q(79833);function X(de){return function(ce){ce=Ie(ce);var ze=De(ce)?m(ce):void 0,ge=ze?ze[0]:ce.charAt(0),nt=ze?Pe(ze,1).join(""):ce.slice(1);return ge[de]()+nt}}Cr.exports=X},35393:function(Cr,oe,Q){var Pe=Q(62663),De=Q(53816),m=Q(58748),Ie="['\u2019]",X=RegExp(Ie,"g");function de(ce){return function(ze){return Pe(m(De(ze).replace(X,"")),ce,"")}}Cr.exports=de},69389:function(Cr,oe,Q){var Pe=Q(18674),De={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=Pe(De);Cr.exports=m},93157:function(Cr){var oe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Q(Pe){return oe.test(Pe)}Cr.exports=Q},2757:function(Cr){var oe="\\ud800-\\udfff",Q="\\u0300-\\u036f",Pe="\\ufe20-\\ufe2f",De="\\u20d0-\\u20ff",m=Q+Pe+De,Ie="\\u2700-\\u27bf",X="a-z\\xdf-\\xf6\\xf8-\\xff",de="\\xac\\xb1\\xd7\\xf7",ce="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ze="\\u2000-\\u206f",ge=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nt="A-Z\\xc0-\\xd6\\xd8-\\xde",ct="\\ufe0e\\ufe0f",Et=de+ce+ze+ge,ar="['\u2019]",dr="["+Et+"]",kt="["+m+"]",nr="\\d+",Ut="["+Ie+"]",ht="["+X+"]",St="[^"+oe+Et+nr+Ie+X+nt+"]",or="\\ud83c[\\udffb-\\udfff]",q="(?:"+kt+"|"+or+")",Gt="[^"+oe+"]",He="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="["+nt+"]",et="\\u200d",qt="(?:"+ht+"|"+St+")",Tr="(?:"+bt+"|"+St+")",Br="(?:"+ar+"(?:d|ll|m|re|s|t|ve))?",rn="(?:"+ar+"(?:D|LL|M|RE|S|T|VE))?",Ee=q+"?",We="["+ct+"]?",Re="(?:"+et+"(?:"+[Gt,He,$e].join("|")+")"+We+Ee+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ft="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=We+Ee+Re,Ht="(?:"+[Ut,He,$e].join("|")+")"+Lt,Mr=RegExp([bt+"?"+ht+"+"+Br+"(?="+[dr,bt,"$"].join("|")+")",Tr+"+"+rn+"(?="+[dr,bt+qt,"$"].join("|")+")",bt+"?"+qt+"+"+Br,bt+"+"+rn,ft,_t,nr,Ht].join("|"),"g");function Kn(Wr){return Wr.match(Mr)||[]}Cr.exports=Kn},68929:function(Cr,oe,Q){var Pe=Q(48403),De=Q(35393),m=De(function(Ie,X,de){return X=X.toLowerCase(),Ie+(de?Pe(X):X)});Cr.exports=m},48403:function(Cr,oe,Q){var Pe=Q(79833),De=Q(11700);function m(Ie){return De(Pe(Ie).toLowerCase())}Cr.exports=m},74691:function(Cr,oe,Q){var Pe=Q(29750),De=Q(14841);function m(Ie,X,de){return de===void 0&&(de=X,X=void 0),de!==void 0&&(de=De(de),de=de===de?de:0),X!==void 0&&(X=De(X),X=X===X?X:0),Pe(De(Ie),X,de)}Cr.exports=m},53816:function(Cr,oe,Q){var Pe=Q(69389),De=Q(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ie="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",de="\\u20d0-\\u20ff",ce=Ie+X+de,ze="["+ce+"]",ge=RegExp(ze,"g");function nt(ct){return ct=De(ct),ct&&ct.replace(m,Pe).replace(ge,"")}Cr.exports=nt},14293:function(Cr){function oe(Q){return Q==null}Cr.exports=oe},81763:function(Cr,oe,Q){var Pe=Q(44239),De=Q(37005),m="[object Number]";function Ie(X){return typeof X=="number"||De(X)&&Pe(X)==m}Cr.exports=Ie},30236:function(Cr,oe,Q){var Pe=Q(42980),De=Q(21463),m=De(function(Ie,X,de,ce){Pe(Ie,X,de,ce)});Cr.exports=m},44908:function(Cr,oe,Q){var Pe=Q(45652);function De(m){return m&&m.length?Pe(m):[]}Cr.exports=De},11700:function(Cr,oe,Q){var Pe=Q(98805),De=Pe("toUpperCase");Cr.exports=De},58748:function(Cr,oe,Q){var Pe=Q(49029),De=Q(93157),m=Q(79833),Ie=Q(2757);function X(de,ce,ze){return de=m(de),ce=ze?void 0:ce,ce===void 0?De(de)?Ie(de):Pe(de):de.match(ce)||[]}Cr.exports=X},6158:function(Cr){(function(oe,Q){Cr.exports=Q()})(this,function(){"use strict";var oe,Q,Pe;function De(m,Ie){if(!oe)oe=Ie;else if(!Q)Q=Ie;else{var X="var sharedChunk = {}; ("+oe+")(sharedChunk); ("+Q+")(sharedChunk);",de={};oe(de),Pe=Ie(de),typeof window!="undefined"&&(Pe.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}return De(["exports"],function(m){"use strict";function Ie(t,o){return t(o={exports:{}},o.exports),o.exports}var X=de;function de(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}de.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},de.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},de.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},de.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var P=this.sampleCurveDerivativeX(y);if(Math.abs(P)<1e-6)break;y-=b/P}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},de.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ce=ze;function ze(t,o){this.x=t,this.y=o}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(t){return t instanceof ze?t:Array.isArray(t)?new ze(t[0],t[1]):t};var ge=typeof self!="undefined"?self:{},nt=Math.pow(2,53)-1;function ct(t,o,u,h){var y=new X(t,o,u,h);return function(b){return y.solve(b)}}var Et=ct(.25,.1,.25,1);function ar(t,o,u){return Math.min(u,Math.max(o,t))}function dr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function kt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var nr=1;function Ut(){return nr++}function ht(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function St(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function or(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function q(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Gt(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function He(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function $e(t){return Array.isArray(t)?t.map($e):typeof t=="object"&&t?Gt(t,$e):t}var bt={};function et(t){bt[t]||(typeof console!="undefined"&&console.warn(t),bt[t]=!0)}function qt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Tr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Br(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rn(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var P=b||S;return o[y]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Ee=null;function We(t){if(Ee==null){var o=t.navigator?t.navigator.userAgent:null;Ee=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ee}function Re(t){try{var o=ge[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var _t,ft,Lt,Ht,Mr=ge.performance&&ge.performance.now?ge.performance.now.bind(ge.performance):Date.now.bind(Date),Kn=ge.requestAnimationFrame||ge.mozRequestAnimationFrame||ge.webkitRequestAnimationFrame||ge.msRequestAnimationFrame,Wr=ge.cancelAnimationFrame||ge.mozCancelAnimationFrame||ge.webkitCancelAnimationFrame||ge.msCancelAnimationFrame,na={now:Mr,frame:function(t){var o=Kn(t);return{cancel:function(){return Wr(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ge.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return _t||(_t=ge.document.createElement("a")),_t.href=t,_t.href},hardwareConcurrency:ge.navigator&&ge.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(ft==null&&(ft=ge.matchMedia("(prefers-reduced-motion: reduce)")),ft.matches)}},Yn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ai={supported:!1,testSupport:function(t){!oi&&Ht&&(ci?gi(t):Lt=t)}},oi=!1,ci=!1;function gi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ht),t.isContextLost())return;ai.supported=!0}catch(u){}t.deleteTexture(o),oi=!0}ge.document&&((Ht=ge.document.createElement("img")).onload=function(){Lt&&gi(Lt),Lt=null,ci=!0},Ht.onerror=function(){oi=!0,Lt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var xa="01",qi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Gi(t){return t.indexOf("mapbox:")===0}qi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},qi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},qi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},qi.prototype.normalizeStyleURL=function(t,o){if(!Gi(t))return t;var u=sn(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},qi.prototype.normalizeGlyphsURL=function(t,o){if(!Gi(t))return t;var u=sn(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},qi.prototype.normalizeSourceURL=function(t,o){if(!Gi(t))return t;var u=sn(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},qi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=sn(t);return Gi(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,Ea(y))},qi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Gi(t))return t;var u=sn(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(na.devicePixelRatio>=2||o===512?"@2x":"")+(ai.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var P=S[b].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||Yn.ACCESS_TOKEN;return Yn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},qi.prototype.canonicalizeTileURL=function(t,o){var u=sn(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},qi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Gi(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];ba(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},qi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=sn(Yn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Yn.REQUIRE_ACCESS_TOKEN)return Ea(t);if(!(o=o||Yn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),Ea(t)};var ia=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ba(t){return ia.test(t)}var R=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function sn(t){var o=t.match(R);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Ea(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Bi(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ge.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var aa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};aa.prototype.getStorageKey=function(t){var o,u=Bi(Yn.ACCESS_TOKEN);return o=u&&u.u?ge.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):Yn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},aa.prototype.fetchEventData=function(){var t=Re("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ge.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=ge.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){et("Unable to read from LocalStorage")}},aa.prototype.saveEventData=function(){var t=Re("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ge.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){et("Unable to write to LocalStorage")}},aa.prototype.processRequests=function(t){},aa.prototype.postEvent=function(t,o,u,h){var y=this;if(Yn.EVENTS_URL){var b=sn(Yn.EVENTS_URL);b.params.push("access_token="+(h||Yn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:xa,userId:this.anonId},P=o?kt(S,o):S,L={url:Ea(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Sa(L,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},aa.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Qi,cs,pe=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(Yn.EVENTS_URL&&b||Yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Gi(S)||ba(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),St(this.anonId)||(this.anonId=ht()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||b&&(h.success[b]=!0)},u))}},o}(aa),fi=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Yn.EVENTS_URL&&Yn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Gi(y)||ba(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Bi(Yn.ACCESS_TOKEN),b=y?y.u:Yn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;St(this.anonId)||(this.anonId=ht(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),z=new Date(P),Z=(P-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||L.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(G){G||(h.eventData.lastSuccess=P,h.eventData.tokenU=b)},u)}},o}(aa)),lo=fi.postTurnstileEvent.bind(fi),Va=new pe,Bt=Va.postMapLoadEvent.bind(Va),tr=500,Or=50;function Vr(){ge.caches&&!Qi&&(Qi=ge.caches.open("mapbox-tiles"))}function Ln(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var zn,bi=1/0;function pi(){return zn==null&&(zn=ge.OffscreenCanvas&&new ge.OffscreenCanvas(1,1).getContext("2d")&&typeof ge.createImageBitmap=="function"),zn}var An={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(An);var Mi=function(t){function o(u,h,y){h===401&&ba(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Li=Br()?function(){return self.worker&&self.worker.referrer}:function(){return(ge.location.protocol==="blob:"?ge.parent:ge).location.href},Na,fs,Lo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Li())&&!/^\w+:/.test(u))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new ge.AbortController,P=new ge.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Li(),signal:S.signal}),L=!1,z=!1,Z=(b=P.url).indexOf("sku=")>0&&ba(b);h.type==="json"&&P.headers.set("Accept","application/json");var G=function(ne,Ce,Te){if(!z){if(ne&&ne.message!=="SecurityError"&&et(ne),Ce&&Te)return J(Ce);var Xe=Date.now();ge.fetch(P).then(function(Be){if(Be.ok){var at=Z?Be.clone():null;return J(Be,at,Xe)}return y(new Mi(Be.statusText,Be.status,h.url))}).catch(function(Be){Be.code!==20&&y(new Error(Be.message))})}},J=function(ne,Ce,Te){(h.type==="arrayBuffer"?ne.arrayBuffer():h.type==="json"?ne.json():ne.text()).then(function(Xe){z||(Ce&&Te&&function(Be,at,gt){if(Vr(),Qi){var Rt={status:at.status,statusText:at.statusText,headers:new ge.Headers};at.headers.forEach(function(ir,Pr){return Rt.headers.set(Pr,ir)});var wt=rn(at.headers.get("Cache-Control")||"");wt["no-store"]||(wt["max-age"]&&Rt.headers.set("Expires",new Date(gt+1e3*wt["max-age"]).toUTCString()),new Date(Rt.headers.get("Expires")).getTime()-gt<42e4||function(ir,Pr){if(cs===void 0)try{new Response(new ReadableStream),cs=!0}catch(Hr){cs=!1}cs?Pr(ir.body):ir.blob().then(Pr)}(at,function(ir){var Pr=new ge.Response(ir,Rt);Vr(),Qi&&Qi.then(function(Hr){return Hr.put(Ln(Be.url),Pr)}).catch(function(Hr){return et(Hr.message)})}))}}(P,Ce,Te),L=!0,y(null,Xe,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(function(Xe){z||y(new Error(Xe.message))})};return Z?function(ne,Ce){if(Vr(),!Qi)return Ce(null);var Te=Ln(ne.url);Qi.then(function(Xe){Xe.match(Te).then(function(Be){var at=function(gt){if(!gt)return!1;var Rt=new Date(gt.headers.get("Expires")||0),wt=rn(gt.headers.get("Cache-Control")||"");return Rt>Date.now()&&!wt["no-cache"]}(Be);Xe.delete(Te),at&&Xe.put(Te,Be.clone()),Ce(null,Be,at)}).catch(Ce)}).catch(Ce)}(P,G):G(null,null),{cancel:function(){z=!0,L||S.abort()}}}(t,o);if(Br()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new ge.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var P=b.response;if(h.type==="json")try{P=JSON.parse(b.response)}catch(L){return y(L)}y(null,P,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Mi(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},ka=function(t,o){return Lo(kt(t,{type:"arrayBuffer"}),o)},Sa=function(t,o){return Lo(kt(t,{method:"POST"}),o)},W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Na=[],fs=0;var $=function(t,o){if(ai.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),fs>=Yn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Na.push(u),u}fs++;var h=!1,y=function(){if(!h)for(h=!0,fs--;Na.length&&fs<Yn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Na.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=ka(t,function(S,P,L,z){y(),S?o(S):P&&(pi()?function(Z,G){var J=new ge.Blob([new Uint8Array(Z)],{type:"image/png"});ge.createImageBitmap(J).then(function(ne){G(null,ne)}).catch(function(ne){G(new Error("Could not load image because of "+ne.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(Z,G,J,ne){var Ce=new ge.Image,Te=ge.URL;Ce.onload=function(){G(null,Ce),Te.revokeObjectURL(Ce.src),Ce.onload=null,ge.requestAnimationFrame(function(){Ce.src=W})},Ce.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Xe=new ge.Blob([new Uint8Array(Z)],{type:"image/png"});Ce.cacheControl=J,Ce.expires=ne,Ce.src=Z.byteLength?Te.createObjectURL(Xe):W}(P,o,L,z))});return{cancel:function(){b.cancel(),y()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function he(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Ae=function(t,o){o===void 0&&(o={}),kt(this,o),this.type=t},je=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",kt({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ae),Je=function(){};Je.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},Je.prototype.off=function(t,o){return he(t,o,this._listeners),he(t,o,this._oneTimeListeners),this},Je.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},Je.prototype.fire=function(t,o){typeof t=="string"&&(t=new Ae(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var P=S[b];he(u,P,this._oneTimeListeners),P.call(this,t)}var L=this._eventedParent;L&&(kt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(t))}else t instanceof je&&console.error(t.error);return this},Je.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Je.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Oe=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function pt(t){var o=t.value;return o?[new Oe(t.key,o,"constants have been deprecated as of v8")]:[]}function pr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Dt(t[u]);return o}return Ot(t)}var mr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var cn={kind:"null"},Ct={kind:"number"},un={kind:"string"},Zr={kind:"boolean"},Yr={kind:"color"},vi={kind:"object"},qr={kind:"value"},wi={kind:"collator"},oa={kind:"formatted"},Ei={kind:"resolvedImage"};function Ti(t,o){return{kind:"array",itemType:t,N:o}}function Si(t){if(t.kind==="array"){var o=Si(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ei=[cn,Ct,un,Zr,Yr,oa,vi,Ti(qr),Ei];function ji(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!ji(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=ei;u<h.length;u+=1)if(!ji(h[u],o))return null}}return"Expected "+Si(t)+" but found "+Si(o)+" instead."}function La(t,o){return o.some(function(u){return u.kind===t.kind})}function Hi(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Pi=Ie(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(P){return(P=Math.round(P))<0?0:P>255?255:P}function y(P){return h(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function b(P){return(L=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:L>1?1:L;var L}function S(P,L,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?P+(L-P)*z*6:2*z<1?L:3*z<2?P+(L-P)*(2/3-z)*6:P}try{o.parseCSSColor=function(P){var L,z=P.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(L=parseInt(z.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:z.length===7&&(L=parseInt(z.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var Z=z.indexOf("("),G=z.indexOf(")");if(Z!==-1&&G+1===z.length){var J=z.substr(0,Z),ne=z.substr(Z+1,G-(Z+1)).split(","),Ce=1;switch(J){case"rgba":if(ne.length!==4)return null;Ce=b(ne.pop());case"rgb":return ne.length!==3?null:[y(ne[0]),y(ne[1]),y(ne[2]),Ce];case"hsla":if(ne.length!==4)return null;Ce=b(ne.pop());case"hsl":if(ne.length!==3)return null;var Te=(parseFloat(ne[0])%360+360)%360/360,Xe=b(ne[1]),Be=b(ne[2]),at=Be<=.5?Be*(Xe+1):Be+Xe-Be*Xe,gt=2*Be-at;return[h(255*S(gt,at,Te+1/3)),h(255*S(gt,at,Te)),h(255*S(gt,at,Te-1/3)),Ce];default:return null}}return null}}catch(P){}}).parseCSSColor,Ni=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Ni.parse=function(t){if(t){if(t instanceof Ni)return t;if(typeof t=="string"){var o=Pi(t);if(o)return new Ni(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Ni.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Ni.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1);var Da=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Da.prototype.compare=function(t,o){return this.collator.compare(t,o)},Da.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Js=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},za=function(t){this.sections=t};za.fromString=function(t){return new za([new Js(t,null,null,null,null)])},za.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},za.factory=function(t){return t instanceof za?t:za.fromString(t)},za.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},za.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var Ca=function(t){this.name=t.name,this.available=t.available};function Ps(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Vo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ni||t instanceof Da||t instanceof za||t instanceof Ca)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Vo(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Vo(t[h]))return!1;return!0}return!1}function Ji(t){if(t===null)return cn;if(typeof t=="string")return un;if(typeof t=="boolean")return Zr;if(typeof t=="number")return Ct;if(t instanceof Ni)return Yr;if(t instanceof Da)return wi;if(t instanceof za)return oa;if(t instanceof Ca)return Ei;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=Ji(y[h]);if(o){if(o===b)continue;o=qr;break}o=b}return Ti(o||qr,u)}return vi}function Pu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Ni||t instanceof za||t instanceof Ca?t.toString():JSON.stringify(t)}Ca.prototype.toString=function(){return this.name},Ca.fromString=function(t){return t?new Ca({name:t,available:!1}):null},Ca.prototype.serialize=function(){return["image",this.name]};var co=function(t,o){this.type=t,this.value=o};co.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Vo(t[1]))return o.error("invalid value");var u=t[1],h=Ji(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new co(h,u)},co.prototype.evaluate=function(){return this.value},co.prototype.eachChild=function(){},co.prototype.outputDefined=function(){return!0},co.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof za?this.value.serialize():this.value};var Ga=function(t){this.name="ExpressionEvaluationError",this.message=t};Ga.prototype.toJSON=function(){return this.message};var $n={string:un,number:Ct,boolean:Zr,object:vi},Wi=function(t,o){this.type=t,this.args=o};Wi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in $n)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=$n[P],h++}else b=qr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Ti(b,S)}else u=$n[y];for(var L=[];h<t.length;h++){var z=o.parse(t[h],h,qr);if(!z)return null;L.push(z)}return new Wi(u,L)},Wi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!ji(this.type,Ji(u)))return u;if(o===this.args.length-1)throw new Ga("Expected value to be of type "+Si(this.type)+", but found "+Si(Ji(u))+" instead.")}return null},Wi.prototype.eachChild=function(t){this.args.forEach(t)},Wi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Wi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var bo=function(t){this.type=oa,this.sections=t};bo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,Ct)))return null;var L=null;if(S["text-font"]&&!(L=o.parse(S["text-font"],1,Ti(un))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Yr)))return null;var Z=h[h.length-1];Z.scale=P,Z.font=L,Z.textColor=z}else{var G=o.parse(t[b],1,qr);if(!G)return null;var J=G.type.kind;if(J!=="string"&&J!=="value"&&J!=="null"&&J!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:G,scale:null,font:null,textColor:null})}}return new bo(h)},bo.prototype.evaluate=function(t){return new za(this.sections.map(function(o){var u=o.content.evaluate(t);return Ji(u)===Ei?new Js("",u,null,null,null):new Js(Pu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},bo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Go=function(t){this.type=Ei,this.input=t};Go.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,un);return u?new Go(u):o.error("No image name provided.")},Go.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Ca.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Go.prototype.eachChild=function(t){t(this.input)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){return["image",this.input.serialize()]};var vu={"to-boolean":Zr,"to-color":Yr,"to-number":Ct,"to-string":un},Vt=function(t,o){this.type=t,this.args=o};Vt.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=vu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,qr);if(!S)return null;y.push(S)}return new Vt(h,y)},Vt.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Ni)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Ps(o[0],o[1],o[2],o[3])))return new Ni(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ga(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,L=this.args;P<L.length;P+=1){if((S=L[P].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ga("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?za.fromString(Pu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ca.fromString(Pu(this.args[0].evaluate(t))):Pu(this.args[0].evaluate(t))},Vt.prototype.eachChild=function(t){this.args.forEach(t)},Vt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Vt.prototype.serialize=function(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Go(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Wt=["Unknown","Point","LineString","Polygon"],fa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Wt[this.feature.type]:this.feature.type:null},fa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fa.prototype.canonicalID=function(){return this.canonical},fa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Ni.parse(t)),o};var pa=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};pa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},pa.prototype.eachChild=function(t){this.args.forEach(t)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},pa.parse=function(t,o){var u,h=t[0],y=pa.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=S.filter(function(Hn){var dn=Hn[0];return!Array.isArray(dn)||dn.length===t.length-1}),L=null,z=0,Z=P;z<Z.length;z+=1){var G=Z[z],J=G[0],ne=G[1];L=new Is(o.registry,o.path,null,o.scope);for(var Ce=[],Te=!1,Xe=1;Xe<t.length;Xe++){var Be=t[Xe],at=Array.isArray(J)?J[Xe-1]:J.type,gt=L.parse(Be,1+Ce.length,at);if(!gt){Te=!0;break}Ce.push(gt)}if(!Te)if(Array.isArray(J)&&J.length!==Ce.length)L.error("Expected "+J.length+" arguments, but found "+Ce.length+" instead.");else{for(var Rt=0;Rt<Ce.length;Rt++){var wt=Array.isArray(J)?J[Rt]:J.type,ir=Ce[Rt];L.concat(Rt+1).checkSubtype(wt,ir.type)}if(L.errors.length===0)return new pa(h,b,ne,Ce)}}if(P.length===1)(u=o.errors).push.apply(u,L.errors);else{for(var Pr=(P.length?P:S).map(function(Hn){var dn;return dn=Hn[0],Array.isArray(dn)?"("+dn.map(Si).join(", ")+")":"("+Si(dn.type)+"...)"}).join(" | "),Hr=[],Bn=1;Bn<t.length;Bn++){var pn=o.parse(t[Bn],1+Hr.length);if(!pn)return null;Hr.push(Si(pn.type))}o.error("Expected arguments of type "+Pr+", but found ("+Hr.join(", ")+") instead.")}return null},pa.register=function(t,o){for(var u in pa.definitions=o,o)t[u]=pa};var ns=function(t,o,u){this.type=wi,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function ao(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function ln(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Sn(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function Tt(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function te(t,o){for(var u,h,y,b,S,P,L,z=!1,Z=0,G=o.length;Z<G;Z++)for(var J=o[Z],ne=0,Ce=J.length;ne<Ce-1;ne++){if((b=(u=t)[0]-(h=J[ne])[0])*(L=u[1]-(y=J[ne+1])[1])-(P=u[0]-y[0])*(S=u[1]-h[1])==0&&b*P<=0&&S*L<=0)return!1;Tt(t,J[ne],J[ne+1])&&(z=!z)}return z}function D(t,o){for(var u=0;u<o.length;u++)if(te(t,o[u]))return!0;return!1}function Ke(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),P=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function Mt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((G=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(J=[(L=o)[0]-(P=t)[0],L[1]-P[1]])[1]-G[1]*J[0]!=0&&Ke(P,L,z,Z)&&Ke(z,Z,P,L))return!0;var P,L,z,Z,G,J;return!1}function Rr(t,o){for(var u=0;u<t.length;++u)if(!te(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Mt(t[h],t[h+1],o))return!1;return!0}function Mn(t,o){for(var u=0;u<o.length;u++)if(Rr(t,o[u]))return!0;return!1}function Ci(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var P=Sn(t[y][S],u);ao(o,P),b.push(P)}h.push(b)}return h}function eo(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Ci(t[y],o,u);h.push(b)}return h}function Fa(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}ao(o,t)}function Ua(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],P=0,L=t;P<L.length;P+=1)for(var z=0,Z=L[P];z<Z.length;z+=1){var G=Z[z],J=[G.x+b[0],G.y+b[1]];Fa(J,o,u,y),S.push(J)}return S}function Ho(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],P=[],L=0,z=t;L<z.length;L+=1){for(var Z=[],G=0,J=z[L];G<J.length;G+=1){var ne=J[G],Ce=[ne.x+S[0],ne.y+S[1]];ao(o,Ce),Z.push(Ce)}P.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Te=0,Xe=P;Te<Xe.length;Te+=1)for(var Be=0,at=Xe[Te];Be<at.length;Be+=1)Fa(at[Be],o,u,b)}return P}ns.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zr);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,un))?null:new ns(h,y,b)},ns.prototype.evaluate=function(t){return new Da(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ns.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ns.prototype.outputDefined=function(){return!1},ns.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var _s=function(t,o){this.type=Zr,this.geojson=t,this.geometries=o};function Do(t){if(t instanceof pa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof _s)return!1;var o=!0;return t.eachChild(function(u){o&&!Do(u)&&(o=!1)}),o}function xs(t){if(t instanceof pa&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!xs(u)&&(o=!1)}),o}function is(t,o){if(t instanceof pa&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!is(h,o)&&(u=!1)}),u}_s.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Vo(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new _s(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new _s(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new _s(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},_s.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ci(u.coordinates,y,b),P=Ua(o.geometry(),h,y,b);if(!ln(h,y))return!1;for(var L=0,z=P;L<z.length;L+=1)if(!te(z[L],S))return!1}if(u.type==="MultiPolygon"){var Z=eo(u.coordinates,y,b),G=Ua(o.geometry(),h,y,b);if(!ln(h,y))return!1;for(var J=0,ne=G;J<ne.length;J+=1)if(!D(ne[J],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ci(u.coordinates,y,b),P=Ho(o.geometry(),h,y,b);if(!ln(h,y))return!1;for(var L=0,z=P;L<z.length;L+=1)if(!Rr(z[L],S))return!1}if(u.type==="MultiPolygon"){var Z=eo(u.coordinates,y,b),G=Ho(o.geometry(),h,y,b);if(!ln(h,y))return!1;for(var J=0,ne=G;J<ne.length;J+=1)if(!Mn(ne[J],Z))return!1}return!0}(t,this.geometries)}return!1},_s.prototype.eachChild=function(){},_s.prototype.outputDefined=function(){return!0},_s.prototype.serialize=function(){return["within",this.geojson]};var ps=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};ps.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new ps(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},ps.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ps.prototype.eachChild=function(){},ps.prototype.outputDefined=function(){return!1},ps.prototype.serialize=function(){return["var",this.name]};var Is=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new _n),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function Hs(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ga("Input is not a number.");b=S-1}return 0}Is.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Is.prototype._parse=function(t,o){function u(z,Z,G){return G==="assert"?new Wi(Z,[z]):G==="coerce"?new Vt(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof co)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof ps)return z(Z.boundExpression);if(Z instanceof pa&&Z.name==="error"||Z instanceof ns||Z instanceof _s)return!1;var G=Z instanceof Vt||Z instanceof Wi,J=!0;return Z.eachChild(function(ne){J=G?J&&z(ne):J&&ne instanceof co}),!!J&&Do(Z)&&is(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var L=new fa;try{b=new co(b.type,b.evaluate(L))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Is.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Is(this.registry,h,o||null,y,this.errors)},Is.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new mr(h,t))},Is.prototype.checkSubtype=function(t,o){var u=ji(t,o);return u&&this.error(u),u};var Wo=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function da(t,o,u){return t*(1-u)+o*u}Wo.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Ct);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],P=t[b+1],L=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var Z=o.parse(P,z,y);if(!Z)return null;y=y||Z.type,h.push([S,Z])}return new Wo(y,u,h)},Wo.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[Hs(o,h)].evaluate(t)},Wo.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},Wo.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Wo.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var Eo=Object.freeze({__proto__:null,number:da,color:function(t,o,u){return new Ni(da(t.r,o.r,u),da(t.g,o.g,u),da(t.b,o.b,u),da(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return da(h,o[y],u)})}}),Iu=6/29*3*(6/29),rl=Math.PI/180,mu=180/Math.PI;function ic(t){return t>.008856451679035631?Math.pow(t,1/3):t/Iu+4/29}function nl(t){return t>6/29?t*t*t:Iu*(t-4/29)}function il(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function uu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Il(t){var o=uu(t.r),u=uu(t.g),h=uu(t.b),y=ic((.4124564*o+.3575761*u+.1804375*h)/.95047),b=ic((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-ic((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*nl(o),u=.95047*nl(u),h=1.08883*nl(h),new Ni(il(3.2404542*u-1.5371385*o-.4985314*h),il(-.969266*u+1.8760108*o+.041556*h),il(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function T(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:Il,reverse:_,interpolate:function(t,o,u){return{l:da(t.l,o.l,u),a:da(t.a,o.a,u),b:da(t.b,o.b,u),alpha:da(t.alpha,o.alpha,u)}}},I={forward:function(t){var o=Il(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*mu;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*rl,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:da(t.c,o.c,u),l:da(t.l,o.l,u),alpha:da(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:B,hcl:I}),ve=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var P=S[b],L=P[1];this.labels.push(P[0]),this.outputs.push(L)}};function Ge(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}ve.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=Ge(o,t.base,u,h);else if(t.name==="linear")y=Ge(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new X(b[0],b[1],b[2],b[3]).solve(Ge(o,1,u,h))}return y},ve.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var P=h.slice(1);if(P.length!==4||P.some(function(Xe){return typeof Xe!="number"||Xe<0||Xe>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Ct)))return null;var L=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Yr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var G=b[Z],J=b[Z+1],ne=Z+3,Ce=Z+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(L.length&&L[L.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);var Te=o.parse(J,Ce,z);if(!Te)return null;z=z||Te.type,L.push([G,Te])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new ve(z,u,h,y,L):o.error("Type "+Si(z)+" is not interpolatable.")},ve.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=Hs(o,h),S=ve.interpolationFactor(this.interpolation,h,o[b],o[b+1]),P=u[b].evaluate(t),L=u[b+1].evaluate(t);return this.operator==="interpolate"?Eo[this.type.kind.toLowerCase()](P,L,S):this.operator==="interpolate-hcl"?I.reverse(I.interpolate(I.forward(P),I.forward(L),S)):B.reverse(B.interpolate(B.forward(P),B.forward(L),S))},ve.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ve.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ve.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ut=function(t,o){this.type=t,this.args=o};ut.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var P=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,y.push(P)}var L=h&&y.some(function(z){return ji(h,z.type)});return new ut(L?qr:u,y)},ut.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof Ca&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ut.prototype.eachChild=function(t){this.args.forEach(t)},ut.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ut.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var lt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};lt.prototype.evaluate=function(t){return this.result.evaluate(t)},lt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},lt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new lt(u,S):null},lt.prototype.outputDefined=function(){return this.result.outputDefined()},lt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var sr=function(t,o,u){this.type=t,this.index=o,this.input=u};sr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Ct),h=o.parse(t[2],2,Ti(o.expectedType||qr));return u&&h?new sr(h.type.itemType,u,h):null},sr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ga("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ga("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ga("Array index must be an integer, but found "+o+" instead.");return u[o]},sr.prototype.eachChild=function(t){t(this.index),t(this.input)},sr.prototype.outputDefined=function(){return!1},sr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var _r=function(t,o){this.type=Zr,this.needle=t,this.haystack=o};_r.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,qr),h=o.parse(t[2],2,qr);return u&&h?La(u.type,[Zr,un,Ct,cn,qr])?new _r(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(u.type)+" instead"):null},_r.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Hi(o,["boolean","string","number","null"]))throw new Ga("Expected first argument to be of type boolean, string, number or null, but found "+Si(Ji(o))+" instead.");if(!Hi(u,["string","array"]))throw new Ga("Expected second argument to be of type array or string, but found "+Si(Ji(u))+" instead.");return u.indexOf(o)>=0},_r.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},_r.prototype.outputDefined=function(){return!0},_r.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Rn=function(t,o,u){this.type=Ct,this.needle=t,this.haystack=o,this.fromIndex=u};Rn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,qr),h=o.parse(t[2],2,qr);if(!u||!h)return null;if(!La(u.type,[Zr,un,Ct,cn,qr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ct);return y?new Rn(u,h,y):null}return new Rn(u,h)},Rn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Hi(o,["boolean","string","number","null"]))throw new Ga("Expected first argument to be of type boolean, string, number or null, but found "+Si(Ji(o))+" instead.");if(!Hi(u,["string","array"]))throw new Ga("Expected second argument to be of type array or string, but found "+Si(Ji(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Rn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Rn.prototype.outputDefined=function(){return!1},Rn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var jn=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};jn.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var P=t[S],L=t[S+1];Array.isArray(P)||(P=[P]);var z=o.concat(S);if(P.length===0)return z.error("Expected at least one branch label.");for(var Z=0,G=P;Z<G.length;Z+=1){var J=G[Z];if(typeof J!="number"&&typeof J!="string")return z.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof J=="number"&&Math.floor(J)!==J)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,Ji(J)))return null}else u=Ji(J);if(y[String(J)]!==void 0)return z.error("Branch labels must be unique.");y[String(J)]=b.length}var ne=o.parse(L,S,h);if(!ne)return null;h=h||ne.type,b.push(ne)}var Ce=o.parse(t[1],1,qr);if(!Ce)return null;var Te=o.parse(t[t.length-1],t.length-1,h);return Te?Ce.type.kind!=="value"&&o.concat(1).checkSubtype(u,Ce.type)?null:new jn(u,h,Ce,y,b,Te):null},jn.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(Ji(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},jn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},jn.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},jn.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(G=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var P=function(ne){return t.inputType.kind==="number"?Number(ne):ne},L=0,z=u;L<z.length;L+=1){var Z=z[L],G=Z[0],J=Z[1];o.push(J.length===1?P(J[0]):J.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Nn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Nn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Zr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new Nn(u,h,P):null},Nn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Nn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Nn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Nn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Ki=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function ya(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function ea(t,o,u,h){return h.compare(o,u)===0}function Xi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,P){this.type=Zr,this.lhs=b,this.rhs=S,this.collator=P,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var P=b[0],L=S.parse(b[1],1,qr);if(!L)return null;if(!ya(P,L.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+Si(L.type)+"'.");var z=S.parse(b[2],2,qr);if(!z)return null;if(!ya(P,z.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+Si(z.type)+"'.");if(L.type.kind!==z.type.kind&&L.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+Si(L.type)+"' and '"+Si(z.type)+"'.");h&&(L.type.kind==="value"&&z.type.kind!=="value"?L=new Wi(z.type,[L]):L.type.kind!=="value"&&z.type.kind==="value"&&(z=new Wi(L.type,[z])));var Z=null;if(b.length===4){if(L.type.kind!=="string"&&z.type.kind!=="string"&&L.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,wi)))return null}return new y(L,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),P=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var L=Ji(S),z=Ji(P);if(L.kind!==z.kind||L.kind!=="string"&&L.kind!=="number")throw new Ga('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+L.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=Ji(S),G=Ji(P);if(Z.kind!=="string"||G.kind!=="string")return o(b,S,P)}return this.collator?u(b,S,P,this.collator.evaluate(b)):o(b,S,P)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Ki.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,qr),h=o.parse(t[2],2,Ct);if(!u||!h)return null;if(!La(u.type,[Ti(qr),un,qr]))return o.error("Expected first argument to be of type array or string, but found "+Si(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ct);return y?new Ki(u.type,u,h,y):null}return new Ki(u.type,u,h)},Ki.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Hi(o,["string","array"]))throw new Ga("Expected first argument to be of type array or string, but found "+Si(Ji(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Ki.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Ki.prototype.outputDefined=function(){return!1},Ki.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var hs=Xi("==",function(t,o,u){return o===u},ea),lu=Xi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!ea(0,o,u,h)}),Hu=Xi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),Qc=Xi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),al=Xi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Cc=Xi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Ws=function(t,o,u,h,y){this.type=un,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Ws.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Ct);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,un)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,un)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Ct)))return null;var P=null;return h["max-fraction-digits"]&&!(P=o.parse(h["max-fraction-digits"],1,Ct))?null:new Ws(u,y,b,S,P)},Ws.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ws.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ws.prototype.outputDefined=function(){return!1},Ws.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Fo=function(t){this.type=Ct,this.input=t};Fo.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Si(u.type)+" instead."):new Fo(u):null},Fo.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ga("Expected value to be of type string or array, but found "+Si(Ji(o))+" instead.")},Fo.prototype.eachChild=function(t){t(this.input)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Ou={"==":hs,"!=":lu,">":Qc,"<":Hu,">=":Cc,"<=":al,array:Wi,at:sr,boolean:Wi,case:Nn,coalesce:ut,collator:ns,format:bo,image:Go,in:_r,"index-of":Rn,interpolate:ve,"interpolate-hcl":ve,"interpolate-lab":ve,length:Fo,let:lt,literal:co,match:jn,number:Wi,"number-format":Ws,object:Wi,slice:Ki,step:Wo,string:Wi,"to-boolean":Vt,"to-color":Vt,"to-number":Vt,"to-string":Vt,var:ps,within:_s};function to(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,P=Ps(u,h,y,S);if(P)throw new Ga(P);return new Ni(u/255*S,h/255*S,y/255*S,S)}function Ff(t,o){return t in o}function Bf(t,o){var u=o[t];return u===void 0?null:u}function as(t){return{type:t}}function ds(t){return{result:"success",value:t}}function eu(t){return{result:"error",value:t}}function Os(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function bs(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ol(t){return!!t.expression&&t.expression.interpolated}function va(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ol(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function dp(t){return t}function sl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Jc(t,o,u,h,y){return sl(typeof u===y?h[u]:void 0,t.default,o.default)}function vp(t,o,u){if(va(u)!=="number")return sl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=Hs(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function mp(t,o,u){var h=t.base!==void 0?t.base:1;if(va(u)!=="number")return sl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=Hs(t.stops.map(function(G){return G[0]}),u),S=function(G,J,ne,Ce){var Te=Ce-ne,Xe=G-ne;return Te===0?0:J===1?Xe/Te:(Math.pow(J,Xe)-1)/(Math.pow(J,Te)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),P=t.stops[b][1],L=t.stops[b+1][1],z=Eo[o.type]||dp;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=K[t.colorSpace];z=function(G,J){return Z.reverse(Z.interpolate(Z.forward(G),Z.forward(J),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var G=[],J=arguments.length;J--;)G[J]=arguments[J];var ne=P.evaluate.apply(void 0,G),Ce=L.evaluate.apply(void 0,G);if(ne!==void 0&&Ce!==void 0)return z(ne,Ce,S)}}:z(P,L,S)}function ef(t,o,u){return o.type==="color"?u=Ni.parse(u):o.type==="formatted"?u=za.fromString(u.toString()):o.type==="resolvedImage"?u=Ca.fromString(u.toString()):va(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),sl(u,t.default,o.default)}pa.register(Ou,{error:[{kind:"error"},[un],function(t,o){throw new Ga(o[0].evaluate(t))}],typeof:[un,[qr],function(t,o){return Si(Ji(o[0].evaluate(t)))}],"to-rgba":[Ti(Ct,4),[Yr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Yr,[Ct,Ct,Ct],to],rgba:[Yr,[Ct,Ct,Ct,Ct],to],has:{type:Zr,overloads:[[[un],function(t,o){return Ff(o[0].evaluate(t),t.properties())}],[[un,vi],function(t,o){var u=o[1];return Ff(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:qr,overloads:[[[un],function(t,o){return Bf(o[0].evaluate(t),t.properties())}],[[un,vi],function(t,o){var u=o[1];return Bf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[qr,[un],function(t,o){return Bf(o[0].evaluate(t),t.featureState||{})}],properties:[vi,[],function(t){return t.properties()}],"geometry-type":[un,[],function(t){return t.geometryType()}],id:[qr,[],function(t){return t.id()}],zoom:[Ct,[],function(t){return t.globals.zoom}],"heatmap-density":[Ct,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ct,[],function(t){return t.globals.lineProgress||0}],accumulated:[qr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Ct,as(Ct),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[Ct,as(Ct),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:Ct,overloads:[[[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Ct],function(t,o){return-o[0].evaluate(t)}]]},"/":[Ct,[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Ct,[Ct,Ct],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Ct,[],function(){return Math.LN2}],pi:[Ct,[],function(){return Math.PI}],e:[Ct,[],function(){return Math.E}],"^":[Ct,[Ct,Ct],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Ct,[Ct],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Ct,[Ct],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Ct,[Ct],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Ct,[Ct],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Ct,[Ct],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Ct,[Ct],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Ct,[Ct],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Ct,[Ct],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Ct,as(Ct),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Ct,as(Ct),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Ct,[Ct],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Ct,[Ct],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ct,[Ct],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Ct,[Ct],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Zr,[un,qr],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Zr,[qr],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Zr,[un],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Zr,[un,qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Zr,[qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Zr,[un,qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Zr,[qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Zr,[un,qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Zr,[qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Zr,[un,qr],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Zr,[qr],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Zr,[qr],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Zr,[Ti(un)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zr,[Ti(qr)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zr,[un,Ti(qr)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Zr,[un,Ti(qr)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,P){for(;S<=P;){var L=S+P>>1;if(b[L]===y)return!0;b[L]>y?P=L-1:S=L+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[as(Zr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[as(Zr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Zr,[Zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Zr,[un],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[un,[un],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[un,[un],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[un,as(qr),function(t,o){return o.map(function(u){return Pu(u.evaluate(t))}).join("")}],"resolved-locale":[un,[wi],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var ac=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new fa,this._defaultValue=o?function(u){return u.type==="color"&&Ol(u.default)?new Ni(0,0,0,0):u.type==="color"?Ni.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Rl(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ou}function kl(t,o){var u=new Is(Ou,[],o?function(y){var b={color:Yr,string:un,number:Ct,enum:un,boolean:Zr,formatted:oa,resolvedImage:Ei};return y.type==="array"?Ti(b[y.value]||qr,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?ds(new ac(h,o)):eu(u.errors)}ac.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},ac.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ga("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Ll=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!xs(o.expression)};Ll.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Ll.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var ul=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!xs(o.expression),this.interpolationType=h};function Dl(t,o){if((t=kl(t,o)).result==="error")return t;var u=t.value.expression,h=Do(u);if(!h&&!Os(o))return eu([new mr("","data expressions not supported")]);var y=is(u,["zoom"]);if(!y&&!bs(o))return eu([new mr("","zoom expressions not supported")]);var b=function S(P){var L=null;if(P instanceof lt)L=S(P.result);else if(P instanceof ut)for(var z=0,Z=P.args;z<Z.length&&!(L=S(Z[z]));z+=1);else(P instanceof Wo||P instanceof ve)&&P.input instanceof pa&&P.input.name==="zoom"&&(L=P);return L instanceof mr||P.eachChild(function(G){var J=S(G);J instanceof mr?L=J:!L&&J?L=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&J&&L!==J&&(L=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(u);return b||y?b instanceof mr?eu([b]):b instanceof ve&&!ol(o)?eu([new mr("",'"interpolate" expressions cannot be used with this property')]):ds(b?new ul(h?"camera":"composite",t.value,b.labels,b instanceof ve?b.interpolation:void 0):new Ll(h?"constant":"source",t.value)):eu([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ul.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},ul.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},ul.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?ve.interpolationFactor(this.interpolationType,t,o,u):0};var ll=function(t,o){this._parameters=t,this._specification=o,pr(this,function u(h,y){var b,S,P,L=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",Z=z||!(z||h.property!==void 0),G=h.type||(ol(y)?"exponential":"interval");if(L&&((h=pr({},h)).stops&&(h.stops=h.stops.map(function(pn){return[pn[0],Ni.parse(pn[1])]})),h.default=Ni.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!K[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(G==="exponential")b=mp;else if(G==="interval")b=vp;else if(G==="categorical"){b=Jc,S=Object.create(null);for(var J=0,ne=h.stops;J<ne.length;J+=1){var Ce=ne[J];S[Ce[0]]=Ce[1]}P=typeof h.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=ef}if(z){for(var Te={},Xe=[],Be=0;Be<h.stops.length;Be++){var at=h.stops[Be],gt=at[0].zoom;Te[gt]===void 0&&(Te[gt]={zoom:gt,type:h.type,property:h.property,default:h.default,stops:[]},Xe.push(gt)),Te[gt].stops.push([at[0].value,at[1]])}for(var Rt=[],wt=0,ir=Xe;wt<ir.length;wt+=1){var Pr=ir[wt];Rt.push([Te[Pr].zoom,u(Te[Pr],y)])}var Hr={name:"linear"};return{kind:"composite",interpolationType:Hr,interpolationFactor:ve.interpolationFactor.bind(void 0,Hr),zoomStops:Rt.map(function(pn){return pn[0]}),evaluate:function(pn,Hn){var dn=pn.zoom;return mp({stops:Rt,base:h.base},y,dn).evaluate(dn,Hn)}}}if(Z){var Bn=G==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Bn,interpolationFactor:ve.interpolationFactor.bind(void 0,Bn),zoomStops:h.stops.map(function(pn){return pn[0]}),evaluate:function(pn){return b(h,y,pn.zoom,S,P)}}}return{kind:"source",evaluate:function(pn,Hn){var dn=Hn&&Hn.properties?Hn.properties[h.property]:void 0;return dn===void 0?sl(h.default,y.default):b(h,y,dn,S,P)}}}(this._parameters,this._specification))};function Rs(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,P=[],L=va(u);if(L!=="object")return[new Oe(o,u,"object expected, "+L+" found")];for(var z in u){var Z=z.split(".")[0],G=h[Z]||h["*"],J=void 0;if(y[Z])J=y[Z];else if(h[Z])J=Ii;else if(y["*"])J=y["*"];else{if(!h["*"]){P.push(new Oe(o,u[z],'unknown property "'+z+'"'));continue}J=Ii}P=P.concat(J({key:(o&&o+".")+z,value:u[z],valueSpec:G,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ne in h)y[ne]||h[ne].required&&h[ne].default===void 0&&u[ne]===void 0&&P.push(new Oe(o,u,'missing required property "'+ne+'"'));return P}function Ac(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Ii;if(va(o)!=="array")return[new Oe(b,o,"array expected, "+va(o)+" found")];if(u.length&&o.length!==u.length)return[new Oe(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Oe(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),va(u.value)==="object"&&(P=u.value);for(var L=[],z=0;z<o.length;z++)L=L.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:P,style:h,styleSpec:y,key:b+"["+z+"]"}));return L}function tf(t){var o=t.key,u=t.value,h=t.valueSpec,y=va(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Oe(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new Oe(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Oe(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function gp(t){var o,u,h,y=t.valueSpec,b=Ot(t.value.type),S={},P=b!=="categorical"&&t.value.property===void 0,L=!P,z=va(t.value.stops)==="array"&&va(t.value.stops[0])==="array"&&va(t.value.stops[0][0])==="object",Z=Rs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ne){if(b==="identity")return[new Oe(ne.key,ne.value,'identity function may not have a "stops" property')];var Ce=[],Te=ne.value;return Ce=Ce.concat(Ac({key:ne.key,value:Te,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:G})),va(Te)==="array"&&Te.length===0&&Ce.push(new Oe(ne.key,Te,"array must have at least one stop")),Ce},default:function(ne){return Ii({key:ne.key,value:ne.value,valueSpec:y,style:ne.style,styleSpec:ne.styleSpec})}}});return b==="identity"&&P&&Z.push(new Oe(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new Oe(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!ol(t.valueSpec)&&Z.push(new Oe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(L&&!Os(t.valueSpec)?Z.push(new Oe(t.key,t.value,"property functions not supported")):P&&!bs(t.valueSpec)&&Z.push(new Oe(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new Oe(t.key,t.value,'"property" property is required')),Z;function G(ne){var Ce=[],Te=ne.value,Xe=ne.key;if(va(Te)!=="array")return[new Oe(Xe,Te,"array expected, "+va(Te)+" found")];if(Te.length!==2)return[new Oe(Xe,Te,"array length 2 expected, length "+Te.length+" found")];if(z){if(va(Te[0])!=="object")return[new Oe(Xe,Te,"object expected, "+va(Te[0])+" found")];if(Te[0].zoom===void 0)return[new Oe(Xe,Te,"object stop key must have zoom")];if(Te[0].value===void 0)return[new Oe(Xe,Te,"object stop key must have value")];if(h&&h>Ot(Te[0].zoom))return[new Oe(Xe,Te[0].zoom,"stop zoom values must appear in ascending order")];Ot(Te[0].zoom)!==h&&(h=Ot(Te[0].zoom),u=void 0,S={}),Ce=Ce.concat(Rs({key:Xe+"[0]",value:Te[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:tf,value:J}}))}else Ce=Ce.concat(J({key:Xe+"[0]",value:Te[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},Te));return Rl(Dt(Te[1]))?Ce.concat([new Oe(Xe+"[1]",Te[1],"expressions are not allowed in function stops.")]):Ce.concat(Ii({key:Xe+"[1]",value:Te[1],valueSpec:y,style:ne.style,styleSpec:ne.styleSpec}))}function J(ne,Ce){var Te=va(ne.value),Xe=Ot(ne.value),Be=ne.value!==null?ne.value:Ce;if(o){if(Te!==o)return[new Oe(ne.key,Be,Te+" stop domain type must match previous stop domain type "+o)]}else o=Te;if(Te!=="number"&&Te!=="string"&&Te!=="boolean")return[new Oe(ne.key,Be,"stop domain value must be a number, string, or boolean")];if(Te!=="number"&&b!=="categorical"){var at="number expected, "+Te+" found";return Os(y)&&b===void 0&&(at+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(ne.key,Be,at)]}return b!=="categorical"||Te!=="number"||isFinite(Xe)&&Math.floor(Xe)===Xe?b!=="categorical"&&Te==="number"&&u!==void 0&&Xe<u?[new Oe(ne.key,Be,"stop domain values must appear in ascending order")]:(u=Xe,b==="categorical"&&Xe in S?[new Oe(ne.key,Be,"stop domain values must be unique")]:(S[Xe]=!0,[])):[new Oe(ne.key,Be,"integer expected, found "+Xe)]}}function cl(t){var o=(t.expressionContext==="property"?Dl:kl)(Dt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Oe(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Oe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!xs(u))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!xs(u))return[new Oe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!is(u,["zoom","feature-state"]))return[new Oe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Do(u))return[new Oe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wc(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(Ot(u))===-1&&y.push(new Oe(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Ot(u))===-1&&y.push(new Oe(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Es(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Es(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}ll.deserialize=function(t){return new ll(t._parameters,t._specification)},ll.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var rf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Es(t)||(t=Fl(t));var o=kl(t,rf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function yp(t,o){return t<o?-1:t>o?1:0}function Fl(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Ru(t[1],t[2],"=="):u==="!="?Bl(Ru(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Ru(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Fl))):u==="all"?["all"].concat(t.slice(1).map(Fl)):u==="none"?["all"].concat(t.slice(1).map(Fl).map(Bl)):u==="in"?nf(t[1],t.slice(2)):u==="!in"?Bl(nf(t[1],t.slice(2))):u==="has"?Nf(t[1]):u==="!has"?Bl(Nf(t[1])):u!=="within"||t}function Ru(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function nf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(yp)]]:["filter-in-small",t,["literal",o]]}}function Nf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Bl(t){return["!",t]}function _p(t){return Es(Dt(t.value))?cl(pr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(va(h)!=="array")return[new Oe(y,h,"array expected, "+va(h)+" found")];var b,S=u.styleSpec,P=[];if(h.length<1)return[new Oe(y,h,"filter array must have at least 1 element")];switch(P=P.concat(wc({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ot(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Ot(h[1])==="$type"&&P.push(new Oe(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&P.push(new Oe(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=va(h[1]))!=="string"&&P.push(new Oe(y+"[1]",h[1],"string expected, "+b+" found"));for(var L=2;L<h.length;L++)b=va(h[L]),Ot(h[1])==="$type"?P=P.concat(wc({key:y+"["+L+"]",value:h[L],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&P.push(new Oe(y+"["+L+"]",h[L],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)P=P.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=va(h[1]),h.length!==2?P.push(new Oe(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&P.push(new Oe(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=va(h[1]),h.length!==2?P.push(new Oe(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&P.push(new Oe(y+"[1]",h[1],"object expected, "+b+" found"))}return P}(t)}function xp(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,P=y[o+"_"+t.layerType];if(!P)return[];var L=S.match(/^(.*)-transition$/);if(o==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Ii({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,Z=t.valueSpec||P[S];if(!Z)return[new Oe(u,b,'unknown property "'+S+'"')];if(va(b)==="string"&&Os(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Oe(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new Oe(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ol(Dt(b))&&Ot(b.type)==="identity"&&G.push(new Oe(u,b,'"text-font" does not support identity functions'))),G.concat(Ii({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function zf(t){return xp(t,"paint")}function Nl(t){return xp(t,"layout")}function bp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Oe(h,u,'either "type" or "ref" is required'));var S,P=Ot(u.type),L=Ot(u.ref);if(u.id)for(var z=Ot(u.id),Z=0;Z<t.arrayIndex;Z++){var G=y.layers[Z];Ot(G.id)===z&&o.push(new Oe(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Ce){Ce in u&&o.push(new Oe(h,u[Ce],'"'+Ce+'" is prohibited for ref layers'))}),y.layers.forEach(function(Ce){Ot(Ce.id)===L&&(S=Ce)}),S?S.ref?o.push(new Oe(h,u.ref,"ref cannot reference another ref layer")):P=Ot(S.type):o.push(new Oe(h,u.ref,'ref layer "'+L+'" not found'));else if(P!=="background")if(u.source){var J=y.sources&&y.sources[u.source],ne=J&&Ot(J.type);J?ne==="vector"&&P==="raster"?o.push(new Oe(h,u.source,'layer "'+u.id+'" requires a raster source')):ne==="raster"&&P!=="raster"?o.push(new Oe(h,u.source,'layer "'+u.id+'" requires a vector source')):ne!=="vector"||u["source-layer"]?ne==="raster-dem"&&P!=="hillshade"?o.push(new Oe(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ne==="geojson"&&J.lineMetrics||o.push(new Oe(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Oe(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Oe(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Oe(h,u,'missing required property "source"'));return o=o.concat(Rs({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ii({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:_p,layout:function(Ce){return Rs({layer:u,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return Nl(pr({layerType:P},Te))}}})},paint:function(Ce){return Rs({layer:u,key:Ce.key,value:Ce.value,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{"*":function(Te){return zf(pr({layerType:P},Te))}}})}}}))}function fl(t){var o=t.value,u=t.key,h=va(o);return h!=="string"?[new Oe(u,o,"string expected, "+h+" found")]:[]}var Ha={promoteId:function(t){var o=t.key,u=t.value;if(va(u)==="string")return fl({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,fl({key:o+"."+y,value:u[y]}));return h}};function oc(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new Oe(u,o,'"type" is required')];var b,S=Ot(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Rs({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Ha});case"geojson":if(b=Rs({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:Ha}),o.cluster)for(var P in o.clusterProperties){var L=o.clusterProperties[P],z=L[0],Z=typeof z=="string"?[z,["accumulated"],["get",P]]:z;b.push.apply(b,cl({key:u+"."+P+".map",value:L[1],expressionContext:"cluster-map"})),b.push.apply(b,cl({key:u+"."+P+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return Rs({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return Rs({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new Oe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function zl(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=va(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Oe("light",o,"object expected, "+S+" found")]);for(var P in o){var L=P.match(/^(.*)-transition$/);b=b.concat(L&&h[L[1]]&&h[L[1]].transition?Ii({key:P,value:o[P],valueSpec:u.transition,style:y,styleSpec:u}):h[P]?Ii({key:P,value:o[P],valueSpec:h[P],style:y,styleSpec:u}):[new Oe(P,o[P],'unknown property "'+P+'"')])}return b}var ku={"*":function(){return[]},array:Ac,boolean:function(t){var o=t.value,u=t.key,h=va(o);return h!=="boolean"?[new Oe(u,o,"boolean expected, "+h+" found")]:[]},number:tf,color:function(t){var o=t.key,u=t.value,h=va(u);return h!=="string"?[new Oe(o,u,"color expected, "+h+" found")]:Pi(u)===null?[new Oe(o,u,'color expected, "'+u+'" found')]:[]},constants:pt,enum:wc,filter:_p,function:gp,layer:bp,object:Rs,source:oc,light:zl,string:fl,formatted:function(t){return fl(t).length===0?[]:cl(t)},resolvedImage:function(t){return fl(t).length===0?[]:cl(t)}};function Ii(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Ol(Ot(o))?gp(t):u.expression&&Rl(Dt(o))?cl(t):u.type&&ku[u.type]?ku[u.type](t):Rs(pr({},t,{valueSpec:u.type?h[u.type]:u}))}function Ma(t){var o=t.value,u=t.key,h=fl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Oe(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Oe(u,o,'"glyphs" url must include a "{range}" token'))),h}function ks(t,o){o===void 0&&(o=ue);var u=[];return u=u.concat(Ii({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),t.constants&&(u=u.concat(pt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Mc(u)}function Mc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function gu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Mc(t.apply(this,o))}}ks.source=gu(oc),ks.light=gu(zl),ks.layer=gu(bp),ks.filter=gu(_p),ks.paintProperty=gu(zf),ks.layoutProperty=gu(Nl);var af=ks,Zh=af.light,jh=af.paintProperty,Pc=af.layoutProperty;function Ic(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new je(new Error(y[h].message))),u=!0;return u}var pl=fo;function fo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],P=y[3+b+1];h.push(S===P?null:y.subarray(S,P))}var L=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],L),this.bboxes=y.subarray(L),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}fo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},fo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},fo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,h,this._queryCell,P,{},y),P},fo.prototype._queryCell=function(t,o,u,h,y,b,S,P){var L=this.cells[y];if(L!==null)for(var z=this.keys,Z=this.bboxes,G=0;G<L.length;G++){var J=L[G];if(S[J]===void 0){var ne=4*J;(P?P(Z[ne+0],Z[ne+1],Z[ne+2],Z[ne+3]):t<=Z[ne+2]&&o<=Z[ne+3]&&u>=Z[ne+0]&&h>=Z[ne+1])?(S[J]=!0,b.push(z[J])):S[J]=!1}}},fo.prototype._forEachCell=function(t,o,u,h,y,b,S,P){for(var L=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),G=this._convertToCellCoord(h),J=L;J<=Z;J++)for(var ne=z;ne<=G;ne++){var Ce=this.d*ne+J;if((!P||P(this._convertFromCellCoord(J),this._convertFromCellCoord(ne),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ne+1)))&&y.call(this,t,o,u,h,Ce,b,S,P))return}},fo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},fo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},fo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var P=t[S];y[3+S]=b,y.set(P,b),b+=P.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Oc=ge.ImageData,Rc=ge.ImageBitmap,Mo={};function vn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Mo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var ro in vn("Object",Object),pl.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},pl.deserialize=function(t){return new pl(t.buffer)},vn("Grid",pl),vn("Color",Ni),vn("Error",Error),vn("ResolvedImage",Ca),vn("StylePropertyFunction",ll),vn("StyleExpression",ac,{omit:["_evaluator"]}),vn("ZoomDependentExpression",ul),vn("ZoomConstantExpression",Ll),vn("CompoundExpression",pa,{omit:["_evaluate"]}),Ou)Ou[ro]._classRegistryKey||vn("Expression_"+ro,Ou[ro]);function Po(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Ul(t){return Rc&&t instanceof Rc}function Yi(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Po(t)||Ul(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Oc)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(Yi(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var L=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(Mo[P].omit.indexOf(z)>=0)){var Z=t[z];L[z]=Mo[P].shallow.indexOf(z)>=0?Z:Yi(Z,o)}t instanceof Error&&(L.message=t.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(L.$name=P),L}throw new Error("can't serialize object of type "+typeof t)}function Ls(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Po(t)||Ul(t)||ArrayBuffer.isView(t)||t instanceof Oc)return t;if(Array.isArray(t))return t.map(Ls);if(typeof t=="object"){var o=t.$name||"Object",u=Mo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var P=t[S];h[S]=Mo[o].shallow.indexOf(S)>=0?P:Ls(P)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Uf=function(){this.first=!0};Uf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function kc(t){for(var o=0,u=t;o<u.length;o+=1)if(of(u[o].charCodeAt(0)))return!0;return!1}function of(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function hl(t){return!(of(t)||function(o){return!!(Kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Kr["Letterlike Symbols"](o)||Kr["Number Forms"](o)||Kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Kr["Control Pictures"](o)&&o!==9251||Kr["Optical Character Recognition"](o)||Kr["Enclosed Alphanumerics"](o)||Kr["Geometric Shapes"](o)||Kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Kr["CJK Symbols and Punctuation"](o)||Kr.Katakana(o)||Kr["Private Use Area"](o)||Kr["CJK Compatibility Forms"](o)||Kr["Small Form Variants"](o)||Kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function mi(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function Bo(t,o){return!(!o&&mi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function yu(t){for(var o=0,u=t;o<u.length;o+=1)if(mi(u[o].charCodeAt(0)))return!0;return!1}var Xs=null,Ds="unavailable",_u=null,sf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ds="error"),Xs&&Xs(t)};function sc(){Zf.fire(new Ae("pluginStateChange",{pluginStatus:Ds,pluginURL:_u}))}var Zf=new Je,uf=function(){return Ds},tu=function(){if(Ds!=="deferred"||!_u)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ds="loading",sc(),_u&&ka({url:_u},function(t){t?sf(t):(Ds="loaded",sc())})},ru={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ds==="loaded"||ru.applyArabicShaping!=null},isLoading:function(){return Ds==="loading"},setState:function(t){Ds=t.pluginStatus,_u=t.pluginURL},isParsed:function(){return ru.applyArabicShaping!=null&&ru.processBidirectionalText!=null&&ru.processStyledBidirectionalText!=null},getPluginURL:function(){return _u}},Oi=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uf,this.transition={})};Oi.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!Bo(y[h].charCodeAt(0),u))return!1;return!0}(t,ru.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var _a=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Ol(u))return new ll(u,h);if(Rl(u)){var y=Dl(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Ni.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};_a.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},_a.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var nu=function(t){this.property=t,this.value=new _a(t,void 0)};nu.prototype.transitioned=function(t,o){return new dl(this.property,this.value,o,kt({},t.transition,this.transition),t.now)},nu.prototype.untransitioned=function(){return new dl(this.property,this.value,null,{},0)};var Xo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Xo.prototype.getValue=function(t){return $e(this._values[t].value.value)},Xo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new nu(this._values[t].property)),this._values[t].value=new _a(this._values[t].property,o===null?void 0:$e(o))},Xo.prototype.getTransition=function(t){return $e(this._values[t].transition)},Xo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new nu(this._values[t].property)),this._values[t].transition=$e(o)||void 0},Xo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Xo.prototype.transitioned=function(t,o){for(var u=new xu(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Xo.prototype.untransitioned=function(){for(var t=new xu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var dl=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};dl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(P){if(P<=0)return 0;if(P>=1)return 1;var L=P*P,z=L*P;return 4*(P<.5?z:3*(P-L)+z-.75)}(S))}return y};var xu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};xu.prototype.possiblyEvaluate=function(t,o,u){for(var h=new cu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},xu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Ss=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ss.prototype.getValue=function(t){return $e(this._values[t].value)},Ss.prototype.setValue=function(t,o){this._values[t]=new _a(this._values[t].property,o===null?void 0:$e(o))},Ss.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},Ss.prototype.possiblyEvaluate=function(t,o,u){for(var h=new cu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var Cs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};Cs.prototype.isConstant=function(){return this.value.kind==="constant"},Cs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},Cs.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var cu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};cu.prototype.get=function(t){return this._values[t]};var Dn=function(t){this.specification=t};Dn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Dn.prototype.interpolate=function(t,o,u){var h=Eo[this.specification.type];return h?h(t,o,u):t};var Pn=function(t,o){this.specification=t,this.overrides=o};Pn.prototype.possiblyEvaluate=function(t,o,u,h){return new Cs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Pn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Cs(this,{kind:"constant",value:void 0},t.parameters);var h=Eo[this.specification.type];return h?new Cs(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Pn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var lf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new Cs(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(P,P,P,h);return new Cs(this,{kind:"constant",value:L},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new Cs(this,{kind:"constant",value:z},h)}return new Cs(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,P){if(u.kind==="source"){var L=u.evaluate(h,y,b,S,P);return this._calculate(L,L,L,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(Pn),vs=function(t){this.specification=t};vs.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Oi(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Oi(Math.floor(o.zoom),o)),t.expression.evaluate(new Oi(Math.floor(o.zoom+1),o)),o)}},vs.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},vs.prototype.interpolate=function(t){return t};var bu=function(t){this.specification=t};bu.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},bu.prototype.interpolate=function(){return!1};var Yo=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new _a(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new nu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};vn("DataDrivenProperty",Pn),vn("DataConstantProperty",Dn),vn("CrossFadedDataDrivenProperty",lf),vn("CrossFadedProperty",vs),vn("ColorRampProperty",bu);var fu=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Ss(h.layout)),h.paint)){for(var y in this._transitionablePaint=new Xo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Pc,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return q(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(jh,"layers."+this.id+".paint."+u,u,h,y))return!1;if(q(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",P=b.value.isDataDriven(),L=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,L,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),He(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Ic(this,u.call(af,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof Cs&&Os(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(Je),Zl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Lc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},sa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Za(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=Zl[y.type].BYTES_PER_ELEMENT,S=u=cf(u,Math.max(o,b)),P=y.components||1;return h=Math.max(h,b),u+=b*P,{name:y.name,type:y.type,components:P,offset:S}}),size:cf(u,Math.max(h,o)),alignment:o}}function cf(t,o){return Math.ceil(t/o)*o}sa.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},sa.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},sa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},sa.prototype.clear=function(){this.length=0},sa.prototype.resize=function(t){this.reserve(t),this.length=t},sa.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},sa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Wu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(sa);Wu.prototype.bytesPerElement=4,vn("StructArrayLayout2i4",Wu);var Lu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.int16[P+0]=h,this.int16[P+1]=y,this.int16[P+2]=b,this.int16[P+3]=S,u},o}(sa);Lu.prototype.bytesPerElement=8,vn("StructArrayLayout4i8",Lu);var Eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,L){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=L,u},o}(sa);Eu.prototype.bytesPerElement=12,vn("StructArrayLayout2i4i12",Eu);var No=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,L){var z=4*u,Z=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=P,this.uint8[Z+7]=L,u},o}(sa);No.prototype.bytesPerElement=8,vn("StructArrayLayout2i4ub8",No);var Xu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(sa);Xu.prototype.bytesPerElement=8,vn("StructArrayLayout2f8",Xu);var zo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,L,z,Z,G){var J=this.length;return this.resize(J+1),this.emplace(J,u,h,y,b,S,P,L,z,Z,G)},o.prototype.emplace=function(u,h,y,b,S,P,L,z,Z,G,J){var ne=10*u;return this.uint16[ne+0]=h,this.uint16[ne+1]=y,this.uint16[ne+2]=b,this.uint16[ne+3]=S,this.uint16[ne+4]=P,this.uint16[ne+5]=L,this.uint16[ne+6]=z,this.uint16[ne+7]=Z,this.uint16[ne+8]=G,this.uint16[ne+9]=J,u},o}(sa);zo.prototype.bytesPerElement=20,vn("StructArrayLayout10ui20",zo);var ff=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,L,z,Z,G,J,ne){var Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,u,h,y,b,S,P,L,z,Z,G,J,ne)},o.prototype.emplace=function(u,h,y,b,S,P,L,z,Z,G,J,ne,Ce){var Te=12*u;return this.int16[Te+0]=h,this.int16[Te+1]=y,this.int16[Te+2]=b,this.int16[Te+3]=S,this.uint16[Te+4]=P,this.uint16[Te+5]=L,this.uint16[Te+6]=z,this.uint16[Te+7]=Z,this.int16[Te+8]=G,this.int16[Te+9]=J,this.int16[Te+10]=ne,this.int16[Te+11]=Ce,u},o}(sa);ff.prototype.bytesPerElement=24,vn("StructArrayLayout4i4ui4i24",ff);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(sa);jl.prototype.bytesPerElement=12,vn("StructArrayLayout3f12",jl);var Dc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(sa);Dc.prototype.bytesPerElement=4,vn("StructArrayLayout1ul4",Dc);var Vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,L,z,Z){var G=this.length;return this.resize(G+1),this.emplace(G,u,h,y,b,S,P,L,z,Z)},o.prototype.emplace=function(u,h,y,b,S,P,L,z,Z,G){var J=10*u,ne=5*u;return this.int16[J+0]=h,this.int16[J+1]=y,this.int16[J+2]=b,this.int16[J+3]=S,this.int16[J+4]=P,this.int16[J+5]=L,this.uint32[ne+3]=z,this.uint16[J+8]=Z,this.uint16[J+9]=G,u},o}(sa);Vl.prototype.bytesPerElement=20,vn("StructArrayLayout6i1ul2ui20",Vl);var Gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var L=this.length;return this.resize(L+1),this.emplace(L,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,L){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=L,u},o}(sa);Gl.prototype.bytesPerElement=12,vn("StructArrayLayout2i2i2i12",Gl);var Hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,P){var L=4*u,z=8*u;return this.float32[L+0]=h,this.float32[L+1]=y,this.float32[L+2]=b,this.int16[z+6]=S,this.int16[z+7]=P,u},o}(sa);Hl.prototype.bytesPerElement=16,vn("StructArrayLayout2f1f2i16",Hl);var pf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=12*u,L=3*u;return this.uint8[P+0]=h,this.uint8[P+1]=y,this.float32[L+1]=b,this.float32[L+2]=S,u},o}(sa);pf.prototype.bytesPerElement=12,vn("StructArrayLayout2ub2f12",pf);var Yu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(sa);Yu.prototype.bytesPerElement=6,vn("StructArrayLayout3ui6",Yu);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at){var gt=this.length;return this.resize(gt+1),this.emplace(gt,u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at)},o.prototype.emplace=function(u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at,gt){var Rt=24*u,wt=12*u,ir=48*u;return this.int16[Rt+0]=h,this.int16[Rt+1]=y,this.uint16[Rt+2]=b,this.uint16[Rt+3]=S,this.uint32[wt+2]=P,this.uint32[wt+3]=L,this.uint32[wt+4]=z,this.uint16[Rt+10]=Z,this.uint16[Rt+11]=G,this.uint16[Rt+12]=J,this.float32[wt+7]=ne,this.float32[wt+8]=Ce,this.uint8[ir+36]=Te,this.uint8[ir+37]=Xe,this.uint8[ir+38]=Be,this.uint32[wt+10]=at,this.int16[Rt+22]=gt,u},o}(sa);vl.prototype.bytesPerElement=48,vn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);var Fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at,gt,Rt,wt,ir,Pr,Hr,Bn,pn,Hn,dn,ki){var ii=this.length;return this.resize(ii+1),this.emplace(ii,u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at,gt,Rt,wt,ir,Pr,Hr,Bn,pn,Hn,dn,ki)},o.prototype.emplace=function(u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te,Xe,Be,at,gt,Rt,wt,ir,Pr,Hr,Bn,pn,Hn,dn,ki,ii){var nn=34*u,Zi=17*u;return this.int16[nn+0]=h,this.int16[nn+1]=y,this.int16[nn+2]=b,this.int16[nn+3]=S,this.int16[nn+4]=P,this.int16[nn+5]=L,this.int16[nn+6]=z,this.int16[nn+7]=Z,this.uint16[nn+8]=G,this.uint16[nn+9]=J,this.uint16[nn+10]=ne,this.uint16[nn+11]=Ce,this.uint16[nn+12]=Te,this.uint16[nn+13]=Xe,this.uint16[nn+14]=Be,this.uint16[nn+15]=at,this.uint16[nn+16]=gt,this.uint16[nn+17]=Rt,this.uint16[nn+18]=wt,this.uint16[nn+19]=ir,this.uint16[nn+20]=Pr,this.uint16[nn+21]=Hr,this.uint16[nn+22]=Bn,this.uint32[Zi+12]=pn,this.float32[Zi+13]=Hn,this.float32[Zi+14]=dn,this.float32[Zi+15]=ki,this.float32[Zi+16]=ii,u},o}(sa);Fc.prototype.bytesPerElement=68,vn("StructArrayLayout8i15ui1ul4f68",Fc);var Wl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(sa);Wl.prototype.bytesPerElement=4,vn("StructArrayLayout1f4",Wl);var iu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(sa);iu.prototype.bytesPerElement=6,vn("StructArrayLayout3i6",iu);var jf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(sa);jf.prototype.bytesPerElement=8,vn("StructArrayLayout1ul2ui8",jf);var Bc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(sa);Bc.prototype.bytesPerElement=4,vn("StructArrayLayout2ui4",Bc);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(sa);ml.prototype.bytesPerElement=2,vn("StructArrayLayout1ui2",ml);var Nc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.float32[P+0]=h,this.float32[P+1]=y,this.float32[P+2]=b,this.float32[P+3]=S,u},o}(sa);Nc.prototype.bytesPerElement=16,vn("StructArrayLayout4f16",Nc);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ce(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Lc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Vl);vn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Lc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(vl);vn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Lc);E.prototype.size=68;var A=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Fc);vn("SymbolInstanceArray",A);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Wl);vn("GlyphOffsetArray",M);var k=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(iu);vn("SymbolLineVertexArray",k);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Lc);U.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(jf);vn("FeatureIndexArray",H);var ie=Za([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function le(t,o){return 256*(t=ar(Math.floor(t),0,255))+ar(Math.floor(o),0,255)}se.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&et("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},se.simpleSegment=function(t,o,u,h){return new se([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vn("SegmentVector",se);var Me=Za([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),we=Ie(function(t){t.exports=function(o,u){var h,y,b,S,P,L,z,Z;for(y=o.length-(h=3&o.length),b=u,P=3432918353,L=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*L+(((z>>>16)*L&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*L+(((z>>>16)*L&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ve=Ie(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),be=we,Ue=Ve;be.murmur3=we,be.murmur2=Ue;var Qe=function(){this.ids=[],this.positions=[],this.indexed=!1};Qe.prototype.add=function(t,o,u,h){this.ids.push(jt(t)),this.positions.push(o,u,h)},Qe.prototype.getPositions=function(t){for(var o=jt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},Qe.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,P,L){for(;P<L;){for(var z=b[P+L>>1],Z=P-1,G=L+1;;){do Z++;while(b[Z]<z);do G--;while(b[G]>z);if(Z>=G)break;Nt(b,Z,G),Nt(S,3*Z,3*G),Nt(S,3*Z+1,3*G+1),Nt(S,3*Z+2,3*G+2)}G-P<L-G?(y(b,S,P,G),P=G+1):(y(b,S,G+1,L),L=G)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},Qe.deserialize=function(t){var o=new Qe;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var dt=Math.pow(2,53)-1;function jt(t){var o=+t;return!isNaN(o)&&o<=dt?o:be(String(t))}function Nt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}vn("FeaturePositionMap",Qe);var Xt=function(t,o){this.gl=t.gl,this.location=o},vr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Xt),Dr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Xt),Lr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Xt),Ur=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Xt),Zn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Xt),kn=function(t){function o(u,h){t.call(this,u,h),this.current=Ni.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Xt),Vn=new Float32Array(16),Ai=function(t){function o(u,h){t.call(this,u,h),this.current=Vn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Xt);function an(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}var si=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};si.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},si.prototype.getBinding=function(t,o,u){return this.type==="color"?new kn(t,o):new Dr(t,o)};var hi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};hi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},hi.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},hi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Zn(t,o):new Dr(t,o)};var ti=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};ti.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Oi(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ti.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},ti.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=an(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ti.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Xn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Oi(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Oi(this.zoom+1),o,{},h,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,b,S)},Xn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Xn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=an(u),b=an(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=ar(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Xn.prototype.getBinding=function(t,o,u){return new Dr(t,o)};var Fn=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};Fn.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},Fn.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},Fn.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},Fn.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Me.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Me.members,this.expression.isStateDependent))},Fn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var wn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof Cs&&Os(b.property.specification)){var S=po(y,t.type),P=b.value,L=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],G=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=G?new hi(P.value,S):new si(P.value,S,L),h.push("/u_"+y);else if(P.kind==="source"||G){var J=Ta(y,L,"source");this.binders[y]=G?new Fn(P,L,z,o,J,t.id):new ti(P,S,L,J),h.push("/a_"+y)}else{var ne=Ta(y,L,"composite");this.binders[y]=new Xn(P,S,L,z,o,ne),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};wn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ti||o instanceof Xn?o.maxValue:0},wn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ti||S instanceof Xn||S instanceof Fn)&&S.populatePaintArray(t,o,u,h,y)}},wn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof hi&&h.setConstantPatternPositions(t,o)}},wn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var P=0,L=o.getPositions(S);P<L.length;P+=1){var z=L[P],Z=u.feature(z.index);for(var G in this.binders){var J=this.binders[G];if((J instanceof ti||J instanceof Xn||J instanceof Fn)&&J.expression.isStateDependent===!0){var ne=h.paint.get(G);J.expression=ne.value,J.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},wn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof si||u instanceof hi)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},wn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ti||u instanceof Xn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof Fn)for(var y=0;y<Me.members.length;y++)t.push(Me.members[y].name)}return t},wn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof si||u instanceof hi||u instanceof Xn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},wn.prototype.getPaintVertexBuffers=function(){return this._buffers},wn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof si||y instanceof hi||y instanceof Xn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var P=S[b];if(o[P]){var L=y.getBinding(t,o[P],P);u.push({name:P,property:h,binding:L})}}}return u},wn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],P=S.name,L=S.property;this.binders[L].setUniform(S.binding,h,u.get(L),P)}},wn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof Fn){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof ti||u instanceof Xn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},wn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ti||u instanceof Xn||u instanceof Fn)&&u.upload(t)}this.updatePaintBuffers()},wn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ti||o instanceof Xn||o instanceof Fn)&&o.destroy()}};var Gn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new wn(b,o,u)}this.needsUpload=!1,this._featureMap=new Qe,this._bufferOffset=0};function po(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ta(t,o,u){var h={color:{source:Xu,composite:Nc},number:{source:Wl,composite:Xu}},y=function(b){return{"line-pattern":{source:zo,composite:zo},"fill-pattern":{source:zo,composite:zo},"fill-extrusion-pattern":{source:zo,composite:zo}}[b]}(t);return y&&y[u]||h[o][u]}Gn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Gn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Gn.prototype.get=function(t){return this.programConfigurations[t]},Gn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Gn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},vn("ConstantBinder",si),vn("CrossFadedConstantBinder",hi),vn("SourceExpressionBinder",ti),vn("CrossFadedCompositeBinder",Fn),vn("CompositeExpressionBinder",Xn),vn("ProgramConfiguration",wn,{omit:["_buffers"]}),vn("ProgramConfigurationSet",Gn);var qo=Math.pow(2,14)-1,Ko=-qo-1;function no(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],P=Math.round(S.x*o),L=Math.round(S.y*o);S.x=ar(P,Ko,qo),S.y=ar(L,Ko,qo),(P<S.x||P>S.x+1||L<S.y||L>S.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function ho(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?no(t):[]}}function As(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var Wa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Wu,this.indexArray=new Yu,this.segments=new se,this.programConfigurations=new Gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function qu(t,o){for(var u=0;u<t.length;u++)if(Fs(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(Fs(t,o[h]))return!0;return!!gl(t,o)}function ws(t,o,u){return!!Fs(t,o)||!!Cu(o,t,u)}function Su(t,o){if(t.length===1)return Ku(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(Fs(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(Ku(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(gl(t,o[S]))return!0;return!1}function os(t,o,u){if(t.length>1){if(gl(t,o))return!0;for(var h=0;h<o.length;h++)if(Cu(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Cu(t[y],o,u))return!0;return!1}function gl(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Du(h,y,o[b],o[b+1]))return!0;return!1}function Du(t,o,u,h){return qt(t,u,h)!==qt(o,u,h)&&qt(t,o,u)!==qt(t,o,h)}function Cu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(yl(t,o[y-1],o[y])<h)return!0;return!1}function yl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Ku(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var P=0,L=(u=t[S]).length-1;P<u.length;L=P++)(h=u[P]).y>o.y!=(y=u[L]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function Fs(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function _l(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=qt(t,o,u[0]);return b!==qt(t,o,u[1])||b!==qt(t,o,u[2])||b!==qt(t,o,u[3])}function pu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function oo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Au(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=ce.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(b));return S}Wa.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var L=P[S],z=L.feature,Z=L.id,G=L.index,J=L.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Ce=ho(z,ne);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Ce,u)){var Te=b?b.evaluate(Ce,{},u):void 0,Xe={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:J,index:G,geometry:ne?Ce.geometry:no(z),patterns:{},sortKey:Te};y.push(Xe)}}b&&y.sort(function(Hr,Bn){return Hr.sortKey-Bn.sortKey});for(var Be=0,at=y;Be<at.length;Be+=1){var gt=at[Be],Rt=gt.geometry,wt=gt.index,ir=gt.sourceLayerIndex,Pr=t[wt].feature;this.addFeature(gt,Rt,wt,u),o.featureIndex.insert(Pr,Rt,wt,ir,this.index)}},Wa.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Wa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ie),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Wa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wa.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,P=b[y];S<P.length;S+=1){var L=P[S],z=L.x,Z=L.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),J=G.vertexLength;As(this.layoutVertexArray,z,Z,-1,-1),As(this.layoutVertexArray,z,Z,1,-1),As(this.layoutVertexArray,z,Z,1,1),As(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+3,J+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},vn("CircleBucket",Wa,{omit:["layers"]});var $u=new Yo({"circle-sort-key":new Pn(ue.layout_circle["circle-sort-key"])}),Fu={paint:new Yo({"circle-radius":new Pn(ue.paint_circle["circle-radius"]),"circle-color":new Pn(ue.paint_circle["circle-color"]),"circle-blur":new Pn(ue.paint_circle["circle-blur"]),"circle-opacity":new Pn(ue.paint_circle["circle-opacity"]),"circle-translate":new Dn(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Dn(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dn(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dn(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(ue.paint_circle["circle-stroke-opacity"])}),layout:$u},Ri=typeof Float32Array!="undefined"?Float32Array:Array;function Bs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ms(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=o[4],L=o[5],z=o[6],Z=o[7],G=o[8],J=o[9],ne=o[10],Ce=o[11],Te=o[12],Xe=o[13],Be=o[14],at=o[15],gt=u[0],Rt=u[1],wt=u[2],ir=u[3];return t[0]=gt*h+Rt*P+wt*G+ir*Te,t[1]=gt*y+Rt*L+wt*J+ir*Xe,t[2]=gt*b+Rt*z+wt*ne+ir*Be,t[3]=gt*S+Rt*Z+wt*Ce+ir*at,t[4]=(gt=u[4])*h+(Rt=u[5])*P+(wt=u[6])*G+(ir=u[7])*Te,t[5]=gt*y+Rt*L+wt*J+ir*Xe,t[6]=gt*b+Rt*z+wt*ne+ir*Be,t[7]=gt*S+Rt*Z+wt*Ce+ir*at,t[8]=(gt=u[8])*h+(Rt=u[9])*P+(wt=u[10])*G+(ir=u[11])*Te,t[9]=gt*y+Rt*L+wt*J+ir*Xe,t[10]=gt*b+Rt*z+wt*ne+ir*Be,t[11]=gt*S+Rt*Z+wt*Ce+ir*at,t[12]=(gt=u[12])*h+(Rt=u[13])*P+(wt=u[14])*G+(ir=u[15])*Te,t[13]=gt*y+Rt*L+wt*J+ir*Xe,t[14]=gt*b+Rt*z+wt*ne+ir*Be,t[15]=gt*S+Rt*Z+wt*Ce+ir*at,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var Qu,zc=ms;function Uc(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}Qu=new Ri(3),Ri!=Float32Array&&(Qu[0]=0,Qu[1]=0,Qu[2]=0),function(){var t=new Ri(4);Ri!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var hf=(function(){var t=new Ri(2);Ri!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Fu)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Wa(u)},o.prototype.queryRadius=function(u){var h=u;return pu("circle-radius",this,h)+pu("circle-stroke-width",this,h)+oo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,L,z){for(var Z=Au(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,L),G=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),J=this.paint.get("circle-pitch-alignment")==="map",ne=J?Z:function(Pr,Hr){return Pr.map(function(Bn){return au(Bn,Hr)})}(Z,z),Ce=J?G*L:G,Te=0,Xe=b;Te<Xe.length;Te+=1)for(var Be=0,at=Xe[Te];Be<at.length;Be+=1){var gt=at[Be],Rt=J?gt:au(gt,z),wt=Ce,ir=Uc([],[gt.x,gt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?wt*=ir[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(wt*=P.cameraToCenterDistance/ir[3]),ws(ne,Rt,wt))return!0}return!1},o}(fu));function au(t,o){var u=Uc([],[t.x,t.y,0,1],o);return new ce(u[0]/u[3],u[1]/u[3])}var xl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Wa);function So(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function bl(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=So({},{width:h,height:y},u);Zc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function Zc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,L=0;L<y.height;L++)for(var z=((u.y+L)*t.width+u.x)*b,Z=((h.y+L)*o.width+h.x)*b,G=0;G<y.width*b;G++)P[Z+G]=S[z+G];return o}vn("HeatmapBucket",xl,{omit:["layers"]});var hu=function(t,o){So(this,t,1,o)};hu.prototype.resize=function(t){bl(this,t,1)},hu.prototype.clone=function(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))},hu.copy=function(t,o,u,h,y){Zc(t,o,u,h,y,1)};var Io=function(t,o){So(this,t,4,o)};Io.prototype.resize=function(t){bl(this,t,4)},Io.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Io.prototype.clone=function(){return new Io({width:this.width,height:this.height},new Uint8Array(this.data))},Io.copy=function(t,o,u,h,y){Zc(t,o,u,h,y,4)},vn("AlphaImage",hu),vn("RGBAImage",Io);var uc={paint:new Yo({"heatmap-radius":new Pn(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dn(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dn(ue.paint_heatmap["heatmap-opacity"])})};function df(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new Io({width:u,height:h}),b=function(Ce,Te,Xe){o[t.evaluationKey]=Xe;var Be=t.expression.evaluate(o);y.data[Ce+Te+0]=Math.floor(255*Be.r/Be.a),y.data[Ce+Te+1]=Math.floor(255*Be.g/Be.a),y.data[Ce+Te+2]=Math.floor(255*Be.b/Be.a),y.data[Ce+Te+3]=Math.floor(255*Be.a)};if(t.clips)for(var S=0,P=0;S<h;++S,P+=4*u)for(var L=0,z=0;L<u;L++,z+=4){var Z=L/(u-1),G=t.clips[S];b(P,z,G.start*(1-Z)+G.end*Z)}else for(var J=0,ne=0;J<u;J++,ne+=4)b(0,ne,J/(u-1));return y}var Ep=function(t){function o(u){t.call(this,u,uc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new xl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(fu),Vf={paint:new Yo({"hillshade-illumination-direction":new Dn(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dn(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dn(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dn(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dn(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dn(ue.paint_hillshade["hillshade-accent-color"])})},nh=function(t){function o(u){t.call(this,u,Vf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(fu),Sp=Za([{name:"a_pos",components:2,type:"Int16"}],4).members,lc=Cp,vf=Cp;function Cp(t,o,u){u=u||2;var h,y,b,S,P,L,z,Z=o&&o.length,G=Z?o[0]*u:t.length,J=ih(t,0,G,u,!0),ne=[];if(!J||J.next===J.prev)return ne;if(Z&&(J=function(Te,Xe,Be,at){var gt,Rt,wt,ir=[];for(gt=0,Rt=Xe.length;gt<Rt;gt++)(wt=ih(Te,Xe[gt]*at,gt<Rt-1?Xe[gt+1]*at:Te.length,at,!1))===wt.next&&(wt.steiner=!0),ir.push(Ad(wt));for(ir.sort(Gh),gt=0;gt<ir.length;gt++)Cd(ir[gt],Be),Be=Bu(Be,Be.next);return Be}(t,o,J,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Ce=u;Ce<G;Ce+=u)(P=t[Ce])<h&&(h=P),(L=t[Ce+1])<y&&(y=L),P>b&&(b=P),L>S&&(S=L);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return mf(J,ne,u,h,y,z),ne}function ih(t,o,u,h,y){var b,S;if(y===Xf(t,o,u,h)>0)for(b=o;b<u;b+=h)S=Wf(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=Wf(b,t[b],t[b+1],S);return S&&Ap(S,S.next)&&(Yl(S),S=S.next),S}function Bu(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Ap(h,h.next)&&Oo(h.prev,h,h.next)!==0)h=h.next;else{if(Yl(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function mf(t,o,u,h,y,b,S){if(t){!S&&b&&function(Z,G,J,ne){var Ce=Z;do Ce.z===null&&(Ce.z=Gf(Ce.x,Ce.y,G,J,ne)),Ce.prevZ=Ce.prev,Ce.nextZ=Ce.next,Ce=Ce.next;while(Ce!==Z);Ce.prevZ.nextZ=null,Ce.prevZ=null,function(Te){var Xe,Be,at,gt,Rt,wt,ir,Pr,Hr=1;do{for(Be=Te,Te=null,Rt=null,wt=0;Be;){for(wt++,at=Be,ir=0,Xe=0;Xe<Hr&&(ir++,at=at.nextZ);Xe++);for(Pr=Hr;ir>0||Pr>0&&at;)ir!==0&&(Pr===0||!at||Be.z<=at.z)?(gt=Be,Be=Be.nextZ,ir--):(gt=at,at=at.nextZ,Pr--),Rt?Rt.nextZ=gt:Te=gt,gt.prevZ=Rt,Rt=gt;Be=at}Rt.nextZ=null,Hr*=2}while(wt>1)}(Ce)}(t,h,y,b);for(var P,L,z=t;t.prev!==t.next;)if(P=t.prev,L=t.next,b?Sd(t,h,y,b):Vh(t))o.push(P.i/u),o.push(t.i/u),o.push(L.i/u),Yl(t),t=L.next,z=L.next;else if((t=L)===z){S?S===1?mf(t=gf(Bu(t),o,u),o,u,h,y,b,2):S===2&&ah(t,o,u,h,y,b):mf(Bu(t),o,u,h,y,b,1);break}}}function Vh(t){var o=t.prev,u=t,h=t.next;if(Oo(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(yf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&Oo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Sd(t,o,u,h){var y=t.prev,b=t,S=t.next;if(Oo(y,b,S)>=0)return!1;for(var P=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,L=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=Gf(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=Gf(P,L,o,u,h),G=t.prevZ,J=t.nextZ;G&&G.z>=z&&J&&J.z<=Z;){if(G!==t.prev&&G!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Oo(G.prev,G,G.next)>=0||(G=G.prevZ,J!==t.prev&&J!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,J.x,J.y)&&Oo(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Oo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;J&&J.z<=Z;){if(J!==t.prev&&J!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,J.x,J.y)&&Oo(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function gf(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!Ap(y,b)&&Hh(y,h,h.next,b)&&Hf(y,b)&&Hf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),Yl(h),Yl(h.next),h=t=b),h=h.next}while(h!==t);return Bu(h)}function ah(t,o,u,h,y,b){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&wd(S,P)){var L=Tp(S,P);return S=Bu(S,S.next),L=Bu(L,L.next),mf(S,o,u,h,y,b),void mf(L,o,u,h,y,b)}P=P.next}S=S.next}while(S!==t)}function Gh(t,o){return t.x-o.x}function Cd(t,o){if(o=function(h,y){var b,S=y,P=h.x,L=h.y,z=-1/0;do{if(L<=S.y&&L>=S.next.y&&S.next.y!==S.y){var Z=S.x+(L-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=P&&Z>z){if(z=Z,Z===P){if(L===S.y)return S;if(L===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(P===z)return b;var G,J=b,ne=b.x,Ce=b.y,Te=1/0;S=b;do P>=S.x&&S.x>=ne&&P!==S.x&&yf(L<Ce?P:z,L,ne,Ce,L<Ce?z:P,L,S.x,S.y)&&(G=Math.abs(L-S.y)/(P-S.x),Hf(S,h)&&(G<Te||G===Te&&(S.x>b.x||S.x===b.x&&oh(b,S)))&&(b=S,Te=G)),S=S.next;while(S!==J);return b}(t,o)){var u=Tp(o,t);Bu(o,o.next),Bu(u,u.next)}}function oh(t,o){return Oo(t.prev,t,o.prev)<0&&Oo(o.next,t,t.next)<0}function Gf(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Ad(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function yf(t,o,u,h,y,b,S,P){return(y-S)*(o-P)-(t-S)*(b-P)>=0&&(t-S)*(h-P)-(u-S)*(o-P)>=0&&(u-S)*(b-P)-(y-S)*(h-P)>=0}function wd(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Hh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Hf(t,o)&&Hf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,P=(u.y+h.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&S<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Oo(t.prev,t,o.prev)||Oo(t,o.prev,o))||Ap(t,o)&&Oo(t.prev,t,t.next)>0&&Oo(o.prev,o,o.next)>0)}function Oo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Ap(t,o){return t.x===o.x&&t.y===o.y}function Hh(t,o,u,h){var y=wp(Oo(t,o,u)),b=wp(Oo(t,o,h)),S=wp(Oo(u,h,t)),P=wp(Oo(u,h,o));return y!==b&&S!==P||!(y!==0||!Xl(t,u,o))||!(b!==0||!Xl(t,h,o))||!(S!==0||!Xl(u,t,h))||!(P!==0||!Xl(u,o,h))}function Xl(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function wp(t){return t>0?1:t<0?-1:0}function Hf(t,o){return Oo(t.prev,t,t.next)<0?Oo(t,o,t.next)>=0&&Oo(t,t.prev,o)>=0:Oo(t,o,t.prev)<0||Oo(t,t.next,o)<0}function Tp(t,o){var u=new jc(t.i,t.x,t.y),h=new jc(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function Wf(t,o,u,h){var y=new jc(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function Yl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jc(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xf(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Mp(t,o,u,h,y){(function b(S,P,L,z,Z){for(;z>L;){if(z-L>600){var G=z-L+1,J=P-L+1,ne=Math.log(G),Ce=.5*Math.exp(2*ne/3),Te=.5*Math.sqrt(ne*Ce*(G-Ce)/G)*(J-G/2<0?-1:1);b(S,P,Math.max(L,Math.floor(P-J*Ce/G+Te)),Math.min(z,Math.floor(P+(G-J)*Ce/G+Te)),Z)}var Xe=S[P],Be=L,at=z;for(ql(S,L,P),Z(S[z],Xe)>0&&ql(S,L,z);Be<at;){for(ql(S,Be,at),Be++,at--;Z(S[Be],Xe)<0;)Be++;for(;Z(S[at],Xe)>0;)at--}Z(S[L],Xe)===0?ql(S,L,at):ql(S,++at,z),at<=P&&(L=at+1),P<=at&&(z=at-1)}})(t,o,u||0,h||t.length-1,y||Yf)}function ql(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function Yf(t,o){return t<o?-1:t>o?1:0}function qf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var P=Tr(t[S]);P!==0&&(t[S].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var L=0;L<b.length;L++)b[L].length<=o||(Mp(b[L],o,1,b[L].length-1,Pp),b[L]=b[L].slice(0,o));return b}function Pp(t,o){return o.area-t.area}function _f(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var P=S[b].paint.get(t+"-pattern");P.isConstant()||(y=!0);var L=P.constantOr(null);L&&(y=!0,h[L.to]=!0,h[L.from]=!0)}return y}function xf(t,o,u,h,y){for(var b=y.patternDependencies,S=0,P=o;S<P.length;S+=1){var L=P[S],z=L.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:h-1},u,{},y.availableImages),G=z.evaluate({zoom:h},u,{},y.availableImages),J=z.evaluate({zoom:h+1},u,{},y.availableImages);G=G&&G.name?G.name:G,J=J&&J.name?J.name:J,b[Z=Z&&Z.name?Z.name:Z]=!0,b[G]=!0,b[J]=!0,u.patterns[L.id]={min:Z,mid:G,max:J}}}return u}Cp.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(Xf(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,P=o.length;S<P;S++)b-=Math.abs(Xf(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var L=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,Z=h[S+1]*u,G=h[S+2]*u;L+=Math.abs((t[z]-t[G])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[G+1]-t[z+1]))}return b===0&&L===0?0:Math.abs((L-b)/b)},Cp.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},lc.default=vf;var Ns=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wu,this.indexArray=new Yu,this.indexArray2=new Bc,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Ns.prototype.populate=function(t,o,u){this.hasPattern=_f("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],L=P.feature,z=P.id,Z=P.index,G=P.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,ne=ho(L,J);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ne,u)){var Ce=h?h.evaluate(ne,{},u,o.availableImages):void 0,Te={id:z,properties:L.properties,type:L.type,sourceLayerIndex:G,index:Z,geometry:J?ne.geometry:no(L),patterns:{},sortKey:Ce};y.push(Te)}}h&&y.sort(function(Pr,Hr){return Pr.sortKey-Hr.sortKey});for(var Xe=0,Be=y;Xe<Be.length;Xe+=1){var at=Be[Xe],gt=at.geometry,Rt=at.index,wt=at.sourceLayerIndex;if(this.hasPattern){var ir=xf("fill",this.layers,at,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(at,gt,Rt,u,{});o.featureIndex.insert(t[Rt].feature,gt,Rt,wt,this.index)}},Ns.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ns.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ns.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=qf(o,500);b<S.length;b+=1){for(var P=S[b],L=0,z=0,Z=P;z<Z.length;z+=1)L+=Z[z].length;for(var G=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),J=G.vertexLength,ne=[],Ce=[],Te=0,Xe=P;Te<Xe.length;Te+=1){var Be=Xe[Te];if(Be.length!==0){Be!==P[0]&&Ce.push(ne.length/2);var at=this.segments2.prepareSegment(Be.length,this.layoutVertexArray,this.indexArray2),gt=at.vertexLength;this.layoutVertexArray.emplaceBack(Be[0].x,Be[0].y),this.indexArray2.emplaceBack(gt+Be.length-1,gt),ne.push(Be[0].x),ne.push(Be[0].y);for(var Rt=1;Rt<Be.length;Rt++)this.layoutVertexArray.emplaceBack(Be[Rt].x,Be[Rt].y),this.indexArray2.emplaceBack(gt+Rt-1,gt+Rt),ne.push(Be[Rt].x),ne.push(Be[Rt].y);at.vertexLength+=Be.length,at.primitiveLength+=Be.length}}for(var wt=lc(ne,Ce),ir=0;ir<wt.length;ir+=3)this.indexArray.emplaceBack(J+wt[ir],J+wt[ir+1],J+wt[ir+2]);G.vertexLength+=L,G.primitiveLength+=wt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},vn("FillBucket",Ns,{omit:["layers","patternFeatures"]});var Ip=new Yo({"fill-sort-key":new Pn(ue.layout_fill["fill-sort-key"])}),Nr={paint:new Yo({"fill-antialias":new Dn(ue.paint_fill["fill-antialias"]),"fill-opacity":new Pn(ue.paint_fill["fill-opacity"]),"fill-color":new Pn(ue.paint_fill["fill-color"]),"fill-outline-color":new Pn(ue.paint_fill["fill-outline-color"]),"fill-translate":new Dn(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Dn(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new lf(ue.paint_fill["fill-pattern"])}),layout:Ip},Kf=function(t){function o(u){t.call(this,u,Nr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Ns(u)},o.prototype.queryRadius=function(){return oo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,L){return Su(Au(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,L),b)},o.prototype.isTileClipped=function(){return!0},o}(fu),Zt=Za([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Op=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(cc,this,o)}function cc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],P=y._values[h.readVarint()];y.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function sh(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,P=[];t.pos<u;){if(y<=0){var L=t.readVarint();h=7&L,y=L>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&P.push(o),o=[]),o.push(new ce(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&P.push(o),P},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,P=-1/0,L=1/0,z=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>P&&(P=y),(b+=t.readSVarint())<L&&(L=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,L,P,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,L=this.loadGeometry(),z=El.types[this.type];function Z(ne){for(var Ce=0;Ce<ne.length;Ce++){var Te=ne[Ce];ne[Ce]=[360*(Te.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Te.y+P)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<L.length;h++)G[h]=L[h][0];Z(L=G);break;case 2:for(h=0;h<L.length;h++)Z(L[h]);break;case 3:for(L=function(ne){var Ce=ne.length;if(Ce<=1)return[ne];for(var Te,Xe,Be=[],at=0;at<Ce;at++){var gt=sh(ne[at]);gt!==0&&(Xe===void 0&&(Xe=gt<0),Xe===gt<0?(Te&&Be.push(Te),Te=[ne[at]]):Te.push(ne[at]))}return Te&&Be.push(Te),Be}(L),h=0;h<L.length;h++)for(y=0;y<L[h].length;y++)Z(L[h][y])}L.length===1?L=L[0]:z="Multi"+z;var J={type:"Feature",geometry:{type:z,coordinates:L},properties:this.properties};return"id"in this&&(J.id=this.id),J};var $f=Wh;function Wh(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Xh,this,o),this.length=this._features.length}function Xh(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function Qf(t,o,u){if(t===3){var h=new $f(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}Wh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Op(this._pbf,o,this.extent,this._keys,this._values)};var wu={VectorTile:function(t,o){this.layers=t.readFields(Qf,{},o)},VectorTileFeature:Op,VectorTileLayer:$f},Yh=wu.VectorTileFeature.types,Jf=Math.pow(2,13);function Vc(t,o,u,h,y,b,S,P){t.emplaceBack(o,u,2*Math.floor(h*Jf)+S,y*Jf*2,b*Jf*2,Math.round(P))}var Nu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Eu,this.indexArray=new Yu,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function uh(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Nu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=_f("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,P=b.id,L=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,G=ho(S,Z);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),G,u)){var J={id:P,sourceLayerIndex:z,index:L,geometry:Z?G.geometry:no(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(xf("fill-extrusion",this.layers,J,this.zoom,o)):this.addFeature(J,J.geometry,L,u,{}),o.featureIndex.insert(S,J.geometry,L,z,this.index,!0)}}},Nu.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Nu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Nu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Nu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Nu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zt),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Nu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Nu.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=qf(o,500);b<S.length;b+=1){for(var P=S[b],L=0,z=0,Z=P;z<Z.length;z+=1)L+=Z[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),J=0,ne=P;J<ne.length;J+=1){var Ce=ne[J];if(Ce.length!==0&&!((Zi=Ce).every(function(En){return En.x<0})||Zi.every(function(En){return En.x>8192})||Zi.every(function(En){return En.y<0})||Zi.every(function(En){return En.y>8192})))for(var Te=0,Xe=0;Xe<Ce.length;Xe++){var Be=Ce[Xe];if(Xe>=1){var at=Ce[Xe-1];if(!uh(Be,at)){G.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var gt=Be.sub(at)._perp()._unit(),Rt=at.dist(Be);Te+Rt>32768&&(Te=0),Vc(this.layoutVertexArray,Be.x,Be.y,gt.x,gt.y,0,0,Te),Vc(this.layoutVertexArray,Be.x,Be.y,gt.x,gt.y,0,1,Te),Vc(this.layoutVertexArray,at.x,at.y,gt.x,gt.y,0,0,Te+=Rt),Vc(this.layoutVertexArray,at.x,at.y,gt.x,gt.y,0,1,Te);var wt=G.vertexLength;this.indexArray.emplaceBack(wt,wt+2,wt+1),this.indexArray.emplaceBack(wt+1,wt+2,wt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+L>se.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),Yh[t.type]==="Polygon"){for(var ir=[],Pr=[],Hr=G.vertexLength,Bn=0,pn=P;Bn<pn.length;Bn+=1){var Hn=pn[Bn];if(Hn.length!==0){Hn!==P[0]&&Pr.push(ir.length/2);for(var dn=0;dn<Hn.length;dn++){var ki=Hn[dn];Vc(this.layoutVertexArray,ki.x,ki.y,0,0,1,1,0),ir.push(ki.x),ir.push(ki.y)}}}for(var ii=lc(ir,Pr),nn=0;nn<ii.length;nn+=3)this.indexArray.emplaceBack(Hr+ii[nn],Hr+ii[nn+2],Hr+ii[nn+1]);G.primitiveLength+=ii.length/3,G.vertexLength+=L}}var Zi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},vn("FillExtrusionBucket",Nu,{omit:["layers","features"]});var qh={paint:new Yo({"fill-extrusion-opacity":new Dn(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dn(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dn(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new lf(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dn(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Sl=function(t){function o(u){t.call(this,u,qh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Nu(u)},o.prototype.queryRadius=function(){return oo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,L,z){var Z=Au(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,L),G=this.paint.get("fill-extrusion-height").evaluate(h,y),J=this.paint.get("fill-extrusion-base").evaluate(h,y),ne=function(Te,Xe,Be,at){for(var gt=[],Rt=0,wt=Te;Rt<wt.length;Rt+=1){var ir=wt[Rt],Pr=[ir.x,ir.y,0,1];Uc(Pr,Pr,Xe),gt.push(new ce(Pr[0]/Pr[3],Pr[1]/Pr[3]))}return gt}(Z,z),Ce=function(Te,Xe,Be,at){for(var gt=[],Rt=[],wt=at[8]*Xe,ir=at[9]*Xe,Pr=at[10]*Xe,Hr=at[11]*Xe,Bn=at[8]*Be,pn=at[9]*Be,Hn=at[10]*Be,dn=at[11]*Be,ki=0,ii=Te;ki<ii.length;ki+=1){for(var nn=[],Zi=[],En=0,ra=ii[ki];En<ra.length;En+=1){var Wn=ra[En],ha=Wn.x,V=Wn.y,mo=at[0]*ha+at[4]*V+at[12],uo=at[1]*ha+at[5]*V+at[13],$a=at[2]*ha+at[6]*V+at[14],go=at[3]*ha+at[7]*V+at[15],es=$a+Pr,ts=go+Hr,zs=mo+Bn,yo=uo+pn,Us=$a+Hn,Ao=go+dn,ls=new ce((mo+wt)/ts,(uo+ir)/ts);ls.z=es/ts,nn.push(ls);var Vi=new ce(zs/Ao,yo/Ao);Vi.z=Us/Ao,Zi.push(Vi)}gt.push(nn),Rt.push(Zi)}return[gt,Rt]}(b,J,G,z);return function(Te,Xe,Be){var at=1/0;Su(Be,Xe)&&(at=fc(Be,Xe[0]));for(var gt=0;gt<Xe.length;gt++)for(var Rt=Xe[gt],wt=Te[gt],ir=0;ir<Rt.length-1;ir++){var Pr=Rt[ir],Hr=[Pr,Rt[ir+1],wt[ir+1],wt[ir],Pr];qu(Be,Hr)&&(at=Math.min(at,fc(Be,Hr)))}return at!==1/0&&at}(Ce[0],Ce[1],ne)},o}(fu);function Gc(t,o){return t.x*o.x+t.y*o.y}function fc(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],P=u.sub(y),L=b.sub(y),z=S.sub(y),Z=Gc(P,P),G=Gc(P,L),J=Gc(L,L),ne=Gc(z,P),Ce=Gc(z,L),Te=Z*J-G*G,Xe=(J*ne-G*Ce)/Te,Be=(Z*Ce-G*ne)/Te,at=y.z*(1-Xe-Be)+u.z*Xe+b.z*Be;if(isFinite(at))return at}return 1/0}for(var gt=1/0,Rt=0,wt=o;Rt<wt.length;Rt+=1)gt=Math.min(gt,wt[Rt].z);return gt}var Cl=Za([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Kh=Za([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,lh=wu.VectorTileFeature.types,Rp=Math.cos(Math.PI/180*37.5),ch=Math.pow(2,14)/.5,ma=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new No,this.layoutVertexArray2=new Xu,this.indexArray=new Yu,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ma.prototype.populate=function(t,o,u){this.hasPattern=_f("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],L=P.feature,z=P.id,Z=P.index,G=P.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,ne=ho(L,J);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ne,u)){var Ce=h?h.evaluate(ne,{},u):void 0,Te={id:z,properties:L.properties,type:L.type,sourceLayerIndex:G,index:Z,geometry:J?ne.geometry:no(L),patterns:{},sortKey:Ce};y.push(Te)}}h&&y.sort(function(Pr,Hr){return Pr.sortKey-Hr.sortKey});for(var Xe=0,Be=y;Xe<Be.length;Xe+=1){var at=Be[Xe],gt=at.geometry,Rt=at.index,wt=at.sourceLayerIndex;if(this.hasPattern){var ir=xf("line",this.layers,at,this.zoom,o);this.patternFeatures.push(ir)}else this.addFeature(at,gt,Rt,u,{});o.featureIndex.insert(t[Rt].feature,gt,Rt,wt,this.index)}},ma.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ma.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},ma.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ma.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ma.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Kh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ma.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ma.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ma.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),P=b.get("line-cap"),L=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,G=o;Z<G.length;Z+=1)this.addLine(G[Z],t,S,P,L,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},ma.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=lh[o.type]==="Polygon",L=t.length;L>=2&&t[L-1].equals(t[L-2]);)L--;for(var z=0;z<L-1&&t[z].equals(t[z+1]);)z++;if(!(L<(P?3:2))){u==="bevel"&&(y=1.05);var Z,G=this.overscaling<=16?122880/(512*this.overscaling):0,J=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),ne=void 0,Ce=void 0,Te=void 0,Xe=void 0;this.e1=this.e2=-1,P&&(Xe=t[z].sub(Z=t[L-2])._unit()._perp());for(var Be=z;Be<L;Be++)if(!(Ce=Be===L-1?P?t[z+1]:void 0:t[Be+1])||!t[Be].equals(Ce)){Xe&&(Te=Xe),Z&&(ne=Z),Z=t[Be],Xe=Ce?Ce.sub(Z)._unit()._perp():Te;var at=(Te=Te||Xe).add(Xe);at.x===0&&at.y===0||at._unit();var gt=Te.x*Xe.x+Te.y*Xe.y,Rt=at.x*Xe.x+at.y*Xe.y,wt=Rt!==0?1/Rt:1/0,ir=2*Math.sqrt(2-2*Rt),Pr=Rt<Rp&&ne&&Ce,Hr=Te.x*Xe.y-Te.y*Xe.x>0;if(Pr&&Be>z){var Bn=Z.dist(ne);if(Bn>2*G){var pn=Z.sub(Z.sub(ne)._mult(G/Bn)._round());this.updateDistance(ne,pn),this.addCurrentVertex(pn,Te,0,0,J),ne=pn}}var Hn=ne&&Ce,dn=Hn?u:P?"butt":h;if(Hn&&dn==="round"&&(wt<b?dn="miter":wt<=2&&(dn="fakeround")),dn==="miter"&&wt>y&&(dn="bevel"),dn==="bevel"&&(wt>2&&(dn="flipbevel"),wt<y&&(dn="miter")),ne&&this.updateDistance(ne,Z),dn==="miter")at._mult(wt),this.addCurrentVertex(Z,at,0,0,J);else if(dn==="flipbevel"){if(wt>100)at=Xe.mult(-1);else{var ki=wt*Te.add(Xe).mag()/Te.sub(Xe).mag();at._perp()._mult(ki*(Hr?-1:1))}this.addCurrentVertex(Z,at,0,0,J),this.addCurrentVertex(Z,at.mult(-1),0,0,J)}else if(dn==="bevel"||dn==="fakeround"){var ii=-Math.sqrt(wt*wt-1),nn=Hr?ii:0,Zi=Hr?0:ii;if(ne&&this.addCurrentVertex(Z,Te,nn,Zi,J),dn==="fakeround")for(var En=Math.round(180*ir/Math.PI/20),ra=1;ra<En;ra++){var Wn=ra/En;if(Wn!==.5){var ha=Wn-.5;Wn+=Wn*ha*(Wn-1)*((1.0904+gt*(gt*(3.55645-1.43519*gt)-3.2452))*ha*ha+(.848013+gt*(.215638*gt-1.06021)))}var V=Xe.sub(Te)._mult(Wn)._add(Te)._unit()._mult(Hr?-1:1);this.addHalfVertex(Z,V.x,V.y,!1,Hr,0,J)}Ce&&this.addCurrentVertex(Z,Xe,-nn,-Zi,J)}else if(dn==="butt")this.addCurrentVertex(Z,at,0,0,J);else if(dn==="square"){var mo=ne?1:-1;this.addCurrentVertex(Z,at,mo,mo,J)}else dn==="round"&&(ne&&(this.addCurrentVertex(Z,Te,0,0,J),this.addCurrentVertex(Z,Te,1,1,J,!0)),Ce&&(this.addCurrentVertex(Z,Xe,-1,-1,J,!0),this.addCurrentVertex(Z,Xe,0,0,J)));if(Pr&&Be<L-1){var uo=Z.dist(Ce);if(uo>2*G){var $a=Z.add(Ce.sub(Z)._mult(G/uo)._round());this.updateDistance(Z,$a),this.addCurrentVertex($a,Xe,0,0,J),Z=$a}}}}},ma.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,P=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,P,b,!0,-h,y),this.distance>ch/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},ma.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var P=.5*(this.lineClips?this.scaledDistance*(ch-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),S.primitiveLength++),y?this.e2=L:this.e1=L},ma.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ma.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},vn("LineBucket",ma,{omit:["layers","patternFeatures"]});var pc=new Yo({"line-cap":new Dn(ue.layout_line["line-cap"]),"line-join":new Pn(ue.layout_line["line-join"]),"line-miter-limit":new Dn(ue.layout_line["line-miter-limit"]),"line-round-limit":new Dn(ue.layout_line["line-round-limit"]),"line-sort-key":new Pn(ue.layout_line["line-sort-key"])}),Ro={paint:new Yo({"line-opacity":new Pn(ue.paint_line["line-opacity"]),"line-color":new Pn(ue.paint_line["line-color"]),"line-translate":new Dn(ue.paint_line["line-translate"]),"line-translate-anchor":new Dn(ue.paint_line["line-translate-anchor"]),"line-width":new Pn(ue.paint_line["line-width"]),"line-gap-width":new Pn(ue.paint_line["line-gap-width"]),"line-offset":new Pn(ue.paint_line["line-offset"]),"line-blur":new Pn(ue.paint_line["line-blur"]),"line-dasharray":new vs(ue.paint_line["line-dasharray"]),"line-pattern":new lf(ue.paint_line["line-pattern"]),"line-gradient":new bu(ue.paint_line["line-gradient"])}),layout:pc},Ys=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Oi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=kt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(Pn))(Ro.paint.properties["line-width"].specification);Ys.useIntegerZoom=!0;var $h=function(t){function o(u){t.call(this,u,Ro),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Wo,this.gradientVersion=(this.gradientVersion+1)%nt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Ys.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ma(u)},o.prototype.queryRadius=function(u){var h=u,y=fh(pu("line-width",this,h),pu("line-gap-width",this,h)),b=pu("line-offset",this,h);return y/2+Math.abs(b)+oo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,L){var z=Au(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,L),Z=L/2*fh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),G=this.paint.get("line-offset").evaluate(h,y);return G&&(b=function(J,ne){for(var Ce=[],Te=new ce(0,0),Xe=0;Xe<J.length;Xe++){for(var Be=J[Xe],at=[],gt=0;gt<Be.length;gt++){var Rt=Be[gt],wt=Be[gt+1],ir=gt===0?Te:Rt.sub(Be[gt-1])._unit()._perp(),Pr=gt===Be.length-1?Te:wt.sub(Rt)._unit()._perp(),Hr=ir._add(Pr)._unit();Hr._mult(1/(Hr.x*Pr.x+Hr.y*Pr.y)),at.push(Hr._mult(ne)._add(Rt))}Ce.push(at)}return Ce}(b,G*L)),function(J,ne,Ce){for(var Te=0;Te<ne.length;Te++){var Xe=ne[Te];if(J.length>=3){for(var Be=0;Be<Xe.length;Be++)if(Fs(J,Xe[Be]))return!0}if(os(J,Xe,Ce))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(fu);function fh(t,o){return o>0?o+2*t:t}var Td=Za([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),d0=Za([{name:"a_projected_pos",components:3,type:"Float32"}],4),Md=(Za([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Za([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),kp=(Za([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Za([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Qh=Za([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pd(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var P=b.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),ru.applyArabicShaping&&(y=ru.applyArabicShaping(y)),y}(h.text,o,u)}),t}Za([{name:"triangle",components:3,type:"Uint16"}]),Za([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Za([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Za([{type:"Float32",name:"offsetX"}]),Za([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var bf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ph=function(t,o,u,h,y){var b,S,P=8*y-h-1,L=(1<<P)-1,z=L>>1,Z=-7,G=u?y-1:0,J=u?-1:1,ne=t[o+G];for(G+=J,b=ne&(1<<-Z)-1,ne>>=-Z,Z+=P;Z>0;b=256*b+t[o+G],G+=J,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+G],G+=J,Z-=8);if(b===0)b=1-z;else{if(b===L)return S?NaN:1/0*(ne?-1:1);S+=Math.pow(2,h),b-=z}return(ne?-1:1)*S*Math.pow(2,b-h)},Jh=function(t,o,u,h,y,b){var S,P,L,z=8*b-y-1,Z=(1<<z)-1,G=Z>>1,J=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=h?0:b-1,Ce=h?1:-1,Te=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(L=Math.pow(2,-S))<1&&(S--,L*=2),(o+=S+G>=1?J/L:J*Math.pow(2,1-G))*L>=2&&(S++,L/=2),S+G>=Z?(P=0,S=Z):S+G>=1?(P=(o*L-1)*Math.pow(2,y),S+=G):(P=o*Math.pow(2,G-1)*Math.pow(2,y),S=0));y>=8;t[u+ne]=255&P,ne+=Ce,P/=256,y-=8);for(S=S<<y|P,z+=y;z>0;t[u+ne]=255&S,ne+=Ce,S/=256,z-=8);t[u+ne-Ce]|=128*Te},ep=Pa;function Pa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pa.Varint=0,Pa.Fixed64=1,Pa.Bytes=2,Pa.Fixed32=5;var Lp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Tu(t){return t.type===Pa.Bytes?t.readVarint()+t.pos:t.pos+1}function Ef(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Ia(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function hc(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function fe(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Le(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function It(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function rr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Pt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Kt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function cr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function gr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function hr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Er(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Ar(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var h=u.readMessage(yr,{}),y=h.width,b=h.height,S=h.left,P=h.top,L=h.advance;o.push({id:h.id,bitmap:new hu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:P,advance:L}})}}function yr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function wr(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Te,Xe){return Xe.h-Te.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,L=0,z=0,Z=t;z<Z.length;z+=1)for(var G=Z[z],J=S.length-1;J>=0;J--){var ne=S[J];if(!(G.w>ne.w||G.h>ne.h)){if(G.x=ne.x,G.y=ne.y,L=Math.max(L,G.y+G.h),P=Math.max(P,G.x+G.w),G.w===ne.w&&G.h===ne.h){var Ce=S.pop();J<S.length&&(S[J]=Ce)}else G.h===ne.h?(ne.x+=G.w,ne.w-=G.w):G.w===ne.w?(ne.y+=G.h,ne.h-=G.h):(S.push({x:ne.x+G.w,y:ne.y,w:ne.w-G.w,h:G.h}),ne.y+=G.h,ne.h-=G.h);break}}return{w:P,h:L,fill:o/(P*L)||0}}Pa.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=gr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Er(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=gr(this.buf,this.pos)+4294967296*gr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=gr(this.buf,this.pos)+4294967296*Er(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ph(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ph(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var P,L,z=S.buf;if(P=(112&(L=z[S.pos++]))>>4,L<128||(P|=(127&(L=z[S.pos++]))<<3,L<128)||(P|=(127&(L=z[S.pos++]))<<10,L<128)||(P|=(127&(L=z[S.pos++]))<<17,L<128)||(P|=(127&(L=z[S.pos++]))<<24,L<128)||(P|=(1&(L=z[S.pos++]))<<31,L<128))return Ef(y,P,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&Lp?function(u,h,y){return Lp.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var P,L,z,Z=u[S],G=null,J=Z>239?4:Z>223?3:Z>191?2:1;if(S+J>y)break;J===1?Z<128&&(G=Z):J===2?(192&(P=u[S+1]))==128&&(G=(31&Z)<<6|63&P)<=127&&(G=null):J===3?(L=u[S+2],(192&(P=u[S+1]))==128&&(192&L)==128&&((G=(15&Z)<<12|(63&P)<<6|63&L)<=2047||G>=55296&&G<=57343)&&(G=null)):J===4&&(L=u[S+2],z=u[S+3],(192&(P=u[S+1]))==128&&(192&L)==128&&(192&z)==128&&((G=(15&Z)<<18|(63&P)<<12|(63&L)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,J=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),S+=J}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Pa.Bytes)return t.push(this.readVarint(o));var u=Tu(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSVarint());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pa.Bytes)return t.push(this.readBoolean());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFloat());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pa.Bytes)return t.push(this.readDouble());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed32());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed32());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readFixed64());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pa.Bytes)return t.push(this.readSFixed64());var o=Tu(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Pa.Varint)for(;this.buf[this.pos++]>127;);else if(o===Pa.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Pa.Fixed32)this.pos+=4;else{if(o!==Pa.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),hr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),hr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),hr(this.buf,-1&t,this.pos),hr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),hr(this.buf,-1&t,this.pos),hr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,P){P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,P.buf[P.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var P=(7&b)<<4;S.buf[S.pos++]|=P|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,P,L=0;L<y.length;L++){if((S=y.charCodeAt(L))>55295&&S<57344){if(!P){S>56319||L+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):P=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(h[b++]=239,h[b++]=191,h[b++]=189,P=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&Ia(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),Jh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Jh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&Ia(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Pa.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,hc,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,It,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,fe,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Le,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,rr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Pt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Kt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,cr,o)},writeBytesField:function(t,o){this.writeTag(t,Pa.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Pa.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Pa.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Pa.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Pa.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Pa.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var it=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},zt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};zt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},zt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},zt.tlbr.get=function(){return this.tl.concat(this.br)},zt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(it.prototype,zt);var xr=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=wr(y),S=new Io({width:b.w||1,height:b.h||1});for(var P in t){var L=t[P],z=u[P].paddedRect;Io.copy(L.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},L.data)}for(var Z in o){var G=o[Z],J=h[Z].paddedRect,ne=J.x+1,Ce=J.y+1,Te=G.data.width,Xe=G.data.height;Io.copy(G.data,S,{x:0,y:0},{x:ne,y:Ce},G.data),Io.copy(G.data,S,{x:0,y:Xe-1},{x:ne,y:Ce-1},{width:Te,height:1}),Io.copy(G.data,S,{x:0,y:0},{x:ne,y:Ce+Xe},{width:Te,height:1}),Io.copy(G.data,S,{x:Te-1,y:0},{x:ne-1,y:Ce},{width:1,height:Xe}),Io.copy(G.data,S,{x:0,y:0},{x:ne+Te,y:Ce},{width:1,height:Xe})}this.image=S,this.iconPositions=u,this.patternPositions=h};xr.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new it(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},xr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},xr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},vn("ImagePosition",it),vn("ImageAtlas",xr);var zr={horizontal:1,vertical:2,horizontalOnly:3},lr=function(){this.scale=1,this.fontStack="",this.imageName=null};lr.forText=function(t,o){var u=new lr;return u.scale=t||1,u.fontStack=o,u},lr.forImage=function(t){var o=new lr;return o.imageName=t,o};var kr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Qr(t,o,u,h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te){var Xe,Be=kr.fromFeature(t,y);G===zr.vertical&&Be.verticalizePunctuation();var at=ru.processBidirectionalText,gt=ru.processStyledBidirectionalText;if(at&&Be.sections.length===1){Xe=[];for(var Rt=0,wt=at(Be.toString(),$r(Be,z,b,o,h,ne,Ce));Rt<wt.length;Rt+=1){var ir=wt[Rt],Pr=new kr;Pr.text=ir,Pr.sections=Be.sections;for(var Hr=0;Hr<ir.length;Hr++)Pr.sectionIndex.push(0);Xe.push(Pr)}}else if(gt){Xe=[];for(var Bn=0,pn=gt(Be.text,Be.sectionIndex,$r(Be,z,b,o,h,ne,Ce));Bn<pn.length;Bn+=1){var Hn=pn[Bn],dn=new kr;dn.text=Hn[0],dn.sectionIndex=Hn[1],dn.sections=Be.sections,Xe.push(dn)}}else Xe=function(nn,Zi){for(var En=[],ra=nn.text,Wn=0,ha=0,V=Zi;ha<V.length;ha+=1){var mo=V[ha];En.push(nn.substring(Wn,mo)),Wn=mo}return Wn<ra.length&&En.push(nn.substring(Wn,ra.length)),En}(Be,$r(Be,z,b,o,h,ne,Ce));var ki=[],ii={positionedLines:ki,text:Be.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(nn,Zi,En,ra,Wn,ha,V,mo,uo,$a,go,es){for(var ts=0,zs=-17,yo=0,Us=0,Ao=mo==="right"?1:mo==="left"?0:.5,ls=0,Vi=0,Oa=Wn;Vi<Oa.length;Vi+=1){var wa=Oa[Vi];wa.trim();var $i=wa.getMaxScale(),ou=24*($i-1),Zs={positionedGlyphs:[],lineOffset:0};nn.positionedLines[ls]=Zs;var Ya=Zs.positionedGlyphs,ko=0;if(wa.length()){for(var Ms=0;Ms<wa.length();Ms++){var la=wa.getSection(Ms),$l=wa.getSectionIndex(Ms),Ks=wa.getCharCode(Ms),Ql=0,wo=null,Jl=null,wl=null,Fp=24,wf=!(uo===zr.horizontal||!go&&!of(Ks)||go&&(Un[Ks]||(dc=Ks,Kr.Arabic(dc)||Kr["Arabic Supplement"](dc)||Kr["Arabic Extended-A"](dc)||Kr["Arabic Presentation Forms-A"](dc)||Kr["Arabic Presentation Forms-B"](dc))));if(la.imageName){var Bp=ra[la.imageName];if(!Bp)continue;wl=la.imageName,nn.iconsInText=nn.iconsInText||!0,Jl=Bp.paddedRect;var Zu=Bp.displaySize;la.scale=24*la.scale/es,Ql=ou+(24-Zu[1]*la.scale),Fp=(wo={width:Zu[0],height:Zu[1],left:1,top:-3,advance:wf?Zu[1]:Zu[0]}).advance;var Np=wf?Zu[0]*la.scale-24*$i:Zu[1]*la.scale-24*$i;Np>0&&Np>ko&&(ko=Np)}else{var Tl=En[la.fontStack],zp=Tl&&Tl[Ks];if(zp&&zp.rect)Jl=zp.rect,wo=zp.metrics;else{var hh=Zi[la.fontStack],rd=hh&&hh[Ks];if(!rd)continue;wo=rd.metrics}Ql=24*($i-la.scale)}wf?(nn.verticalizable=!0,Ya.push({glyph:Ks,imageName:wl,x:ts,y:zs+Ql,vertical:wf,scale:la.scale,fontStack:la.fontStack,sectionIndex:$l,metrics:wo,rect:Jl}),ts+=Fp*la.scale+$a):(Ya.push({glyph:Ks,imageName:wl,x:ts,y:zs+Ql,vertical:wf,scale:la.scale,fontStack:la.fontStack,sectionIndex:$l,metrics:wo,rect:Jl}),ts+=wo.advance*la.scale+$a)}Ya.length!==0&&(yo=Math.max(ts-$a,yo),yi(Ya,0,Ya.length-1,Ao,ko)),ts=0;var Tf=ha*$i+ko;Zs.lineOffset=Math.max(ko,ou),zs+=Tf,Us=Math.max(Tf,Us),++ls}else zs+=ha,++ls}var dc,Up=zs- -17,rp=Jr(V),vc=rp.horizontalAlign,np=rp.verticalAlign;(function(dh,ip,nd,vh,id,Zp,mh,jp,gh){var ap,yh=(ip-nd)*id;ap=Zp!==mh?-jp*vh- -17:(-vh*gh+.5)*mh;for(var op=0,Vp=dh;op<Vp.length;op+=1)for(var Mf=0,Gp=Vp[op].positionedGlyphs;Mf<Gp.length;Mf+=1){var sp=Gp[Mf];sp.x+=yh,sp.y+=ap}})(nn.positionedLines,Ao,vc,np,yo,Us,ha,Up,Wn.length),nn.top+=-np*Up,nn.bottom=nn.top+Up,nn.left+=-vc*yo,nn.right=nn.left+yo}(ii,o,u,h,Xe,S,P,L,G,z,J,Te),!function(nn){for(var Zi=0,En=nn;Zi<En.length;Zi+=1)if(En[Zi].positionedGlyphs.length!==0)return!1;return!0}(ki)&&ii}kr.fromFeature=function(t,o){for(var u=new kr,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},kr.prototype.length=function(){return this.text.length},kr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},kr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},kr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},kr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&hl(h)&&!bf[t[u+1]]||y&&hl(y)&&!bf[t[u-1]]||!bf[t[u]]?t[u]:bf[t[u]]}return o}(this.text)},kr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Un[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Un[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},kr.prototype.substring=function(t,o){var u=new kr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},kr.prototype.toString=function(){return this.text},kr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},kr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(lr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},kr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(lr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}else et("Can't add FormattedSection with an empty image.")},kr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Un={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qt={};function er(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var P=u[o.fontStack],L=P&&P[t];return L?L.metrics.advance*o.scale+y:0}function xn(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Xr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function Sr(t,o,u,h,y,b){for(var S=null,P=xn(o,u,y,b),L=0,z=h;L<z.length;L+=1){var Z=z[L],G=xn(o-Z.x,u,y,b)+Z.badness;G<=P&&(S=Z,P=G)}return{index:t,x:o,priorBreak:S,badness:P}}function $r(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var P,L=[],z=function(Xe,Be,at,gt,Rt,wt){for(var ir=0,Pr=0;Pr<Xe.length();Pr++){var Hr=Xe.getSection(Pr);ir+=er(Xe.getCharCode(Pr),Hr,gt,Rt,Be,wt)}return ir/Math.max(1,Math.ceil(ir/at))}(t,o,u,h,y,S),Z=t.text.indexOf("\u200B")>=0,G=0,J=0;J<t.length();J++){var ne=t.getSection(J),Ce=t.getCharCode(J);if(Un[Ce]||(G+=er(Ce,ne,h,y,o,S)),J<t.length()-1){var Te=!((P=Ce)<11904||!(Kr["Bopomofo Extended"](P)||Kr.Bopomofo(P)||Kr["CJK Compatibility Forms"](P)||Kr["CJK Compatibility Ideographs"](P)||Kr["CJK Compatibility"](P)||Kr["CJK Radicals Supplement"](P)||Kr["CJK Strokes"](P)||Kr["CJK Symbols and Punctuation"](P)||Kr["CJK Unified Ideographs Extension A"](P)||Kr["CJK Unified Ideographs"](P)||Kr["Enclosed CJK Letters and Months"](P)||Kr["Halfwidth and Fullwidth Forms"](P)||Kr.Hiragana(P)||Kr["Ideographic Description Characters"](P)||Kr["Kangxi Radicals"](P)||Kr["Katakana Phonetic Extensions"](P)||Kr.Katakana(P)||Kr["Vertical Forms"](P)||Kr["Yi Radicals"](P)||Kr["Yi Syllables"](P)));(Qt[Ce]||Te||ne.imageName)&&L.push(Sr(J+1,G,z,L,Xr(Ce,t.getCharCode(J+1),Te&&Z),!1))}}return function Xe(Be){return Be?Xe(Be.priorBreak).concat(Be.index):[]}(Sr(t.length(),G,z,L,0,!0))}function Jr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,P=o;P<=u;P++)t[P].x-=S,t[P].y+=y}function ri(t,o,u,h,y,b){var S,P=t.image;if(P.content){var L=P.content,z=P.pixelRatio||1;S=[L[0]/z,L[1]/z,P.displaySize[0]-L[2]/z,P.displaySize[1]-L[3]/z]}var Z,G,J,ne,Ce=o.left*b,Te=o.right*b;u==="width"||u==="both"?(ne=y[0]+Ce-h[3],G=y[0]+Te+h[1]):G=(ne=y[0]+(Ce+Te-P.displaySize[0])/2)+P.displaySize[0];var Xe=o.top*b,Be=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+Xe-h[0],J=y[1]+Be+h[2]):J=(Z=y[1]+(Xe+Be-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Z,right:G,bottom:J,left:ne,collisionPadding:S}}Qt[10]=!0,Qt[32]=!0,Qt[38]=!0,Qt[40]=!0,Qt[41]=!0,Qt[43]=!0,Qt[45]=!0,Qt[47]=!0,Qt[173]=!0,Qt[183]=!0,Qt[8203]=!0,Qt[8208]=!0,Qt[8211]=!0,Qt[8231]=!0;var Gr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ce);function on(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Oi(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var P=h[b],L=h[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:L,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:L,minSize:u.evaluate(new Oi(P)),maxSize:u.evaluate(new Oi(L)),interpolationType:y}}function Qn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?da(y/128,u.upperSize/128,o.uSizeT):h}function li(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?ar(ve.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=da(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}vn("Anchor",Gr);var zi=Object.freeze({__proto__:null,getSizeData:on,evaluateSizeForFeature:Qn,evaluateSizeForZoom:li,SIZE_PACK_FACTOR:128});function io(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(b),b=t[S]}P+=t[S].dist(t[S+1]),S++;for(var L=[],z=0;P<u/2;){var Z=t[S],G=t[S+1];if(!G)return!1;var J=t[S-1].angleTo(Z)-Z.angleTo(G);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:P,angleDelta:J}),z+=J;P-L[0].distance>h;)z-=L.shift().angleDelta;if(z>y)return!1;S++,P+=Z.dist(G)}return!0}function so(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Fi(t,o,u){return t?.6*o*u:0}function ss(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Xa(t,o,u,h,y,b){for(var S=Fi(u,y,b),P=ss(u,h)*b,L=0,z=so(t)/2,Z=0;Z<t.length-1;Z++){var G=t[Z],J=t[Z+1],ne=G.dist(J);if(L+ne>z){var Ce=(z-L)/ne,Te=da(G.x,J.x,Ce),Xe=da(G.y,J.y,Ce),Be=new Gr(Te,Xe,J.angleTo(G),Z);return Be._round(),!S||io(t,Be,P,S,o)?Be:void 0}L+=ne}}function $o(t,o,u,h,y,b,S,P,L){var z=Fi(h,b,S),Z=ss(h,y),G=Z*S,J=t[0].x===0||t[0].x===L||t[0].y===0||t[0].y===L;return o-G<o/4&&(o=G+o/4),function ne(Ce,Te,Xe,Be,at,gt,Rt,wt,ir){for(var Pr=gt/2,Hr=so(Ce),Bn=0,pn=Te-Xe,Hn=[],dn=0;dn<Ce.length-1;dn++){for(var ki=Ce[dn],ii=Ce[dn+1],nn=ki.dist(ii),Zi=ii.angleTo(ki);pn+Xe<Bn+nn;){var En=((pn+=Xe)-Bn)/nn,ra=da(ki.x,ii.x,En),Wn=da(ki.y,ii.y,En);if(ra>=0&&ra<ir&&Wn>=0&&Wn<ir&&pn-Pr>=0&&pn+Pr<=Hr){var ha=new Gr(ra,Wn,Zi,dn);ha._round(),Be&&!io(Ce,ha,gt,Be,at)||Hn.push(ha)}}Bn+=nn}return wt||Hn.length||Rt||(Hn=ne(Ce,Bn/2,Xe,Be,at,gt,Rt,!0,ir)),Hn}(t,J?o/2*P%o:(Z/2+2*b)*S*P%o,o,z,u,G,J,!1,L)}function vo(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var P=t[S],L=void 0,z=0;z<P.length-1;z++){var Z=P[z],G=P[z+1];Z.x<o&&G.x<o||(Z.x<o?Z=new ce(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x<o&&(G=new ce(o,Z.y+(o-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y<u&&G.y<u||(Z.y<u?Z=new ce(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round():G.y<u&&(G=new ce(Z.x+(u-Z.y)/(G.y-Z.y)*(G.x-Z.x),u)._round()),Z.x>=h&&G.x>=h||(Z.x>=h?Z=new ce(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round():G.x>=h&&(G=new ce(h,Z.y+(h-Z.x)/(G.x-Z.x)*(G.y-Z.y))._round()),Z.y>=y&&G.y>=y||(Z.y>=y?Z=new ce(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round():G.y>=y&&(G=new ce(Z.x+(y-Z.y)/(G.y-Z.y)*(G.x-Z.x),y)._round()),L&&Z.equals(L[L.length-1])||b.push(L=[Z]),L.push(G)))))}return b}function Qo(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,P=b.paddedRect.w-2,L=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,G=b.stretchX||[[0,P]],J=b.stretchY||[[0,L]],ne=function(ra,Wn){return ra+Wn[1]-Wn[0]},Ce=G.reduce(ne,0),Te=J.reduce(ne,0),Xe=P-Ce,Be=L-Te,at=0,gt=Ce,Rt=0,wt=Te,ir=0,Pr=Xe,Hr=0,Bn=Be;if(b.content&&h){var pn=b.content;at=Uo(G,0,pn[0]),Rt=Uo(J,0,pn[1]),gt=Uo(G,pn[0],pn[2]),wt=Uo(J,pn[1],pn[3]),ir=pn[0]-at,Hr=pn[1]-Rt,Pr=pn[2]-pn[0]-gt,Bn=pn[3]-pn[1]-wt}var Hn=function(ra,Wn,ha,V){var mo=Ka(ra.stretch-at,gt,z,t.left),uo=_i(ra.fixed-ir,Pr,ra.stretch,Ce),$a=Ka(Wn.stretch-Rt,wt,Z,t.top),go=_i(Wn.fixed-Hr,Bn,Wn.stretch,Te),es=Ka(ha.stretch-at,gt,z,t.left),ts=_i(ha.fixed-ir,Pr,ha.stretch,Ce),zs=Ka(V.stretch-Rt,wt,Z,t.top),yo=_i(V.fixed-Hr,Bn,V.stretch,Te),Us=new ce(mo,$a),Ao=new ce(es,$a),ls=new ce(es,zs),Vi=new ce(mo,zs),Oa=new ce(uo/S,go/S),wa=new ce(ts/S,yo/S),$i=o*Math.PI/180;if($i){var ou=Math.sin($i),Zs=Math.cos($i),Ya=[Zs,-ou,ou,Zs];Us._matMult(Ya),Ao._matMult(Ya),Vi._matMult(Ya),ls._matMult(Ya)}var ko=ra.stretch+ra.fixed,Ms=Wn.stretch+Wn.fixed;return{tl:Us,tr:Ao,bl:Vi,br:ls,tex:{x:b.paddedRect.x+1+ko,y:b.paddedRect.y+1+Ms,w:ha.stretch+ha.fixed-ko,h:V.stretch+V.fixed-Ms},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oa,pixelOffsetBR:wa,minFontScaleX:Pr/S/z,minFontScaleY:Bn/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var dn=gs(G,Xe,Ce),ki=gs(J,Be,Te),ii=0;ii<dn.length-1;ii++)for(var nn=dn[ii],Zi=dn[ii+1],En=0;En<ki.length-1;En++)y.push(Hn(nn,ki[En],Zi,ki[En+1]));else y.push(Hn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:L+1}));return y}function Uo(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function gs(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],P=S[0],L=S[1],z=h[h.length-1];h.push({fixed:P-z.stretch,stretch:z.stretch}),h.push({fixed:P-z.stretch,stretch:z.stretch+(L-P)})}return h.push({fixed:o+1,stretch:u}),h}function Ka(t,o,u,h){return t/o*u+h}function _i(t,o,u,h){return t-o*u/h}var Zo=function(t,o,u,h,y,b,S,P,L,z){if(this.boxStartIndex=t.length,L){var Z=b.top,G=b.bottom,J=b.collisionPadding;J&&(Z-=J[1],G+=J[3]);var ne=G-Z;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{var Ce=b.top*S-P,Te=b.bottom*S+P,Xe=b.left*S-P,Be=b.right*S+P,at=b.collisionPadding;if(at&&(Xe-=at[0]*S,Ce-=at[1]*S,Be+=at[2]*S,Te+=at[3]*S),z){var gt=new ce(Xe,Ce),Rt=new ce(Be,Ce),wt=new ce(Xe,Te),ir=new ce(Be,Te),Pr=z*Math.PI/180;gt._rotate(Pr),Rt._rotate(Pr),wt._rotate(Pr),ir._rotate(Pr),Xe=Math.min(gt.x,Rt.x,wt.x,ir.x),Be=Math.max(gt.x,Rt.x,wt.x,ir.x),Ce=Math.min(gt.y,Rt.y,wt.y,ir.y),Te=Math.max(gt.y,Rt.y,wt.y,ir.y)}t.emplaceBack(o.x,o.y,Xe,Ce,Be,Te,u,h,y)}this.boxEndIndex=t.length},ta=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=Jo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function Jo(t,o){return t<o?-1:t>o?1:0}function ni(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,P=t[0],L=0;L<P.length;L++){var z=P[L];(!L||z.x<h)&&(h=z.x),(!L||z.y<y)&&(y=z.y),(!L||z.x>b)&&(b=z.x),(!L||z.y>S)&&(S=z.y)}var Z=Math.min(b-h,S-y),G=Z/2,J=new ta([],Di);if(Z===0)return new ce(h,y);for(var ne=h;ne<b;ne+=Z)for(var Ce=y;Ce<S;Ce+=Z)J.push(new ua(ne+G,Ce+G,G,t));for(var Te=function(at){for(var gt=0,Rt=0,wt=0,ir=at[0],Pr=0,Hr=ir.length,Bn=Hr-1;Pr<Hr;Bn=Pr++){var pn=ir[Pr],Hn=ir[Bn],dn=pn.x*Hn.y-Hn.x*pn.y;Rt+=(pn.x+Hn.x)*dn,wt+=(pn.y+Hn.y)*dn,gt+=3*dn}return new ua(Rt/gt,wt/gt,0,at)}(t),Xe=J.length;J.length;){var Be=J.pop();(Be.d>Te.d||!Te.d)&&(Te=Be,u&&console.log("found best %d after %d probes",Math.round(1e4*Be.d)/1e4,Xe)),Be.max-Te.d<=o||(J.push(new ua(Be.p.x-(G=Be.h/2),Be.p.y-G,G,t)),J.push(new ua(Be.p.x+G,Be.p.y-G,G,t)),J.push(new ua(Be.p.x-G,Be.p.y+G,G,t)),J.push(new ua(Be.p.x+G,Be.p.y+G,G,t)),Xe+=4)}return u&&(console.log("num probes: "+Xe),console.log("best distance: "+Te.d)),Te.p}function Di(t,o){return o.max-t.max}function ua(t,o,u,h){this.p=new ce(t,o),this.h=u,this.d=function(y,b){for(var S=!1,P=1/0,L=0;L<b.length;L++)for(var z=b[L],Z=0,G=z.length,J=G-1;Z<G;J=Z++){var ne=z[Z],Ce=z[J];ne.y>y.y!=Ce.y>y.y&&y.x<(Ce.x-ne.x)*(y.y-ne.y)/(Ce.y-ne.y)+ne.x&&(S=!S),P=Math.min(P,yl(y,ne,Ce))}return(S?1:-1)*Math.sqrt(P)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ta.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ta.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ta.prototype.peek=function(){return this.data[0]},ta.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},ta.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],P=b+1;if(P<this.length&&u(o[P],S)<0&&(b=P,S=o[P]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Co=Number.POSITIVE_INFINITY;function Al(t,o){return o[1]!==Co?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function Se(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ft(t,o,u,h,y,b,S,P,L,z,Z,G,J,ne,Ce){var Te=function(Rt,wt,ir,Pr,Hr,Bn,pn,Hn){for(var dn=Pr.layout.get("text-rotate").evaluate(Bn,{})*Math.PI/180,ki=[],ii=0,nn=wt.positionedLines;ii<nn.length;ii+=1)for(var Zi=nn[ii],En=0,ra=Zi.positionedGlyphs;En<ra.length;En+=1){var Wn=ra[En];if(Wn.rect){var ha=Wn.rect||{},V=4,mo=!0,uo=1,$a=0,go=(Hr||Hn)&&Wn.vertical,es=Wn.metrics.advance*Wn.scale/2;if(Hn&&wt.verticalizable&&($a=Zi.lineOffset/2-(Wn.imageName?-(24-Wn.metrics.width*Wn.scale)/2:24*(Wn.scale-1))),Wn.imageName){var ts=pn[Wn.imageName];mo=ts.sdf,V=1/(uo=ts.pixelRatio)}var zs=Hr?[Wn.x+es,Wn.y]:[0,0],yo=Hr?[0,0]:[Wn.x+es+ir[0],Wn.y+ir[1]-$a],Us=[0,0];go&&(Us=yo,yo=[0,0]);var Ao=(Wn.metrics.left-V)*Wn.scale-es+yo[0],ls=(-Wn.metrics.top-V)*Wn.scale+yo[1],Vi=Ao+ha.w*Wn.scale/uo,Oa=ls+ha.h*Wn.scale/uo,wa=new ce(Ao,ls),$i=new ce(Vi,ls),ou=new ce(Ao,Oa),Zs=new ce(Vi,Oa);if(go){var Ya=new ce(-es,es- -17),ko=-Math.PI/2,Ms=12-es,la=new ce(22-Ms,-(Wn.imageName?Ms:0)),$l=new(Function.prototype.bind.apply(ce,[null].concat(Us)));wa._rotateAround(ko,Ya)._add(la)._add($l),$i._rotateAround(ko,Ya)._add(la)._add($l),ou._rotateAround(ko,Ya)._add(la)._add($l),Zs._rotateAround(ko,Ya)._add(la)._add($l)}if(dn){var Ks=Math.sin(dn),Ql=Math.cos(dn),wo=[Ql,-Ks,Ks,Ql];wa._matMult(wo),$i._matMult(wo),ou._matMult(wo),Zs._matMult(wo)}var Jl=new ce(0,0),wl=new ce(0,0);ki.push({tl:wa,tr:$i,bl:ou,br:Zs,tex:ha,writingMode:wt.writingMode,glyphOffset:zs,sectionIndex:Wn.sectionIndex,isSDF:mo,pixelOffsetTL:Jl,pixelOffsetBR:wl,minFontScaleX:0,minFontScaleY:0})}}return ki}(0,u,P,y,b,S,h,t.allowVerticalPlacement),Xe=t.textSizeData,Be=null;Xe.kind==="source"?(Be=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Xe.kind==="composite"&&((Be=[128*ne.compositeTextSizes[0].evaluate(S,{},Ce),128*ne.compositeTextSizes[1].evaluate(S,{},Ce)])[0]>32640||Be[1]>32640)&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Te,Be,P,b,S,z,o,L.lineStartIndex,L.lineLength,J,Ce);for(var at=0,gt=Z;at<gt.length;at+=1)G[gt[at]]=t.text.placedSymbolArray.length-1;return 4*Te.length}function vt(t){for(var o in t)return t[o];return null}function hn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var Ui=wu.VectorTileFeature.types,_e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ae(t,o,u,h,y,b,S,P,L,z,Z,G,J){var ne=P?Math.min(32640,Math.round(P[0])):0,Ce=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(ne<<1)+(L?1:0),Ce,16*z,16*Z,256*G,256*J)}function Ze(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ot(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(yu(u[o].text))return!0;return!1}var At=function(t){this.layoutVertexArray=new ff,this.indexArray=new Yu,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new jl,this.opacityVertexArray=new Dc,this.placedSymbolArray=new d};At.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},At.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Td.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,d0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_e,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},At.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vn("SymbolBuffers",At);var Ye=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new se,this.collisionVertexArray=new pf};Ye.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Md.members,!0)},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vn("CollisionBuffers",Ye);var ke=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bs([]),this.placementViewportMatrix=Bs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=on(this.zoom,o["text-size"]),this.iconSizeData=on(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return zr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};ke.prototype.createArrays=function(){this.text=new At(new Gn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new At(new Gn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new k,this.symbolInstances=new A},ke.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=bf[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},ke.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),P=y.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof za&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],L||z){for(var G=o.iconDependencies,J=o.glyphDependencies,ne=o.availableImages,Ce=new Oi(this.zoom),Te=0,Xe=t;Te<Xe.length;Te+=1){var Be=Xe[Te],at=Be.feature,gt=Be.id,Rt=Be.index,wt=Be.sourceLayerIndex,ir=h._featureFilter.needGeometry,Pr=ho(at,ir);if(h._featureFilter.filter(Ce,Pr,u)){ir||(Pr.geometry=no(at));var Hr=void 0;if(L){var Bn=h.getValueAndResolveTokens("text-field",Pr,u,ne),pn=za.factory(Bn);ot(pn)&&(this.hasRTLText=!0),(!this.hasRTLText||uf()==="unavailable"||this.hasRTLText&&ru.isParsed())&&(Hr=Pd(pn,h,Pr))}var Hn=void 0;if(z){var dn=h.getValueAndResolveTokens("icon-image",Pr,u,ne);Hn=dn instanceof Ca?dn:Ca.fromString(dn)}if(Hr||Hn){var ki=this.sortFeaturesByKey?Z.evaluate(Pr,{},u):void 0;if(this.features.push({id:gt,text:Hr,icon:Hn,index:Rt,sourceLayerIndex:wt,geometry:Pr.geometry,properties:at.properties,type:Ui[at.type],sortKey:ki}),Hn&&(G[Hn.name]=!0),Hr){var ii=b.evaluate(Pr,{},u).join(","),nn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(var Zi=0,En=Hr.sections;Zi<En.length;Zi+=1){var ra=En[Zi];if(ra.image)G[ra.image.name]=!0;else{var Wn=kc(Hr.toString()),ha=ra.fontStack||ii,V=J[ha]=J[ha]||{};this.calculateGlyphDependencies(ra.text,V,nn,this.allowVerticalPlacement,Wn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(mo){var uo={},$a={},go=[],es=0;function ts(Ya){go.push(mo[Ya]),es++}function zs(Ya,ko,Ms){var la=$a[Ya];return delete $a[Ya],$a[ko]=la,go[la].geometry[0].pop(),go[la].geometry[0]=go[la].geometry[0].concat(Ms[0]),la}function yo(Ya,ko,Ms){var la=uo[ko];return delete uo[ko],uo[Ya]=la,go[la].geometry[0].shift(),go[la].geometry[0]=Ms[0].concat(go[la].geometry[0]),la}function Us(Ya,ko,Ms){var la=Ms?ko[0][ko[0].length-1]:ko[0][0];return Ya+":"+la.x+":"+la.y}for(var Ao=0;Ao<mo.length;Ao++){var ls=mo[Ao],Vi=ls.geometry,Oa=ls.text?ls.text.toString():null;if(Oa){var wa=Us(Oa,Vi),$i=Us(Oa,Vi,!0);if(wa in $a&&$i in uo&&$a[wa]!==uo[$i]){var ou=yo(wa,$i,Vi),Zs=zs(wa,$i,go[ou].geometry);delete uo[wa],delete $a[$i],$a[Us(Oa,go[Zs].geometry,!0)]=Zs,go[ou].geometry=null}else wa in $a?zs(wa,$i,Vi):$i in uo?yo(wa,$i,Vi):(ts(Ao),uo[wa]=es-1,$a[$i]=es-1)}else ts(Ao)}return go.filter(function(Ya){return Ya.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(mo,uo){return mo.sortKey-uo.sortKey})}},ke.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},ke.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ke.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ke.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ke.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ke.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ke.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)b[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=o[P-1].dist(o[P]));for(var L=0;L<o.length;L++){var z=b[L];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},ke.prototype.addSymbols=function(t,o,u,h,y,b,S,P,L,z,Z,G){for(var J=t.indexArray,ne=t.layoutVertexArray,Ce=t.segments.prepareSegment(4*o.length,ne,J,this.canOverlap?b.sortKey:void 0),Te=this.glyphOffsetArray.length,Xe=Ce.vertexLength,Be=this.allowVerticalPlacement&&S===zr.vertical?Math.PI/2:0,at=b.text&&b.text.sections,gt=0;gt<o.length;gt++){var Rt=o[gt],wt=Rt.tl,ir=Rt.tr,Pr=Rt.bl,Hr=Rt.br,Bn=Rt.tex,pn=Rt.pixelOffsetTL,Hn=Rt.pixelOffsetBR,dn=Rt.minFontScaleX,ki=Rt.minFontScaleY,ii=Rt.glyphOffset,nn=Rt.isSDF,Zi=Rt.sectionIndex,En=Ce.vertexLength,ra=ii[1];ae(ne,P.x,P.y,wt.x,ra+wt.y,Bn.x,Bn.y,u,nn,pn.x,pn.y,dn,ki),ae(ne,P.x,P.y,ir.x,ra+ir.y,Bn.x+Bn.w,Bn.y,u,nn,Hn.x,pn.y,dn,ki),ae(ne,P.x,P.y,Pr.x,ra+Pr.y,Bn.x,Bn.y+Bn.h,u,nn,pn.x,Hn.y,dn,ki),ae(ne,P.x,P.y,Hr.x,ra+Hr.y,Bn.x+Bn.w,Bn.y+Bn.h,u,nn,Hn.x,Hn.y,dn,ki),Ze(t.dynamicLayoutVertexArray,P,Be),J.emplaceBack(En,En+1,En+2),J.emplaceBack(En+1,En+2,En+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),gt!==o.length-1&&Zi===o[gt+1].sectionIndex||t.programConfigurations.populatePaintArrays(ne.length,b,b.index,{},G,at&&at[Zi])}t.placedSymbolArray.emplaceBack(P.x,P.y,Te,this.glyphOffsetArray.length-Te,Xe,L,z,P.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},ke.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},ke.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),L=P.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,G=S.anchorX,J=S.anchorY;this._addCollisionDebugVertex(z,Z,b,G,J,new ce(t,o)),this._addCollisionDebugVertex(z,Z,b,G,J,new ce(u,o)),this._addCollisionDebugVertex(z,Z,b,G,J,new ce(u,h)),this._addCollisionDebugVertex(z,Z,b,G,J,new ce(t,h)),P.vertexLength+=4;var ne=y.indexArray;ne.emplaceBack(L,L+1),ne.emplaceBack(L+1,L+2),ne.emplaceBack(L+2,L+3),ne.emplaceBack(L+3,L),P.primitiveLength+=4},ke.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},ke.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ye(Gl,kp.members,Bc),this.iconCollisionBox=new Ye(Gl,kp.members,Bc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},ke.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,P,L){for(var z={},Z=o;Z<u;Z++){var G=t.get(Z);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var J=h;J<y;J++){var ne=t.get(J);z.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},z.verticalTextFeatureIndex=ne.featureIndex;break}for(var Ce=b;Ce<S;Ce++){var Te=t.get(Ce);z.iconBox={x1:Te.x1,y1:Te.y1,x2:Te.x2,y2:Te.y2,anchorPointX:Te.anchorPointX,anchorPointY:Te.anchorPointY},z.iconFeatureIndex=Te.featureIndex;break}for(var Xe=P;Xe<L;Xe++){var Be=t.get(Xe);z.verticalIconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},z.verticalIconFeatureIndex=Be.featureIndex;break}return z},ke.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},ke.prototype.hasTextData=function(){return this.text.segments.get().length>0},ke.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ke.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ke.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ke.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ke.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},ke.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var P=this.symbolInstances.get(S);h.push(0|Math.round(o*P.anchorX+u*P.anchorY)),y.push(P.featureIndex)}return b.sort(function(L,z){return h[L]-h[z]||y[z]-y[L]}),b},ke.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},ke.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,P){b>=0&&P.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vn("SymbolBucket",ke,{omit:["layers","collisionBoxArray","features","compareText"]}),ke.MAX_GLYPHS=65535,ke.addDynamicAttributes=Ze;var tt=new Yo({"symbol-placement":new Dn(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Dn(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dn(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dn(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dn(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dn(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dn(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dn(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(ue.layout_symbol["icon-size"]),"icon-text-fit":new Dn(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(ue.layout_symbol["icon-image"]),"icon-rotate":new Pn(ue.layout_symbol["icon-rotate"]),"icon-padding":new Dn(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Dn(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(ue.layout_symbol["icon-offset"]),"icon-anchor":new Pn(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dn(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dn(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dn(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(ue.layout_symbol["text-field"]),"text-font":new Pn(ue.layout_symbol["text-font"]),"text-size":new Pn(ue.layout_symbol["text-size"]),"text-max-width":new Pn(ue.layout_symbol["text-max-width"]),"text-line-height":new Dn(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(ue.layout_symbol["text-justify"]),"text-radial-offset":new Pn(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dn(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(ue.layout_symbol["text-anchor"]),"text-max-angle":new Dn(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Dn(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(ue.layout_symbol["text-rotate"]),"text-padding":new Dn(ue.layout_symbol["text-padding"]),"text-keep-upright":new Dn(ue.layout_symbol["text-keep-upright"]),"text-transform":new Pn(ue.layout_symbol["text-transform"]),"text-offset":new Pn(ue.layout_symbol["text-offset"]),"text-allow-overlap":new Dn(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dn(ue.layout_symbol["text-ignore-placement"]),"text-optional":new Dn(ue.layout_symbol["text-optional"])}),me={paint:new Yo({"icon-opacity":new Pn(ue.paint_symbol["icon-opacity"]),"icon-color":new Pn(ue.paint_symbol["icon-color"]),"icon-halo-color":new Pn(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Dn(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dn(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pn(ue.paint_symbol["text-opacity"]),"text-color":new Pn(ue.paint_symbol["text-color"],{runtimeType:Yr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Pn(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(ue.paint_symbol["text-halo-blur"]),"text-translate":new Dn(ue.paint_symbol["text-translate"]),"text-translate-anchor":new Dn(ue.paint_symbol["text-translate-anchor"])}),layout:tt},Ne=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t};Ne.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ne.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ne.prototype.outputDefined=function(){return!1},Ne.prototype.serialize=function(){return null},vn("FormatSectionOverride",Ne,{omit:["defaultValue"]});var xe=function(t){function o(u){t.call(this,u,me)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,P=y;S<P.length;S+=1){var L=P[S];b.indexOf(L)<0&&b.push(L)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||Rl(P.value)||!S?S:function(L,z){return z.replace(/{([^{}]+)}/g,function(Z,G){return G in L?String(L[G]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new ke(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=me.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),P=new Ne(S),L=new ac(P,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Ll("source",L):new ul("composite",L,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new Cs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=me.paint.properties[h],S=!1,P=function(Z){for(var G=0,J=Z;G<J.length;G+=1)if(b.overrides&&b.overrides.hasOverride(J[G]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof za)P(y.value.value.sections);else if(y.value.kind==="source"){var L=function(Z){S||(Z instanceof co&&Ji(Z.value)===oa?P(Z.value.sections):Z instanceof bo?P(Z.sections):Z.eachChild(L))},z=y.value;z._styleExpression&&L(z._styleExpression.expression)}return S},o}(fu),st={paint:new Yo({"background-color":new Dn(ue.paint_background["background-color"]),"background-pattern":new vs(ue.paint_background["background-pattern"]),"background-opacity":new Dn(ue.paint_background["background-opacity"])})},mt=function(t){function o(u){t.call(this,u,st)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(fu),fr={paint:new Yo({"raster-opacity":new Dn(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dn(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dn(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dn(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Dn(ue.paint_raster["raster-saturation"]),"raster-contrast":new Dn(ue.paint_raster["raster-contrast"]),"raster-resampling":new Dn(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Dn(ue.paint_raster["raster-fade-duration"])})},Jt=function(t){function o(u){t.call(this,u,fr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(fu),$t=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(fu),en={circle:hf,heatmap:Ep,hillshade:nh,fill:Kf,"fill-extrusion":Sl,line:$h,symbol:xe,background:mt,raster:Jt},Fr=ge.HTMLImageElement,Tn=ge.HTMLCanvasElement,fn=ge.HTMLVideoElement,Cn=ge.ImageData,bn=ge.ImageBitmap,mn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};mn.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Fr||t instanceof Tn||t instanceof fn||t instanceof Cn||bn&&t instanceof bn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,h,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{var L=u||{x:0,y:0},z=L.x,Z=L.y;t instanceof Fr||t instanceof Tn||t instanceof fn||t instanceof Cn||bn&&t instanceof bn?P.texSubImage2D(P.TEXTURE_2D,0,z,Z,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,z,Z,h,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},mn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},mn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},mn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Jn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Jn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Jn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Aa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},or(["receive","process"],this),this.invoker=new Jn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Br()?t:ge};function ys(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}Aa.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=We(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:Yi(o,P)},P),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},Aa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Br()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Aa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Aa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(Ls(o.error)):h(null,Ls(o.data)))}else{var y=!1,b=We(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?Yi(Z):null,data:Yi(G,b)},b)}:function(Z){y=!0},P=null,L=Ls(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,L,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,z[0],L.source)[z[1]](L,S)}else S(new Error("Could not find function "+o.type));!y&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},Aa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ja=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};ja.prototype.setNorthEast=function(t){return this._ne=t instanceof ga?new ga(t.lng,t.lat):ga.convert(t),this},ja.prototype.setSouthWest=function(t){return this._sw=t instanceof ga?new ga(t.lng,t.lat):ga.convert(t),this},ja.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof ga)o=t,u=t;else{if(!(t instanceof ja))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ja.convert(t)):this.extend(ga.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new ga(o.lng,o.lat),this._ne=new ga(u.lng,u.lat)),this},ja.prototype.getCenter=function(){return new ga((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ja.prototype.getSouthWest=function(){return this._sw},ja.prototype.getNorthEast=function(){return this._ne},ja.prototype.getNorthWest=function(){return new ga(this.getWest(),this.getNorth())},ja.prototype.getSouthEast=function(){return new ga(this.getEast(),this.getSouth())},ja.prototype.getWest=function(){return this._sw.lng},ja.prototype.getSouth=function(){return this._sw.lat},ja.prototype.getEast=function(){return this._ne.lng},ja.prototype.getNorth=function(){return this._ne.lat},ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ja.prototype.contains=function(t){var o=ga.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},ja.convert=function(t){return!t||t instanceof ja?t:new ja(t)};var ga=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ga.prototype.wrap=function(){return new ga(dr(this.lng,-180,180),this.lat)},ga.prototype.toArray=function(){return[this.lng,this.lat]},ga.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ga.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},ga.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new ja(new ga(this.lng-u,this.lat-o),new ga(this.lng+u,this.lat+o))},ga.convert=function(t){if(t instanceof ga)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ga(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ga(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Kl=2*Math.PI*63710088e-1;function qs(t){return Kl*Math.cos(t*Math.PI/180)}function Ju(t){return(180+t)/360}function zu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ed(t,o){return t/qs(o)}function Uu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Hc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};Hc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ga.convert(t);return new Hc(Ju(u.lng),zu(u.lat),ed(o,u.lat))},Hc.prototype.toLngLat=function(){return new ga(360*this.x-180,Uu(this.y))},Hc.prototype.toAltitude=function(){return this.z*qs(Uu(this.y))},Hc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Kl*(t=Uu(this.y),1/Math.cos(t*Math.PI/180));var t};var Dp=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=td(0,t,t,o,u)};Dp.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Dp.prototype.url=function(t,o){var u,h,y,b,S,P=(h=this.y,y=this.z,b=ys(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=ys(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),L=function(z,Z,G){for(var J,ne="",Ce=z;Ce>0;Ce--)ne+=(Z&(J=1<<Ce-1)?1:0)+(G&J?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",P)},Dp.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ce(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Dp.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Sv=function(t,o){this.wrap=t,this.canonical=o,this.key=td(t,o.z,o.z,o.x,o.y)},us=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Dp(u,+h,+y),this.key=td(o,t,u,h,y)};function td(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}us.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},us.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new us(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},us.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?td(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):td(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},us.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},us.prototype.children=function(t){if(this.overscaledZ>=t)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new us(o,this.wrap,o,u,h),new us(o,this.wrap,o,u+1,h),new us(o,this.wrap,o,u,h+1),new us(o,this.wrap,o,u+1,h+1)]},us.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},us.prototype.wrapped=function(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.unwrapTo=function(t){return new us(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},us.prototype.toUnwrapped=function(){return new Sv(this.wrap,this.canonical)},us.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},us.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Hc(t.x-this.wrap,t.y))},vn("CanonicalTileID",Dp),vn("OverscaledTileID",us,{omit:["posMatrix"]});var Sf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return et('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Sf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},Sf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Sf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Sf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Sf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Sf.prototype.getPixels=function(){return new Io({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Sf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var P=-o*this.dim,L=-u*this.dim,z=b;z<S;z++)for(var Z=h;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+P,z+L)]},vn("DEMData",Sf);var Id=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Id.prototype.encode=function(t){return this._stringToNumber[t]},Id.prototype.decode=function(t){return this._numberToString[t]};var Od=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},v0={geometry:{configurable:!0}};v0.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},v0.geometry.set=function(t){this._geometry=t},Od.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Od.prototype,v0);var Cf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Cf.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},kt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},Cf.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},Cf.prototype.getState=function(t,o){var u=String(o),h=kt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},Cf.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},Cf.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),kt(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var L in this.state[S])P[L]={},this.state[S][L]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,G=Object.keys(this.deletedStates[S][z]);Z<G.length;Z+=1)delete this.state[S][z][G[Z]];P[z]=this.state[S][z]}u[S]=u[S]||{},kt(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var J in t)t[J].setFeatureState(u,o)};var Af=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new pl(8192,16,0),this.grid3D=new pl(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function Cv(t,o,u,h,y){return Gt(t,function(b,S){var P=o instanceof cu?o.get(S):null;return P&&P.evaluate?P.evaluate(u,h,y):P})}function Av(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var P=S[b];o=Math.min(o,P.x),u=Math.min(u,P.y),h=Math.max(h,P.x),y=Math.max(y,P.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function mm(t,o){return o-t}Af.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var P=b?this.grid3D:this.grid,L=0;L<o.length;L++){for(var z=o[L],Z=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var J=z[G];Z[0]=Math.min(Z[0],J.x),Z[1]=Math.min(Z[1],J.y),Z[2]=Math.max(Z[2],J.x),Z[3]=Math.max(Z[3],J.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&P.insert(S,Z[0],Z[1],Z[2],Z[3])}},Af.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new wu.VectorTile(new ep(this.rawTileData)).layers,this.sourceLayerCoder=new Id(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Af.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,P=Tc(b.filter),L=t.queryGeometry,z=t.queryPadding*S,Z=Av(L),G=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),J=Av(t.cameraQueryGeometry),ne=this.grid3D.query(J.minX-z,J.minY-z,J.maxX+z,J.maxY+z,function(Rt,wt,ir,Pr){return function(Hr,Bn,pn,Hn,dn){for(var ki=0,ii=Hr;ki<ii.length;ki+=1){var nn=ii[ki];if(Bn<=nn.x&&pn<=nn.y&&Hn>=nn.x&&dn>=nn.y)return!0}var Zi=[new ce(Bn,pn),new ce(Bn,dn),new ce(Hn,dn),new ce(Hn,pn)];if(Hr.length>2){for(var En=0,ra=Zi;En<ra.length;En+=1)if(Fs(Hr,ra[En]))return!0}for(var Wn=0;Wn<Hr.length-1;Wn++)if(_l(Hr[Wn],Hr[Wn+1],Zi))return!0;return!1}(t.cameraQueryGeometry,Rt-z,wt-z,ir+z,Pr+z)}),Ce=0,Te=ne;Ce<Te.length;Ce+=1)G.push(Te[Ce]);G.sort(mm);for(var Xe,Be={},at=function(Rt){var wt=G[Rt];if(wt!==Xe){Xe=wt;var ir=y.featureIndexArray.get(wt),Pr=null;y.loadMatchingFeature(Be,ir.bucketIndex,ir.sourceLayerIndex,ir.featureIndex,P,b.layers,b.availableImages,o,u,h,function(Hr,Bn,pn){return Pr||(Pr=no(Hr)),Bn.queryIntersectsFeature(L,Hr,pn,Pr,y.z,t.transform,S,t.pixelPosMatrix)})}},gt=0;gt<G.length;gt++)at(gt);return Be},Af.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,P,L,z,Z){var G=this.bucketLayerIDs[o];if(!b||function(Hr,Bn){for(var pn=0;pn<Hr.length;pn++)if(Bn.indexOf(Hr[pn])>=0)return!0;return!1}(b,G)){var J=this.sourceLayerCoder.decode(u),ne=this.vtLayers[J].feature(h);if(y.needGeometry){var Ce=ho(ne,!0);if(!y.filter(new Oi(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!y.filter(new Oi(this.tileID.overscaledZ),ne))return;for(var Te=this.getId(ne,J),Xe=0;Xe<G.length;Xe++){var Be=G[Xe];if(!(b&&b.indexOf(Be)<0)){var at=P[Be];if(at){var gt={};Te!==void 0&&z&&(gt=z.getState(at.sourceLayer||"_geojsonTileLayer",Te));var Rt=kt({},L[Be]);Rt.paint=Cv(Rt.paint,at.paint,ne,gt,S),Rt.layout=Cv(Rt.layout,at.layout,ne,gt,S);var wt=!Z||Z(ne,at,gt);if(wt){var ir=new Od(ne,this.z,this.x,this.y,Te);ir.layer=Rt;var Pr=t[Be];Pr===void 0&&(Pr=t[Be]=[]),Pr.push({featureIndex:h,feature:ir,intersectionZ:wt})}}}}}},Af.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,P){var L={};this.loadVTLayers();for(var z=Tc(y),Z=0,G=t;Z<G.length;Z+=1)this.loadMatchingFeature(L,u,h,G[Z],z,b,S,P,o);return L},Af.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},Af.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},vn("FeatureIndex",Af,{omit:["rawTileData","sourceLayerCoder"]});var Ts=function(t,o){this.tileID=t,this.uid=Ut(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ts.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<na.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ts.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var G={};if(!Z)return G;for(var J=function(){var Te=Ce[ne],Xe=Te.layerIds.map(function(gt){return Z.getLayer(gt)}).filter(Boolean);if(Xe.length!==0){Te.layers=Xe,Te.stateDependentLayerIds&&(Te.stateDependentLayers=Te.stateDependentLayerIds.map(function(gt){return Xe.filter(function(Rt){return Rt.id===gt})[0]}));for(var Be=0,at=Xe;Be<at.length;Be+=1)G[at[Be].id]=Te}},ne=0,Ce=z;ne<Ce.length;ne+=1)J();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof ke){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof ke&&S.hasRTLText){this.hasRTLText=!0,ru.isLoading()||ru.isLoaded()||uf()!=="deferred"||tu();break}}for(var P in this.queryPadding=0,this.buckets){var L=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(L))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Ts.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ts.prototype.getBucket=function(t){return this.buckets[t.id]},Ts.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},Ts.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Ts.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,P,L,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:S,queryPadding:this.queryPadding*L},t,o,u):{}},Ts.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Tc(o&&o.filter),P=this.tileID.canonical,L=P.z,z=P.x,Z=P.y,G={z:L,x:z,y:Z},J=0;J<b.length;J++){var ne=b.feature(J);if(S.needGeometry){var Ce=ho(ne,!0);if(!S.filter(new Oi(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!S.filter(new Oi(this.tileID.overscaledZ),ne))continue;var Te=u.getId(ne,y),Xe=new Od(ne,L,z,Z,Te);Xe.tile=G,t.push(Xe)}}},Ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ts.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=rn(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ts.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],P=t[b];if(S&&P&&Object.keys(P).length!==0){y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=o&&o.style&&o.style.getLayer(h);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(y)))}}}},Ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<na.now()},Ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ts.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=na.now()+t},Ts.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},Ts.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var tp=ge.performance,wv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},tp.mark(this._marks.start)};wv.prototype.finish=function(){tp.mark(this._marks.end);var t=tp.getEntriesByName(this._marks.measure);return t.length===0&&(tp.measure(this._marks.measure,this._marks.start,this._marks.end),t=tp.getEntriesByName(this._marks.measure),tp.clearMarks(this._marks.start),tp.clearMarks(this._marks.end),tp.clearMeasures(this._marks.measure)),t},m.Actor=Aa,m.AlphaImage=hu,m.CanonicalTileID=Dp,m.CollisionBoxArray=f,m.Color=Ni,m.DEMData=Sf,m.DataConstantProperty=Dn,m.DictionaryCoder=Id,m.EXTENT=8192,m.ErrorEvent=je,m.EvaluationParameters=Oi,m.Event=Ae,m.Evented=Je,m.FeatureIndex=Af,m.FillBucket=Ns,m.FillExtrusionBucket=Nu,m.ImageAtlas=xr,m.ImagePosition=it,m.LineBucket=ma,m.LngLat=ga,m.LngLatBounds=ja,m.MercatorCoordinate=Hc,m.ONE_EM=24,m.OverscaledTileID=us,m.Point=ce,m.Point$1=ce,m.Properties=Yo,m.Protobuf=ep,m.RGBAImage=Io,m.RequestManager=qi,m.RequestPerformance=wv,m.ResourceType=An,m.SegmentVector=se,m.SourceFeatureState=Cf,m.StructArrayLayout1ui2=ml,m.StructArrayLayout2f1f2i16=Hl,m.StructArrayLayout2i4=Wu,m.StructArrayLayout3ui6=Yu,m.StructArrayLayout4i8=Lu,m.SymbolBucket=ke,m.Texture=mn,m.Tile=Ts,m.Transitionable=Xo,m.Uniform1f=Dr,m.Uniform1i=vr,m.Uniform2f=Lr,m.Uniform3f=Ur,m.Uniform4f=Zn,m.UniformColor=kn,m.UniformMatrix4f=Ai,m.UnwrappedTileID=Sv,m.ValidationError=Oe,m.WritingMode=zr,m.ZoomHistory=Uf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ze,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,P){o(S,function(L,z){L&&(b=L),y[P]=z,--h==0&&u(b,y)})})},m.bezier=ct,m.bindAll=or,m.browser=na,m.cacheEntryPossiblyAdded=function(t){++bi>Or&&(t.getActor().send("enforceCacheSizeLimit",tr),bi=0)},m.clamp=ar,m.clearTileCache=function(t){var o=ge.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=vo,m.clone=function(t){var o=new Ri(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=$e,m.clone$2=function(t){var o=new Ri(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Qh,m.config=Yn,m.create=function(){var t=new Ri(16);return Ri!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new Ri(9);return Ri!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new Ri(4);return Ri!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=Ie,m.createExpression=kl,m.createLayout=Za,m.createStyleLayer=function(t){return t.type==="custom"?new $t(t):new en[t.type](t)},m.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],P=u[1],L=u[2];return t[0]=y*L-b*P,t[1]=b*S-h*L,t[2]=h*P-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Et,m.emitValidationErrors=Ic,m.endsWith=q,m.enforceCacheSizeLimit=function(t){Vr(),Qi&&Qi.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=Qn,m.evaluateSizeForZoom=li,m.evaluateVariableOffset=Al,m.evented=Zf,m.extend=kt,m.featureFilter=Tc,m.filterObject=He,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Jr,m.getAnchorJustification=Se,m.getArrayBuffer=ka,m.getImage=$,m.getJSON=function(t,o){return Lo(kt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=uf,m.getReferrer=Li,m.getVideo=function(t,o){var u,h,y=ge.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=ge.document.createElement("source");u=t[b],h=void 0,(h=ge.document.createElement("a")).href=u,(h.protocol!==ge.document.location.protocol||h.host!==ge.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=Bs,m.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],P=o[5],L=o[6],z=o[7],Z=o[8],G=o[9],J=o[10],ne=o[11],Ce=o[12],Te=o[13],Xe=o[14],Be=o[15],at=u*P-h*S,gt=u*L-y*S,Rt=u*z-b*S,wt=h*L-y*P,ir=h*z-b*P,Pr=y*z-b*L,Hr=Z*Te-G*Ce,Bn=Z*Xe-J*Ce,pn=Z*Be-ne*Ce,Hn=G*Xe-J*Te,dn=G*Be-ne*Te,ki=J*Be-ne*Xe,ii=at*ki-gt*dn+Rt*Hn+wt*pn-ir*Bn+Pr*Hr;return ii?(t[0]=(P*ki-L*dn+z*Hn)*(ii=1/ii),t[1]=(y*dn-h*ki-b*Hn)*ii,t[2]=(Te*Pr-Xe*ir+Be*wt)*ii,t[3]=(J*ir-G*Pr-ne*wt)*ii,t[4]=(L*pn-S*ki-z*Bn)*ii,t[5]=(u*ki-y*pn+b*Bn)*ii,t[6]=(Xe*Rt-Ce*Pr-Be*gt)*ii,t[7]=(Z*Pr-J*Rt+ne*gt)*ii,t[8]=(S*dn-P*pn+z*Hr)*ii,t[9]=(h*pn-u*dn-b*Hr)*ii,t[10]=(Ce*ir-Te*Rt+Be*at)*ii,t[11]=(G*Rt-Z*ir-ne*at)*ii,t[12]=(P*Bn-S*Hn-L*Hr)*ii,t[13]=(u*Hn-h*Bn+y*Hr)*ii,t[14]=(Te*gt-Ce*wt-Xe*at)*ii,t[15]=(Z*wt-G*gt+J*at)*ii,t):null},m.isChar=Kr,m.isMapboxURL=Gi,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=Lo,m.mapObject=Gt,m.mercatorXfromLng=Ju,m.mercatorYfromLat=zu,m.mercatorZfromAltitude=ed,m.mul=zc,m.multiply=ms,m.mvt=wu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=da,m.offscreenCanvasSupported=pi,m.ortho=function(t,o,u,h,y,b,S){var P=1/(o-u),L=1/(h-y),z=1/(b-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*L,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*P,t[13]=(y+h)*L,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new ep(t).readFields(Ar,[])},m.pbf=ep,m.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,L=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,G=Z.maxZoom;z.compositeTextSizes=[L["text-size"].possiblyEvaluate(new Oi(Z.minZoom),S),L["text-size"].possiblyEvaluate(new Oi(G),S)]}if(t.iconSizeData.kind==="composite"){var J=t.iconSizeData,ne=J.maxZoom;z.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new Oi(J.minZoom),S),L["icon-size"].possiblyEvaluate(new Oi(ne),S)]}z.layoutTextSize=L["text-size"].possiblyEvaluate(new Oi(t.zoom+1),S),z.layoutIconSize=L["icon-size"].possiblyEvaluate(new Oi(t.zoom+1),S),z.textMaxSize=L["text-size"].possiblyEvaluate(new Oi(18));for(var Ce=24*P.get("text-line-height"),Te=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Xe=P.get("text-keep-upright"),Be=P.get("text-size"),at=function(){var wt=Rt[gt],ir=P.get("text-font").evaluate(wt,{},S).join(","),Pr=Be.evaluate(wt,{},S),Hr=z.layoutTextSize.evaluate(wt,{},S),Bn=z.layoutIconSize.evaluate(wt,{},S),pn={horizontal:{},vertical:void 0},Hn=wt.text,dn=[0,0];if(Hn){var ki=Hn.toString(),ii=24*P.get("text-letter-spacing").evaluate(wt,{},S),nn=function(Vi){for(var Oa=0,wa=Vi;Oa<wa.length;Oa+=1)if($i=wa[Oa].charCodeAt(0),Kr.Arabic($i)||Kr["Arabic Supplement"]($i)||Kr["Arabic Extended-A"]($i)||Kr["Arabic Presentation Forms-A"]($i)||Kr["Arabic Presentation Forms-B"]($i))return!1;var $i;return!0}(ki)?ii:0,Zi=P.get("text-anchor").evaluate(wt,{},S),En=P.get("text-variable-anchor");if(!En){var ra=P.get("text-radial-offset").evaluate(wt,{},S);dn=ra?Al(Zi,[24*ra,Co]):P.get("text-offset").evaluate(wt,{},S).map(function(Vi){return 24*Vi})}var Wn=Te?"center":P.get("text-justify").evaluate(wt,{},S),ha=P.get("symbol-placement"),V=ha==="point"?24*P.get("text-max-width").evaluate(wt,{},S):0,mo=function(){t.allowVerticalPlacement&&kc(ki)&&(pn.vertical=Qr(Hn,o,u,y,ir,V,Ce,Zi,"left",nn,dn,zr.vertical,!0,ha,Hr,Pr))};if(!Te&&En){for(var uo=Wn==="auto"?En.map(function(Vi){return Se(Vi)}):[Wn],$a=!1,go=0;go<uo.length;go++){var es=uo[go];if(!pn.horizontal[es])if($a)pn.horizontal[es]=pn.horizontal[0];else{var ts=Qr(Hn,o,u,y,ir,V,Ce,"center",es,nn,dn,zr.horizontal,!1,ha,Hr,Pr);ts&&(pn.horizontal[es]=ts,$a=ts.positionedLines.length===1)}}mo()}else{Wn==="auto"&&(Wn=Se(Zi));var zs=Qr(Hn,o,u,y,ir,V,Ce,Zi,Wn,nn,dn,zr.horizontal,!1,ha,Hr,Pr);zs&&(pn.horizontal[Wn]=zs),mo(),kc(ki)&&Te&&Xe&&(pn.vertical=Qr(Hn,o,u,y,ir,V,Ce,Zi,Wn,nn,dn,zr.vertical,!1,ha,Hr,Pr))}}var yo=void 0,Us=!1;if(wt.icon&&wt.icon.name){var Ao=h[wt.icon.name];Ao&&(yo=function(Vi,Oa,wa){var $i=Jr(wa),ou=Oa[0]-Vi.displaySize[0]*$i.horizontalAlign,Zs=Oa[1]-Vi.displaySize[1]*$i.verticalAlign;return{image:Vi,top:Zs,bottom:Zs+Vi.displaySize[1],left:ou,right:ou+Vi.displaySize[0]}}(y[wt.icon.name],P.get("icon-offset").evaluate(wt,{},S),P.get("icon-anchor").evaluate(wt,{},S)),Us=Ao.sdf,t.sdfIcons===void 0?t.sdfIcons=Ao.sdf:t.sdfIcons!==Ao.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ao.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ls=vt(pn.horizontal)||pn.vertical;t.iconsInText=!!ls&&ls.iconsInText,(ls||yo)&&function(Vi,Oa,wa,$i,ou,Zs,Ya,ko,Ms,la,$l){var Ks=Zs.textMaxSize.evaluate(Oa,{});Ks===void 0&&(Ks=Ya);var Ql,wo=Vi.layers[0].layout,Jl=wo.get("icon-offset").evaluate(Oa,{},$l),wl=vt(wa.horizontal),Fp=Ya/24,wf=Vi.tilePixelRatio*Fp,Bp=Vi.tilePixelRatio*Ks/24,Zu=Vi.tilePixelRatio*ko,Np=Vi.tilePixelRatio*wo.get("symbol-spacing"),Tl=wo.get("text-padding")*Vi.tilePixelRatio,zp=wo.get("icon-padding")*Vi.tilePixelRatio,hh=wo.get("text-max-angle")/180*Math.PI,rd=wo.get("text-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",Tf=wo.get("icon-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",dc=wo.get("symbol-placement"),Up=Np/2,rp=wo.get("icon-text-fit");$i&&rp!=="none"&&(Vi.allowVerticalPlacement&&wa.vertical&&(Ql=ri($i,wa.vertical,rp,wo.get("icon-text-fit-padding"),Jl,Fp)),wl&&($i=ri($i,wl,rp,wo.get("icon-text-fit-padding"),Jl,Fp)));var vc=function(m0,Hp){Hp.x<0||Hp.x>=8192||Hp.y<0||Hp.y>=8192||function(To,_o,g0,Wc,ud,Ld,_h,ec,xh,Wp,bh,Eh,ld,Dd,Xp,Fd,Bd,y0,_0,x0,ju,Sh,b0,mc,E0){var Nd,Pf,up,gc,lp,Yp=To.addToLineVertexArray(_o,g0),S0=0,C0=0,A0=0,w0=0,zd=-1,Ud=-1,Xc={},T0=be(""),Zd=0,jd=0;if(ec._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Zd=(Nd=ec.layout.get("text-offset").evaluate(ju,{},mc).map(function(Th){return 24*Th}))[0],jd=Nd[1]):(Zd=24*ec.layout.get("text-radial-offset").evaluate(ju,{},mc),jd=Co),To.allowVerticalPlacement&&Wc.vertical){var M0=ec.layout.get("text-rotate").evaluate(ju,{},mc)+90;gc=new Zo(xh,_o,Wp,bh,Eh,Wc.vertical,ld,Dd,Xp,M0),_h&&(lp=new Zo(xh,_o,Wp,bh,Eh,_h,Bd,y0,Xp,M0))}if(ud){var Vd=ec.layout.get("icon-rotate").evaluate(ju,{}),P0=ec.layout.get("icon-text-fit")!=="none",I0=Qo(ud,Vd,b0,P0),Gd=_h?Qo(_h,Vd,b0,P0):void 0;up=new Zo(xh,_o,Wp,bh,Eh,ud,Bd,y0,!1,Vd),S0=4*I0.length;var O0=To.iconSizeData,If=null;O0.kind==="source"?(If=[128*ec.layout.get("icon-size").evaluate(ju,{})])[0]>32640&&et(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):O0.kind==="composite"&&((If=[128*Sh.compositeIconSizes[0].evaluate(ju,{},mc),128*Sh.compositeIconSizes[1].evaluate(ju,{},mc)])[0]>32640||If[1]>32640)&&et(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),To.addSymbols(To.icon,I0,If,x0,_0,ju,!1,_o,Yp.lineStartIndex,Yp.lineLength,-1,mc),zd=To.icon.placedSymbolArray.length-1,Gd&&(C0=4*Gd.length,To.addSymbols(To.icon,Gd,If,x0,_0,ju,zr.vertical,_o,Yp.lineStartIndex,Yp.lineLength,-1,mc),Ud=To.icon.placedSymbolArray.length-1)}for(var Yc in Wc.horizontal){var Ch=Wc.horizontal[Yc];if(!Pf){T0=be(Ch.text);var R0=ec.layout.get("text-rotate").evaluate(ju,{},mc);Pf=new Zo(xh,_o,Wp,bh,Eh,Ch,ld,Dd,Xp,R0)}var Ah=Ch.positionedLines.length===1;if(A0+=Ft(To,_o,Ch,Ld,ec,Xp,ju,Fd,Yp,Wc.vertical?zr.horizontal:zr.horizontalOnly,Ah?Object.keys(Wc.horizontal):[Yc],Xc,zd,Sh,mc),Ah)break}Wc.vertical&&(w0+=Ft(To,_o,Wc.vertical,Ld,ec,Xp,ju,Fd,Yp,zr.vertical,["vertical"],Xc,Ud,Sh,mc));var k0=Pf?Pf.boxStartIndex:To.collisionBoxArray.length,L0=Pf?Pf.boxEndIndex:To.collisionBoxArray.length,Tv=gc?gc.boxStartIndex:To.collisionBoxArray.length,Mv=gc?gc.boxEndIndex:To.collisionBoxArray.length,Pv=up?up.boxStartIndex:To.collisionBoxArray.length,D0=up?up.boxEndIndex:To.collisionBoxArray.length,F0=lp?lp.boxStartIndex:To.collisionBoxArray.length,B0=lp?lp.boxEndIndex:To.collisionBoxArray.length,Ml=-1,wh=function(Th,Hd){return Th&&Th.circleDiameter?Math.max(Th.circleDiameter,Hd):Hd};Ml=wh(Pf,Ml),Ml=wh(gc,Ml),Ml=wh(up,Ml);var N0=(Ml=wh(lp,Ml))>-1?1:0;N0&&(Ml*=E0/24),To.glyphOffsetArray.length>=ke.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ju.sortKey!==void 0&&To.addToSortKeyRanges(To.symbolInstances.length,ju.sortKey),To.symbolInstances.emplaceBack(_o.x,_o.y,Xc.right>=0?Xc.right:-1,Xc.center>=0?Xc.center:-1,Xc.left>=0?Xc.left:-1,Xc.vertical||-1,zd,Ud,T0,k0,L0,Tv,Mv,Pv,D0,F0,B0,Wp,A0,w0,S0,C0,N0,0,ld,Zd,jd,Ml)}(Vi,Hp,m0,wa,$i,ou,Ql,Vi.layers[0],Vi.collisionBoxArray,Oa.index,Oa.sourceLayerIndex,Vi.index,wf,Tl,rd,Ms,Zu,zp,Tf,Jl,Oa,Zs,la,$l,Ya)};if(dc==="line")for(var np=0,dh=vo(Oa.geometry,0,0,8192,8192);np<dh.length;np+=1)for(var ip=dh[np],nd=0,vh=$o(ip,Np,hh,wa.vertical||wl,$i,24,Bp,Vi.overscaling,8192);nd<vh.length;nd+=1){var id=vh[nd];wl&&hn(Vi,wl.text,Up,id)||vc(ip,id)}else if(dc==="line-center")for(var Zp=0,mh=Oa.geometry;Zp<mh.length;Zp+=1){var jp=mh[Zp];if(jp.length>1){var gh=Xa(jp,hh,wa.vertical||wl,$i,24,Bp);gh&&vc(jp,gh)}}else if(Oa.type==="Polygon")for(var ap=0,yh=qf(Oa.geometry,0);ap<yh.length;ap+=1){var op=yh[ap],Vp=ni(op,16);vc(op[0],new Gr(Vp.x,Vp.y,0))}else if(Oa.type==="LineString")for(var Mf=0,Gp=Oa.geometry;Mf<Gp.length;Mf+=1){var sp=Gp[Mf];vc(sp,new Gr(sp[0].x,sp[0].y,0))}else if(Oa.type==="Point")for(var ad=0,Rd=Oa.geometry;ad<Rd.length;ad+=1)for(var od=0,kd=Rd[ad];od<kd.length;od+=1){var sd=kd[od];vc([sd],new Gr(sd.x,sd.y,0))}}(t,wt,pn,yo,h,z,Hr,Bn,dn,Us,S)},gt=0,Rt=t.features;gt<Rt.length;gt+=1)at();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},m.plugin=ru,m.polygonIntersectsPolygon=qu,m.postMapLoadEvent=Bt,m.postTurnstileEvent=lo,m.potpack=wr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=vn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Ds,pluginURL:_u}),Zf.on("pluginStateChange",t),t},m.renderColorRamp=df,m.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=Math.sin(u),L=Math.cos(u);return t[0]=h*L+b*P,t[1]=y*L+S*P,t[2]=h*-P+b*L,t[3]=y*-P+S*L,t},m.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],P=o[6],L=o[7],z=o[8],Z=o[9],G=o[10],J=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+Z*h,t[6]=P*y+G*h,t[7]=L*y+J*h,t[8]=z*y-b*h,t[9]=Z*y-S*h,t[10]=G*y-P*h,t[11]=J*y-L*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],P=o[2],L=o[3],z=o[4],Z=o[5],G=o[6],J=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+Z*h,t[2]=P*y+G*h,t[3]=L*y+J*h,t[4]=z*y-b*h,t[5]=Z*y-S*h,t[6]=G*y-P*h,t[7]=J*y-L*h,t},m.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){tr=t,Or=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Ds==="deferred"||Ds==="loading"||Ds==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");_u=na.resolveURL(t),Ds="deferred",Xs=o,sc(),u||tu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=ue,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=zi,m.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Uc,m.translate=function(t,o,u){var h,y,b,S,P,L,z,Z,G,J,ne,Ce,Te=u[0],Xe=u[1],Be=u[2];return o===t?(t[12]=o[0]*Te+o[4]*Xe+o[8]*Be+o[12],t[13]=o[1]*Te+o[5]*Xe+o[9]*Be+o[13],t[14]=o[2]*Te+o[6]*Xe+o[10]*Be+o[14],t[15]=o[3]*Te+o[7]*Xe+o[11]*Be+o[15]):(y=o[1],b=o[2],S=o[3],P=o[4],L=o[5],z=o[6],Z=o[7],G=o[8],J=o[9],ne=o[10],Ce=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=P,t[5]=L,t[6]=z,t[7]=Z,t[8]=G,t[9]=J,t[10]=ne,t[11]=Ce,t[12]=h*Te+P*Xe+G*Be+o[12],t[13]=y*Te+L*Xe+J*Be+o[13],t[14]=b*Te+z*Xe+ne*Be+o[14],t[15]=S*Te+Z*Xe+Ce*Be+o[15]),t},m.triggerPluginCompletionEvent=sf,m.uniqueId=Ut,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=Zh,m.validateStyle=af,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=wu,m.version="1.13.2",m.warnOnce=et,m.webpSupported=ai,m.window=ge,m.wrap=dr}),De(["./shared"],function(m){"use strict";function Ie(W){var $=typeof W;if($==="number"||$==="boolean"||$==="string"||W==null)return JSON.stringify(W);if(Array.isArray(W)){for(var re="[",he=0,Ae=W;he<Ae.length;he+=1)re+=Ie(Ae[he])+",";return re+"]"}for(var je=Object.keys(W).sort(),Je="{",ue=0;ue<je.length;ue++)Je+=JSON.stringify(je[ue])+":"+Ie(W[je[ue]])+",";return Je+"}"}function X(W){for(var $="",re=0,he=m.refProperties;re<he.length;re+=1)$+="/"+Ie(W[he[re]]);return $}var de=function(W){this.keyCache={},W&&this.replace(W)};de.prototype.replace=function(W){this._layerConfigs={},this._layers={},this.update(W,[])},de.prototype.update=function(W,$){for(var re=this,he=0,Ae=W;he<Ae.length;he+=1){var je=Ae[he];this._layerConfigs[je.id]=je;var Je=this._layers[je.id]=m.createStyleLayer(je);Je._featureFilter=m.featureFilter(Je.filter),this.keyCache[je.id]&&delete this.keyCache[je.id]}for(var ue=0,Oe=$;ue<Oe.length;ue+=1){var pt=Oe[ue];delete this.keyCache[pt],delete this._layerConfigs[pt],delete this._layers[pt]}this.familiesBySource={};for(var pr=0,Ot=function(Zr,Yr){for(var vi={},qr=0;qr<Zr.length;qr++){var wi=Yr&&Yr[Zr[qr].id]||X(Zr[qr]);Yr&&(Yr[Zr[qr].id]=wi);var oa=vi[wi];oa||(oa=vi[wi]=[]),oa.push(Zr[qr])}var Ei=[];for(var Ti in vi)Ei.push(vi[Ti]);return Ei}(m.values(this._layerConfigs),this.keyCache);pr<Ot.length;pr+=1){var Dt=Ot[pr].map(function(Zr){return re._layers[Zr.id]}),mr=Dt[0];if(mr.visibility!=="none"){var _n=mr.source||"",cn=this.familiesBySource[_n];cn||(cn=this.familiesBySource[_n]={});var Ct=mr.sourceLayer||"_geojsonTileLayer",un=cn[Ct];un||(un=cn[Ct]=[]),un.push(Dt)}}};var ce=function(W){var $={},re=[];for(var he in W){var Ae=W[he],je=$[he]={};for(var Je in Ae){var ue=Ae[+Je];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var Oe={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};re.push(Oe),je[Je]={rect:Oe,metrics:ue.metrics}}}}var pt=m.potpack(re),pr=new m.AlphaImage({width:pt.w||1,height:pt.h||1});for(var Ot in W){var Dt=W[Ot];for(var mr in Dt){var _n=Dt[+mr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var cn=$[Ot][mr].rect;m.AlphaImage.copy(_n.bitmap,pr,{x:0,y:0},{x:cn.x+1,y:cn.y+1},_n.bitmap)}}}this.image=pr,this.positions=$};m.register("GlyphAtlas",ce);var ze=function(W){this.tileID=new m.OverscaledTileID(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId};function ge(W,$,re){for(var he=new m.EvaluationParameters($),Ae=0,je=W;Ae<je.length;Ae+=1)je[Ae].recalculate(he,re)}function nt(W,$){var re=m.getArrayBuffer(W.request,function(he,Ae,je,Je){he?$(he):Ae&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Ae)),rawData:Ae,cacheControl:je,expires:Je})});return function(){re.cancel(),$()}}ze.prototype.parse=function(W,$,re,he,Ae){var je=this;this.status="parsing",this.data=W,this.collisionBoxArray=new m.CollisionBoxArray;var Je=new m.DictionaryCoder(Object.keys(W.layers).sort()),ue=new m.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var Oe,pt,pr,Ot,Dt={},mr={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},_n=$.familiesBySource[this.source];for(var cn in _n){var Ct=W.layers[cn];if(Ct){Ct.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var un=Je.encode(cn),Zr=[],Yr=0;Yr<Ct.length;Yr++){var vi=Ct.feature(Yr),qr=ue.getId(vi,cn);Zr.push({feature:vi,id:qr,index:Yr,sourceLayerIndex:un})}for(var wi=0,oa=_n[cn];wi<oa.length;wi+=1){var Ei=oa[wi],Ti=Ei[0];Ti.minzoom&&this.zoom<Math.floor(Ti.minzoom)||Ti.maxzoom&&this.zoom>=Ti.maxzoom||Ti.visibility!=="none"&&(ge(Ei,this.zoom,re),(Dt[Ti.id]=Ti.createBucket({index:ue.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source})).populate(Zr,mr,this.tileID.canonical),ue.bucketLayerIDs.push(Ei.map(function(Hi){return Hi.id})))}}}var Si=m.mapObject(mr.glyphDependencies,function(Hi){return Object.keys(Hi).map(Number)});Object.keys(Si).length?he.send("getGlyphs",{uid:this.uid,stacks:Si},function(Hi,Pi){Oe||(Oe=Hi,pt=Pi,La.call(je))}):pt={};var ei=Object.keys(mr.iconDependencies);ei.length?he.send("getImages",{icons:ei,source:this.source,tileID:this.tileID,type:"icons"},function(Hi,Pi){Oe||(Oe=Hi,pr=Pi,La.call(je))}):pr={};var ji=Object.keys(mr.patternDependencies);function La(){if(Oe)return Ae(Oe);if(pt&&pr&&Ot){var Hi=new ce(pt),Pi=new m.ImageAtlas(pr,Ot);for(var Ni in Dt){var Da=Dt[Ni];Da instanceof m.SymbolBucket?(ge(Da.layers,this.zoom,re),m.performSymbolLayout(Da,pt,Hi.positions,pr,Pi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Da.hasPattern&&(Da instanceof m.LineBucket||Da instanceof m.FillBucket||Da instanceof m.FillExtrusionBucket)&&(ge(Da.layers,this.zoom,re),Da.addFeatures(mr,this.tileID.canonical,Pi.patternPositions))}this.status="done",Ae(null,{buckets:m.values(Dt).filter(function(Js){return!Js.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hi.image,imageAtlas:Pi,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?pr:null,glyphPositions:this.returnDependencies?Hi.positions:null})}}ji.length?he.send("getImages",{icons:ji,source:this.source,tileID:this.tileID,type:"patterns"},function(Hi,Pi){Oe||(Oe=Hi,Ot=Pi,La.call(je))}):Ot={},La.call(this)};var ct=function(W,$,re,he){this.actor=W,this.layerIndex=$,this.availableImages=re,this.loadVectorData=he||nt,this.loading={},this.loaded={}};ct.prototype.loadTile=function(W,$){var re=this,he=W.uid;this.loading||(this.loading={});var Ae=!!(W&&W.request&&W.request.collectResourceTiming)&&new m.RequestPerformance(W.request),je=this.loading[he]=new ze(W);je.abort=this.loadVectorData(W,function(Je,ue){if(delete re.loading[he],Je||!ue)return je.status="done",re.loaded[he]=je,$(Je);var Oe=ue.rawData,pt={};ue.expires&&(pt.expires=ue.expires),ue.cacheControl&&(pt.cacheControl=ue.cacheControl);var pr={};if(Ae){var Ot=Ae.finish();Ot&&(pr.resourceTiming=JSON.parse(JSON.stringify(Ot)))}je.vectorTile=ue.vectorTile,je.parse(ue.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Dt,mr){if(Dt||!mr)return $(Dt);$(null,m.extend({rawTileData:Oe.slice(0)},mr,pt,pr))}),re.loaded=re.loaded||{},re.loaded[he]=je})},ct.prototype.reloadTile=function(W,$){var re=this,he=this.loaded,Ae=W.uid,je=this;if(he&&he[Ae]){var Je=he[Ae];Je.showCollisionBoxes=W.showCollisionBoxes;var ue=function(Oe,pt){var pr=Je.reloadCallback;pr&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,je.layerIndex,re.availableImages,je.actor,pr)),$(Oe,pt)};Je.status==="parsing"?Je.reloadCallback=ue:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},ct.prototype.abortTile=function(W,$){var re=this.loading,he=W.uid;re&&re[he]&&re[he].abort&&(re[he].abort(),delete re[he]),$()},ct.prototype.removeTile=function(W,$){var re=this.loaded,he=W.uid;re&&re[he]&&delete re[he],$()};var Et=m.window.ImageBitmap,ar=function(){this.loaded={}};function dr(W,$){if(W.length!==0){kt(W[0],$);for(var re=1;re<W.length;re++)kt(W[re],!$)}}function kt(W,$){for(var re=0,he=0,Ae=W.length,je=Ae-1;he<Ae;je=he++)re+=(W[he][0]-W[je][0])*(W[je][1]+W[he][1]);re>=0!=!!$&&W.reverse()}ar.prototype.loadTile=function(W,$){var re=W.uid,he=W.encoding,Ae=W.rawImageData,je=Et&&Ae instanceof Et?this.getImageData(Ae):Ae,Je=new m.DEMData(re,je,he);this.loaded=this.loaded||{},this.loaded[re]=Je,$(null,Je)},ar.prototype.getImageData=function(W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,W.width+2,W.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},ar.prototype.removeTile=function(W){var $=this.loaded,re=W.uid;$&&$[re]&&delete $[re]};var nr=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(W){this._feature=W,this.extent=m.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var W=[],$=0,re=this._feature.geometry;$<re.length;$+=1){var he=re[$];W.push([new m.Point$1(he[0],he[1])])}return W}for(var Ae=[],je=0,Je=this._feature.geometry;je<Je.length;je+=1){for(var ue=[],Oe=0,pt=Je[je];Oe<pt.length;Oe+=1){var pr=pt[Oe];ue.push(new m.Point$1(pr[0],pr[1]))}Ae.push(ue)}return Ae},Ut.prototype.toGeoJSON=function(W,$,re){return nr.call(this,W,$,re)};var ht=function(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=W.length,this._features=W};ht.prototype.feature=function(W){return new Ut(this._features[W])};var St=m.vectorTile.VectorTileFeature,or=q;function q(W,$){this.options=$||{},this.features=W,this.length=W.length}function Gt(W,$){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=$||4096}q.prototype.feature=function(W){return new Gt(this.features[W],this.options.extent)},Gt.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var $=0;$<W.length;$++){for(var re=W[$],he=[],Ae=0;Ae<re.length;Ae++)he.push(new m.Point$1(re[Ae][0],re[Ae][1]));this.geometry.push(he)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,$=1/0,re=-1/0,he=1/0,Ae=-1/0,je=0;je<W.length;je++)for(var Je=W[je],ue=0;ue<Je.length;ue++){var Oe=Je[ue];$=Math.min($,Oe.x),re=Math.max(re,Oe.x),he=Math.min(he,Oe.y),Ae=Math.max(Ae,Oe.y)}return[$,he,re,Ae]},Gt.prototype.toGeoJSON=St.prototype.toGeoJSON;var He=bt,$e=or;function bt(W){var $=new m.pbf;return function(re,he){for(var Ae in re.layers)he.writeMessage(3,et,re.layers[Ae])}(W,$),$.finish()}function et(W,$){var re;$.writeVarintField(15,W.version||1),$.writeStringField(1,W.name||""),$.writeVarintField(5,W.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<W.length;re++)he.feature=W.feature(re),$.writeMessage(2,qt,he);var Ae=he.keys;for(re=0;re<Ae.length;re++)$.writeStringField(3,Ae[re]);var je=he.values;for(re=0;re<je.length;re++)$.writeMessage(4,We,je[re])}function qt(W,$){var re=W.feature;re.id!==void 0&&$.writeVarintField(1,re.id),$.writeMessage(2,Tr,W),$.writeVarintField(3,re.type),$.writeMessage(4,Ee,re)}function Tr(W,$){var re=W.feature,he=W.keys,Ae=W.values,je=W.keycache,Je=W.valuecache;for(var ue in re.properties){var Oe=je[ue];Oe===void 0&&(he.push(ue),je[ue]=Oe=he.length-1),$.writeVarint(Oe);var pt=re.properties[ue],pr=typeof pt;pr!=="string"&&pr!=="boolean"&&pr!=="number"&&(pt=JSON.stringify(pt));var Ot=pr+":"+pt,Dt=Je[Ot];Dt===void 0&&(Ae.push(pt),Je[Ot]=Dt=Ae.length-1),$.writeVarint(Dt)}}function Br(W,$){return($<<3)+(7&W)}function rn(W){return W<<1^W>>31}function Ee(W,$){for(var re=W.loadGeometry(),he=W.type,Ae=0,je=0,Je=re.length,ue=0;ue<Je;ue++){var Oe=re[ue],pt=1;he===1&&(pt=Oe.length),$.writeVarint(Br(1,pt));for(var pr=he===3?Oe.length-1:Oe.length,Ot=0;Ot<pr;Ot++){Ot===1&&he!==1&&$.writeVarint(Br(2,pr-1));var Dt=Oe[Ot].x-Ae,mr=Oe[Ot].y-je;$.writeVarint(rn(Dt)),$.writeVarint(rn(mr)),Ae+=Dt,je+=mr}he===3&&$.writeVarint(Br(7,1))}}function We(W,$){var re=typeof W;re==="string"?$.writeStringField(1,W):re==="boolean"?$.writeBooleanField(7,W):re==="number"&&(W%1!=0?$.writeDoubleField(3,W):W<0?$.writeSVarintField(6,W):$.writeVarintField(5,W))}function Re(W,$,re,he){_t(W,re,he),_t($,2*re,2*he),_t($,2*re+1,2*he+1)}function _t(W,$,re){var he=W[$];W[$]=W[re],W[re]=he}function ft(W,$,re,he){var Ae=W-re,je=$-he;return Ae*Ae+je*je}He.fromVectorTileJs=bt,He.fromGeojsonVt=function(W,$){$=$||{};var re={};for(var he in W)re[he]=new or(W[he].features,$),re[he].name=he,re[he].version=$.version,re[he].extent=$.extent;return bt({layers:re})},He.GeoJSONWrapper=$e;var Lt=function(W){return W[0]},Ht=function(W){return W[1]},Mr=function(W,$,re,he,Ae){$===void 0&&($=Lt),re===void 0&&(re=Ht),he===void 0&&(he=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=he,this.points=W;for(var je=W.length<65536?Uint16Array:Uint32Array,Je=this.ids=new je(W.length),ue=this.coords=new Ae(2*W.length),Oe=0;Oe<W.length;Oe++)Je[Oe]=Oe,ue[2*Oe]=$(W[Oe]),ue[2*Oe+1]=re(W[Oe]);(function pt(pr,Ot,Dt,mr,_n,cn){if(!(_n-mr<=Dt)){var Ct=mr+_n>>1;(function un(Zr,Yr,vi,qr,wi,oa){for(;wi>qr;){if(wi-qr>600){var Ei=wi-qr+1,Ti=vi-qr+1,Si=Math.log(Ei),ei=.5*Math.exp(2*Si/3),ji=.5*Math.sqrt(Si*ei*(Ei-ei)/Ei)*(Ti-Ei/2<0?-1:1);un(Zr,Yr,vi,Math.max(qr,Math.floor(vi-Ti*ei/Ei+ji)),Math.min(wi,Math.floor(vi+(Ei-Ti)*ei/Ei+ji)),oa)}var La=Yr[2*vi+oa],Hi=qr,Pi=wi;for(Re(Zr,Yr,qr,vi),Yr[2*wi+oa]>La&&Re(Zr,Yr,qr,wi);Hi<Pi;){for(Re(Zr,Yr,Hi,Pi),Hi++,Pi--;Yr[2*Hi+oa]<La;)Hi++;for(;Yr[2*Pi+oa]>La;)Pi--}Yr[2*qr+oa]===La?Re(Zr,Yr,qr,Pi):Re(Zr,Yr,++Pi,wi),Pi<=vi&&(qr=Pi+1),vi<=Pi&&(wi=Pi-1)}})(pr,Ot,Ct,mr,_n,cn%2),pt(pr,Ot,Dt,mr,Ct-1,cn+1),pt(pr,Ot,Dt,Ct+1,_n,cn+1)}})(Je,ue,he,0,Je.length-1,0)};Mr.prototype.range=function(W,$,re,he){return function(Ae,je,Je,ue,Oe,pt,pr){for(var Ot,Dt,mr=[0,Ae.length-1,0],_n=[];mr.length;){var cn=mr.pop(),Ct=mr.pop(),un=mr.pop();if(Ct-un<=pr)for(var Zr=un;Zr<=Ct;Zr++)Dt=je[2*Zr+1],(Ot=je[2*Zr])>=Je&&Ot<=Oe&&Dt>=ue&&Dt<=pt&&_n.push(Ae[Zr]);else{var Yr=Math.floor((un+Ct)/2);Dt=je[2*Yr+1],(Ot=je[2*Yr])>=Je&&Ot<=Oe&&Dt>=ue&&Dt<=pt&&_n.push(Ae[Yr]);var vi=(cn+1)%2;(cn===0?Je<=Ot:ue<=Dt)&&(mr.push(un),mr.push(Yr-1),mr.push(vi)),(cn===0?Oe>=Ot:pt>=Dt)&&(mr.push(Yr+1),mr.push(Ct),mr.push(vi))}}return _n}(this.ids,this.coords,W,$,re,he,this.nodeSize)},Mr.prototype.within=function(W,$,re){return function(he,Ae,je,Je,ue,Oe){for(var pt=[0,he.length-1,0],pr=[],Ot=ue*ue;pt.length;){var Dt=pt.pop(),mr=pt.pop(),_n=pt.pop();if(mr-_n<=Oe)for(var cn=_n;cn<=mr;cn++)ft(Ae[2*cn],Ae[2*cn+1],je,Je)<=Ot&&pr.push(he[cn]);else{var Ct=Math.floor((_n+mr)/2),un=Ae[2*Ct],Zr=Ae[2*Ct+1];ft(un,Zr,je,Je)<=Ot&&pr.push(he[Ct]);var Yr=(Dt+1)%2;(Dt===0?je-ue<=un:Je-ue<=Zr)&&(pt.push(_n),pt.push(Ct-1),pt.push(Yr)),(Dt===0?je+ue>=un:Je+ue>=Zr)&&(pt.push(Ct+1),pt.push(mr),pt.push(Yr))}}return pr}(this.ids,this.coords,W,$,re,this.nodeSize)};var Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(W){return W}},Wr=function(W){this.options=xa(Object.create(Kn),W),this.trees=new Array(this.options.maxZoom+1)};function na(W,$,re,he,Ae){return{x:W,y:$,zoom:1/0,id:re,parentId:-1,numPoints:he,properties:Ae}}function Yn(W,$){var re=W.geometry.coordinates,he=re[1];return{x:ci(re[0]),y:gi(he),zoom:1/0,index:$,parentId:-1}}function ai(W){return{type:"Feature",id:W.id,properties:oi(W),geometry:{type:"Point",coordinates:[(he=W.x,360*(he-.5)),($=W.y,re=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var $,re,he}function oi(W){var $=W.numPoints,re=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return xa(xa({},W.properties),{cluster:!0,cluster_id:W.id,point_count:$,point_count_abbreviated:re})}function ci(W){return W/360+.5}function gi(W){var $=Math.sin(W*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function xa(W,$){for(var re in $)W[re]=$[re];return W}function qi(W){return W.x}function Gi(W){return W.y}function ia(W,$,re,he,Ae,je){var Je=Ae-re,ue=je-he;if(Je!==0||ue!==0){var Oe=((W-re)*Je+($-he)*ue)/(Je*Je+ue*ue);Oe>1?(re=Ae,he=je):Oe>0&&(re+=Je*Oe,he+=ue*Oe)}return(Je=W-re)*Je+(ue=$-he)*ue}function ba(W,$,re,he){var Ae={id:W===void 0?null:W,type:$,geometry:re,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var Je=je.geometry,ue=je.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")R(je,Je);else if(ue==="Polygon"||ue==="MultiLineString")for(var Oe=0;Oe<Je.length;Oe++)R(je,Je[Oe]);else if(ue==="MultiPolygon")for(Oe=0;Oe<Je.length;Oe++)for(var pt=0;pt<Je[Oe].length;pt++)R(je,Je[Oe][pt])}(Ae),Ae}function R(W,$){for(var re=0;re<$.length;re+=3)W.minX=Math.min(W.minX,$[re]),W.minY=Math.min(W.minY,$[re+1]),W.maxX=Math.max(W.maxX,$[re]),W.maxY=Math.max(W.maxY,$[re+1])}function sn(W,$,re,he){if($.geometry){var Ae=$.geometry.coordinates,je=$.geometry.type,Je=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),ue=[],Oe=$.id;if(re.promoteId?Oe=$.properties[re.promoteId]:re.generateId&&(Oe=he||0),je==="Point")Ea(Ae,ue);else if(je==="MultiPoint")for(var pt=0;pt<Ae.length;pt++)Ea(Ae[pt],ue);else if(je==="LineString")Bi(Ae,ue,Je,!1);else if(je==="MultiLineString"){if(re.lineMetrics){for(pt=0;pt<Ae.length;pt++)Bi(Ae[pt],ue=[],Je,!1),W.push(ba(Oe,"LineString",ue,$.properties));return}aa(Ae,ue,Je,!1)}else if(je==="Polygon")aa(Ae,ue,Je,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(pt=0;pt<$.geometry.geometries.length;pt++)sn(W,{id:Oe,geometry:$.geometry.geometries[pt],properties:$.properties},re,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<Ae.length;pt++){var pr=[];aa(Ae[pt],pr,Je,!0),ue.push(pr)}}W.push(ba(Oe,je,ue,$.properties))}}function Ea(W,$){$.push(Qi(W[0])),$.push(cs(W[1])),$.push(0)}function Bi(W,$,re,he){for(var Ae,je,Je=0,ue=0;ue<W.length;ue++){var Oe=Qi(W[ue][0]),pt=cs(W[ue][1]);$.push(Oe),$.push(pt),$.push(0),ue>0&&(Je+=he?(Ae*pt-Oe*je)/2:Math.sqrt(Math.pow(Oe-Ae,2)+Math.pow(pt-je,2))),Ae=Oe,je=pt}var pr=$.length-3;$[2]=1,function Ot(Dt,mr,_n,cn){for(var Ct,un=cn,Zr=_n-mr>>1,Yr=_n-mr,vi=Dt[mr],qr=Dt[mr+1],wi=Dt[_n],oa=Dt[_n+1],Ei=mr+3;Ei<_n;Ei+=3){var Ti=ia(Dt[Ei],Dt[Ei+1],vi,qr,wi,oa);if(Ti>un)Ct=Ei,un=Ti;else if(Ti===un){var Si=Math.abs(Ei-Zr);Si<Yr&&(Ct=Ei,Yr=Si)}}un>cn&&(Ct-mr>3&&Ot(Dt,mr,Ct,cn),Dt[Ct+2]=un,_n-Ct>3&&Ot(Dt,Ct,_n,cn))}($,0,pr,re),$[pr+2]=1,$.size=Math.abs(Je),$.start=0,$.end=$.size}function aa(W,$,re,he){for(var Ae=0;Ae<W.length;Ae++){var je=[];Bi(W[Ae],je,re,he),$.push(je)}}function Qi(W){return W/360+.5}function cs(W){var $=Math.sin(W*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function pe(W,$,re,he,Ae,je,Je,ue){if(he/=$,je>=(re/=$)&&Je<he)return W;if(Je<re||je>=he)return null;for(var Oe=[],pt=0;pt<W.length;pt++){var pr=W[pt],Ot=pr.geometry,Dt=pr.type,mr=Ae===0?pr.minX:pr.minY,_n=Ae===0?pr.maxX:pr.maxY;if(mr>=re&&_n<he)Oe.push(pr);else if(!(_n<re||mr>=he)){var cn=[];if(Dt==="Point"||Dt==="MultiPoint")fi(Ot,cn,re,he,Ae);else if(Dt==="LineString")lo(Ot,cn,re,he,Ae,!1,ue.lineMetrics);else if(Dt==="MultiLineString")Bt(Ot,cn,re,he,Ae,!1);else if(Dt==="Polygon")Bt(Ot,cn,re,he,Ae,!0);else if(Dt==="MultiPolygon")for(var Ct=0;Ct<Ot.length;Ct++){var un=[];Bt(Ot[Ct],un,re,he,Ae,!0),un.length&&cn.push(un)}if(cn.length){if(ue.lineMetrics&&Dt==="LineString"){for(Ct=0;Ct<cn.length;Ct++)Oe.push(ba(pr.id,Dt,cn[Ct],pr.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(cn.length===1?(Dt="LineString",cn=cn[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=cn.length===3?"Point":"MultiPoint"),Oe.push(ba(pr.id,Dt,cn,pr.tags))}}}return Oe.length?Oe:null}function fi(W,$,re,he,Ae){for(var je=0;je<W.length;je+=3){var Je=W[je+Ae];Je>=re&&Je<=he&&($.push(W[je]),$.push(W[je+1]),$.push(W[je+2]))}}function lo(W,$,re,he,Ae,je,Je){for(var ue,Oe,pt=Va(W),pr=Ae===0?Or:Vr,Ot=W.start,Dt=0;Dt<W.length-3;Dt+=3){var mr=W[Dt],_n=W[Dt+1],cn=W[Dt+2],Ct=W[Dt+3],un=W[Dt+4],Zr=Ae===0?mr:_n,Yr=Ae===0?Ct:un,vi=!1;Je&&(ue=Math.sqrt(Math.pow(mr-Ct,2)+Math.pow(_n-un,2))),Zr<re?Yr>re&&(Oe=pr(pt,mr,_n,Ct,un,re),Je&&(pt.start=Ot+ue*Oe)):Zr>he?Yr<he&&(Oe=pr(pt,mr,_n,Ct,un,he),Je&&(pt.start=Ot+ue*Oe)):tr(pt,mr,_n,cn),Yr<re&&Zr>=re&&(Oe=pr(pt,mr,_n,Ct,un,re),vi=!0),Yr>he&&Zr<=he&&(Oe=pr(pt,mr,_n,Ct,un,he),vi=!0),!je&&vi&&(Je&&(pt.end=Ot+ue*Oe),$.push(pt),pt=Va(W)),Je&&(Ot+=ue)}var qr=W.length-3;mr=W[qr],_n=W[qr+1],cn=W[qr+2],(Zr=Ae===0?mr:_n)>=re&&Zr<=he&&tr(pt,mr,_n,cn),qr=pt.length-3,je&&qr>=3&&(pt[qr]!==pt[0]||pt[qr+1]!==pt[1])&&tr(pt,pt[0],pt[1],pt[2]),pt.length&&$.push(pt)}function Va(W){var $=[];return $.size=W.size,$.start=W.start,$.end=W.end,$}function Bt(W,$,re,he,Ae,je){for(var Je=0;Je<W.length;Je++)lo(W[Je],$,re,he,Ae,je,!1)}function tr(W,$,re,he){W.push($),W.push(re),W.push(he)}function Or(W,$,re,he,Ae,je){var Je=(je-$)/(he-$);return W.push(je),W.push(re+(Ae-re)*Je),W.push(1),Je}function Vr(W,$,re,he,Ae,je){var Je=(je-re)/(Ae-re);return W.push($+(he-$)*Je),W.push(je),W.push(1),Je}function Ln(W,$){for(var re=[],he=0;he<W.length;he++){var Ae,je=W[he],Je=je.type;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")Ae=zn(je.geometry,$);else if(Je==="MultiLineString"||Je==="Polygon"){Ae=[];for(var ue=0;ue<je.geometry.length;ue++)Ae.push(zn(je.geometry[ue],$))}else if(Je==="MultiPolygon")for(Ae=[],ue=0;ue<je.geometry.length;ue++){for(var Oe=[],pt=0;pt<je.geometry[ue].length;pt++)Oe.push(zn(je.geometry[ue][pt],$));Ae.push(Oe)}re.push(ba(je.id,Je,Ae,je.tags))}return re}function zn(W,$){var re=[];re.size=W.size,W.start!==void 0&&(re.start=W.start,re.end=W.end);for(var he=0;he<W.length;he+=3)re.push(W[he]+$,W[he+1],W[he+2]);return re}function bi(W,$){if(W.transformed)return W;var re,he,Ae,je=1<<W.z,Je=W.x,ue=W.y;for(re=0;re<W.features.length;re++){var Oe=W.features[re],pt=Oe.geometry,pr=Oe.type;if(Oe.geometry=[],pr===1)for(he=0;he<pt.length;he+=2)Oe.geometry.push(pi(pt[he],pt[he+1],$,je,Je,ue));else for(he=0;he<pt.length;he++){var Ot=[];for(Ae=0;Ae<pt[he].length;Ae+=2)Ot.push(pi(pt[he][Ae],pt[he][Ae+1],$,je,Je,ue));Oe.geometry.push(Ot)}}return W.transformed=!0,W}function pi(W,$,re,he,Ae,je){return[Math.round(re*(W*he-Ae)),Math.round(re*($*he-je))]}function An(W,$,re,he,Ae){for(var je=$===Ae.maxZoom?0:Ae.tolerance/((1<<$)*Ae.extent),Je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:he,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<W.length;ue++){Je.numFeatures++,Mi(Je,W[ue],je,Ae);var Oe=W[ue].minX,pt=W[ue].minY,pr=W[ue].maxX,Ot=W[ue].maxY;Oe<Je.minX&&(Je.minX=Oe),pt<Je.minY&&(Je.minY=pt),pr>Je.maxX&&(Je.maxX=pr),Ot>Je.maxY&&(Je.maxY=Ot)}return Je}function Mi(W,$,re,he){var Ae=$.geometry,je=$.type,Je=[];if(je==="Point"||je==="MultiPoint")for(var ue=0;ue<Ae.length;ue+=3)Je.push(Ae[ue]),Je.push(Ae[ue+1]),W.numPoints++,W.numSimplified++;else if(je==="LineString")Li(Je,Ae,W,re,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(ue=0;ue<Ae.length;ue++)Li(Je,Ae[ue],W,re,je==="Polygon",ue===0);else if(je==="MultiPolygon")for(var Oe=0;Oe<Ae.length;Oe++){var pt=Ae[Oe];for(ue=0;ue<pt.length;ue++)Li(Je,pt[ue],W,re,!0,ue===0)}if(Je.length){var pr=$.tags||null;if(je==="LineString"&&he.lineMetrics){for(var Ot in pr={},$.tags)pr[Ot]=$.tags[Ot];pr.mapbox_clip_start=Ae.start/Ae.size,pr.mapbox_clip_end=Ae.end/Ae.size}var Dt={geometry:Je,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:pr};$.id!==null&&(Dt.id=$.id),W.features.push(Dt)}}function Li(W,$,re,he,Ae,je){var Je=he*he;if(he>0&&$.size<(Ae?Je:he))re.numPoints+=$.length/3;else{for(var ue=[],Oe=0;Oe<$.length;Oe+=3)(he===0||$[Oe+2]>Je)&&(re.numSimplified++,ue.push($[Oe]),ue.push($[Oe+1])),re.numPoints++;Ae&&function(pt,pr){for(var Ot=0,Dt=0,mr=pt.length,_n=mr-2;Dt<mr;_n=Dt,Dt+=2)Ot+=(pt[Dt]-pt[_n])*(pt[Dt+1]+pt[_n+1]);if(Ot>0===pr)for(Dt=0,mr=pt.length;Dt<mr/2;Dt+=2){var cn=pt[Dt],Ct=pt[Dt+1];pt[Dt]=pt[mr-2-Dt],pt[Dt+1]=pt[mr-1-Dt],pt[mr-2-Dt]=cn,pt[mr-1-Dt]=Ct}}(ue,je),W.push(ue)}}function Na(W,$){var re=($=this.options=function(Ae,je){for(var Je in je)Ae[Je]=je[Je];return Ae}(Object.create(this.options),$)).debug;if(re&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Ae,je){var Je=[];if(Ae.type==="FeatureCollection")for(var ue=0;ue<Ae.features.length;ue++)sn(Je,Ae.features[ue],je,ue);else sn(Je,Ae.type==="Feature"?Ae:{geometry:Ae},je);return Je}(W,$);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Ae,je){var Je=je.buffer/je.extent,ue=Ae,Oe=pe(Ae,1,-1-Je,Je,0,-1,2,je),pt=pe(Ae,1,1-Je,2+Je,0,-1,2,je);return(Oe||pt)&&(ue=pe(Ae,1,-Je,1+Je,0,-1,2,je)||[],Oe&&(ue=Ln(Oe,1).concat(ue)),pt&&(ue=ue.concat(Ln(pt,-1)))),ue}(he,$)).length&&this.splitTile(he,0,0,0),re&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fs(W,$,re){return 32*((1<<W)*re+$)+W}function Lo(W,$){var re=W.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var he=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!he)return $(null,null);var Ae=new ht(he.features),je=He(Ae);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),$(null,{vectorTile:Ae,rawData:je.buffer})}Wr.prototype.load=function(W){var $=this.options,re=$.log,he=$.minZoom,Ae=$.maxZoom,je=$.nodeSize;re&&console.time("total time");var Je="prepare "+W.length+" points";re&&console.time(Je),this.points=W;for(var ue=[],Oe=0;Oe<W.length;Oe++)W[Oe].geometry&&ue.push(Yn(W[Oe],Oe));this.trees[Ae+1]=new Mr(ue,qi,Gi,je,Float32Array),re&&console.timeEnd(Je);for(var pt=Ae;pt>=he;pt--){var pr=+Date.now();ue=this._cluster(ue,pt),this.trees[pt]=new Mr(ue,qi,Gi,je,Float32Array),re&&console.log("z%d: %d clusters in %dms",pt,ue.length,+Date.now()-pr)}return re&&console.timeEnd("total time"),this},Wr.prototype.getClusters=function(W,$){var re=((W[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,W[1])),Ae=W[2]===180?180:((W[2]+180)%360+360)%360-180,je=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)re=-180,Ae=180;else if(re>Ae){var Je=this.getClusters([re,he,180,je],$),ue=this.getClusters([-180,he,Ae,je],$);return Je.concat(ue)}for(var Oe=this.trees[this._limitZoom($)],pt=[],pr=0,Ot=Oe.range(ci(re),gi(je),ci(Ae),gi(he));pr<Ot.length;pr+=1){var Dt=Oe.points[Ot[pr]];pt.push(Dt.numPoints?ai(Dt):this.points[Dt.index])}return pt},Wr.prototype.getChildren=function(W){var $=this._getOriginId(W),re=this._getOriginZoom(W),he="No cluster with the specified id.",Ae=this.trees[re];if(!Ae)throw new Error(he);var je=Ae.points[$];if(!je)throw new Error(he);for(var Je=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ue=[],Oe=0,pt=Ae.within(je.x,je.y,Je);Oe<pt.length;Oe+=1){var pr=Ae.points[pt[Oe]];pr.parentId===W&&ue.push(pr.numPoints?ai(pr):this.points[pr.index])}if(ue.length===0)throw new Error(he);return ue},Wr.prototype.getLeaves=function(W,$,re){var he=[];return this._appendLeaves(he,W,$=$||10,re=re||0,0),he},Wr.prototype.getTile=function(W,$,re){var he=this.trees[this._limitZoom(W)],Ae=Math.pow(2,W),je=this.options,Je=je.radius/je.extent,ue=(re-Je)/Ae,Oe=(re+1+Je)/Ae,pt={features:[]};return this._addTileFeatures(he.range(($-Je)/Ae,ue,($+1+Je)/Ae,Oe),he.points,$,re,Ae,pt),$===0&&this._addTileFeatures(he.range(1-Je/Ae,ue,1,Oe),he.points,Ae,re,Ae,pt),$===Ae-1&&this._addTileFeatures(he.range(0,ue,Je/Ae,Oe),he.points,-1,re,Ae,pt),pt.features.length?pt:null},Wr.prototype.getClusterExpansionZoom=function(W){for(var $=this._getOriginZoom(W)-1;$<=this.options.maxZoom;){var re=this.getChildren(W);if($++,re.length!==1)break;W=re[0].properties.cluster_id}return $},Wr.prototype._appendLeaves=function(W,$,re,he,Ae){for(var je=0,Je=this.getChildren($);je<Je.length;je+=1){var ue=Je[je],Oe=ue.properties;if(Oe&&Oe.cluster?Ae+Oe.point_count<=he?Ae+=Oe.point_count:Ae=this._appendLeaves(W,Oe.cluster_id,re,he,Ae):Ae<he?Ae++:W.push(ue),W.length===re)break}return Ae},Wr.prototype._addTileFeatures=function(W,$,re,he,Ae,je){for(var Je=0,ue=W;Je<ue.length;Je+=1){var Oe=$[ue[Je]],pt=Oe.numPoints,pr={type:1,geometry:[[Math.round(this.options.extent*(Oe.x*Ae-re)),Math.round(this.options.extent*(Oe.y*Ae-he))]],tags:pt?oi(Oe):this.points[Oe.index].properties},Ot=void 0;pt?Ot=Oe.id:this.options.generateId?Ot=Oe.index:this.points[Oe.index].id&&(Ot=this.points[Oe.index].id),Ot!==void 0&&(pr.id=Ot),je.features.push(pr)}},Wr.prototype._limitZoom=function(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))},Wr.prototype._cluster=function(W,$){for(var re=[],he=this.options,Ae=he.reduce,je=he.minPoints,Je=he.radius/(he.extent*Math.pow(2,$)),ue=0;ue<W.length;ue++){var Oe=W[ue];if(!(Oe.zoom<=$)){Oe.zoom=$;for(var pt=this.trees[$+1],pr=pt.within(Oe.x,Oe.y,Je),Ot=Oe.numPoints||1,Dt=Ot,mr=0,_n=pr;mr<_n.length;mr+=1){var cn=pt.points[_n[mr]];cn.zoom>$&&(Dt+=cn.numPoints||1)}if(Dt>=je){for(var Ct=Oe.x*Ot,un=Oe.y*Ot,Zr=Ae&&Ot>1?this._map(Oe,!0):null,Yr=(ue<<5)+($+1)+this.points.length,vi=0,qr=pr;vi<qr.length;vi+=1){var wi=pt.points[qr[vi]];if(!(wi.zoom<=$)){wi.zoom=$;var oa=wi.numPoints||1;Ct+=wi.x*oa,un+=wi.y*oa,wi.parentId=Yr,Ae&&(Zr||(Zr=this._map(Oe,!0)),Ae(Zr,this._map(wi)))}}Oe.parentId=Yr,re.push(na(Ct/Dt,un/Dt,Yr,Dt,Zr))}else if(re.push(Oe),Dt>1)for(var Ei=0,Ti=pr;Ei<Ti.length;Ei+=1){var Si=pt.points[Ti[Ei]];Si.zoom<=$||(Si.zoom=$,re.push(Si))}}}return re},Wr.prototype._getOriginId=function(W){return W-this.points.length>>5},Wr.prototype._getOriginZoom=function(W){return(W-this.points.length)%32},Wr.prototype._map=function(W,$){if(W.numPoints)return $?xa({},W.properties):W.properties;var re=this.points[W.index].properties,he=this.options.map(re);return $&&he===re?xa({},he):he},Na.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Na.prototype.splitTile=function(W,$,re,he,Ae,je,Je){for(var ue=[W,$,re,he],Oe=this.options,pt=Oe.debug;ue.length;){he=ue.pop(),re=ue.pop(),$=ue.pop(),W=ue.pop();var pr=1<<$,Ot=fs($,re,he),Dt=this.tiles[Ot];if(!Dt&&(pt>1&&console.time("creation"),Dt=this.tiles[Ot]=An(W,$,re,he,Oe),this.tileCoords.push({z:$,x:re,y:he}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,re,he,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var mr="z"+$;this.stats[mr]=(this.stats[mr]||0)+1,this.total++}if(Dt.source=W,Ae){if($===Oe.maxZoom||$===Ae)continue;var _n=1<<Ae-$;if(re!==Math.floor(je/_n)||he!==Math.floor(Je/_n))continue}else if($===Oe.indexMaxZoom||Dt.numPoints<=Oe.indexMaxPoints)continue;if(Dt.source=null,W.length!==0){pt>1&&console.time("clipping");var cn,Ct,un,Zr,Yr,vi,qr=.5*Oe.buffer/Oe.extent,wi=.5-qr,oa=.5+qr,Ei=1+qr;cn=Ct=un=Zr=null,Yr=pe(W,pr,re-qr,re+oa,0,Dt.minX,Dt.maxX,Oe),vi=pe(W,pr,re+wi,re+Ei,0,Dt.minX,Dt.maxX,Oe),W=null,Yr&&(cn=pe(Yr,pr,he-qr,he+oa,1,Dt.minY,Dt.maxY,Oe),Ct=pe(Yr,pr,he+wi,he+Ei,1,Dt.minY,Dt.maxY,Oe),Yr=null),vi&&(un=pe(vi,pr,he-qr,he+oa,1,Dt.minY,Dt.maxY,Oe),Zr=pe(vi,pr,he+wi,he+Ei,1,Dt.minY,Dt.maxY,Oe),vi=null),pt>1&&console.timeEnd("clipping"),ue.push(cn||[],$+1,2*re,2*he),ue.push(Ct||[],$+1,2*re,2*he+1),ue.push(un||[],$+1,2*re+1,2*he),ue.push(Zr||[],$+1,2*re+1,2*he+1)}}},Na.prototype.getTile=function(W,$,re){var he=this.options,Ae=he.extent,je=he.debug;if(W<0||W>24)return null;var Je=1<<W,ue=fs(W,$=($%Je+Je)%Je,re);if(this.tiles[ue])return bi(this.tiles[ue],Ae);je>1&&console.log("drilling down to z%d-%d-%d",W,$,re);for(var Oe,pt=W,pr=$,Ot=re;!Oe&&pt>0;)pt--,pr=Math.floor(pr/2),Ot=Math.floor(Ot/2),Oe=this.tiles[fs(pt,pr,Ot)];return Oe&&Oe.source?(je>1&&console.log("found parent tile z%d-%d-%d",pt,pr,Ot),je>1&&console.time("drilling down"),this.splitTile(Oe.source,pt,pr,Ot,W,$,re),je>1&&console.timeEnd("drilling down"),this.tiles[ue]?bi(this.tiles[ue],Ae):null):null};var ka=function(W){function $(re,he,Ae,je){W.call(this,re,he,Ae,Lo),je&&(this.loadGeoJSON=je)}return W&&($.__proto__=W),($.prototype=Object.create(W&&W.prototype)).constructor=$,$.prototype.loadData=function(re,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var je=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new m.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,function(Je,ue){if(Je||!ue)return he(Je);if(typeof ue!="object")return he(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function Dt(mr,_n){var cn,Ct=mr&&mr.type;if(Ct==="FeatureCollection")for(cn=0;cn<mr.features.length;cn++)Dt(mr.features[cn],_n);else if(Ct==="GeometryCollection")for(cn=0;cn<mr.geometries.length;cn++)Dt(mr.geometries[cn],_n);else if(Ct==="Feature")Dt(mr.geometry,_n);else if(Ct==="Polygon")dr(mr.coordinates,_n);else if(Ct==="MultiPolygon")for(cn=0;cn<mr.coordinates.length;cn++)dr(mr.coordinates[cn],_n);return mr})(ue,!0);try{if(Ae.filter){var Oe=m.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(function(Dt){return Dt.key+": "+Dt.message}).join(", "));var pt=ue.features.filter(function(Dt){return Oe.value.evaluate({zoom:0},Dt)});ue={type:"FeatureCollection",features:pt}}re._geoJSONIndex=Ae.cluster?new Wr(function(Dt){var mr=Dt.superclusterOptions,_n=Dt.clusterProperties;if(!_n||!mr)return mr;for(var cn={},Ct={},un={accumulated:null,zoom:0},Zr={properties:null},Yr=Object.keys(_n),vi=0,qr=Yr;vi<qr.length;vi+=1){var wi=qr[vi],oa=_n[wi],Ei=oa[0],Ti=m.createExpression(oa[1]),Si=m.createExpression(typeof Ei=="string"?[Ei,["accumulated"],["get",wi]]:Ei);cn[wi]=Ti.value,Ct[wi]=Si.value}return mr.map=function(ei){Zr.properties=ei;for(var ji={},La=0,Hi=Yr;La<Hi.length;La+=1){var Pi=Hi[La];ji[Pi]=cn[Pi].evaluate(un,Zr)}return ji},mr.reduce=function(ei,ji){Zr.properties=ji;for(var La=0,Hi=Yr;La<Hi.length;La+=1){var Pi=Hi[La];un.accumulated=ei[Pi],ei[Pi]=Ct[Pi].evaluate(un,Zr)}},mr}(Ae)).load(ue.features):function(Dt,mr){return new Na(Dt,mr)}(ue,Ae.geojsonVtOptions)}catch(Dt){return he(Dt)}re.loaded={};var pr={};if(je){var Ot=je.finish();Ot&&(pr.resourceTiming={},pr.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Ot)))}he(null,pr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(re,he){var Ae=this.loaded;return Ae&&Ae[re.uid]?W.prototype.reloadTile.call(this,re,he):this.loadTile(re,he)},$.prototype.loadGeoJSON=function(re,he){if(re.request)m.getJSON(re.request,he);else{if(typeof re.data!="string")return he(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(re.data))}catch(Ae){return he(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(re,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},$.prototype.getClusterExpansionZoom=function(re,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Ae){he(Ae)}},$.prototype.getClusterChildren=function(re,he){try{he(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Ae){he(Ae)}},$.prototype.getClusterLeaves=function(re,he){try{he(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Ae){he(Ae)}},$}(ct),Sa=function(W){var $=this;this.self=W,this.actor=new m.Actor(W,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ct,geojson:ka},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,he){if($.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');$.workerSourceTypes[re]=he},this.self.registerRTLTextPlugin=function(re){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=re.applyArabicShaping,m.plugin.processBidirectionalText=re.processBidirectionalText,m.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return Sa.prototype.setReferrer=function(W,$){this.referrer=$},Sa.prototype.setImages=function(W,$,re){for(var he in this.availableImages[W]=$,this.workerSources[W]){var Ae=this.workerSources[W][he];for(var je in Ae)Ae[je].availableImages=$}re()},Sa.prototype.setLayers=function(W,$,re){this.getLayerIndex(W).replace($),re()},Sa.prototype.updateLayers=function(W,$,re){this.getLayerIndex(W).update($.layers,$.removedIds),re()},Sa.prototype.loadTile=function(W,$,re){this.getWorkerSource(W,$.type,$.source).loadTile($,re)},Sa.prototype.loadDEMTile=function(W,$,re){this.getDEMWorkerSource(W,$.source).loadTile($,re)},Sa.prototype.reloadTile=function(W,$,re){this.getWorkerSource(W,$.type,$.source).reloadTile($,re)},Sa.prototype.abortTile=function(W,$,re){this.getWorkerSource(W,$.type,$.source).abortTile($,re)},Sa.prototype.removeTile=function(W,$,re){this.getWorkerSource(W,$.type,$.source).removeTile($,re)},Sa.prototype.removeDEMTile=function(W,$){this.getDEMWorkerSource(W,$.source).removeTile($)},Sa.prototype.removeSource=function(W,$,re){if(this.workerSources[W]&&this.workerSources[W][$.type]&&this.workerSources[W][$.type][$.source]){var he=this.workerSources[W][$.type][$.source];delete this.workerSources[W][$.type][$.source],he.removeSource!==void 0?he.removeSource($,re):re()}},Sa.prototype.loadWorkerSource=function(W,$,re){try{this.self.importScripts($.url),re()}catch(he){re(he.toString())}},Sa.prototype.syncRTLPluginState=function(W,$,re){try{m.plugin.setState($);var he=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Ae=m.plugin.isParsed();re(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Ae)}}catch(je){re(je.toString())}},Sa.prototype.getAvailableImages=function(W){var $=this.availableImages[W];return $||($=[]),$},Sa.prototype.getLayerIndex=function(W){var $=this.layerIndexes[W];return $||($=this.layerIndexes[W]=new de),$},Sa.prototype.getWorkerSource=function(W,$,re){var he=this;return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][$]||(this.workerSources[W][$]={}),this.workerSources[W][$][re]||(this.workerSources[W][$][re]=new this.workerSourceTypes[$]({send:function(Ae,je,Je){he.actor.send(Ae,je,Je,W)}},this.getLayerIndex(W),this.getAvailableImages(W))),this.workerSources[W][$][re]},Sa.prototype.getDEMWorkerSource=function(W,$){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][$]||(this.demWorkerSources[W][$]=new ar),this.demWorkerSources[W][$]},Sa.prototype.enforceCacheSizeLimit=function(W,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Sa(self)),Sa}),De(["./shared"],function(m){"use strict";var Ie=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,k,U=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(U);try{k=new Worker(H),M=!0}catch(ie){M=!1}return k&&k.terminate(),URL.revokeObjectURL(H),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var k=M.getContext("2d");if(!k)return!1;var U=k.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[A=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[A]=function(M){var k=function(H){var ie=document.createElement("canvas"),se=Object.create(f.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=H,ie.probablySupportsContext?ie.probablySupportsContext("webgl",se)||ie.probablySupportsContext("experimental-webgl",se):ie.supportsContext?ie.supportsContext("webgl",se)||ie.supportsContext("experimental-webgl",se):ie.getContext("webgl",se)||ie.getContext("experimental-webgl",se)}(M);if(!k)return!1;var U=k.createShader(k.VERTEX_SHADER);return!(!U||k.isContextLost())&&(k.shaderSource(U,"void main() {}"),k.compileShader(U),k.getShaderParameter(U,k.COMPILE_STATUS)===!0)}(A)),d[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),X={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},de=m.window.document&&m.window.document.documentElement.style;function ce(l){if(!de)return l[0];for(var f=0;f<l.length;f++)if(l[f]in de)return l[f];return l[0]}var ze,ge=ce(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);X.disableDrag=function(){de&&ge&&(ze=de[ge],de[ge]="none")},X.enableDrag=function(){de&&ge&&(de[ge]=ze)};var nt=ce(["transform","WebkitTransform"]);X.setTransform=function(l,f){l.style[nt]=f};var ct=!1;try{var Et=Object.defineProperty({},"passive",{get:function(){ct=!0}});m.window.addEventListener("test",Et,Et),m.window.removeEventListener("test",Et,Et)}catch(l){ct=!1}X.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&ct?d:d.capture)},X.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&ct?d:d.capture)};var ar=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",ar,!0)};function dr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}X.suppressClick=function(){m.window.addEventListener("click",ar,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",ar,!0)},0)},X.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},X.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},X.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},X.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var kt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var A=E[d];this._notify(A.ids,A.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,A=0,M=c;A<M.length;A+=1){var k=M[A];if(k[0]<E||k[1]<k[0]||d<k[1])return!1;E=k[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var A=0,M=c;A<M.length;A+=1)this.images[M[A]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},A=0,M=c;A<M.length;A+=1){var k=M[A];this.images[k]||this.fire(new m.Event("styleimagemissing",{id:k}));var U=this.images[k];U?E[k]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var A={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new m.ImagePosition(A,E);this.patterns[c]={bin:A,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),A=E.w,M=E.h,k=this.atlasImage;for(var U in k.resize({width:A||1,height:M||1}),this.patterns){var H=this.patterns[U].bin,ie=H.x+1,se=H.y+1,le=this.images[U].data,Me=le.width,we=le.height;m.RGBAImage.copy(le,k,{x:0,y:0},{x:ie,y:se},{width:Me,height:we}),m.RGBAImage.copy(le,k,{x:0,y:we-1},{x:ie,y:se-1},{width:Me,height:1}),m.RGBAImage.copy(le,k,{x:0,y:0},{x:ie,y:se+we},{width:Me,height:1}),m.RGBAImage.copy(le,k,{x:Me-1,y:0},{x:ie-1,y:se},{width:1,height:we}),m.RGBAImage.copy(le,k,{x:0,y:0},{x:ie+Me,y:se},{width:1,height:we})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var A=E[d];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var M=this.images[A];dr(M)&&this.updateImage(A,M)}}},f}(m.Evented),nr=St,Ut=St,ht=1e20;function St(l,f,c,d,E,A){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=A||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function or(l,f,c,d,E,A,M){for(var k=0;k<f;k++){for(var U=0;U<c;U++)d[U]=l[U*f+k];for(q(d,E,A,M,c),U=0;U<c;U++)l[U*f+k]=E[U]}for(U=0;U<c;U++){for(k=0;k<f;k++)d[k]=l[U*f+k];for(q(d,E,A,M,f),k=0;k<f;k++)l[U*f+k]=Math.sqrt(E[k])}}function q(l,f,c,d,E){c[0]=0,d[0]=-ht,d[1]=+ht;for(var A=1,M=0;A<E;A++){for(var k=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);k<=d[M];)M--,k=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);c[++M]=A,d[M]=k,d[M+1]=+ht}for(A=0,M=0;A<E;A++){for(;d[M+1]<A;)M++;f[A]=(A-c[M])*(A-c[M])+l[c[M]]}}St.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ht:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ht:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(or(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),or(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},nr.default=Ut;var Gt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Gt.prototype.setURL=function(l){this.url=l},Gt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var A=0,M=l[E];A<M.length;A+=1)d.push({stack:E,id:M[A]});m.asyncAll(d,function(k,U){var H=k.stack,ie=k.id,se=c.entries[H];se||(se=c.entries[H]={glyphs:{},requests:{},ranges:{}});var le=se.glyphs[ie];if(le===void 0){if(le=c._tinySDF(se,H,ie))return se.glyphs[ie]=le,void U(null,{stack:H,id:ie,glyph:le});var Me=Math.floor(ie/256);if(256*Me>65535)U(new Error("glyphs > 65535 not supported"));else if(se.ranges[Me])U(null,{stack:H,id:ie,glyph:le});else{var we=se.requests[Me];we||(we=se.requests[Me]=[],Gt.loadGlyphRange(H,Me,c.url,c.requestManager,function(Ve,be){if(be){for(var Ue in be)c._doesCharSupportLocalGlyph(+Ue)||(se.glyphs[+Ue]=be[+Ue]);se.ranges[Me]=!0}for(var Qe=0,dt=we;Qe<dt.length;Qe+=1)(0,dt[Qe])(Ve,be);delete se.requests[Me]})),we.push(function(Ve,be){Ve?U(Ve):be&&U(null,{stack:H,id:ie,glyph:be[ie]||null})})}}else U(null,{stack:H,id:ie,glyph:le})},function(k,U){if(k)f(k);else if(U){for(var H={},ie=0,se=U;ie<se.length;ie+=1){var le=se[ie],Me=le.stack,we=le.id,Ve=le.glyph;(H[Me]||(H[Me]={}))[we]=Ve&&{id:Ve.id,bitmap:Ve.bitmap.clone(),metrics:Ve.metrics}}f(null,H)}})},Gt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Gt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),E=l.tinySDF=new Gt.TinySDF(24,3,8,.25,d,A)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Gt.loadGlyphRange=function(l,f,c,d,E){var A=256*f,M=A+255,k=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",A+"-"+M),m.ResourceType.Glyphs);m.getArrayBuffer(k,function(U,H){if(U)E(U);else if(H){for(var ie={},se=0,le=m.parseGlyphPBF(H);se<le.length;se+=1){var Me=le[se];ie[Me.id]=Me}E(null,ie)}})},Gt.TinySDF=nr;var He=function(){this.specification=m.styleSpec.light.position};He.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},He.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var $e=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new He,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),bt=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable($e),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var A=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),A):this._transitionable.setValue(E,A)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),et=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};et.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},et.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,A=l[0]*c,M=!0;d.push({left:E,right:A,isDash:M,zeroLength:l[0]===0});for(var k=l[0],U=1;U<l.length;U++){var H=l[U];d.push({left:E=k*c,right:A=(k+=H)*c,isDash:M=!M,zeroLength:H===0})}return d},et.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var A=this.width*(this.nextRow+c+E),M=0,k=l[M],U=0;U<this.width;U++){U/k.right>1&&(k=l[++M]);var H=Math.abs(U-k.left),ie=Math.abs(U-k.right),se=Math.min(H,ie),le=void 0,Me=E/c*(d+1);if(k.isDash){var we=d-Math.abs(Me);le=Math.sqrt(se*se+we*we)}else le=d-Math.sqrt(se*se+Me*Me);this.data[A+U]=Math.max(0,Math.min(255,le+128))}},et.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],A=l[l.length-1];E.isDash===A.isDash&&(E.left=A.left-this.width,A.right=E.right+this.width);for(var M=this.width*this.nextRow,k=0,U=l[k],H=0;H<this.width;H++){H/U.right>1&&(U=l[++k]);var ie=Math.abs(H-U.left),se=Math.abs(H-U.right),le=Math.min(ie,se);this.data[M+H]=Math.max(0,Math.min(255,(U.isDash?le:-le)+128))}},et.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,A=0;A<l.length;A++)E+=l[A];if(E!==0){var M=this.width/E,k=this.getDashRanges(l,this.width,M);f?this.addRoundDash(k,M,c):this.addRegularDash(k)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},et.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var qt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var A=new l.Actor(d[E],c,this.id);A.name="Worker "+E,this.actors.push(A)}};function Tr(l,f,c){var d=function(E,A){if(E)return c(E);if(A){var M=m.pick(m.extend(A,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(M.vectorLayers=A.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(k){return k.id})),M.tiles=f.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}qt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},qt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},qt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},qt.Actor=m.Actor;var Br=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Br.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Br.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),A=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<A};var rn=function(l){function f(c,d,E,A){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Br(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(k,U){return delete c.request,c.aborted?d(null):k&&k.status!==404?d(k):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",A,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",A,M.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ee=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Br(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,A=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(A,m.ResourceType.Tile),function(M,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(k){E.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var U=E.map.painter.context,H=U.gl;c.texture=E.map.painter.getTileTexture(k.width),c.texture?c.texture.update(k,{useMipmap:!0}):(c.texture=new m.Texture(U,k,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),We=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(M,k){M&&(c.state="errored",d(M)),k&&(c.dem=k,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(M,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(k){this.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var U=m.window.ImageBitmap&&k instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?k:m.browser.getImageData(k,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,A.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),A=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,k=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y).key]={backfilled:!1},d.y>0&&(H[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new m.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y+1).key]={backfilled:!1}),H},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Ee),Re=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(A),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var A={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(A.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",A))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},A),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),A=this._data;typeof A=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(A),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(A),this.actor.send(this.type+".loadData",E,function(M,k){d._removed||k&&k.abandoned||(d._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[d.id]&&(d._resourceTiming=k.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,A=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(A,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,k){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(k,E.map.painter,A==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),_t=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ft=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(A,M){E._loaded=!0,A?E.fire(new m.ErrorEvent(A)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var k=1/0,U=1/0,H=-1/0,ie=-1/0,se=0,le=M;se<le.length;se+=1){var Me=le[se];k=Math.min(k,Me.x),U=Math.min(U,Me.y),H=Math.max(H,Me.x),ie=Math.max(ie,Me.y)}var we=Math.max(H-k,ie-U),Ve=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),be=Math.pow(2,Ve);return new m.CanonicalTileID(Ve,Math.floor((k+H)/2*be),Math.floor((U+ie)/2*be))}(E),this.minzoom=this.maxzoom=this.tileID.z;var A=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Lt=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,A=d.urls;E<A.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(A[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(M,k){c._loaded=!0,M?c.fire(new m.ErrorEvent(M)):k&&(c.video=k,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ft),Ht=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(k){return typeof k!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(ft),Mr={vector:rn,raster:Ee,"raster-dem":We,geojson:Re,video:Lt,image:ft,canvas:Ht};function Kn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function Wr(l,f,c,d,E,A){var M=function(Ve,be,Ue){if(Ve)for(var Qe=0,dt=Ve;Qe<dt.length;Qe+=1){var jt=be[dt[Qe]];if(jt&&jt.source===Ue&&jt.type==="fill-extrusion")return!0}else for(var Nt in be){var Xt=be[Nt];if(Xt.source===Ue&&Xt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),k=A.maxPitchScaleFactor(),U=l.tilesIn(d,k,M);U.sort(na);for(var H=[],ie=0,se=U;ie<se.length;ie+=1){var le=se[ie];H.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(f,c,l._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,E,A,k,Kn(l.transform,le.tileID))})}var Me=function(Ve){for(var be={},Ue={},Qe=0,dt=Ve;Qe<dt.length;Qe+=1){var jt=dt[Qe],Nt=jt.queryResults,Xt=jt.wrappedTileID,vr=Ue[Xt]=Ue[Xt]||{};for(var Dr in Nt)for(var Lr=Nt[Dr],Ur=vr[Dr]=vr[Dr]||{},Zn=be[Dr]=be[Dr]||[],kn=0,Vn=Lr;kn<Vn.length;kn+=1){var Ai=Vn[kn];Ur[Ai.featureIndex]||(Ur[Ai.featureIndex]=!0,Zn.push(Ai))}}return be}(H);for(var we in Me)Me[we].forEach(function(Ve){var be=Ve.feature,Ue=l.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Ue});return Me}function na(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Yn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Yn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Yn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var A={value:f,timeout:void 0};if(c!==void 0&&(A.timeout=setTimeout(function(){d.remove(l,A)},c)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Yn.prototype.has=function(l){return l.wrapped().key in this.data},Yn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Yn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Yn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Yn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Yn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Yn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Yn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var A=E[d];l(A.value)||f.push(A)}for(var M=0,k=f;M<k.length;M+=1){var U=k[M];this.remove(U.value.tileID,U)}};var ai=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ai.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ai.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ai.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ci=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ci.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ci.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},ci.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},ci.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],A=f.attributes[E.name];A!==void 0&&l.vertexAttribPointer(A,E.components,l[oi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},ci.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};gi.prototype.get=function(){return this.current},gi.prototype.set=function(l){},gi.prototype.getDefault=function(){return this.default},gi.prototype.setDefault=function(){this.set(this.default)};var xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(gi),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(gi),Gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(gi),ia=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(gi),ba=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(gi),R=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(gi),sn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(gi),Ea=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(gi),Bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(gi),aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(gi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(gi),cs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(gi),pe=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(gi),fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(gi),lo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(gi),Va=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(gi),Bt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(gi),tr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(gi),Or=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(gi),Vr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(gi),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(gi),zn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(gi),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(gi),pi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(gi),An=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(gi),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(gi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(gi),Na=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(gi),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(gi),Lo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(gi),ka=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(gi),Sa=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(gi),W=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Sa),$=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Sa),re=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new W(l,E),d&&(this.depthAttachment=new $(l,E))};re.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,f,c){this.func=l,this.mask=f,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Ae=function(l,f,c,d,E,A){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=A};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var je=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};je.disabled=new je(je.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),je.unblended=new je(je.Replace,m.Color.transparent,[!0,!0,!0,!0]),je.alphaBlended=new je([1,771],m.Color.transparent,[!0,!0,!0,!0]);var Je=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Je.disabled=new Je(!1,1029,2305),Je.backCCW=new Je(!0,1029,2305);var ue=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new xa(this),this.clearDepth=new qi(this),this.clearStencil=new Gi(this),this.colorMask=new ia(this),this.depthMask=new ba(this),this.stencilMask=new R(this),this.stencilFunc=new sn(this),this.stencilOp=new Ea(this),this.stencilTest=new Bi(this),this.depthRange=new aa(this),this.depthTest=new Qi(this),this.depthFunc=new cs(this),this.blend=new pe(this),this.blendFunc=new fi(this),this.blendColor=new lo(this),this.blendEquation=new Va(this),this.cullFace=new Bt(this),this.cullFaceSide=new tr(this),this.frontFace=new Or(this),this.program=new Vr(this),this.activeTexture=new Ln(this),this.viewport=new zn(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new pi(this),this.bindTexture=new An(this),this.bindVertexBuffer=new Mi(this),this.bindElementBuffer=new Li(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Na(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new Lo(this),this.pixelStoreUnpackFlipY=new ka(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(l,f){return new ai(this,l,f)},ue.prototype.createVertexBuffer=function(l,f,c){return new ci(this,l,f,c)},ue.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},ue.prototype.createFramebuffer=function(l,f,c){return new re(this,l,f,c)},ue.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},ue.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ue.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Oe=function(l){function f(c,d,E){var A=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(M,k,U,H){var ie=new Mr[k.type](M,k,U,H);if(ie.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+ie.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ie),ie}(c,d,E,this),this._tiles={},this._cache=new Yn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(pt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var A in this._tiles)this._isIdRenderable(A,c)&&E.push(this._tiles[A]);return c?E.sort(function(M,k){var U=M.tileID,H=k.tileID,ie=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),se=new m.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-H.overscaledZ||se.y-ie.y||se.x-ie.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(pt).map(function(M){return M.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,A){if(A)return c.state="errored",void(A.status!==404?this._source.fire(new m.ErrorEvent(A,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var A=d[E];if(c.neighboringTiles&&c.neighboringTiles[A]){var M=this.getTileByID(A);k(c,M),k(M,c)}}function k(U,H){U.needsHillshadePrepare=!0;var ie=H.tileID.canonical.x-U.tileID.canonical.x,se=H.tileID.canonical.y-U.tileID.canonical.y,le=Math.pow(2,U.tileID.canonical.z),Me=H.tileID.key;ie===0&&se===0||Math.abs(se)>1||(Math.abs(ie)>1&&(Math.abs(ie+le)===1?ie+=le:Math.abs(ie-le)===1&&(ie-=le)),H.dem&&U.dem&&(U.dem.backfillBorder(H.dem,ie,se),U.neighboringTiles&&U.neighboringTiles[Me]&&(U.neighboringTiles[Me].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,A){for(var M in this._tiles){var k=this._tiles[M];if(!(A[M]||!k.hasData()||k.tileID.overscaledZ<=d||k.tileID.overscaledZ>E)){for(var U=k.tileID;k&&k.tileID.overscaledZ>d+1;){var H=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[H.key])&&k.hasData()&&(U=H)}for(var ie=U;ie.overscaledZ>d;)if(c[(ie=ie.scaledTo(ie.overscaledZ-1)).key]){A[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var A=c.overscaledZ-1;A>=d;A--){var M=c.scaledTo(A),k=this._getLoadedTile(M);if(k)return k}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,A=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(M)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var A in this._tiles){var M=this._tiles[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var k in this._tiles=E,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(vr){return new m.OverscaledTileID(vr.canonical.z,vr.wrap,vr.canonical.z,vr.canonical.x,vr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(vr){return d._source.hasTile(vr)}))):E=[];var A=c.coveringZoomLevel(this._source),M=Math.max(A-f.maxOverzooming,this._source.minzoom),k=Math.max(A+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,A);if(pr(this._source.type)){for(var H={},ie={},se=0,le=Object.keys(U);se<le.length;se+=1){var Me=le[se],we=U[Me],Ve=this._tiles[Me];if(Ve&&!(Ve.fadeEndTime&&Ve.fadeEndTime<=m.browser.now())){var be=this.findLoadedParent(we,M);be&&(this._addTile(be.tileID),H[be.tileID.key]=be.tileID),ie[Me]=we}}for(var Ue in this._retainLoadedChildren(ie,A,k,U),H)U[Ue]||(this._coveredTiles[Ue]=!0,U[Ue]=H[Ue])}for(var Qe in U)this._tiles[Qe].clearFadeHold();for(var dt=0,jt=m.keysDifference(this._tiles,U);dt<jt.length;dt+=1){var Nt=jt[dt],Xt=this._tiles[Nt];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},A={},M=Math.max(d-f.maxOverzooming,this._source.minzoom),k=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},H=0,ie=c;H<ie.length;H+=1){var se=ie[H],le=this._addTile(se);E[se.key]=se,le.hasData()||d<this._source.maxzoom&&(U[se.key]=se)}this._retainLoadedChildren(U,d,k,E);for(var Me=0,we=c;Me<we.length;Me+=1){var Ve=we[Me],be=this._tiles[Ve.key];if(!be.hasData()){if(d+1>this._source.maxzoom){var Ue=Ve.children(this._source.maxzoom)[0],Qe=this.getTile(Ue);if(Qe&&Qe.hasData()){E[Ue.key]=Ue;continue}}else{var dt=Ve.children(this._source.maxzoom);if(E[dt[0].key]&&E[dt[1].key]&&E[dt[2].key]&&E[dt[3].key])continue}for(var jt=be.wasRequested(),Nt=Ve.overscaledZ-1;Nt>=M;--Nt){var Xt=Ve.scaledTo(Nt);if(A[Xt.key]||(A[Xt.key]=!0,!(be=this.getTile(Xt))&&jt&&(be=this._addTile(Xt)),be&&(E[Xt.key]=Xt,jt=be.wasRequested(),be.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,A=this._tiles[c].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){E=this._loadedParentTiles[A.key];break}d.push(A.key);var M=A.scaledTo(A.overscaledZ-1);if(E=this._getLoadedTile(M))break;A=M}for(var k=0,U=d;k<U.length;k+=1)this._loadedParentTiles[U[k]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var A=d.getExpiryTimeout();A&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},A))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var A=this,M=[],k=this.transform;if(!k)return M;for(var U=E?k.getCameraQueryGeometry(c):c,H=c.map(function(Nt){return k.pointCoordinate(Nt)}),ie=U.map(function(Nt){return k.pointCoordinate(Nt)}),se=this.getIds(),le=1/0,Me=1/0,we=-1/0,Ve=-1/0,be=0,Ue=ie;be<Ue.length;be+=1){var Qe=Ue[be];le=Math.min(le,Qe.x),Me=Math.min(Me,Qe.y),we=Math.max(we,Qe.x),Ve=Math.max(Ve,Qe.y)}for(var dt=function(Nt){var Xt=A._tiles[se[Nt]];if(!Xt.holdingForFade()){var vr=Xt.tileID,Dr=Math.pow(2,k.zoom-Xt.tileID.overscaledZ),Lr=d*Xt.queryPadding*m.EXTENT/Xt.tileSize/Dr,Ur=[vr.getTilePoint(new m.MercatorCoordinate(le,Me)),vr.getTilePoint(new m.MercatorCoordinate(we,Ve))];if(Ur[0].x-Lr<m.EXTENT&&Ur[0].y-Lr<m.EXTENT&&Ur[1].x+Lr>=0&&Ur[1].y+Lr>=0){var Zn=H.map(function(Vn){return vr.getTilePoint(Vn)}),kn=ie.map(function(Vn){return vr.getTilePoint(Vn)});M.push({tile:Xt,tileID:vr,queryGeometry:Zn,cameraQueryGeometry:kn,scale:Dr})}}},jt=0;jt<se.length;jt++)dt(jt);return M},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),A=0,M=E;A<M.length;A+=1){var k=M[A];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(pr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var A=this._tiles[c];A&&A.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(A){return!A.hasDependency(c,d)})},f}(m.Evented);function pt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function pr(l){return l==="raster"||l==="image"||l==="video"}function Ot(){return new m.window.Worker(Nc.workerUrl)}Oe.maxOverzooming=10,Oe.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",mr=function(){this.active={}};mr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<mr.workerCount;)this.workers.push(new Ot);return this.active[l]=!0,this.workers.slice()},mr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},mr.prototype.isPreloaded=function(){return!!this.active[Dt]},mr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,cn=Math.floor(m.browser.hardwareConcurrency/2);function Ct(){return _n||(_n=new mr),_n}function un(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Zr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=un(l[d],f[l[d].ref]));return l}mr.workerCount=Math.max(Math.min(cn,6),1);var Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vi(l,f,c){c.push({command:Yr.addSource,args:[l,f[l]]})}function qr(l,f,c){f.push({command:Yr.removeSource,args:[l]}),c[l]=!0}function wi(l,f,c,d){qr(l,c,d),vi(l,f,c)}function oa(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function Ei(l,f,c,d,E,A){var M;for(M in f=f||{},l=l||{})l.hasOwnProperty(M)&&(m.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}));for(M in f)f.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(m.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}))}function Ti(l){return l.id}function Si(l,f){return l[f.id]=f,l}var ei=function(l,f){this.reset(l,f)};ei.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ei.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,A=this._distances[E],M=c-A,k=M>0?(d-A)/M:0;return this.points[E].mult(1-k).add(this.points[f].mult(k))};var ji=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var A=0;A<this.xCellCount*this.yCellCount;A++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function La(l,f,c,d,E){var A=m.create();return f?(m.scale(A,A,[1/E,1/E,1]),c||m.rotateZ(A,A,d.angle)):m.multiply(A,d.labelPlaneMatrix,l),A}function Hi(l,f,c,d,E){if(f){var A=m.clone(l);return m.scale(A,A,[E,E,1]),c||m.rotateZ(A,A,-d.angle),A}return d.glCoordMatrix}function Pi(l,f){var c=[l.x,l.y,0,1];Ga(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Ni(l,f){return .5+l/f*.5}function Da(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function Js(l,f,c,d,E,A,M,k){var U=d?l.textSizeData:l.iconSizeData,H=m.evaluateSizeForZoom(U,c.transform.zoom),ie=[256/c.width*2+1,256/c.height*2+1],se=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;se.clear();for(var le=l.lineVertexArray,Me=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=c.transform.width/c.transform.height,Ve=!1,be=0;be<Me.length;be++){var Ue=Me.get(be);if(Ue.hidden||Ue.writingMode===m.WritingMode.vertical&&!Ve)co(Ue.numGlyphs,se);else{Ve=!1;var Qe=[Ue.anchorX,Ue.anchorY,0,1];if(m.transformMat4(Qe,Qe,f),Da(Qe,ie)){var dt=Ni(c.transform.cameraToCenterDistance,Qe[3]),jt=m.evaluateSizeForFeature(U,H,Ue),Nt=M?jt/dt:jt*dt,Xt=new m.Point(Ue.anchorX,Ue.anchorY),vr=Pi(Xt,E).point,Dr={},Lr=Ps(Ue,Nt,!1,k,f,E,A,l.glyphOffsetArray,le,se,vr,Xt,Dr,we);Ve=Lr.useVertical,(Lr.notEnoughRoom||Ve||Lr.needsFlipping&&Ps(Ue,Nt,!0,k,f,E,A,l.glyphOffsetArray,le,se,vr,Xt,Dr,we).notEnoughRoom)&&co(Ue.numGlyphs,se)}else co(Ue.numGlyphs,se)}}d?l.text.dynamicLayoutVertexBuffer.updateData(se):l.icon.dynamicLayoutVertexBuffer.updateData(se)}function za(l,f,c,d,E,A,M,k,U,H,ie){var se=k.glyphStartIndex+k.numGlyphs,le=k.lineStartIndex,Me=k.lineStartIndex+k.lineLength,we=f.getoffsetX(k.glyphStartIndex),Ve=f.getoffsetX(se-1),be=Ji(l*we,c,d,E,A,M,k.segment,le,Me,U,H,ie);if(!be)return null;var Ue=Ji(l*Ve,c,d,E,A,M,k.segment,le,Me,U,H,ie);return Ue?{first:be,last:Ue}:null}function Ca(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function Ps(l,f,c,d,E,A,M,k,U,H,ie,se,le,Me){var we,Ve=f/24,be=l.lineOffsetX*Ve,Ue=l.lineOffsetY*Ve;if(l.numGlyphs>1){var Qe=l.glyphStartIndex+l.numGlyphs,dt=l.lineStartIndex,jt=l.lineStartIndex+l.lineLength,Nt=za(Ve,k,be,Ue,c,ie,se,l,U,A,le);if(!Nt)return{notEnoughRoom:!0};var Xt=Pi(Nt.first.point,M).point,vr=Pi(Nt.last.point,M).point;if(d&&!c){var Dr=Ca(l.writingMode,Xt,vr,Me);if(Dr)return Dr}we=[Nt.first];for(var Lr=l.glyphStartIndex+1;Lr<Qe-1;Lr++)we.push(Ji(Ve*k.getoffsetX(Lr),be,Ue,c,ie,se,l.segment,dt,jt,U,A,le));we.push(Nt.last)}else{if(d&&!c){var Ur=Pi(se,E).point,Zn=l.lineStartIndex+l.segment+1,kn=new m.Point(U.getx(Zn),U.gety(Zn)),Vn=Pi(kn,E),Ai=Vn.signedDistanceFromCamera>0?Vn.point:Vo(se,kn,Ur,1,E),an=Ca(l.writingMode,Ur,Ai,Me);if(an)return an}var si=Ji(Ve*k.getoffsetX(l.glyphStartIndex),be,Ue,c,ie,se,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,A,le);if(!si)return{notEnoughRoom:!0};we=[si]}for(var hi=0,ti=we;hi<ti.length;hi+=1){var Xn=ti[hi];m.addDynamicAttributes(H,Xn.point,Xn.angle)}return{}}function Vo(l,f,c,d,E){var A=Pi(l.add(l.sub(f)._unit()),E).point,M=c.sub(A);return c.add(M._mult(d/M.mag()))}function Ji(l,f,c,d,E,A,M,k,U,H,ie,se){var le=d?l-f:l+f,Me=le>0?1:-1,we=0;d&&(Me*=-1,we=Math.PI),Me<0&&(we+=Math.PI);for(var Ve=Me>0?k+M:k+M+1,be=E,Ue=E,Qe=0,dt=0,jt=Math.abs(le),Nt=[];Qe+dt<=jt;){if((Ve+=Me)<k||Ve>=U)return null;if(Ue=be,Nt.push(be),(be=se[Ve])===void 0){var Xt=new m.Point(H.getx(Ve),H.gety(Ve)),vr=Pi(Xt,ie);if(vr.signedDistanceFromCamera>0)be=se[Ve]=vr.point;else{var Dr=Ve-Me;be=Vo(Qe===0?A:new m.Point(H.getx(Dr),H.gety(Dr)),Xt,Ue,jt-Qe+1,ie)}}Qe+=dt,dt=Ue.dist(be)}var Lr=(jt-Qe)/dt,Ur=be.sub(Ue),Zn=Ur.mult(Lr)._add(Ue);Zn._add(Ur._unit()._perp()._mult(c*Me));var kn=we+Math.atan2(be.y-Ue.y,be.x-Ue.x);return Nt.push(Zn),{point:Zn,angle:kn,path:Nt}}ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ji.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},ji.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},ji.prototype._insertBoxCell=function(l,f,c,d,E,A){this.boxCells[E].push(A)},ji.prototype._insertCircleCell=function(l,f,c,d,E,A){this.circleCells[E].push(A)},ji.prototype._query=function(l,f,c,d,E,A){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var M=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var U=0;U<this.circleKeys.length;U++){var H=this.circles[3*U],ie=this.circles[3*U+1],se=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:H-se,y1:ie-se,x2:H+se,y2:ie+se})}return A?M.filter(A):M}return this._forEachCell(l,f,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},A),E?M.length>0:M},ji.prototype._queryCircle=function(l,f,c,d,E){var A=l-c,M=l+c,k=f-c,U=f+c;if(M<0||A>this.width||U<0||k>this.height)return!d&&[];var H=[];return this._forEachCell(A,k,M,U,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},ji.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},ji.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},ji.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},ji.prototype._queryCell=function(l,f,c,d,E,A,M,k){var U=M.seenUids,H=this.boxCells[E];if(H!==null)for(var ie=this.bboxes,se=0,le=H;se<le.length;se+=1){var Me=le[se];if(!U.box[Me]){U.box[Me]=!0;var we=4*Me;if(l<=ie[we+2]&&f<=ie[we+3]&&c>=ie[we+0]&&d>=ie[we+1]&&(!k||k(this.boxKeys[Me]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Me],x1:ie[we],y1:ie[we+1],x2:ie[we+2],y2:ie[we+3]})}}}var Ve=this.circleCells[E];if(Ve!==null)for(var be=this.circles,Ue=0,Qe=Ve;Ue<Qe.length;Ue+=1){var dt=Qe[Ue];if(!U.circle[dt]){U.circle[dt]=!0;var jt=3*dt;if(this._circleAndRectCollide(be[jt],be[jt+1],be[jt+2],l,f,c,d)&&(!k||k(this.circleKeys[dt]))){if(M.hitTest)return A.push(!0),!0;var Nt=be[jt],Xt=be[jt+1],vr=be[jt+2];A.push({key:this.circleKeys[dt],x1:Nt-vr,y1:Xt-vr,x2:Nt+vr,y2:Xt+vr})}}}},ji.prototype._queryCellCircle=function(l,f,c,d,E,A,M,k){var U=M.circle,H=M.seenUids,ie=this.boxCells[E];if(ie!==null)for(var se=this.bboxes,le=0,Me=ie;le<Me.length;le+=1){var we=Me[le];if(!H.box[we]){H.box[we]=!0;var Ve=4*we;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Ve+0],se[Ve+1],se[Ve+2],se[Ve+3])&&(!k||k(this.boxKeys[we])))return A.push(!0),!0}}var be=this.circleCells[E];if(be!==null)for(var Ue=this.circles,Qe=0,dt=be;Qe<dt.length;Qe+=1){var jt=dt[Qe];if(!H.circle[jt]){H.circle[jt]=!0;var Nt=3*jt;if(this._circlesCollide(Ue[Nt],Ue[Nt+1],Ue[Nt+2],U.x,U.y,U.radius)&&(!k||k(this.circleKeys[jt])))return A.push(!0),!0}}},ji.prototype._forEachCell=function(l,f,c,d,E,A,M,k){for(var U=this._convertToXCellCoord(l),H=this._convertToYCellCoord(f),ie=this._convertToXCellCoord(c),se=this._convertToYCellCoord(d),le=U;le<=ie;le++)for(var Me=H;Me<=se;Me++)if(E.call(this,l,f,c,d,this.xCellCount*Me+le,A,M,k))return},ji.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},ji.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},ji.prototype._circlesCollide=function(l,f,c,d,E,A){var M=d-l,k=E-f,U=c+A;return U*U>M*M+k*k},ji.prototype._circleAndRectCollide=function(l,f,c,d,E,A,M){var k=(A-d)/2,U=Math.abs(l-(d+k));if(U>k+c)return!1;var H=(M-E)/2,ie=Math.abs(f-(E+H));if(ie>H+c)return!1;if(U<=k||ie<=H)return!0;var se=U-k,le=ie-H;return se*se+le*le<=c*c};var Pu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function co(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(Pu,3*d)}}function Ga(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var $n=function(l,f,c){f===void 0&&(f=new ji(l.width+200,l.height+200,25)),c===void 0&&(c=new ji(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Wi(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}$n.prototype.placeCollisionBox=function(l,f,c,d,E){var A=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*A.perspectiveRatio,k=l.x1*M+A.point.x,U=l.y1*M+A.point.y,H=l.x2*M+A.point.x,ie=l.y2*M+A.point.y;return!this.isInsideGrid(k,U,H,ie)||!f&&this.grid.hitTest(k,U,H,ie,E)?{box:[],offscreen:!1}:{box:[k,U,H,ie],offscreen:this.isOffscreen(k,U,H,ie)}},$n.prototype.placeCollisionCircles=function(l,f,c,d,E,A,M,k,U,H,ie,se,le){var Me=[],we=new m.Point(f.anchorX,f.anchorY),Ve=Pi(we,A),be=Ni(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Ue=(H?E/be:E*be)/m.ONE_EM,Qe=Pi(we,M).point,dt=za(Ue,d,f.lineOffsetX*Ue,f.lineOffsetY*Ue,!1,Qe,we,f,c,M,{}),jt=!1,Nt=!1,Xt=!0;if(dt){for(var vr=.5*se*be+le,Dr=new m.Point(-100,-100),Lr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),Ur=new ei,Zn=dt.first,kn=dt.last,Vn=[],Ai=Zn.path.length-1;Ai>=1;Ai--)Vn.push(Zn.path[Ai]);for(var an=1;an<kn.path.length;an++)Vn.push(kn.path[an]);var si=2.5*vr;if(k){var hi=Vn.map(function(os){return Pi(os,k)});Vn=hi.some(function(os){return os.signedDistanceFromCamera<=0})?[]:hi.map(function(os){return os.point})}var ti=[];if(Vn.length>0){for(var Xn=Vn[0].clone(),Fn=Vn[0].clone(),wn=1;wn<Vn.length;wn++)Xn.x=Math.min(Xn.x,Vn[wn].x),Xn.y=Math.min(Xn.y,Vn[wn].y),Fn.x=Math.max(Fn.x,Vn[wn].x),Fn.y=Math.max(Fn.y,Vn[wn].y);ti=Xn.x>=Dr.x&&Fn.x<=Lr.x&&Xn.y>=Dr.y&&Fn.y<=Lr.y?[Vn]:Fn.x<Dr.x||Xn.x>Lr.x||Fn.y<Dr.y||Xn.y>Lr.y?[]:m.clipLine([Vn],Dr.x,Dr.y,Lr.x,Lr.y)}for(var Gn=0,po=ti;Gn<po.length;Gn+=1){var Ta;Ur.reset(po[Gn],.25*vr),Ta=Ur.length<=.5*vr?1:Math.ceil(Ur.paddedLength/si)+1;for(var qo=0;qo<Ta;qo++){var Ko=qo/Math.max(Ta-1,1),no=Ur.lerp(Ko),ho=no.x+100,As=no.y+100;Me.push(ho,As,vr,0);var Wa=ho-vr,qu=As-vr,ws=ho+vr,Su=As+vr;if(Xt=Xt&&this.isOffscreen(Wa,qu,ws,Su),Nt=Nt||this.isInsideGrid(Wa,qu,ws,Su),!l&&this.grid.hitTestCircle(ho,As,vr,ie)&&(jt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:jt}}}}return{circles:!U&&jt||!Nt?[]:Me,offscreen:Xt,collisionDetected:jt}},$n.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,A=-1/0,M=0,k=l;M<k.length;M+=1){var U=k[M],H=new m.Point(U.x+100,U.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),A=Math.max(A,H.y),f.push(H)}for(var ie={},se={},le=0,Me=this.grid.query(c,d,E,A).concat(this.ignoredGrid.query(c,d,E,A));le<Me.length;le+=1){var we=Me[le],Ve=we.key;if(ie[Ve.bucketInstanceId]===void 0&&(ie[Ve.bucketInstanceId]={}),!ie[Ve.bucketInstanceId][Ve.featureIndex]){var be=[new m.Point(we.x1,we.y1),new m.Point(we.x2,we.y1),new m.Point(we.x2,we.y2),new m.Point(we.x1,we.y2)];m.polygonIntersectsPolygon(f,be)&&(ie[Ve.bucketInstanceId][Ve.featureIndex]=!0,se[Ve.bucketInstanceId]===void 0&&(se[Ve.bucketInstanceId]=[]),se[Ve.bucketInstanceId].push(Ve.featureIndex))}}return se},$n.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},$n.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var A=f?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},k=0;k<l.length;k+=4)A.insertCircle(M,l[k],l[k+1],l[k+2])},$n.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ga(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},$n.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},$n.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},$n.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var bo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};bo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Go=function(l,f,c,d,E){this.text=new bo(l?l.text:null,f,c,E),this.icon=new bo(l?l.icon:null,f,d,E)};Go.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var vu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},Vt=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Wt=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},fa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function pa(l,f,c,d,E){var A=m.getAnchorAlignment(l),M=-(A.horizontalAlign-.5)*f,k=-(A.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(M+U[0]*E,k+U[1]*E)}function ns(l,f,c,d,E,A){var M=l.x1,k=l.x2,U=l.y1,H=l.y2,ie=l.anchorPointX,se=l.anchorPointY,le=new m.Point(f,c);return d&&le._rotate(E?A:-A),{x1:M+le.x,y1:U+le.y,x2:k+le.x,y2:H+le.y,anchorPointX:ie,anchorPointY:se}}fa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var ao=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new $n(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new fa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ln(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}ao.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),A=c.latestFeatureIndex;if(E&&A&&f.id===E.layerIds[0]){var M=c.collisionBoxArray,k=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/m.EXTENT,ie=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),se=k.get("text-pitch-alignment")==="map",le=k.get("text-rotation-alignment")==="map",Me=Wi(c,1,this.transform.zoom),we=La(ie,se,le,this.transform,Me),Ve=null;if(se){var be=Hi(ie,se,le,this.transform,Me);Ve=m.multiply([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[E.bucketInstanceId]=new Wt(E.bucketInstanceId,A,E.sourceLayerIndex,E.index,c.tileID);var Ue={bucket:E,layout:k,posMatrix:ie,textLabelPlaneMatrix:we,labelToScreenMatrix:Ve,scale:U,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var Qe=0,dt=E.sortKeyRanges;Qe<dt.length;Qe+=1){var jt=dt[Qe];l.push({sortKey:jt.sortKey,symbolInstanceStart:jt.symbolInstanceStart,symbolInstanceEnd:jt.symbolInstanceEnd,parameters:Ue})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}},ao.prototype.attemptAnchorPlacement=function(l,f,c,d,E,A,M,k,U,H,ie,se,le,Me,we){var Ve,be=[se.textOffset0,se.textOffset1],Ue=pa(l,c,d,be,E),Qe=this.collisionIndex.placeCollisionBox(ns(f,Ue.x,Ue.y,A,M,this.transform.angle),ie,k,U,H.predicate);if(!we||this.collisionIndex.placeCollisionBox(ns(we,Ue.x,Ue.y,A,M,this.transform.angle),ie,k,U,H.predicate).box.length!==0)return Qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:be,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Ve},this.markUsedJustification(le,l,se,Me),le.allowVerticalPlacement&&(this.markUsedOrientation(le,Me,se),this.placedOrientations[se.crossTileID]=Me),{shift:Ue,placedGlyphBoxes:Qe}):void 0},ao.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,A=E.bucket,M=E.layout,k=E.posMatrix,U=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,ie=E.textPixelRatio,se=E.holdingForFade,le=E.collisionBoxArray,Me=E.partiallyEvaluatedTextSize,we=E.collisionGroup,Ve=M.get("text-optional"),be=M.get("icon-optional"),Ue=M.get("text-allow-overlap"),Qe=M.get("icon-allow-overlap"),dt=M.get("text-rotation-alignment")==="map",jt=M.get("text-pitch-alignment")==="map",Nt=M.get("icon-text-fit")!=="none",Xt=M.get("symbol-z-order")==="viewport-y",vr=Ue&&(Qe||!A.hasIconData()||be),Dr=Qe&&(Ue||!A.hasTextData()||Ve);!A.collisionArrays&&le&&A.deserializeCollisionBoxes(le);var Lr=function(an,si){if(!f[an.crossTileID])if(se)d.placements[an.crossTileID]=new vu(!1,!1,!1);else{var hi,ti=!1,Xn=!1,Fn=!0,wn=null,Gn={box:null,offscreen:null},po={box:null,offscreen:null},Ta=null,qo=null,Ko=0,no=0,ho=0;si.textFeatureIndex?Ko=si.textFeatureIndex:an.useRuntimeCollisionCircles&&(Ko=an.featureIndex),si.verticalTextFeatureIndex&&(no=si.verticalTextFeatureIndex);var As=si.textBox;if(As){var Wa=function(Ri){var Bs=m.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Ri&&d.prevPlacement){var ms=d.prevPlacement.placedOrientations[an.crossTileID];ms&&(d.placedOrientations[an.crossTileID]=ms,d.markUsedOrientation(A,Bs=ms,an))}return Bs},qu=function(Ri,Bs){if(A.allowVerticalPlacement&&an.numVerticalGlyphVertices>0&&si.verticalTextBox)for(var ms=0,Qu=A.writingModes;ms<Qu.length&&(Qu[ms]===m.WritingMode.vertical?(Gn=Bs(),po=Gn):Gn=Ri(),!(Gn&&Gn.box&&Gn.box.length));ms+=1);else Gn=Ri()};if(M.get("text-variable-anchor")){var ws=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[an.crossTileID]){var Su=d.prevPlacement.variableOffsets[an.crossTileID];ws.indexOf(Su.anchor)>0&&(ws=ws.filter(function(Ri){return Ri!==Su.anchor})).unshift(Su.anchor)}var os=function(Ri,Bs,ms){for(var Qu=Ri.x2-Ri.x1,zc=Ri.y2-Ri.y1,Uc=an.textBoxScale,hf=Nt&&!Qe?Bs:null,au={box:[],offscreen:!1},xl=Ue?2*ws.length:ws.length,So=0;So<xl;++So){var bl=d.attemptAnchorPlacement(ws[So%ws.length],Ri,Qu,zc,Uc,dt,jt,ie,k,we,So>=ws.length,an,A,ms,hf);if(bl&&(au=bl.placedGlyphBoxes)&&au.box&&au.box.length){ti=!0,wn=bl.shift;break}}return au};qu(function(){return os(As,si.iconBox,m.WritingMode.horizontal)},function(){var Ri=si.verticalTextBox;return A.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&an.numVerticalGlyphVertices>0&&Ri?os(Ri,si.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Gn&&(ti=Gn.box,Fn=Gn.offscreen);var gl=Wa(Gn&&Gn.box);if(!ti&&d.prevPlacement){var Du=d.prevPlacement.variableOffsets[an.crossTileID];Du&&(d.variableOffsets[an.crossTileID]=Du,d.markUsedJustification(A,Du.anchor,an,gl))}}else{var Cu=function(Ri,Bs){var ms=d.collisionIndex.placeCollisionBox(Ri,Ue,ie,k,we.predicate);return ms&&ms.box&&ms.box.length&&(d.markUsedOrientation(A,Bs,an),d.placedOrientations[an.crossTileID]=Bs),ms};qu(function(){return Cu(As,m.WritingMode.horizontal)},function(){var Ri=si.verticalTextBox;return A.allowVerticalPlacement&&an.numVerticalGlyphVertices>0&&Ri?Cu(Ri,m.WritingMode.vertical):{box:null,offscreen:null}}),Wa(Gn&&Gn.box&&Gn.box.length)}}if(ti=(hi=Gn)&&hi.box&&hi.box.length>0,Fn=hi&&hi.offscreen,an.useRuntimeCollisionCircles){var yl=A.text.placedSymbolArray.get(an.centerJustifiedTextSymbolIndex),Ku=m.evaluateSizeForFeature(A.textSizeData,Me,yl),Fs=M.get("text-padding");Ta=d.collisionIndex.placeCollisionCircles(Ue,yl,A.lineVertexArray,A.glyphOffsetArray,Ku,k,U,H,c,jt,we.predicate,an.collisionCircleDiameter,Fs),ti=Ue||Ta.circles.length>0&&!Ta.collisionDetected,Fn=Fn&&Ta.offscreen}if(si.iconFeatureIndex&&(ho=si.iconFeatureIndex),si.iconBox){var _l=function(Ri){var Bs=Nt&&wn?ns(Ri,wn.x,wn.y,dt,jt,d.transform.angle):Ri;return d.collisionIndex.placeCollisionBox(Bs,Qe,ie,k,we.predicate)};Xn=po&&po.box&&po.box.length&&si.verticalIconBox?(qo=_l(si.verticalIconBox)).box.length>0:(qo=_l(si.iconBox)).box.length>0,Fn=Fn&&qo.offscreen}var pu=Ve||an.numHorizontalGlyphVertices===0&&an.numVerticalGlyphVertices===0,oo=be||an.numIconVertices===0;if(pu||oo?oo?pu||(Xn=Xn&&ti):ti=Xn&&ti:Xn=ti=Xn&&ti,ti&&hi&&hi.box&&d.collisionIndex.insertCollisionBox(hi.box,M.get("text-ignore-placement"),A.bucketInstanceId,po&&po.box&&no?no:Ko,we.ID),Xn&&qo&&d.collisionIndex.insertCollisionBox(qo.box,M.get("icon-ignore-placement"),A.bucketInstanceId,ho,we.ID),Ta&&(ti&&d.collisionIndex.insertCollisionCircles(Ta.circles,M.get("text-ignore-placement"),A.bucketInstanceId,Ko,we.ID),c)){var Au=A.bucketInstanceId,$u=d.collisionCircleArrays[Au];$u===void 0&&($u=d.collisionCircleArrays[Au]=new Vt);for(var Fu=0;Fu<Ta.circles.length;Fu+=4)$u.circles.push(Ta.circles[Fu+0]),$u.circles.push(Ta.circles[Fu+1]),$u.circles.push(Ta.circles[Fu+2]),$u.circles.push(Ta.collisionDetected?1:0)}d.placements[an.crossTileID]=new vu(ti||vr,Xn||Dr,Fn||A.justReloaded),f[an.crossTileID]=!0}};if(Xt)for(var Ur=A.getSortedSymbolIndexes(this.transform.angle),Zn=Ur.length-1;Zn>=0;--Zn){var kn=Ur[Zn];Lr(A.symbolInstances.get(kn),A.collisionArrays[kn])}else for(var Vn=l.symbolInstanceStart;Vn<l.symbolInstanceEnd;Vn++)Lr(A.symbolInstances.get(Vn),A.collisionArrays[Vn]);if(c&&A.bucketInstanceId in this.collisionCircleArrays){var Ai=this.collisionCircleArrays[A.bucketInstanceId];m.invert(Ai.invProjMatrix,k),Ai.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},ao.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];A<M.length;A+=1){var k=M[A];k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=E>=0&&k!==E?0:c.crossTileID)}},ao.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];A<M.length;A+=1)l.text.placedSymbolArray.get(M[A]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},ao.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},A=f?f.variableOffsets:{},M=f?f.placedOrientations:{};for(var k in this.placements){var U=this.placements[k],H=E[k];H?(this.opacities[k]=new Go(H,d,U.text,U.icon),c=c||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[k]=new Go(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ie in E){var se=E[ie];if(!this.opacities[ie]){var le=new Go(se,d,!1,!1);le.isHidden()||(this.opacities[ie]=le,c=c||se.text.placed||se.icon.placed)}}for(var Me in A)this.variableOffsets[Me]||!this.opacities[Me]||this.opacities[Me].isHidden()||(this.variableOffsets[Me]=A[Me]);for(var we in M)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=M[we]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},ao.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var A=E[d],M=A.getBucket(l);M&&A.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,A.collisionBoxArray)}},ao.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,A=new Go(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),k=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",ie=E.get("text-pitch-alignment")==="map",se=E.get("icon-text-fit")!=="none",le=new Go(null,0,M&&(k||!l.hasIconData()||E.get("icon-optional")),k&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Me=function(Ue,Qe,dt){for(var jt=0;jt<Qe/4;jt++)Ue.opacityVertexArray.emplaceBack(dt)},we=function(Ue){var Qe=l.symbolInstances.get(Ue),dt=Qe.numHorizontalGlyphVertices,jt=Qe.numVerticalGlyphVertices,Nt=Qe.crossTileID,Xt=d.opacities[Nt];f[Nt]?Xt=A:Xt||(d.opacities[Nt]=Xt=le),f[Nt]=!0;var vr=Qe.numIconVertices>0,Dr=d.placedOrientations[Qe.crossTileID],Lr=Dr===m.WritingMode.vertical,Ur=Dr===m.WritingMode.horizontal||Dr===m.WritingMode.horizontalOnly;if(dt>0||jt>0){var Zn=Mn(Xt.text);Me(l.text,dt,Lr?Ci:Zn),Me(l.text,jt,Ur?Ci:Zn);var kn=Xt.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach(function(Gn){Gn>=0&&(l.text.placedSymbolArray.get(Gn).hidden=kn||Lr?1:0)}),Qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=kn||Ur?1:0);var Vn=d.variableOffsets[Qe.crossTileID];Vn&&d.markUsedJustification(l,Vn.anchor,Qe,Dr);var Ai=d.placedOrientations[Qe.crossTileID];Ai&&(d.markUsedJustification(l,"left",Qe,Ai),d.markUsedOrientation(l,Ai,Qe))}if(vr){var an=Mn(Xt.icon),si=!(se&&Qe.verticalPlacedIconSymbolIndex&&Lr);Qe.placedIconSymbolIndex>=0&&(Me(l.icon,Qe.numIconVertices,si?an:Ci),l.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=Xt.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(Me(l.icon,Qe.numVerticalIconVertices,si?Ci:an),l.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=Xt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var hi=l.collisionArrays[Ue];if(hi){var ti=new m.Point(0,0);if(hi.textBox||hi.verticalTextBox){var Xn=!0;if(U){var Fn=d.variableOffsets[Nt];Fn?(ti=pa(Fn.anchor,Fn.width,Fn.height,Fn.textOffset,Fn.textBoxScale),H&&ti._rotate(ie?d.transform.angle:-d.transform.angle)):Xn=!1}hi.textBox&&ln(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Xn||Lr,ti.x,ti.y),hi.verticalTextBox&&ln(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Xn||Ur,ti.x,ti.y)}var wn=Boolean(!Ur&&hi.verticalIconBox);hi.iconBox&&ln(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,wn,se?ti.x:0,se?ti.y:0),hi.verticalIconBox&&ln(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!wn,se?ti.x:0,se?ti.y:0)}}},Ve=0;Ve<l.symbolInstances.length;Ve++)we(Ve);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var be=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=be.invProjMatrix,l.placementViewportMatrix=be.viewportMatrix,l.collisionCircleArray=be.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},ao.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ao.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},ao.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},ao.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},ao.prototype.setStale=function(){this.stale=!0};var Sn=Math.pow(2,25),Tt=Math.pow(2,24),te=Math.pow(2,17),D=Math.pow(2,16),Ke=Math.pow(2,9),Mt=Math.pow(2,8),Rr=Math.pow(2,1);function Mn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Sn+f*Tt+c*te+f*D+c*Ke+f*Mt+c*Rr+f}var Ci=0,eo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};eo.prototype.continuePlacement=function(l,f,c,d,E){for(var A=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(A,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(M,k){return M.sortKey-k.sortKey}));this._currentPartIndex<A.length;)if(f.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Fa=function(l,f,c,d,E,A,M){this.placement=new ao(l,E,A,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Fa.prototype.isDone=function(){return this._done},Fa.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),A=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=f[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=k)&&(!M.maxzoom||M.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new eo(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Fa.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ua=512/m.EXTENT/2,Ho=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),A=E.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Ho.prototype.getScaledCoordinates=function(l,f){var c=Ua/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Ho.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var A=l.get(E);if(!A.crossTileID){var M=this.indexedSymbolInstances[A.key];if(M)for(var k=this.getScaledCoordinates(A,f),U=0,H=M;U<H.length;U+=1){var ie=H[U];if(Math.abs(ie.coord.x-k.x)<=d&&Math.abs(ie.coord.y-k.y)<=d&&!c[ie.crossTileID]){c[ie.crossTileID]=!0,A.crossTileID=ie.crossTileID;break}}}}};var _s=function(){this.maxCrossTileID=0};_s.prototype.generate=function(){return++this.maxCrossTileID};var Do=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Do.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var A in d){var M=d[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},Do.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var A in this.indexes){var M=this.indexes[A];if(Number(A)>l.overscaledZ)for(var k in M){var U=M[k];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var H=M[l.scaledTo(Number(A)).key];H&&H.findMatches(f.symbolInstances,l,E)}}for(var ie=0;ie<f.symbolInstances.length;ie++){var se=f.symbolInstances.get(ie);se.crossTileID||(se.crossTileID=c.generate(),E[se.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ho(l,f.symbolInstances,f.bucketInstanceId),!0},Do.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},Do.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var xs=function(){this.layerIndexes={},this.crossTileIDs=new _s,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};xs.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new Do);var E=!1,A={};d.handleWrapJump(c);for(var M=0,k=f;M<k.length;M+=1){var U=k[M],H=U.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,H,this.crossTileIDs)&&(E=!0),A[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(A)&&(E=!0),E},xs.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var is=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},ps=m.pick(Yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Is=m.pick(Yr,["setCenter","setZoom","setBearing","setPitch"]),Hs=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),Wo=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new qt(Ct(),this),this.imageManager=new kt,this.imageManager.setEventedParent(this),this.glyphManager=new Gt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new et(256,512),this.crossTileSymbolIndex=new xs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var A=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(M){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(k,U){if(m.triggerPluginCompletionEvent(k),U&&U.every(function(ie){return ie}))for(var H in A.sourceCaches)A.sourceCaches[H].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var k=E.sourceCaches[M.sourceId];if(k){var U=k.getSource();if(U&&U.vectorLayerIds)for(var H in E._layers){var ie=E._layers[H];ie.source===U.id&&E._validateLayer(ie)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var A=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(M,function(k,U){E._request=null,k?E.fire(new m.ErrorEvent(k)):U&&E._load(U,A)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Hs,!1)},f.prototype._load=function(c,d){if(!d||!is(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var A=Zr(this.stylesheet.layers);this._order=A.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var M=0,k=A;M<k.length;M+=1){var U=k[M];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,A,M){var k,U,H,ie=m.browser.devicePixelRatio>1?"@2x":"",se=m.getJSON(A.transformRequest(A.normalizeSpriteURL(E,ie,".json"),m.ResourceType.SpriteJSON),function(we,Ve){se=null,H||(H=we,k=Ve,Me())}),le=m.getImage(A.transformRequest(A.normalizeSpriteURL(E,ie,".png"),m.ResourceType.SpriteImage),function(we,Ve){le=null,H||(H=we,U=Ve,Me())});function Me(){if(H)M(H);else if(k&&U){var we=m.browser.getImageData(U),Ve={};for(var be in k){var Ue=k[be],Qe=Ue.width,dt=Ue.height,jt=Ue.x,Nt=Ue.y,Xt=Ue.sdf,vr=Ue.pixelRatio,Dr=Ue.stretchX,Lr=Ue.stretchY,Ur=Ue.content,Zn=new m.RGBAImage({width:Qe,height:dt});m.RGBAImage.copy(we,Zn,{x:jt,y:Nt},{x:0,y:0},{width:Qe,height:dt}),Ve[be]={data:Zn,pixelRatio:vr,sdf:Xt,stretchX:Dr,stretchY:Lr,content:Ur}}M(null,Ve)}}return{cancel:function(){se&&(se.cancel(),se=null),le&&(le.cancel(),le=null)}}}(c,this.map._requestManager,function(E,A){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(A)for(var M in A)d.imageManager.addImage(M,A[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var A=d.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+A.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,A=c;E<A.length;E+=1){var M=this._layers[A[E]];M.type!=="custom"&&d.push(M.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var M in(E.length||A.length)&&this._updateWorkerLayers(E,A),this._updatedSources){var k=this._updatedSources[M];k==="reload"?this._reloadSource(M):k==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var ie in this.sourceCaches){var se=this.sourceCaches[ie];H[ie]=se.used,se.used=!1}for(var le=0,Me=this._order;le<Me.length;le+=1){var we=this._layers[Me[le]];we.recalculate(c,this._availableImages),!we.isHidden(c.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var Ve in H){var be=this.sourceCaches[Ve];H[Ve]!==be.used&&be.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ve}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),is(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Zr(c.layers);var E=function(M,k){if(!M)return[{command:Yr.setStyle,args:[k]}];var U=[];try{if(!m.deepEqual(M.version,k.version))return[{command:Yr.setStyle,args:[k]}];m.deepEqual(M.center,k.center)||U.push({command:Yr.setCenter,args:[k.center]}),m.deepEqual(M.zoom,k.zoom)||U.push({command:Yr.setZoom,args:[k.zoom]}),m.deepEqual(M.bearing,k.bearing)||U.push({command:Yr.setBearing,args:[k.bearing]}),m.deepEqual(M.pitch,k.pitch)||U.push({command:Yr.setPitch,args:[k.pitch]}),m.deepEqual(M.sprite,k.sprite)||U.push({command:Yr.setSprite,args:[k.sprite]}),m.deepEqual(M.glyphs,k.glyphs)||U.push({command:Yr.setGlyphs,args:[k.glyphs]}),m.deepEqual(M.transition,k.transition)||U.push({command:Yr.setTransition,args:[k.transition]}),m.deepEqual(M.light,k.light)||U.push({command:Yr.setLight,args:[k.light]});var H={},ie=[];(function(le,Me,we,Ve){var be;for(be in Me=Me||{},le=le||{})le.hasOwnProperty(be)&&(Me.hasOwnProperty(be)||qr(be,we,Ve));for(be in Me)Me.hasOwnProperty(be)&&(le.hasOwnProperty(be)?m.deepEqual(le[be],Me[be])||(le[be].type==="geojson"&&Me[be].type==="geojson"&&oa(le,Me,be)?we.push({command:Yr.setGeoJSONSourceData,args:[be,Me[be].data]}):wi(be,Me,we,Ve)):vi(be,Me,we))})(M.sources,k.sources,ie,H);var se=[];M.layers&&M.layers.forEach(function(le){H[le.source]?U.push({command:Yr.removeLayer,args:[le.id]}):se.push(le)}),U=U.concat(ie),function(le,Me,we){Me=Me||[];var Ve,be,Ue,Qe,dt,jt,Nt,Xt=(le=le||[]).map(Ti),vr=Me.map(Ti),Dr=le.reduce(Si,{}),Lr=Me.reduce(Si,{}),Ur=Xt.slice(),Zn=Object.create(null);for(Ve=0,be=0;Ve<Xt.length;Ve++)Lr.hasOwnProperty(Ue=Xt[Ve])?be++:(we.push({command:Yr.removeLayer,args:[Ue]}),Ur.splice(Ur.indexOf(Ue,be),1));for(Ve=0,be=0;Ve<vr.length;Ve++)Ur[Ur.length-1-Ve]!==(Ue=vr[vr.length-1-Ve])&&(Dr.hasOwnProperty(Ue)?(we.push({command:Yr.removeLayer,args:[Ue]}),Ur.splice(Ur.lastIndexOf(Ue,Ur.length-be),1)):be++,we.push({command:Yr.addLayer,args:[Lr[Ue],jt=Ur[Ur.length-Ve]]}),Ur.splice(Ur.length-Ve,0,Ue),Zn[Ue]=!0);for(Ve=0;Ve<vr.length;Ve++)if(Qe=Dr[Ue=vr[Ve]],dt=Lr[Ue],!Zn[Ue]&&!m.deepEqual(Qe,dt))if(m.deepEqual(Qe.source,dt.source)&&m.deepEqual(Qe["source-layer"],dt["source-layer"])&&m.deepEqual(Qe.type,dt.type)){for(Nt in Ei(Qe.layout,dt.layout,we,Ue,null,Yr.setLayoutProperty),Ei(Qe.paint,dt.paint,we,Ue,null,Yr.setPaintProperty),m.deepEqual(Qe.filter,dt.filter)||we.push({command:Yr.setFilter,args:[Ue,dt.filter]}),m.deepEqual(Qe.minzoom,dt.minzoom)&&m.deepEqual(Qe.maxzoom,dt.maxzoom)||we.push({command:Yr.setLayerZoomRange,args:[Ue,dt.minzoom,dt.maxzoom]}),Qe)Qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?Ei(Qe[Nt],dt[Nt],we,Ue,Nt.slice(6),Yr.setPaintProperty):m.deepEqual(Qe[Nt],dt[Nt])||we.push({command:Yr.setLayerProperty,args:[Ue,Nt,dt[Nt]]}));for(Nt in dt)dt.hasOwnProperty(Nt)&&!Qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?Ei(Qe[Nt],dt[Nt],we,Ue,Nt.slice(6),Yr.setPaintProperty):m.deepEqual(Qe[Nt],dt[Nt])||we.push({command:Yr.setLayerProperty,args:[Ue,Nt,dt[Nt]]}))}else we.push({command:Yr.removeLayer,args:[Ue]}),jt=Ur[Ur.lastIndexOf(Ue)+1],we.push({command:Yr.addLayer,args:[dt,jt]})}(se,k.layers,U)}catch(le){console.warn("Unable to compute style diff:",le),U=[{command:Yr.setStyle,args:[k]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Is)});if(E.length===0)return!1;var A=E.filter(function(M){return!(M.command in ps)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var A=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new Oe(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=c.id;if(this.getLayer(A))this.fire(new m.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var M;if(c.type==="custom"){if(is(this,m.validateCustomStyleLayer(c)))return;M=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(A,c.source),c=m.clone$1(c),c=m.extend(c,{source:A})),this._validate(m.validateStyle.layer,"layers."+A,c,{arrayIndex:-1},E))return;M=m.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[M.id]=M.serialize()}var k=d?this._order.indexOf(d):this._order.length;if(d&&k===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(k,0,A),this._layerOrderChanged=!0,this._layers[A]=M,this._removedLayers[A]&&M.source&&M.type!=="custom"){var U=this._removedLayers[A];delete this._removedLayers[A],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var A=d?this._order.indexOf(d):this._order.length;d&&A===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(A,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var A=this.getLayer(c);A?A.minzoom===d&&A.maxzoom===E||(d!=null&&(A.minzoom=d),E!=null&&(A.maxzoom=E),this._updateLayer(A)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=this.getLayer(c);if(A){if(!m.deepEqual(A.filter,d))return d==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(m.validateStyle.filter,"layers."+A.id+".filter",d,null,E)||(A.filter=m.clone$1(d),this._updateLayer(A)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,A),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,A)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var k=M.getSource().type;k==="geojson"&&A?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||A?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(A,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=this.sourceCaches[E];if(A!==void 0){var M=A.getSource().type,k=M==="vector"?c.sourceLayer:void 0;M!=="vector"||k?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(k,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,A=this.sourceCaches[d];if(A!==void 0){if(A.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Dr){return d._layers[Dr].type==="fill-extrusion"},A={},M=[],k=this._order.length-1;k>=0;k--){var U=this._order[k];if(E(U)){A[U]=k;for(var H=0,ie=c;H<ie.length;H+=1){var se=ie[H][U];if(se)for(var le=0,Me=se;le<Me.length;le+=1)M.push(Me[le])}}}M.sort(function(Dr,Lr){return Lr.intersectionZ-Dr.intersectionZ});for(var we=[],Ve=this._order.length-1;Ve>=0;Ve--){var be=this._order[Ve];if(E(be))for(var Ue=M.length-1;Ue>=0;Ue--){var Qe=M[Ue].feature;if(A[Qe.layer.id]<Ve)break;we.push(Qe),M.pop()}else for(var dt=0,jt=c;dt<jt.length;dt+=1){var Nt=jt[dt][be];if(Nt)for(var Xt=0,vr=Nt;Xt<vr.length;Xt+=1)we.push(vr[Xt].feature)}}return we},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var A={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,k=d.layers;M<k.length;M+=1){var U=k[M],H=this._layers[U];if(!H)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];A[H.source]=!0}}var ie=[];for(var se in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!A[se]||ie.push(Wr(this.sourceCaches[se],this._layers,this._serializedLayers,c,d,E));return this.placement&&ie.push(function(le,Me,we,Ve,be,Ue,Qe){for(var dt={},jt=Ue.queryRenderedSymbols(Ve),Nt=[],Xt=0,vr=Object.keys(jt).map(Number);Xt<vr.length;Xt+=1)Nt.push(Qe[vr[Xt]]);Nt.sort(na);for(var Dr=function(){var Vn=Ur[Lr],Ai=Vn.featureIndex.lookupSymbolFeatures(jt[Vn.bucketInstanceId],Me,Vn.bucketIndex,Vn.sourceLayerIndex,be.filter,be.layers,be.availableImages,le);for(var an in Ai){var si=dt[an]=dt[an]||[],hi=Ai[an];hi.sort(function(Fn,wn){var Gn=Vn.featureSortOrder;if(Gn){var po=Gn.indexOf(Fn.featureIndex);return Gn.indexOf(wn.featureIndex)-po}return wn.featureIndex-Fn.featureIndex});for(var ti=0,Xn=hi;ti<Xn.length;ti+=1)si.push(Xn[ti])}},Lr=0,Ur=Nt;Lr<Ur.length;Lr+=1)Dr();var Zn=function(Vn){dt[Vn].forEach(function(Ai){var an=Ai.feature,si=we[le[Vn].source].getFeatureState(an.layer["source-layer"],an.id);an.source=an.layer.source,an.layer["source-layer"]&&(an.sourceLayer=an.layer["source-layer"]),an.state=si})};for(var kn in dt)Zn(kn);return dt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ie)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(A,M){for(var k=A.getRenderableIds().map(function(Me){return A.getTileByID(Me)}),U=[],H={},ie=0;ie<k.length;ie++){var se=k[ie],le=se.tileID.canonical.key;H[le]||(H[le]=!0,se.querySourceFeatures(U,M))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),A=!1;for(var M in c)if(!m.deepEqual(c[M],E[M])){A=!0;break}if(A){var k={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(k)}},f.prototype._validate=function(c,d,E,A,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&is(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},A)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,A,M){M===void 0&&(M=!1);for(var k=!1,U=!1,H={},ie=0,se=this._order;ie<se.length;ie+=1){var le=this._layers[se[ie]];if(le.type==="symbol"){if(!H[le.source]){var Me=this.sourceCaches[le.source];H[le.source]=Me.getRenderableIds(!0).map(function(Qe){return Me.getTileByID(Qe)}).sort(function(Qe,dt){return dt.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(dt.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(le,H[le.source],c.center.lng);k=k||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Fa(c,this._order,M,d,E,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),k&&this.pauseablePlacement.placement.setStale()),U||k)for(var Ve=0,be=this._order;Ve<be.length;Ve+=1){var Ue=this._layers[be[Ve]];Ue.type==="symbol"&&this.placement.updateLayerOpacities(Ue,H[Ue.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var A=this.sourceCaches[d.source];A&&A.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);Wo.getSourceType=function(l){return Mr[l]},Wo.setSourceType=function(l,f){Mr[l]=f},Wo.registerForPluginStateChange=m.registerForPluginStateChange;var da=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),Eo=Xi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Iu=Xi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rl=Xi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),mu=Xi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),ic=Xi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),nl=Xi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),il=Xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),uu=Xi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Il=Xi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Xi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Xi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),I=Xi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ve=Xi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ge=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ut=Xi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),lt=Xi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),sr=Xi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_r=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Rn=Xi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),jn=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Nn=Xi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ki=Xi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ya=Xi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ea=Xi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Xi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=A?A.concat(E):E,k={};return{fragmentSource:l=l.replace(c,function(U,H,ie,se,le){return k[le]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
varying `+ie+" "+se+" "+le+`;
#else
uniform `+ie+" "+se+" u_"+le+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+le+`
    `+ie+" "+se+" "+le+" = u_"+le+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,H,ie,se,le){var Me=se==="float"?"vec2":"vec4",we=le.match(/color/)?"color":Me;return k[le]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ie+" "+Me+" a_"+le+`;
varying `+ie+" "+se+" "+le+`;
#else
uniform `+ie+" "+se+" u_"+le+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = a_"+le+`;
#else
    `+ie+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = unpack_mix_"+we+"(a_"+le+", u_"+le+`_t);
#else
    `+ie+" "+se+" "+le+" = u_"+le+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+ie+" "+Me+" a_"+le+`;
#else
uniform `+ie+" "+se+" u_"+le+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ie+" "+se+" "+le+" = a_"+le+`;
#else
    `+ie+" "+se+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+ie+" "+se+" "+le+" = unpack_mix_"+we+"(a_"+le+", u_"+le+`_t);
#else
    `+ie+" "+se+" "+le+" = u_"+le+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var hs=Object.freeze({__proto__:null,prelude:Eo,background:Iu,backgroundPattern:rl,circle:mu,clippingMask:ic,heatmap:nl,heatmapTexture:il,collisionBox:uu,collisionCircle:Il,debug:_,fill:T,fillOutline:B,fillOutlinePattern:I,fillPattern:K,fillExtrusion:ve,fillExtrusionPattern:Ge,hillshadePrepare:ut,hillshade:lt,line:sr,lineGradient:_r,linePattern:Rn,lineSDF:jn,raster:Nn,symbolIcon:Ki,symbolSDF:ya,symbolTextAndIcon:ea}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Hu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}lu.prototype.bind=function(l,f,c,d,E,A,M,k){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,H=0;!U&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===k?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),k&&k.bind()):this.freshBind(f,c,d,E,A,M,k)},lu.prototype.freshBind=function(l,f,c,d,E,A,M){var k,U=l.numAttributes,H=this.context,ie=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=M;else{k=H.currentNumAttributes||0;for(var se=U;se<k;se++)ie.disableVertexAttribArray(se)}f.enableAttributes(ie,l);for(var le=0,Me=c;le<Me.length;le+=1)Me[le].enableAttributes(ie,l);A&&A.enableAttributes(ie,l),M&&M.enableAttributes(ie,l),f.bind(),f.setVertexAttribPointers(ie,l,E);for(var we=0,Ve=c;we<Ve.length;we+=1){var be=Ve[we];be.bind(),be.setVertexAttribPointers(ie,l,E)}A&&(A.bind(),A.setVertexAttribPointers(ie,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(ie,l,E)),H.currentNumAttributes=U},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Qc=function(l,f,c,d,E,A){var M=l.gl;this.program=M.createProgram();for(var k=Hu(c.staticAttributes),U=d?d.getBinderAttributes():[],H=k.concat(U),ie=c.staticUniforms?Hu(c.staticUniforms):[],se=d?d.getBinderUniforms():[],le=[],Me=0,we=ie.concat(se);Me<we.length;Me+=1){var Ve=we[Me];le.indexOf(Ve)<0&&le.push(Ve)}var be=d?d.defines():[];A&&be.push("#define OVERDRAW_INSPECTOR;");var Ue=be.concat(Eo.fragmentSource,c.fragmentSource).join(`
`),Qe=be.concat(Eo.vertexSource,c.vertexSource).join(`
`),dt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(dt,Ue),M.compileShader(dt),M.attachShader(this.program,dt);var jt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(jt,Qe),M.compileShader(jt),M.attachShader(this.program,jt),this.attributes={};var Nt={};this.numAttributes=H.length;for(var Xt=0;Xt<this.numAttributes;Xt++)H[Xt]&&(M.bindAttribLocation(this.program,Xt,H[Xt]),this.attributes[H[Xt]]=Xt);M.linkProgram(this.program),M.deleteShader(jt),M.deleteShader(dt);for(var vr=0;vr<le.length;vr++){var Dr=le[vr];if(Dr&&!Nt[Dr]){var Lr=M.getUniformLocation(this.program,Dr);Lr&&(Nt[Dr]=Lr)}}this.fixedUniforms=E(l,Nt),this.binderUniforms=d?d.getUniforms(l,Nt):[]}}};function al(l,f,c){var d=1/Wi(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),A=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,M=A*(c.tileID.canonical.x+c.tileID.wrap*E),k=A*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,k>>16],u_pixel_coord_lower:[65535&M,65535&k]}}Qc.prototype.draw=function(l,f,c,d,E,A,M,k,U,H,ie,se,le,Me,we,Ve){var be,Ue=l.gl;if(!this.failedToCreate){for(var Qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(A),this.fixedUniforms)this.fixedUniforms[Qe].set(M[Qe]);Me&&Me.setUniforms(l,this.binderUniforms,se,{zoom:le});for(var dt=(be={},be[Ue.LINES]=2,be[Ue.TRIANGLES]=3,be[Ue.LINE_STRIP]=1,be)[f],jt=0,Nt=ie.get();jt<Nt.length;jt+=1){var Xt=Nt[jt],vr=Xt.vaos||(Xt.vaos={});(vr[k]||(vr[k]=new lu)).bind(l,this,U,Me?Me.getPaintVertexBuffers():[],H,Xt.vertexOffset,we,Ve),Ue.drawElements(f,Xt.primitiveLength*dt,Ue.UNSIGNED_SHORT,Xt.primitiveOffset*dt*2)}}};var Cc=function(l,f,c,d){var E=f.style.light,A=E.properties.get("position"),M=[A.x,A.y,A.z],k=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(k,-f.transform.angle),m.transformMat3(M,M,k);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Ws=function(l,f,c,d,E,A,M){return m.extend(Cc(l,f,c,d),al(A,f,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},Fo=function(l){return{u_matrix:l}},Ou=function(l,f,c,d){return m.extend(Fo(l),al(c,f,d))},to=function(l,f){return{u_matrix:l,u_world:f}},Ff=function(l,f,c,d,E){return m.extend(Ou(l,f,c,d),{u_world:E})},Bf=function(l,f,c,d){var E,A,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var k=Wi(c,1,M.zoom);E=!0,A=[k,k]}else E=!1,A=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:A}},as=function(l,f,c){var d=Wi(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),A=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:A}},ds=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},eu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Os=function(l){return{u_matrix:l}},bs=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:Wi(f,1,c),u_intensity:d}},ol=function(l,f,c){var d=l.transform;return{u_matrix:Jc(l,f,c),u_ratio:1/Wi(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},va=function(l,f,c,d){return m.extend(ol(l,f,c),{u_image:0,u_image_height:d})},Ol=function(l,f,c,d){var E=l.transform,A=sl(f,E);return{u_matrix:Jc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/Wi(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[A,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},dp=function(l,f,c,d,E){var A=l.lineAtlas,M=sl(f,l.transform),k=c.layout.get("line-cap")==="round",U=A.getDash(d.from,k),H=A.getDash(d.to,k),ie=U.width*E.fromScale,se=H.width*E.toScale;return m.extend(ol(l,f,c),{u_patternscale_a:[M/ie,-U.height/2],u_patternscale_b:[M/se,-H.height/2],u_sdfgamma:A.width/(256*Math.min(ie,se)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:H.y,u_mix:E.t})};function sl(l,f){return 1/Wi(l,1,f.tileZoom)}function Jc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var vp=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(A=E.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:mp(E.paint.get("raster-hue-rotate"))};var A,M};function mp(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var ef,ac=function(l,f,c,d,E,A,M,k,U,H){var ie=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_pitch:ie.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ie.width/ie.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:M,u_coord_matrix:k,u_is_text:+U,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},Rl=function(l,f,c,d,E,A,M,k,U,H,ie){var se=E.transform;return m.extend(ac(l,f,c,d,E,A,M,k,U,H),{u_gamma_scale:d?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ie})},kl=function(l,f,c,d,E,A,M,k,U,H){return m.extend(Rl(l,f,c,d,E,A,M,k,!0,U,!0),{u_texsize_icon:H,u_texture_icon:1})},Ll=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},ul=function(l,f,c,d,E,A){return m.extend(function(M,k,U,H){var ie=U.imageManager.getPattern(M.from.toString()),se=U.imageManager.getPattern(M.to.toString()),le=U.imageManager.getPixelSize(),Me=le.width,we=le.height,Ve=Math.pow(2,H.tileID.overscaledZ),be=H.tileSize*Math.pow(2,U.transform.tileZoom)/Ve,Ue=be*(H.tileID.canonical.x+H.tileID.wrap*Ve),Qe=be*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ie.tl,u_pattern_br_a:ie.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[Me,we],u_mix:k.t,u_pattern_size_a:ie.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Wi(H,1,U.transform.tileZoom),u_pixel_coord_upper:[Ue>>16,Qe>>16],u_pixel_coord_lower:[65535&Ue,65535&Qe]}}(d,A,c,E),{u_matrix:l,u_opacity:f})},Dl={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function ll(l,f,c,d,E,A,M){for(var k=l.context,U=k.gl,H=l.useProgram("collisionBox"),ie=[],se=0,le=0,Me=0;Me<d.length;Me++){var we=d[Me],Ve=f.getTile(we),be=Ve.getBucket(c);if(be){var Ue=we.posMatrix;E[0]===0&&E[1]===0||(Ue=l.translatePosMatrix(we.posMatrix,Ve,E,A));var Qe=M?be.textCollisionBox:be.iconCollisionBox,dt=be.collisionCircleArray;if(dt.length>0){var jt=m.create(),Nt=Ue;m.mul(jt,be.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(jt,jt,be.placementViewportMatrix),ie.push({circleArray:dt,circleOffset:le,transform:Nt,invTransform:jt}),le=se+=dt.length/4}Qe&&H.draw(k,U.LINES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),Je.disabled,as(Ue,l.transform,Ve),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,l.transform.zoom,null,null,Qe.collisionVertexBuffer)}}if(M&&ie.length){var Xt=l.useProgram("collisionCircle"),vr=new m.StructArrayLayout2f1f2i16;vr.resize(4*se),vr._trim();for(var Dr=0,Lr=0,Ur=ie;Lr<Ur.length;Lr+=1)for(var Zn=Ur[Lr],kn=0;kn<Zn.circleArray.length/4;kn++){var Vn=4*kn,Ai=Zn.circleArray[Vn+0],an=Zn.circleArray[Vn+1],si=Zn.circleArray[Vn+2],hi=Zn.circleArray[Vn+3];vr.emplace(Dr++,Ai,an,si,hi,0),vr.emplace(Dr++,Ai,an,si,hi,1),vr.emplace(Dr++,Ai,an,si,hi,2),vr.emplace(Dr++,Ai,an,si,hi,3)}(!ef||ef.length<2*se)&&(ef=function(Ta){var qo=2*Ta,Ko=new m.StructArrayLayout3ui6;Ko.resize(qo),Ko._trim();for(var no=0;no<qo;no++){var ho=6*no;Ko.uint16[ho+0]=4*no+0,Ko.uint16[ho+1]=4*no+1,Ko.uint16[ho+2]=4*no+2,Ko.uint16[ho+3]=4*no+2,Ko.uint16[ho+4]=4*no+3,Ko.uint16[ho+5]=4*no+0}return Ko}(se));for(var ti=k.createIndexBuffer(ef,!0),Xn=k.createVertexBuffer(vr,m.collisionCircleLayout.members,!0),Fn=0,wn=ie;Fn<wn.length;Fn+=1){var Gn=wn[Fn],po=ds(Gn.transform,Gn.invTransform,l.transform);Xt.draw(k,U.TRIANGLES,he.disabled,Ae.disabled,l.colorModeForRenderPass(),Je.disabled,po,c.id,Xn,ti,m.SegmentVector.simpleSegment(0,2*Gn.circleOffset,Gn.circleArray.length,Gn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Xn.destroy(),ti.destroy()}}var Rs=m.identity(new Float32Array(16));function Ac(l,f,c,d,E,A){var M=m.getAnchorAlignment(l),k=-(M.horizontalAlign-.5)*f,U=-(M.verticalAlign-.5)*c,H=m.evaluateVariableOffset(l,d);return new m.Point((k/E+H[0])*A,(U/E+H[1])*A)}function tf(l,f,c,d,E,A,M,k,U,H,ie){var se=l.text.placedSymbolArray,le=l.text.dynamicLayoutVertexArray,Me=l.icon.dynamicLayoutVertexArray,we={};le.clear();for(var Ve=0;Ve<se.length;Ve++){var be=se.get(Ve),Ue=be.hidden||!be.crossTileID||l.allowVerticalPlacement&&!be.placedOrientation?null:d[be.crossTileID];if(Ue){var Qe=new m.Point(be.anchorX,be.anchorY),dt=Pi(Qe,c?k:M),jt=Ni(A.cameraToCenterDistance,dt.signedDistanceFromCamera),Nt=E.evaluateSizeForFeature(l.textSizeData,H,be)*jt/m.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var Xt=Ac(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale,Nt),vr=c?Pi(Qe.add(Xt),M).point:dt.point.add(f?Xt.rotate(-A.angle):Xt),Dr=l.allowVerticalPlacement&&be.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Lr=0;Lr<be.numGlyphs;Lr++)m.addDynamicAttributes(le,vr,Dr);ie&&be.associatedIconIndex>=0&&(we[be.associatedIconIndex]={shiftedAnchor:vr,angle:Dr})}else co(be.numGlyphs,le)}if(ie){Me.clear();for(var Ur=l.icon.placedSymbolArray,Zn=0;Zn<Ur.length;Zn++){var kn=Ur.get(Zn);if(kn.hidden)co(kn.numGlyphs,Me);else{var Vn=we[Zn];if(Vn)for(var Ai=0;Ai<kn.numGlyphs;Ai++)m.addDynamicAttributes(Me,Vn.shiftedAnchor,Vn.angle);else co(kn.numGlyphs,Me)}}l.icon.dynamicLayoutVertexBuffer.updateData(Me)}l.text.dynamicLayoutVertexBuffer.updateData(le)}function gp(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function cl(l,f,c,d,E,A,M,k,U,H,ie,se){for(var le=l.context,Me=le.gl,we=l.transform,Ve=k==="map",be=U==="map",Ue=Ve&&c.layout.get("symbol-placement")!=="point",Qe=Ve&&!be&&!Ue,dt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,jt=!1,Nt=l.depthModeForSublayer(0,he.ReadOnly),Xt=c.layout.get("text-variable-anchor"),vr=[],Dr=0,Lr=d;Dr<Lr.length;Dr+=1){var Ur=Lr[Dr],Zn=f.getTile(Ur),kn=Zn.getBucket(c);if(kn){var Vn=E?kn.text:kn.icon;if(Vn&&Vn.segments.get().length){var Ai=Vn.programConfigurations.get(c.id),an=E||kn.sdfIcons,si=E?kn.textSizeData:kn.iconSizeData,hi=be||we.pitch!==0,ti=l.useProgram(gp(an,E,kn),Ai),Xn=m.evaluateSizeForZoom(si,we.zoom),Fn=void 0,wn=[0,0],Gn=void 0,po=void 0,Ta=null,qo=void 0;if(E)Gn=Zn.glyphAtlasTexture,po=Me.LINEAR,Fn=Zn.glyphAtlasTexture.size,kn.iconsInText&&(wn=Zn.imageAtlasTexture.size,Ta=Zn.imageAtlasTexture,qo=hi||l.options.rotating||l.options.zooming||si.kind==="composite"||si.kind==="camera"?Me.LINEAR:Me.NEAREST);else{var Ko=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;Gn=Zn.imageAtlasTexture,po=an||l.options.rotating||l.options.zooming||Ko||hi?Me.LINEAR:Me.NEAREST,Fn=Zn.imageAtlasTexture.size}var no=Wi(Zn,1,l.transform.zoom),ho=La(Ur.posMatrix,be,Ve,l.transform,no),As=Hi(Ur.posMatrix,be,Ve,l.transform,no),Wa=Xt&&kn.hasTextData(),qu=c.layout.get("icon-text-fit")!=="none"&&Wa&&kn.hasIconData();Ue&&Js(kn,Ur.posMatrix,l,E,ho,As,be,H);var ws=l.translatePosMatrix(Ur.posMatrix,Zn,A,M),Su=Ue||E&&Xt||qu?Rs:ho,os=l.translatePosMatrix(As,Zn,A,M,!0),gl=an&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Du={program:ti,buffers:Vn,uniformValues:an?kn.iconsInText?kl(si.kind,Xn,Qe,be,l,ws,Su,os,Fn,wn):Rl(si.kind,Xn,Qe,be,l,ws,Su,os,E,Fn,!0):ac(si.kind,Xn,Qe,be,l,ws,Su,os,E,Fn),atlasTexture:Gn,atlasTextureIcon:Ta,atlasInterpolation:po,atlasInterpolationIcon:qo,isSDF:an,hasHalo:gl};if(dt&&kn.canOverlap){jt=!0;for(var Cu=0,yl=Vn.segments.get();Cu<yl.length;Cu+=1){var Ku=yl[Cu];vr.push({segments:new m.SegmentVector([Ku]),sortKey:Ku.sortKey,state:Du})}}else vr.push({segments:Vn.segments,sortKey:0,state:Du})}}}jt&&vr.sort(function($u,Fu){return $u.sortKey-Fu.sortKey});for(var Fs=0,_l=vr;Fs<_l.length;Fs+=1){var pu=_l[Fs],oo=pu.state;if(le.activeTexture.set(Me.TEXTURE0),oo.atlasTexture.bind(oo.atlasInterpolation,Me.CLAMP_TO_EDGE),oo.atlasTextureIcon&&(le.activeTexture.set(Me.TEXTURE1),oo.atlasTextureIcon&&oo.atlasTextureIcon.bind(oo.atlasInterpolationIcon,Me.CLAMP_TO_EDGE)),oo.isSDF){var Au=oo.uniformValues;oo.hasHalo&&(Au.u_is_halo=1,wc(oo.buffers,pu.segments,c,l,oo.program,Nt,ie,se,Au)),Au.u_is_halo=0}wc(oo.buffers,pu.segments,c,l,oo.program,Nt,ie,se,oo.uniformValues)}}function wc(l,f,c,d,E,A,M,k,U){var H=d.context;E.draw(H,H.gl.TRIANGLES,A,M,k,Je.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Es(l,f,c,d,E,A,M){var k,U,H,ie,se,le=l.context.gl,Me=c.paint.get("fill-pattern"),we=Me&&Me.constantOr(1),Ve=c.getCrossfadeParameters();M?(U=we&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=le.LINES):(U=we?"fillPattern":"fill",k=le.TRIANGLES);for(var be=0,Ue=d;be<Ue.length;be+=1){var Qe=Ue[be],dt=f.getTile(Qe);if(!we||dt.patternsLoaded()){var jt=dt.getBucket(c);if(jt){var Nt=jt.programConfigurations.get(c.id),Xt=l.useProgram(U,Nt);we&&(l.context.activeTexture.set(le.TEXTURE0),dt.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Ve));var vr=Me.constantOr(null);if(vr&&dt.imageAtlas){var Dr=dt.imageAtlas,Lr=Dr.patternPositions[vr.to.toString()],Ur=Dr.patternPositions[vr.from.toString()];Lr&&Ur&&Nt.setConstantPatternPositions(Lr,Ur)}var Zn=l.translatePosMatrix(Qe.posMatrix,dt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){ie=jt.indexBuffer2,se=jt.segments2;var kn=[le.drawingBufferWidth,le.drawingBufferHeight];H=U==="fillOutlinePattern"&&we?Ff(Zn,l,Ve,dt,kn):to(Zn,kn)}else ie=jt.indexBuffer,se=jt.segments,H=we?Ou(Zn,l,Ve,dt):Fo(Zn);Xt.draw(l.context,k,E,l.stencilModeForClipping(Qe),A,Je.disabled,H,c.id,jt.layoutVertexBuffer,ie,se,c.paint,l.transform.zoom,Nt)}}}}function rf(l,f,c,d,E,A,M){for(var k=l.context,U=k.gl,H=c.paint.get("fill-extrusion-pattern"),ie=H.constantOr(1),se=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity"),Me=0,we=d;Me<we.length;Me+=1){var Ve=we[Me],be=f.getTile(Ve),Ue=be.getBucket(c);if(Ue){var Qe=Ue.programConfigurations.get(c.id),dt=l.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Qe);ie&&(l.context.activeTexture.set(U.TEXTURE0),be.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Qe.updatePaintBuffers(se));var jt=H.constantOr(null);if(jt&&be.imageAtlas){var Nt=be.imageAtlas,Xt=Nt.patternPositions[jt.to.toString()],vr=Nt.patternPositions[jt.from.toString()];Xt&&vr&&Qe.setConstantPatternPositions(Xt,vr)}var Dr=l.translatePosMatrix(Ve.posMatrix,be,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Lr=c.paint.get("fill-extrusion-vertical-gradient"),Ur=ie?Ws(Dr,l,Lr,le,Ve,se,be):Cc(Dr,l,Lr,le);dt.draw(k,k.gl.TRIANGLES,E,A,M,Je.backCCW,Ur,c.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,c.paint,l.transform.zoom,Qe)}}}function Tc(l,f,c,d,E,A){var M=l.context,k=M.gl,U=f.fbo;if(U){var H=l.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,U.colorAttachment.get());var ie=function(se,le,Me){var we=Me.paint.get("hillshade-shadow-color"),Ve=Me.paint.get("hillshade-highlight-color"),be=Me.paint.get("hillshade-accent-color"),Ue=Me.paint.get("hillshade-illumination-direction")*(Math.PI/180);Me.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ue-=se.transform.angle);var Qe,dt,jt,Nt=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(Qe=le.tileID,dt=Math.pow(2,Qe.canonical.z),jt=Qe.canonical.y,[new m.MercatorCoordinate(0,jt/dt).toLngLat().lat,new m.MercatorCoordinate(0,(jt+1)/dt).toLngLat().lat]),u_light:[Me.paint.get("hillshade-exaggeration"),Ue],u_shadow:we,u_highlight:Ve,u_accent:be}}(l,f,c);H.draw(M,k.TRIANGLES,d,E,A,Je.disabled,ie,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function yp(l,f,c,d,E,A){var M=l.context,k=M.gl,U=f.dem;if(U&&U.data){var H=U.dim,ie=U.stride,se=U.getPixels();if(M.activeTexture.set(k.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ie),f.demTexture){var le=f.demTexture;le.update(se,{premultiply:!1}),le.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(M,se,k.RGBA,{premultiply:!1}),f.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);M.activeTexture.set(k.TEXTURE0);var Me=f.fbo;if(!Me){var we=new m.Texture(M,{width:H,height:H,data:null},k.RGBA);we.bind(k.LINEAR,k.CLAMP_TO_EDGE),(Me=f.fbo=M.createFramebuffer(H,H,!0)).colorAttachment.set(we.texture)}M.bindFramebuffer.set(Me.framebuffer),M.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(M,k.TRIANGLES,d,E,A,Je.disabled,function(Ve,be){var Ue=be.stride,Qe=m.create();return m.ortho(Qe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Qe,Qe,[0,-m.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[Ue,Ue],u_zoom:Ve.overscaledZ,u_unpack:be.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Fl(l,f,c,d,E){var A=d.paint.get("raster-fade-duration");if(A>0){var M=m.browser.now(),k=(M-l.timeAdded)/A,U=f?(M-f.timeAdded)/A:-1,H=c.getSource(),ie=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),se=!f||Math.abs(f.tileID.overscaledZ-ie)>Math.abs(l.tileID.overscaledZ-ie),le=se&&l.refreshedUponExpiration?1:m.clamp(se?k:1-U,0,1);return l.refreshedUponExpiration&&k>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}var Ru=new m.Color(1,0,0,1),nf=new m.Color(0,1,0,1),Nf=new m.Color(0,0,1,1),Bl=new m.Color(1,0,1,1),_p=new m.Color(0,1,1,1);function xp(l,f,c,d){Nl(l,0,f+c/2,l.transform.width,c,d)}function zf(l,f,c,d){Nl(l,f-c/2,0,c,l.transform.height,d)}function Nl(l,f,c,d,E,A){var M=l.context,k=M.gl;k.enable(k.SCISSOR_TEST),k.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),M.clear({color:A}),k.disable(k.SCISSOR_TEST)}function bp(l,f,c){var d=l.context,E=d.gl,A=c.posMatrix,M=l.useProgram("debug"),k=he.disabled,U=Ae.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,k,U,H,Je.disabled,eu(A,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ie=f.getTileByID(c.key).latestRawTileData,se=Math.floor((ie&&ie.byteLength||0)/1024),le=f.getTile(c).tileSize,Me=512/Math.min(le,512)*(c.overscaledZ/l.transform.zoom)*.5,we=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(we+=" => "+c.overscaledZ),function(Ve,be){Ve.initDebugOverlayCanvas();var Ue=Ve.debugOverlayCanvas,Qe=Ve.context.gl,dt=Ve.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,Ue.width,Ue.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(be,5,5),dt.strokeText(be,5,5),Ve.debugOverlayTexture.update(Ue),Ve.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(l,we+" "+se+"kb"),M.draw(d,E.TRIANGLES,k,U,je.alphaBlended,Je.disabled,eu(A,m.Color.transparent,Me),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var fl={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var A=Ae.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(k,U,H,ie,se,le,Me){for(var we=U.transform,Ve=se==="map",be=le==="map",Ue=0,Qe=k;Ue<Qe.length;Ue+=1){var dt=Qe[Ue],jt=ie.getTile(dt),Nt=jt.getBucket(H);if(Nt&&Nt.text&&Nt.text.segments.get().length){var Xt=m.evaluateSizeForZoom(Nt.textSizeData,we.zoom),vr=Wi(jt,1,U.transform.zoom),Dr=La(dt.posMatrix,be,Ve,U.transform,vr),Lr=H.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(Xt){var Ur=Math.pow(2,we.zoom-jt.tileID.overscaledZ);tf(Nt,Ve,be,Me,m.symbolSize,we,Dr,dt.posMatrix,Ur,Xt,Lr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&cl(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),A,M),c.paint.get("text-opacity").constantOr(1)!==0&&cl(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),A,M),f.map.showCollisionBoxes&&(ll(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ll(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),A=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||A.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,H=U.gl,ie=l.depthModeForSublayer(0,he.ReadOnly),se=Ae.disabled,le=l.colorModeForRenderPass(),Me=[],we=0;we<d.length;we++){var Ve=d[we],be=f.getTile(Ve),Ue=be.getBucket(c);if(Ue){var Qe=Ue.programConfigurations.get(c.id),dt={programConfiguration:Qe,program:l.useProgram("circle",Qe),layoutVertexBuffer:Ue.layoutVertexBuffer,indexBuffer:Ue.indexBuffer,uniformValues:Bf(l,Ve,be,c)};if(k)for(var jt=0,Nt=Ue.segments.get();jt<Nt.length;jt+=1){var Xt=Nt[jt];Me.push({segments:new m.SegmentVector([Xt]),sortKey:Xt.sortKey,state:dt})}else Me.push({segments:Ue.segments,sortKey:0,state:dt})}}k&&Me.sort(function(Zn,kn){return Zn.sortKey-kn.sortKey});for(var vr=0,Dr=Me;vr<Dr.length;vr+=1){var Lr=Dr[vr],Ur=Lr.state;Ur.program.draw(U,H.TRIANGLES,ie,se,le,Je.disabled,Ur.uniformValues,c.id,Ur.layoutVertexBuffer,Ur.indexBuffer,Lr.segments,c.paint,l.transform.zoom,Ur.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,A=E.gl,M=Ae.disabled,k=new je([A.ONE,A.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Me,we,Ve){var be=Me.gl;Me.activeTexture.set(be.TEXTURE1),Me.viewport.set([0,0,we.width/4,we.height/4]);var Ue=Ve.heatmapFbo;if(Ue)be.bindTexture(be.TEXTURE_2D,Ue.colorAttachment.get()),Me.bindFramebuffer.set(Ue.framebuffer);else{var Qe=be.createTexture();be.bindTexture(be.TEXTURE_2D,Qe),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),Ue=Ve.heatmapFbo=Me.createFramebuffer(we.width/4,we.height/4,!1),function(dt,jt,Nt,Xt){var vr=dt.gl;vr.texImage2D(vr.TEXTURE_2D,0,vr.RGBA,jt.width/4,jt.height/4,0,vr.RGBA,dt.extRenderToTextureHalfFloat?dt.extTextureHalfFloat.HALF_FLOAT_OES:vr.UNSIGNED_BYTE,null),Xt.colorAttachment.set(Nt)}(Me,we,Qe,Ue)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var H=d[U];if(!f.hasRenderableParent(H)){var ie=f.getTile(H),se=ie.getBucket(c);if(se){var le=se.programConfigurations.get(c.id);l.useProgram("heatmap",le).draw(E,A.TRIANGLES,he.disabled,M,k,Je.disabled,bs(H.posMatrix,ie,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,l.transform.zoom,le)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Me,we){var Ve=Me.context,be=Ve.gl,Ue=we.heatmapFbo;if(Ue){Ve.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_2D,Ue.colorAttachment.get()),Ve.activeTexture.set(be.TEXTURE1);var Qe=we.colorRampTexture;Qe||(Qe=we.colorRampTexture=new m.Texture(Ve,we.colorRamp,be.RGBA)),Qe.bind(be.LINEAR,be.CLAMP_TO_EDGE),Me.useProgram("heatmapTexture").draw(Ve,be.TRIANGLES,he.disabled,Ae.disabled,Me.colorModeForRenderPass(),Je.disabled,function(dt,jt,Nt,Xt){var vr=m.create();m.ortho(vr,0,dt.width,dt.height,0,0,1);var Dr=dt.context.gl;return{u_matrix:vr,u_world:[Dr.drawingBufferWidth,Dr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:jt.paint.get("heatmap-opacity")}}(Me,we),we.id,Me.viewportBuffer,Me.quadTriangleIndexBuffer,Me.viewportSegments,we.paint,Me.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),A=c.paint.get("line-width");if(E.constantOr(1)!==0&&A.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,he.ReadOnly),k=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),ie=H.constantOr(1),se=c.paint.get("line-gradient"),le=c.getCrossfadeParameters(),Me=ie?"linePattern":U?"lineSDF":se?"lineGradient":"line",we=l.context,Ve=we.gl,be=!0,Ue=0,Qe=d;Ue<Qe.length;Ue+=1){var dt=Qe[Ue],jt=f.getTile(dt);if(!ie||jt.patternsLoaded()){var Nt=jt.getBucket(c);if(Nt){var Xt=Nt.programConfigurations.get(c.id),vr=l.context.program.get(),Dr=l.useProgram(Me,Xt),Lr=be||Dr.program!==vr,Ur=H.constantOr(null);if(Ur&&jt.imageAtlas){var Zn=jt.imageAtlas,kn=Zn.patternPositions[Ur.to.toString()],Vn=Zn.patternPositions[Ur.from.toString()];kn&&Vn&&Xt.setConstantPatternPositions(kn,Vn)}var Ai=ie?Ol(l,jt,c,le):U?dp(l,jt,c,U,le):se?va(l,jt,c,Nt.lineClipsArray.length):ol(l,jt,c);if(ie)we.activeTexture.set(Ve.TEXTURE0),jt.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),Xt.updatePaintBuffers(le);else if(U&&(Lr||l.lineAtlas.dirty))we.activeTexture.set(Ve.TEXTURE0),l.lineAtlas.bind(we);else if(se){var an=Nt.gradients[c.id],si=an.texture;if(c.gradientVersion!==an.version){var hi=256;if(c.stepInterpolant){var ti=f.getSource().maxzoom,Xn=dt.canonical.z===ti?Math.ceil(1<<l.transform.maxZoom-dt.canonical.z):1;hi=m.clamp(m.nextPowerOfTwo(Nt.maxLineLength/m.EXTENT*1024*Xn),256,we.maxTextureSize)}an.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:an.gradient||void 0,clips:Nt.lineClipsArray}),an.texture?an.texture.update(an.gradient):an.texture=new m.Texture(we,an.gradient,Ve.RGBA),an.version=c.gradientVersion,si=an.texture}we.activeTexture.set(Ve.TEXTURE0),si.bind(c.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Dr.draw(we,Ve.TRIANGLES,M,l.stencilModeForClipping(dt),k,Je.disabled,Ai,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,Xt,Nt.layoutVertexBuffer2),be=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),A=c.paint.get("fill-opacity");if(A.constantOr(1)!==0){var M=l.colorModeForRenderPass(),k=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!k.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Es(l,f,c,d,H,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ie=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Es(l,f,c,d,ie,M,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var A=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))rf(l,f,c,d,A,Ae.disabled,je.disabled),rf(l,f,c,d,A,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();rf(l,f,c,d,A,Ae.disabled,M)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,A=l.depthModeForSublayer(0,he.ReadOnly),M=l.colorModeForRenderPass(),k=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=k[0],H=0,ie=k[1];H<ie.length;H+=1){var se=ie[H],le=f.getTile(se);le.needsHillshadePrepare&&l.renderPass==="offscreen"?yp(l,le,c,A,Ae.disabled,M):l.renderPass==="translucent"&&Tc(l,le,c,A,U[se.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,A=E.gl,M=f.getSource(),k=l.useProgram("raster"),U=l.colorModeForRenderPass(),H=M instanceof ft?[{},d]:l.stencilConfigForOverlap(d),ie=H[0],se=H[1],le=se[se.length-1].overscaledZ,Me=!l.options.moving,we=0,Ve=se;we<Ve.length;we+=1){var be=Ve[we],Ue=l.depthModeForSublayer(be.overscaledZ-le,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,A.LESS),Qe=f.getTile(be),dt=l.transform.calculatePosMatrix(be.toUnwrapped(),Me);Qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var jt=f.findLoadedParent(be,0),Nt=Fl(Qe,jt,f,c,l.transform),Xt=void 0,vr=void 0,Dr=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),Qe.texture.bind(Dr,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(A.TEXTURE1),jt?(jt.texture.bind(Dr,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Xt=Math.pow(2,jt.tileID.overscaledZ-Qe.tileID.overscaledZ),vr=[Qe.tileID.canonical.x*Xt%1,Qe.tileID.canonical.y*Xt%1]):Qe.texture.bind(Dr,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);var Lr=vp(dt,vr||[0,0],Xt||1,Nt,c);M instanceof ft?k.draw(E,A.TRIANGLES,Ue,Ae.disabled,U,Je.disabled,Lr,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):k.draw(E,A.TRIANGLES,Ue,ie[be.overscaledZ],U,Je.disabled,Lr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var A=l.context,M=A.gl,k=l.transform,U=k.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var ie=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ie){var se=Ae.disabled,le=l.depthModeForSublayer(0,ie==="opaque"?he.ReadWrite:he.ReadOnly),Me=l.colorModeForRenderPass(),we=l.useProgram(H?"backgroundPattern":"background"),Ve=k.coveringTiles({tileSize:U});H&&(A.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var be=c.getCrossfadeParameters(),Ue=0,Qe=Ve;Ue<Qe.length;Ue+=1){var dt=Qe[Ue],jt=l.transform.calculatePosMatrix(dt.toUnwrapped()),Nt=H?ul(jt,E,l,H,{tileID:dt,tileSize:U},be):Ll(jt,E,d);we.draw(A,M.TRIANGLES,le,se,Me,Je.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)bp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var A=E.prerender;A&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),A.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Ae.disabled);var M=E.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ha=function(l,f){this.context=new ue(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Oe.maxUnderzooming+Oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xs,this.gpuTimers={}};Ha.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ha.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,da.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,da.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,_t.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,da.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var A=new m.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(A);var M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Ae({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},Ha.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,he.disabled,this.stencilClearMode,je.disabled,Je.disabled,Os(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ha.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(je.disabled),c.setDepthMode(he.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,M=f;A<M.length;A+=1){var k=M[A],U=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,he.disabled,new Ae({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),je.disabled,Je.disabled,Os(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ha.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ae({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ha.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ae({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ha.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,H){return H.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,A=d[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var M={},k=0;k<A;k++)M[k+E]=new Ae({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=A,[M,d]}return[(f={},f[E]=Ae.disabled,f),d]},Ha.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new je([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?je.unblended:je.alphaBlended},Ha.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,f,[d,d])},Ha.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ha.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var A in E){var M=E[A];M.used&&M.prepare(this.context)}var k,U,H={},ie={},se={};for(var le in E){var Me=E[le];H[le]=Me.getVisibleCoordinates(),ie[le]=H[le].slice().reverse(),se[le]=Me.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<d.length;we++)if(this.style._layers[d[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var Ve=0,be=d;Ve<be.length;Ve+=1){var Ue=this.style._layers[be[Ve]];if(Ue.hasOffscreenPass()&&!Ue.isHidden(this.transform.zoom)){var Qe=ie[Ue.source];(Ue.type==="custom"||Qe.length)&&this.renderLayer(this,E[Ue.source],Ue,Qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var dt=this.style._layers[d[this.currentLayer]],jt=E[dt.source],Nt=H[dt.source];this._renderTileClippingMasks(dt,Nt),this.renderLayer(this,jt,dt,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Xt=this.style._layers[d[this.currentLayer]],vr=E[Xt.source],Dr=(Xt.type==="symbol"?se:ie)[Xt.source];this._renderTileClippingMasks(Xt,H[Xt.source]),this.renderLayer(this,vr,Xt,Dr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Lr){Lr.source&&!Lr.isHidden(c.transform.zoom)&&(Lr.source!==(U&&U.id)&&(U=c.style.sourceCaches[Lr.source]),(!k||k.getSource().maxzoom<U.getSource().maxzoom)&&(k=U))}),k&&fl.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(Lr){var Ur=Lr.transform.padding;xp(Lr,Lr.transform.height-(Ur.top||0),3,Ru),xp(Lr,Ur.bottom||0,3,nf),zf(Lr,Ur.left||0,3,Nf),zf(Lr,Lr.transform.width-(Ur.right||0),3,Bl);var Zn=Lr.transform.centerPoint;(function(kn,Vn,Ai,an){Nl(kn,Vn-1,Ai-10,2,20,an),Nl(kn,Vn-10,Ai-1,20,2,an)})(Lr,Zn.x,Lr.transform.height-Zn.y,_p)}(this),this.context.setDefault()},Ha.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),fl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ha.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ha.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ha.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ha.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,A=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=A}return f},Ha.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var A=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(A){var M=Math.sin(A),k=Math.cos(A);c=[c[0]*k-c[1]*M,c[0]*M+c[1]*k]}var U=[E?c[0]:Wi(f,c[0],this.transform.zoom),E?c[1]:Wi(f,c[1],this.transform.zoom),0],H=new Float32Array(16);return m.translate(H,l,U),H},Ha.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ha.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ha.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ha.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Qc(this.context,l,hs[l],f,Dl[l],this._showOverdrawInspector)),this.cache[c]},Ha.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ha.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ha.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ha.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var oc=function(l,f){this.points=l,this.planes=f};oc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return m.transformMat4([],M,l)}).map(function(M){return m.scale$1([],M,1/M[3]/f*d)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var k=m.sub([],E[M[0]],E[M[1]]),U=m.sub([],E[M[2]],E[M[1]]),H=m.normalize([],m.cross([],k,U)),ie=-m.dot(H,E[M[1]]);return H.concat(ie)});return new oc(E,A)};var zl=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};zl.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new zl(c,d)},zl.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},zl.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},zl.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],A=0,M=0;M<f.length;M++)A+=m.dot$1(E,f[M])>=0;if(A===0)return 0;A!==f.length&&(c=!1)}if(c)return 2;for(var k=0;k<3;k++){for(var U=Number.MAX_VALUE,H=-Number.MAX_VALUE,ie=0;ie<l.points.length;ie++){var se=l.points[ie][k]-this.min[k];U=Math.min(U,se),H=Math.max(H,se)}if(H<0||U>this.max[k]-this.min[k])return 0}return 1};var ku=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};ku.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},ku.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},ku.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},ku.prototype.clone=function(){return new ku(this.top,this.bottom,this.left,this.right)},ku.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ii=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ku,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ii.prototype.clone=function(){var l=new Ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new m.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ii.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Ii.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Ii.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Ii.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),A=this.pointCoordinate(new m.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,A.x)),k=Math.floor(Math.max(c.x,d.x,E.x,A.x)),U=M-1;U<=k+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Ii.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),A=[E*d.x,E*d.y,0],M=oc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),k=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=f);var U=function(Lr){return{aabb:new zl([Lr*E,0,0],[(Lr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Lr,fullyVisible:!1}},H=[],ie=[],se=f,le=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Me=1;Me<=3;Me++)H.push(U(-Me)),H.push(U(Me));for(H.push(U(0));H.length>0;){var we=H.pop(),Ve=we.x,be=we.y,Ue=we.fullyVisible;if(!Ue){var Qe=we.aabb.intersects(M);if(Qe===0)continue;Ue=Qe===2}var dt=we.aabb.distanceX(A),jt=we.aabb.distanceY(A),Nt=Math.max(Math.abs(dt),Math.abs(jt));if(we.zoom===se||Nt>3+(1<<se-we.zoom)-2&&we.zoom>=k)ie.push({tileID:new m.OverscaledTileID(we.zoom===se?le:we.zoom,we.wrap,we.zoom,Ve,be),distanceSq:m.sqrLen([A[0]-.5-Ve,A[1]-.5-be])});else for(var Xt=0;Xt<4;Xt++){var vr=(Ve<<1)+Xt%2,Dr=(be<<1)+(Xt>>1);H.push({aabb:we.aabb.quadrant(Xt),zoom:we.zoom+1,x:vr,y:Dr,wrap:we.wrap,fullyVisible:Ue})}}return ie.sort(function(Lr,Ur){return Lr.distanceSq-Ur.distanceSq}).map(function(Lr){return Lr.tileID})},Ii.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Ii.prototype.zoomScale=function(l){return Math.pow(2,l)},Ii.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Ii.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Ii.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Ii.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),A=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},Ii.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Ii.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Ii.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Ii.prototype.coordinateLocation=function(l){return l.toLngLat()},Ii.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],A=f[1]/d,M=c[1]/E,k=f[2]/d,U=c[2]/E,H=k===U?0:(0-k)/(U-k);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,H)/this.worldSize,m.number(A,M,H)/this.worldSize)},Ii.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Ii.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Ii.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ii.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ii.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,A=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,k=m.identity(new Float64Array(16));return m.translate(k,k,[M*A,E.y*A,0]),m.scale(k,k,[A/m.EXTENT,A/m.EXTENT,1]),m.multiply(k,f?this.alignedProjMatrix:this.projMatrix,k),d[c]=new Float32Array(k),d[c]},Ii.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ii.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,A=90,M=-180,k=180,U=this.size,H=this._unmodified;if(this.latRange){var ie=this.latRange;E=m.mercatorYfromLat(ie[1])*this.worldSize,l=(A=m.mercatorYfromLat(ie[0])*this.worldSize)-E<U.y?U.y/(A-E):0}if(this.lngRange){var se=this.lngRange;M=m.mercatorXfromLng(se[0])*this.worldSize,f=(k=m.mercatorXfromLng(se[1])*this.worldSize)-M<U.x?U.x/(k-M):0}var le=this.point,Me=Math.max(f||0,l||0);if(Me)return this.center=this.unproject(new m.Point(f?(k+M)/2:le.x,l?(A+E)/2:le.y)),this.zoom+=this.scaleZoom(Me),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var we=le.y,Ve=U.y/2;we-Ve<E&&(d=E+Ve),we+Ve>A&&(d=A-Ve)}if(this.lngRange){var be=le.x,Ue=U.x/2;be-Ue<M&&(c=M+Ue),be+Ue>k&&(c=k-Ue)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:le.x,d!==void 0?d:le.y))),this._unmodified=H,this._constraining=!1}},Ii.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,A=E.x,M=E.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,H=new Float64Array(16);m.perspective(H,this._fov,this.width/this.height,U,k),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,m.scale(H,H,[1,-1,1]),m.translate(H,H,[0,0,-this.cameraToCenterDistance]),m.rotateX(H,H,this._pitch),m.rotateZ(H,H,this.angle),m.translate(H,H,[-A,-M,0]),this.mercatorMatrix=m.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),m.scale(H,H,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=m.invert([],this.projMatrix);var ie=this.width%2/2,se=this.height%2/2,le=Math.cos(this.angle),Me=Math.sin(this.angle),we=A-Math.round(A)+le*ie+Me*se,Ve=M-Math.round(M)+le*se+Me*ie,be=new Float64Array(H);if(m.translate(be,be,[we>.5?we-1:we,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=be,H=m.create(),m.scale(H,H,[this.width/2,-this.height/2,1]),m.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=m.create(),m.scale(H,H,[1,-1,1]),m.translate(H,H,[-1,-1,0]),m.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ii.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ii.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Ii.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,A=f.y,M=0,k=l;M<k.length;M+=1){var U=k[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),A=Math.max(A,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,A),new m.Point(c,A),new m.Point(c,d)]},Object.defineProperties(Ii.prototype,Ma);var ks=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};ks.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ks.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ks.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),A=Math.round(f.lng*E)/E,M=Math.round(f.lat*E)/E,k=this._map.getBearing(),U=this._map.getPitch(),H="";if(H+=l?"/"+A+"/"+M+"/"+c:c+"/"+M+"/"+A,(k||U)&&(H+="/"+Math.round(10*k)/10),U&&(H+="/"+Math.round(U)),this._hashName){var ie=this._hashName,se=!1,le=m.window.location.hash.slice(1).split("&").map(function(Me){var we=Me.split("=")[0];return we===ie?(se=!0,we+"="+H):Me}).filter(function(Me){return Me});return se||le.push(ie+"="+H),"#"+le.join("&")}return"#"+H},ks.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},ks.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},ks.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Mc={linearity:.3,easing:m.bezier(0,0,.3,1)},gu=m.extend({deceleration:2500,maxSpeed:1400},Mc),af=m.extend({deceleration:20,maxSpeed:1400},Mc),Zh=m.extend({deceleration:1e3,maxSpeed:360},Mc),jh=m.extend({deceleration:1e3,maxSpeed:90},Mc),Pc=function(l){this._map=l,this.clear()};function Ic(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function pl(l,f,c){var d=c.maxSpeed,E=c.linearity,A=c.deceleration,M=m.clamp(l*E/(f/1e3),-d,d),k=Math.abs(M)/(A*E);return{easing:c.easing,duration:1e3*k,amount:M*(k/2)}}Pc.prototype.clear=function(){this._inertiaBuffer=[]},Pc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Pc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Pc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(f.pan.mag()){var k=pl(f.pan.mag(),A,m.extend({},gu,l||{}));M.offset=f.pan.mult(k.amount/f.pan.mag()),M.center=this._map.transform.center,Ic(M,k)}if(f.zoom){var U=pl(f.zoom,A,af);M.zoom=this._map.transform.zoom+U.amount,Ic(M,U)}if(f.bearing){var H=pl(f.bearing,A,Zh);M.bearing=this._map.transform.bearing+m.clamp(H.amount,-179,179),Ic(M,H)}if(f.pitch){var ie=pl(f.pitch,A,jh);M.pitch=this._map.transform.pitch+ie.amount,Ic(M,ie)}if(M.zoom||M.bearing){var se=f.pinchAround===void 0?f.around:f.pinchAround;M.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),m.extend(M,{noMoveStart:!0})}};var fo=function(l){function f(d,E,A,M){M===void 0&&(M={});var k=X.mousePos(E.getCanvasContainer(),A),U=E.unproject(k);l.call(this,d,m.extend({point:k,lngLat:U,originalEvent:A},M)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Oc=function(l){function f(d,E,A){var M=d==="touchend"?A.changedTouches:A.touches,k=X.touchPos(E.getCanvasContainer(),M),U=k.map(function(se){return E.unproject(se)}),H=k.reduce(function(se,le,Me,we){return se.add(le.div(we.length))},new m.Point(0,0)),ie=E.unproject(H);l.call(this,d,{points:k,point:H,lngLats:U,lngLat:ie,originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Rc=function(l){function f(d,E,A){l.call(this,d,{originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Mo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};Mo.prototype.reset=function(){delete this._mousedownPos},Mo.prototype.wheel=function(l){return this._firePreventable(new Rc(l.type,this._map,l))},Mo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new fo(l.type,this._map,l))},Mo.prototype.mouseup=function(l){this._map.fire(new fo(l.type,this._map,l))},Mo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new fo(l.type,this._map,l))},Mo.prototype.dblclick=function(l){return this._firePreventable(new fo(l.type,this._map,l))},Mo.prototype.mouseover=function(l){this._map.fire(new fo(l.type,this._map,l))},Mo.prototype.mouseout=function(l){this._map.fire(new fo(l.type,this._map,l))},Mo.prototype.touchstart=function(l){return this._firePreventable(new Oc(l.type,this._map,l))},Mo.prototype.touchmove=function(l){this._map.fire(new Oc(l.type,this._map,l))},Mo.prototype.touchend=function(l){this._map.fire(new Oc(l.type,this._map,l))},Mo.prototype.touchcancel=function(l){this._map.fire(new Oc(l.type,this._map,l))},Mo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Mo.prototype.isEnabled=function(){return!0},Mo.prototype.isActive=function(){return!1},Mo.prototype.enable=function(){},Mo.prototype.disable=function(){};var vn=function(l){this._map=l};vn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},vn.prototype.mousemove=function(l){this._map.fire(new fo(l.type,this._map,l))},vn.prototype.mousedown=function(){this._delayContextMenu=!0},vn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},vn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new fo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},vn.prototype.isEnabled=function(){return!0},vn.prototype.isActive=function(){return!1},vn.prototype.enable=function(){},vn.prototype.disable=function(){};var ro=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Po(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}ro.prototype.isEnabled=function(){return!!this._enabled},ro.prototype.isActive=function(){return!!this._active},ro.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ro.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ro.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(X.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},ro.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=X.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),A=Math.max(d.x,c.x),M=Math.min(d.y,c.y),k=Math.max(d.y,c.y);X.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=A-E+"px",this._box.style.height=k-M+"px"}}},ro.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),X.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(A){return A.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},ro.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},ro.prototype.blur=function(){this.reset()},ro.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(X.remove(this._box),this._box=null),X.enableDrag(),delete this._startPos,delete this._lastPos},ro.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var Ul=function(l){this.reset(),this.numTouches=l.numTouches};Ul.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ul.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),A=0,M=d;A<M.length;A+=1)E._add(M[A]);return E.div(d.length)}(f),this.touches=Po(c,f)))},Ul.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Po(c,f);for(var E in this.touches){var A=d[E];(!A||A.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Ul.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Yi=function(l){this.singleTap=new Ul(l),this.numTaps=l.numTaps,this.reset()};Yi.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Yi.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Yi.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Yi.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(d)<30;if(E&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ls=function(){this._zoomIn=new Yi({numTouches:1,numTaps:2}),this._zoomOut=new Yi({numTouches:2,numTaps:1}),this.reset()};Ls.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ls.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ls.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ls.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),A=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):A?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(A)},{originalEvent:l})}}):void 0},Ls.prototype.touchcancel=function(){this.reset()},Ls.prototype.enable=function(){this._enabled=!0},Ls.prototype.disable=function(){this._enabled=!1,this.reset()},Ls.prototype.isEnabled=function(){return this._enabled},Ls.prototype.isActive=function(){return this._active};var Uf={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,f){return!1},Kr.prototype._move=function(l,f){return{}},Kr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=X.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var A=Uf[E];return d.buttons===void 0||(d.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&X.mouseButton(l)===this._eventButton&&(this._moved&&X.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var kc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Kr),of=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),hl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),mi=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};mi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},mi.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},mi.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},mi.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},mi.prototype.touchcancel=function(){this.reset()},mi.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Po(c,f),E=new m.Point(0,0),A=new m.Point(0,0),M=0;for(var k in d){var U=d[k],H=this._touches[k];H&&(E._add(U),A._add(U.sub(H)),M++,d[k]=U)}if(this._touches=d,!(M<this._minTouches)&&A.mag()){var ie=A.div(M);if(this._sum._add(ie),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:ie}}},mi.prototype.enable=function(){this._enabled=!0},mi.prototype.disable=function(){this._enabled=!1,this.reset()},mi.prototype.isEnabled=function(){return this._enabled},mi.prototype.isActive=function(){return this._active};var Bo=function(){this.reset()};function yu(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Xs(l,f){return Math.log(l/f)/Math.LN2}Bo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Bo.prototype._start=function(l){},Bo.prototype._move=function(l,f,c){return{}},Bo.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Bo.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],A=yu(c,f,d[0]),M=yu(c,f,E);if(A&&M){var k=this._aroundCenter?null:A.add(M).div(2);return this._move([A,M],k,l)}}},Bo.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],A=yu(c,f,d[0]),M=yu(c,f,E);A&&M||(this._active&&X.suppressClick(),this.reset())}},Bo.prototype.touchcancel=function(){this.reset()},Bo.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Bo.prototype.disable=function(){this._enabled=!1,this.reset()},Bo.prototype.isEnabled=function(){return this._enabled},Bo.prototype.isActive=function(){return this._active};var Ds=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Xs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xs(this._distance,E),pinchAround:d}},f}(Bo);function _u(l,f){return 180*l.angleWith(f)/Math.PI}var sf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=_u(c,this._startVector);return Math.abs(E)<d},f}(Bo);function sc(l){return Math.abs(l.y)>Math.abs(l.x)}var Zf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,sc(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var A=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(A.y+M.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var A=c.mag()>=2,M=d.mag()>=2;if(A||M){if(!A||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var k=c.y>0==d.y>0;return sc(c)&&sc(d)&&k}},f}(Bo),uf={panStep:100,bearingStep:15,pitchStep:10},tu=function(){var l=uf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function ru(l){return l*(2-l)}tu.prototype.blur=function(){this.reset()},tu.prototype.reset=function(){this._active=!1},tu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,A=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(k){var U=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:ru,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:k.getBearing()+d*f._bearingStep,pitch:k.getPitch()+E*f._pitchStep,offset:[-A*f._panStep,-M*f._panStep],center:k.getCenter()},{originalEvent:l})}}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active},tu.prototype.disableRotation=function(){this._rotationDisabled=!0},tu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Oi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Oi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Oi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=X.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,M=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,k=this._startZoom,U=this._easing,H=!1;if(this._type==="wheel"&&k&&U){var ie=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),se=U(ie);A=m.number(k,M,se),ie<1?this._frameId||(this._frameId=!0):H=!0}else A=M,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:A-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),A=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-A*A);f=m.bezier(A,M,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var _a=function(l,f){this._clickZoom=l,this._tapZoom=f};_a.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},_a.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},_a.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},_a.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var nu=function(){this.reset()};nu.prototype.reset=function(){this._active=!1},nu.prototype.blur=function(){this.reset()},nu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},nu.prototype.enable=function(){this._enabled=!0},nu.prototype.disable=function(){this._enabled=!1,this.reset()},nu.prototype.isEnabled=function(){return this._enabled},nu.prototype.isActive=function(){return this._active};var Xo=function(){this._tap=new Yi({numTouches:1,numTaps:1}),this.reset()};Xo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Xo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Xo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Xo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Xo.prototype.touchcancel=function(){this.reset()},Xo.prototype.enable=function(){this._enabled=!0},Xo.prototype.disable=function(){this._enabled=!1,this.reset()},Xo.prototype.isEnabled=function(){return this._enabled},Xo.prototype.isActive=function(){return this._active};var dl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};dl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},dl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},dl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},dl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var xu=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};xu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},xu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},xu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},xu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ss=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Ss.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ss.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ss.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ss.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ss.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ss.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Cs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},cu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Dn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Pn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var A=E[d],M=A[0];X.addEventListener(M,A[1],M===m.window.document?this.handleWindowEvent:this.handleEvent,A[2])}};Pn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];X.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Pn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new Mo(f,l));var d=f.boxZoom=new ro(f,l);this._add("boxZoom",d);var E=new Ls,A=new nu;f.doubleClickZoom=new _a(A,E),this._add("tapZoom",E),this._add("clickZoom",A);var M=new Xo;this._add("tapDragZoom",M);var k=f.touchPitch=new Zf;this._add("touchPitch",k);var U=new of(l),H=new hl(l);f.dragRotate=new xu(l,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var ie=new kc(l),se=new mi(l);f.dragPan=new dl(c,ie,se),this._add("mousePan",ie),this._add("touchPan",se,["touchZoom","touchRotate"]);var le=new sf,Me=new Ds;f.touchZoomRotate=new Ss(c,Me,le,M),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]);var we=f.scrollZoom=new Oi(f,this);this._add("scrollZoom",we,["mousePan"]);var Ve=f.keyboard=new tu;this._add("keyboard",Ve),this._add("blockableMapEvent",new vn(f));for(var be=0,Ue=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];be<Ue.length;be+=1){var Qe=Ue[be];l.interactive&&l[Qe]&&f[Qe].enable(l[Qe])}},Pn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Pn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Pn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Pn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Pn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Pn.prototype.isMoving=function(){return Boolean(Cs(this._eventsInProgress))||this.isZooming()},Pn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Pn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Pn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Pn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},A={},M=l.touches?this._getMapTouches(l.touches):void 0,k=M?X.touchPos(this._el,M):X.mousePos(this._el,l),U=0,H=this._handlers;U<H.length;U+=1){var ie=H[U],se=ie.handlerName,le=ie.handler,Me=ie.allowed;if(le.isEnabled()){var we=void 0;this._blockedByActive(A,Me,se)?le.reset():le[f||l.type]&&(we=le[f||l.type](l,k,M),this.mergeHandlerResult(d,E,we,se,c),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||le.isActive())&&(A[se]=le)}}var Ve={};for(var be in this._previousActiveHandlers)A[be]||(Ve[be]=c);this._previousActiveHandlers=A,(Object.keys(Ve).length||Dn(d))&&(this._changes.push([d,E,Ve]),this._triggerRenderFrame()),(Object.keys(A).length||Dn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ue=d.cameraAnimation;Ue&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ue(this._map))},Pn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var A={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=A),c.panDelta!==void 0&&(f.drag=A),c.pitchDelta!==void 0&&(f.pitch=A),c.bearingDelta!==void 0&&(f.rotate=A)}},Pn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var A=E[d],M=A[0],k=A[1],U=A[2];M.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),m.extend(f,k),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},Pn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!Dn(l))return this._fireEvents(f,c,!0);var A=l.panDelta,M=l.zoomDelta,k=l.bearingDelta,U=l.pitchDelta,H=l.around,ie=l.pinchAround;ie!==void 0&&(H=ie),d._stop(!0),H=H||d.transform.centerPoint;var se=E.pointLocation(A?H.sub(A):H);k&&(E.bearing+=k),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(se,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Pn.prototype._fireEvents=function(l,f,c){var d=this,E=Cs(this._eventsInProgress),A=Cs(l),M={};for(var k in l)this._eventsInProgress[k]||(M[k+"start"]=l[k].originalEvent),this._eventsInProgress[k]=l[k];for(var U in!E&&A&&this._fireEvent("movestart",A.originalEvent),M)this._fireEvent(U,M[U]);for(var H in A&&this._fireEvent("move",A.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var ie,se={};for(var le in this._eventsInProgress){var Me=this._eventsInProgress[le],we=Me.handlerName,Ve=Me.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[le],se[le+"end"]=ie=f[we]||Ve)}for(var be in se)this._fireEvent(be,se[be]);var Ue=Cs(this._eventsInProgress);if(c&&(E||A)&&!Ue){this._updatingCamera=!0;var Qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),dt=function(jt){return jt!==0&&-d._bearingSnap<jt&&jt<d._bearingSnap};Qe?(dt(Qe.bearing||this._map.getBearing())&&(Qe.bearing=0),this._map.easeTo(Qe,{originalEvent:ie})):(this._map.fire(new m.Event("moveend",{originalEvent:ie})),dt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Pn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},Pn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new cu("renderFrame",{timeStamp:f})),l._applyChanges()})},Pn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var lf=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,A){var M={top:0,bottom:0,right:0,left:0};if(typeof(A=m.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var k=A.padding;A.padding={top:k,bottom:k,right:k,left:k}}A.padding=m.extend(M,A.padding);var U=this.transform,H=U.padding,ie=U.project(m.LngLat.convert(c)),se=U.project(m.LngLat.convert(d)),le=ie.rotate(-E*Math.PI/180),Me=se.rotate(-E*Math.PI/180),we=new m.Point(Math.max(le.x,Me.x),Math.max(le.y,Me.y)),Ve=new m.Point(Math.min(le.x,Me.x),Math.min(le.y,Me.y)),be=we.sub(Ve),Ue=(U.width-(H.left+H.right+A.padding.left+A.padding.right))/be.x,Qe=(U.height-(H.top+H.bottom+A.padding.top+A.padding.bottom))/be.y;if(!(Qe<0||Ue<0)){var dt=Math.min(U.scaleZoom(U.scale*Math.min(Ue,Qe)),A.maxZoom),jt=typeof A.offset.x=="number"?new m.Point(A.offset.x,A.offset.y):m.Point.convert(A.offset),Nt=new m.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(E*Math.PI/180),Xt=jt.add(Nt).mult(U.scale/U.zoomScale(dt));return{center:U.unproject(ie.add(se).div(2).sub(Xt)),zoom:dt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,A,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,A),A,M)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,A=!1,M=!1,k=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(A=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(k=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),A&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),M&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),k&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var A=this.transform,M=this.getZoom(),k=this.getBearing(),U=this.getPitch(),H=this.getPadding(),ie="zoom"in c?+c.zoom:M,se="bearing"in c?this._normalizeBearing(c.bearing,k):k,le="pitch"in c?+c.pitch:U,Me="padding"in c?c.padding:A.padding,we=m.Point.convert(c.offset),Ve=A.centerPoint.add(we),be=A.pointLocation(Ve),Ue=m.LngLat.convert(c.center||be);this._normalizeCenter(Ue);var Qe,dt,jt=A.project(be),Nt=A.project(Ue).sub(jt),Xt=A.zoomScale(ie-M);c.around&&(Qe=m.LngLat.convert(c.around),dt=A.locationPoint(Qe));var vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ie!==M,this._rotating=this._rotating||k!==se,this._pitching=this._pitching||le!==U,this._padding=!A.isPaddingEqual(Me),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,vr),this._ease(function(Dr){if(E._zooming&&(A.zoom=m.number(M,ie,Dr)),E._rotating&&(A.bearing=m.number(k,se,Dr)),E._pitching&&(A.pitch=m.number(U,le,Dr)),E._padding&&(A.interpolatePadding(H,Me,Dr),Ve=A.centerPoint.add(we)),Qe)A.setLocationAtPoint(Qe,dt);else{var Lr=A.zoomScale(A.zoom-M),Ur=ie>M?Math.min(2,Xt):Math.max(.5,Xt),Zn=Math.pow(Ur,1-Dr),kn=A.unproject(jt.add(Nt.mult(Dr*Zn)).mult(Lr));A.setLocationAtPoint(A.renderWorldCopies?kn.wrap():kn,Ve)}E._fireMoveEvents(d)},function(Dr){E._afterEase(d,Dr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,A=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),A&&this.fire(new m.Event("rotateend",c)),M&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var A=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var M=this.transform,k=this.getZoom(),U=this.getBearing(),H=this.getPitch(),ie=this.getPadding(),se="zoom"in c?m.clamp(+c.zoom,M.minZoom,M.maxZoom):k,le="bearing"in c?this._normalizeBearing(c.bearing,U):U,Me="pitch"in c?+c.pitch:H,we="padding"in c?c.padding:M.padding,Ve=M.zoomScale(se-k),be=m.Point.convert(c.offset),Ue=M.centerPoint.add(be),Qe=M.pointLocation(Ue),dt=m.LngLat.convert(c.center||Qe);this._normalizeCenter(dt);var jt=M.project(Qe),Nt=M.project(dt).sub(jt),Xt=c.curve,vr=Math.max(M.width,M.height),Dr=vr/Ve,Lr=Nt.mag();if("minZoom"in c){var Ur=m.clamp(Math.min(c.minZoom,k,se),M.minZoom,M.maxZoom),Zn=vr/M.zoomScale(Ur-k);Xt=Math.sqrt(Zn/Lr*2)}var kn=Xt*Xt;function Vn(wn){var Gn=(Dr*Dr-vr*vr+(wn?-1:1)*kn*kn*Lr*Lr)/(2*(wn?Dr:vr)*kn*Lr);return Math.log(Math.sqrt(Gn*Gn+1)-Gn)}function Ai(wn){return(Math.exp(wn)-Math.exp(-wn))/2}function an(wn){return(Math.exp(wn)+Math.exp(-wn))/2}var si=Vn(0),hi=function(wn){return an(si)/an(si+Xt*wn)},ti=function(wn){return vr*((an(si)*(Ai(Gn=si+Xt*wn)/an(Gn))-Ai(si))/kn)/Lr;var Gn},Xn=(Vn(1)-si)/Xt;if(Math.abs(Lr)<1e-6||!isFinite(Xn)){if(Math.abs(vr-Dr)<1e-6)return this.easeTo(c,d);var Fn=Dr<vr?-1:1;Xn=Math.abs(Math.log(Dr/vr))/Xt,ti=function(){return 0},hi=function(wn){return Math.exp(Fn*Xt*wn)}}return c.duration="duration"in c?+c.duration:1e3*Xn/("screenSpeed"in c?+c.screenSpeed/Xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==le,this._pitching=Me!==H,this._padding=!M.isPaddingEqual(we),this._prepareEase(d,!1),this._ease(function(wn){var Gn=wn*Xn,po=1/hi(Gn);M.zoom=wn===1?se:k+M.scaleZoom(po),E._rotating&&(M.bearing=m.number(U,le,wn)),E._pitching&&(M.pitch=m.number(H,Me,wn)),E._padding&&(M.interpolatePadding(ie,we,wn),Ue=M.centerPoint.add(be));var Ta=wn===1?dt:M.unproject(jt.add(Nt.mult(ti(Gn))).mult(po));M.setLocationAtPoint(M.renderWorldCopies?Ta.wrap():Ta,Ue),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var A=this.handlers;A&&A.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),vs=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};vs.prototype.getDefaultPosition=function(){return"bottom-right"},vs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},vs.prototype.onRemove=function(){X.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},vs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},vs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},vs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,A){return E.value&&(d+=E.key+"="+E.value+(A<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},vs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},vs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var A=E.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort(function(k,U){return k.length-U.length});var M=(l=l.filter(function(k,U){for(var H=U+1;H<l.length;H++)if(l[H].indexOf(k)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},vs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bu=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};bu.prototype.onAdd=function(l){this._map=l,this._container=X.create("div","mapboxgl-ctrl");var f=X.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bu.prototype.onRemove=function(){X.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bu.prototype.getDefaultPosition=function(){return"bottom-left"},bu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},bu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},bu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Yo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Yo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var fu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Zl=m.window.HTMLImageElement,Lc=m.window.HTMLElement,sa=m.window.ImageBitmap,Za={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},cf=function(l){function f(d){var E=this;if((d=m.extend({},Za,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new Ii(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,A,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},fu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Lc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Pn(this,d),this._hash=d.hash&&new ks(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new vs({customAttribution:d.customAttribution})),this.addControl(new bu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new m.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new m.Event(M.dataType+"dataloading",M))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(A,M.firstChild):M.appendChild(A),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),A=E[0],M=E[1];if(A===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(A,M),this.transform.resize(A,M),this.painter.resize(A,M);var k=!this._moving;return k&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),k&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,A){var M,k=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:A,delegates:{mousemove:function(ie){var se=k.getLayer(E)?k.queryRenderedFeatures(ie.point,{layers:[E]}):[];se.length?U||(U=!0,A.call(k,new fo(d,k,ie.originalEvent,{features:se}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:A,delegates:{mousemove:function(ie){(k.getLayer(E)?k.queryRenderedFeatures(ie.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,A.call(k,new fo(d,k,ie.originalEvent)))},mouseout:function(ie){H&&(H=!1,A.call(k,new fo(d,k,ie.originalEvent)))}}}}return{layer:E,listener:A,delegates:(M={},M[d]=function(ie){var se=k.getLayer(E)?k.queryRenderedFeatures(ie.point,{layers:[E]}):[];se.length&&(ie.features=se,A.call(k,ie),delete ie.features)},M)}},f.prototype.on=function(d,E,A){if(A===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(k,M.delegates[k]);return this},f.prototype.once=function(d,E,A){if(A===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var k in M.delegates)this.once(k,M.delegates[k]);return this},f.prototype.off=function(d,E,A){var M=this;return A===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(k){for(var U=k[d],H=0;H<U.length;H++){var ie=U[H];if(ie.layer===E&&ie.listener===A){for(var se in ie.delegates)M.off(se,ie.delegates[se]);return U.splice(H,1),M}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var A;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")A=[m.Point.convert(d)];else{var M=m.Point.convert(d[0]),k=m.Point.convert(d[1]);A=[M,new m.Point(k.x,M.y),k,new m.Point(M.x,k.y),M]}return this.style.queryRenderedFeatures(A,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new Wo(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var A=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),k=this._requestManager.transformRequest(M,m.ResourceType.Style);m.getJSON(k,function(U,H){U?A.fire(new m.ErrorEvent(U)):H&&A._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(A){m.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var A=d[E]._tiles;for(var M in A){var k=A[M];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,A)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,A){A===void 0&&(A={});var M=A.pixelRatio;M===void 0&&(M=1);var k=A.sdf;k===void 0&&(k=!1);var U=A.stretchX,H=A.stretchY,ie=A.content;if(this._lazyInitEmptyStyle(),E instanceof Zl||sa&&E instanceof sa){var se=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:M,stretchX:U,stretchY:H,content:ie,sdf:k,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var le=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:H,content:ie,sdf:k,version:0,userImage:le}),le.onAdd&&le.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var A=this.style.getImage(d);if(!A)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof Zl||sa&&E instanceof sa?m.browser.getImageData(E):E,k=M.width,U=M.height,H=M.data;return k===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==A.data.width||U!==A.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(H,!(E instanceof Zl||sa&&E instanceof sa)),void this.style.updateImage(d,A))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,A){return this.style.setLayerZoomRange(d,E,A),this._update(!0)},f.prototype.setFilter=function(d,E,A){return A===void 0&&(A={}),this.style.setFilter(d,E,A),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,A,M),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,A,M),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=X.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=X.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=X.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var M=this._controlContainer=X.create("div","mapboxgl-control-container",d),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){k[U]=X.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var A=m.browser.devicePixelRatio||1;this._canvas.width=A*d,this._canvas.height=A*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Ha(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,A=this,M=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,E),M=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,ie=m.browser.now();this.style.zoomHistory.update(H,ie);var se=new m.EvaluationParameters(H,{now:ie,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=se.crossFadingFactor();le===1&&le===this._crossFadingFactor||(U=!0,this._crossFadingFactor=le),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Me=m.browser.now()-M;k.endQueryEXT(k.TIME_ELAPSED_EXT,E),setTimeout(function(){var be=k.getQueryObjectEXT(E,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(E),A.fire(new m.Event("gpu-timing-frame",{cpuTime:Me,gpuTime:be}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var be=A.painter.queryGpuTimers(we);A.fire(new m.Event("gpu-timing-layer",{layerTimes:be}))},50)}var Ve=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ve||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||Ve||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),Wu(this._canvasContainer),Wu(this._controlContainer),Wu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(lf);function Wu(l){l.parentNode&&l.parentNode.removeChild(l)}var Lu={showCompass:!0,showZoom:!0,visualizePitch:!1},Eu=function(l){var f=this;this.options=m.extend({},Lu,l),this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),X.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),X.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=X.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Eu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Eu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Eu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new No(this._map,this._compass,this.options.visualizePitch)),this._container},Eu.prototype.onRemove=function(){X.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Eu.prototype._createButton=function(l,f){var c=X.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Eu.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var No=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new of({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new hl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),X.addEventListener(f,"mousedown",this.mousedown),X.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),X.addEventListener(f,"touchmove",this.touchmove),X.addEventListener(f,"touchend",this.touchend),X.addEventListener(f,"touchcancel",this.reset)};function Xu(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),A=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<A?l=d:c.locationPoint(E).distSqr(f)<A&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}No.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),X.disableDrag()},No.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},No.prototype.off=function(){var l=this.element;X.removeEventListener(l,"mousedown",this.mousedown),X.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),X.removeEventListener(l,"touchmove",this.touchmove),X.removeEventListener(l,"touchend",this.touchend),X.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},No.prototype.offTemp=function(){X.enableDrag(),X.removeEventListener(m.window,"mousemove",this.mousemove),X.removeEventListener(m.window,"mouseup",this.mouseup)},No.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),X.mousePos(this.element,l)),X.addEventListener(m.window,"mousemove",this.mousemove),X.addEventListener(m.window,"mouseup",this.mouseup)},No.prototype.mousemove=function(l){this.move(l,X.mousePos(this.element,l))},No.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},No.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=X.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},No.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=X.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},No.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},No.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var zo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ff(l,f,c){var d=l.classList;for(var E in zo)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var jl,Dc=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=X.create("div"),this._element.setAttribute("aria-label","Map marker");var E=X.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var A=X.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var M=X.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var k=X.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var U=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<H.length;U+=1){var ie=H[U],se=X.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ie.rx),se.setAttributeNS(null,"ry",ie.ry),k.appendChild(se)}var le=X.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"fill",this._color);var Me=X.createNS("http://www.w3.org/2000/svg","path");Me.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),le.appendChild(Me);var we=X.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var Ve=X.createNS("http://www.w3.org/2000/svg","path");Ve.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Ve);var be=X.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),be.setAttributeNS(null,"fill","#FFFFFF");var Ue=X.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Qe=X.createNS("http://www.w3.org/2000/svg","circle");Qe.setAttributeNS(null,"fill","#000000"),Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"cx","5.5"),Qe.setAttributeNS(null,"cy","5.5"),Qe.setAttributeNS(null,"r","5.4999962");var dt=X.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#FFFFFF"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962"),Ue.appendChild(Qe),Ue.appendChild(dt),M.appendChild(k),M.appendChild(le),M.appendChild(we),M.appendChild(be),M.appendChild(Ue),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(jt){jt.preventDefault()}),this._element.addEventListener("mousedown",function(jt){jt.preventDefault()}),ff(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),X.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),X.setTransform(this._element,zo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Gl=0,Hl=!1,pf=function(l){function f(c){l.call(this),this.options=m.extend({},Vl,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,jl!==void 0?d(jl):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(jl=E.state!=="denied")}):d(jl=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),X.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Gl=0,Hl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,A=this._map.getBearing(),M=m.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),A=d.distanceTo(E),M=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Hl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=X.create("button","mapboxgl-ctrl-geolocate",this._container),X.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Dc(this._dotElement),this._circleElement=X.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gl--,Hl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Gl>1?(c={maximumAge:6e5,timeout:0},Hl=!0):(c=this.options.positionOptions,Hl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),Yu={maxWidth:100,unit:"metric"},vl=function(l){this.options=m.extend({},Yu,l),m.bindAll(["_onMove","setUnit"],this)};function Fc(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,A=l.unproject([0,E]),M=l.unproject([d,E]),k=A.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*k;U>5280?Wl(f,d,U/5280,l._getUIString("ScaleControl.Miles")):Wl(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Wl(f,d,k/1852,l._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Wl(f,d,k/1e3,l._getUIString("ScaleControl.Kilometers")):Wl(f,d,k,l._getUIString("ScaleControl.Meters"))}function Wl(l,f,c,d){var E,A,M,k=(E=c,(A=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/A)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var H=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*H)/H}(M)));l.style.width=f*(k/c)+"px",l.innerHTML=k+"&nbsp;"+d}vl.prototype.getDefaultPosition=function(){return"bottom-left"},vl.prototype._onMove=function(){Fc(this._map,this._container,this.options)},vl.prototype.onAdd=function(l){return this._map=l,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vl.prototype.onRemove=function(){X.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vl.prototype.setUnit=function(l){this.options.unit=l,Fc(this._map,this._container,this.options)};var iu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};iu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},iu.prototype.onRemove=function(){X.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},iu.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},iu.prototype._setupUI=function(){var l=this._fullscreenButton=X.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},iu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},iu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},iu.prototype._isFullscreen=function(){return this._fullscreen},iu.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},iu.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var jf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ml=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(jf),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&X.remove(this._content),this._container&&(X.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),A=m.window.document.createElement("body");for(A.innerHTML=c;d=A.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=X.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=X.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=X.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=X.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return d._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),A=this.options.anchor,M=function se(le){if(le){if(typeof le=="number"){var Me=Math.round(Math.sqrt(.5*Math.pow(le,2)));return{center:new m.Point(0,0),top:new m.Point(0,le),"top-left":new m.Point(Me,Me),"top-right":new m.Point(-Me,Me),bottom:new m.Point(0,-le),"bottom-left":new m.Point(Me,-Me),"bottom-right":new m.Point(-Me,-Me),left:new m.Point(le,0),right:new m.Point(-le,0)}}if(le instanceof m.Point||Array.isArray(le)){var we=m.Point.convert(le);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:m.Point.convert(le.center||[0,0]),top:m.Point.convert(le.top||[0,0]),"top-left":m.Point.convert(le["top-left"]||[0,0]),"top-right":m.Point.convert(le["top-right"]||[0,0]),bottom:m.Point.convert(le.bottom||[0,0]),"bottom-left":m.Point.convert(le["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(le["bottom-right"]||[0,0]),left:m.Point.convert(le.left||[0,0]),right:m.Point.convert(le.right||[0,0])}}return se(new m.Point(0,0))}(this.options.offset);if(!A){var k,U=this._container.offsetWidth,H=this._container.offsetHeight;k=E.y+M.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<U/2?k.push("left"):E.x>this._map.transform.width-U/2&&k.push("right"),A=k.length===0?"bottom":k.join("-")}var ie=E.add(M[A]).round();X.setTransform(this._container,zo[A]+" translate("+ie.x+"px,"+ie.y+"px)"),ff(this._container,A,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Bc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),Nc={version:m.version,supported:Ie,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:cf,NavigationControl:Eu,GeolocateControl:pf,AttributionControl:vs,ScaleControl:vl,FullscreenControl:iu,Popup:ml,Marker:Dc,Style:Wo,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Ct().acquire(Dt)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Dt),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return mr.workerCount},set workerCount(l){mr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Nc}),Pe})},28660:function(Cr,oe,Q){var Pe=Q(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var De;(function(m){(function(Ie){var X=typeof Q.g=="object"?Q.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),de=ce(m);typeof X.Reflect=="undefined"?X.Reflect=m:de=ce(X.Reflect,de),Ie(de);function ce(ze,ge){return function(nt,ct){typeof ze[nt]!="function"&&Object.defineProperty(ze,nt,{configurable:!0,writable:!0,value:ct}),ge&&ge(nt,ct)}}})(function(Ie){var X=Object.prototype.hasOwnProperty,de=typeof Symbol=="function",ce=de&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ze=de&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ge=typeof Object.create=="function",nt={__proto__:[]}instanceof Array,ct=!ge&&!nt,Et={create:ge?function(){return Va(Object.create(null))}:nt?function(){return Va({__proto__:null})}:function(){return Va({})},has:ct?function(Bt,tr){return X.call(Bt,tr)}:function(Bt,tr){return tr in Bt},get:ct?function(Bt,tr){return X.call(Bt,tr)?Bt[tr]:void 0}:function(Bt,tr){return Bt[tr]}},ar=Object.getPrototypeOf(Function),dr=typeof Pe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",kt=!dr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:pe(),nr=!dr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:fi(),Ut=!dr&&typeof WeakMap=="function"?WeakMap:lo(),ht=new Ut;function St(Bt,tr,Or,Vr){if(Wr(Or)){if(!Gi(Bt))throw new TypeError;if(!ba(tr))throw new TypeError;return Br(Bt,tr)}else{if(!Gi(Bt))throw new TypeError;if(!ai(tr))throw new TypeError;if(!ai(Vr)&&!Wr(Vr)&&!na(Vr))throw new TypeError;return na(Vr)&&(Vr=void 0),Or=qi(Or),rn(Bt,tr,Or,Vr)}}Ie("decorate",St);function or(Bt,tr){function Or(Vr,Ln){if(!ai(Vr))throw new TypeError;if(!Wr(Ln)&&!R(Ln))throw new TypeError;Lt(Bt,tr,Vr,Ln)}return Or}Ie("metadata",or);function q(Bt,tr,Or,Vr){if(!ai(Or))throw new TypeError;return Wr(Vr)||(Vr=qi(Vr)),Lt(Bt,tr,Or,Vr)}Ie("defineMetadata",q);function Gt(Bt,tr,Or){if(!ai(tr))throw new TypeError;return Wr(Or)||(Or=qi(Or)),We(Bt,tr,Or)}Ie("hasMetadata",Gt);function He(Bt,tr,Or){if(!ai(tr))throw new TypeError;return Wr(Or)||(Or=qi(Or)),Re(Bt,tr,Or)}Ie("hasOwnMetadata",He);function $e(Bt,tr,Or){if(!ai(tr))throw new TypeError;return Wr(Or)||(Or=qi(Or)),_t(Bt,tr,Or)}Ie("getMetadata",$e);function bt(Bt,tr,Or){if(!ai(tr))throw new TypeError;return Wr(Or)||(Or=qi(Or)),ft(Bt,tr,Or)}Ie("getOwnMetadata",bt);function et(Bt,tr){if(!ai(Bt))throw new TypeError;return Wr(tr)||(tr=qi(tr)),Ht(Bt,tr)}Ie("getMetadataKeys",et);function qt(Bt,tr){if(!ai(Bt))throw new TypeError;return Wr(tr)||(tr=qi(tr)),Mr(Bt,tr)}Ie("getOwnMetadataKeys",qt);function Tr(Bt,tr,Or){if(!ai(tr))throw new TypeError;Wr(Or)||(Or=qi(Or));var Vr=Ee(tr,Or,!1);if(Wr(Vr)||!Vr.delete(Bt))return!1;if(Vr.size>0)return!0;var Ln=ht.get(tr);return Ln.delete(Or),Ln.size>0||ht.delete(tr),!0}Ie("deleteMetadata",Tr);function Br(Bt,tr){for(var Or=Bt.length-1;Or>=0;--Or){var Vr=Bt[Or],Ln=Vr(tr);if(!Wr(Ln)&&!na(Ln)){if(!ba(Ln))throw new TypeError;tr=Ln}}return tr}function rn(Bt,tr,Or,Vr){for(var Ln=Bt.length-1;Ln>=0;--Ln){var zn=Bt[Ln],bi=zn(tr,Or,Vr);if(!Wr(bi)&&!na(bi)){if(!ai(bi))throw new TypeError;Vr=bi}}return Vr}function Ee(Bt,tr,Or){var Vr=ht.get(Bt);if(Wr(Vr)){if(!Or)return;Vr=new kt,ht.set(Bt,Vr)}var Ln=Vr.get(tr);if(Wr(Ln)){if(!Or)return;Ln=new kt,Vr.set(tr,Ln)}return Ln}function We(Bt,tr,Or){var Vr=Re(Bt,tr,Or);if(Vr)return!0;var Ln=cs(tr);return na(Ln)?!1:We(Bt,Ln,Or)}function Re(Bt,tr,Or){var Vr=Ee(tr,Or,!1);return Wr(Vr)?!1:gi(Vr.has(Bt))}function _t(Bt,tr,Or){var Vr=Re(Bt,tr,Or);if(Vr)return ft(Bt,tr,Or);var Ln=cs(tr);if(!na(Ln))return _t(Bt,Ln,Or)}function ft(Bt,tr,Or){var Vr=Ee(tr,Or,!1);if(!Wr(Vr))return Vr.get(Bt)}function Lt(Bt,tr,Or,Vr){var Ln=Ee(Or,Vr,!0);Ln.set(Bt,tr)}function Ht(Bt,tr){var Or=Mr(Bt,tr),Vr=cs(Bt);if(Vr===null)return Or;var Ln=Ht(Vr,tr);if(Ln.length<=0)return Or;if(Or.length<=0)return Ln;for(var zn=new nr,bi=[],pi=0,An=Or;pi<An.length;pi++){var Mi=An[pi],Li=zn.has(Mi);Li||(zn.add(Mi),bi.push(Mi))}for(var Na=0,fs=Ln;Na<fs.length;Na++){var Mi=fs[Na],Li=zn.has(Mi);Li||(zn.add(Mi),bi.push(Mi))}return bi}function Mr(Bt,tr){var Or=[],Vr=Ee(Bt,tr,!1);if(Wr(Vr))return Or;for(var Ln=Vr.keys(),zn=Ea(Ln),bi=0;;){var pi=aa(zn);if(!pi)return Or.length=bi,Or;var An=Bi(pi);try{Or[bi]=An}catch(Mi){try{Qi(zn)}finally{throw Mi}}bi++}}function Kn(Bt){if(Bt===null)return 1;switch(typeof Bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Bt===null?1:6;default:return 6}}function Wr(Bt){return Bt===void 0}function na(Bt){return Bt===null}function Yn(Bt){return typeof Bt=="symbol"}function ai(Bt){return typeof Bt=="object"?Bt!==null:typeof Bt=="function"}function oi(Bt,tr){switch(Kn(Bt)){case 0:return Bt;case 1:return Bt;case 2:return Bt;case 3:return Bt;case 4:return Bt;case 5:return Bt}var Or=tr===3?"string":tr===5?"number":"default",Vr=sn(Bt,ce);if(Vr!==void 0){var Ln=Vr.call(Bt,Or);if(ai(Ln))throw new TypeError;return Ln}return ci(Bt,Or==="default"?"number":Or)}function ci(Bt,tr){if(tr==="string"){var Or=Bt.toString;if(ia(Or)){var Vr=Or.call(Bt);if(!ai(Vr))return Vr}var Ln=Bt.valueOf;if(ia(Ln)){var Vr=Ln.call(Bt);if(!ai(Vr))return Vr}}else{var Ln=Bt.valueOf;if(ia(Ln)){var Vr=Ln.call(Bt);if(!ai(Vr))return Vr}var zn=Bt.toString;if(ia(zn)){var Vr=zn.call(Bt);if(!ai(Vr))return Vr}}throw new TypeError}function gi(Bt){return!!Bt}function xa(Bt){return""+Bt}function qi(Bt){var tr=oi(Bt,3);return Yn(tr)?tr:xa(tr)}function Gi(Bt){return Array.isArray?Array.isArray(Bt):Bt instanceof Object?Bt instanceof Array:Object.prototype.toString.call(Bt)==="[object Array]"}function ia(Bt){return typeof Bt=="function"}function ba(Bt){return typeof Bt=="function"}function R(Bt){switch(Kn(Bt)){case 3:return!0;case 4:return!0;default:return!1}}function sn(Bt,tr){var Or=Bt[tr];if(Or!=null){if(!ia(Or))throw new TypeError;return Or}}function Ea(Bt){var tr=sn(Bt,ze);if(!ia(tr))throw new TypeError;var Or=tr.call(Bt);if(!ai(Or))throw new TypeError;return Or}function Bi(Bt){return Bt.value}function aa(Bt){var tr=Bt.next();return tr.done?!1:tr}function Qi(Bt){var tr=Bt.return;tr&&tr.call(Bt)}function cs(Bt){var tr=Object.getPrototypeOf(Bt);if(typeof Bt!="function"||Bt===ar||tr!==ar)return tr;var Or=Bt.prototype,Vr=Or&&Object.getPrototypeOf(Or);if(Vr==null||Vr===Object.prototype)return tr;var Ln=Vr.constructor;return typeof Ln!="function"||Ln===Bt?tr:Ln}function pe(){var Bt={},tr=[],Or=function(){function bi(pi,An,Mi){this._index=0,this._keys=pi,this._values=An,this._selector=Mi}return bi.prototype["@@iterator"]=function(){return this},bi.prototype[ze]=function(){return this},bi.prototype.next=function(){var pi=this._index;if(pi>=0&&pi<this._keys.length){var An=this._selector(this._keys[pi],this._values[pi]);return pi+1>=this._keys.length?(this._index=-1,this._keys=tr,this._values=tr):this._index++,{value:An,done:!1}}return{value:void 0,done:!0}},bi.prototype.throw=function(pi){throw this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),pi},bi.prototype.return=function(pi){return this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),{value:pi,done:!0}},bi}();return function(){function bi(){this._keys=[],this._values=[],this._cacheKey=Bt,this._cacheIndex=-2}return Object.defineProperty(bi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),bi.prototype.has=function(pi){return this._find(pi,!1)>=0},bi.prototype.get=function(pi){var An=this._find(pi,!1);return An>=0?this._values[An]:void 0},bi.prototype.set=function(pi,An){var Mi=this._find(pi,!0);return this._values[Mi]=An,this},bi.prototype.delete=function(pi){var An=this._find(pi,!1);if(An>=0){for(var Mi=this._keys.length,Li=An+1;Li<Mi;Li++)this._keys[Li-1]=this._keys[Li],this._values[Li-1]=this._values[Li];return this._keys.length--,this._values.length--,pi===this._cacheKey&&(this._cacheKey=Bt,this._cacheIndex=-2),!0}return!1},bi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Bt,this._cacheIndex=-2},bi.prototype.keys=function(){return new Or(this._keys,this._values,Vr)},bi.prototype.values=function(){return new Or(this._keys,this._values,Ln)},bi.prototype.entries=function(){return new Or(this._keys,this._values,zn)},bi.prototype["@@iterator"]=function(){return this.entries()},bi.prototype[ze]=function(){return this.entries()},bi.prototype._find=function(pi,An){return this._cacheKey!==pi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=pi)),this._cacheIndex<0&&An&&(this._cacheIndex=this._keys.length,this._keys.push(pi),this._values.push(void 0)),this._cacheIndex},bi}();function Vr(bi,pi){return bi}function Ln(bi,pi){return pi}function zn(bi,pi){return[bi,pi]}}function fi(){return function(){function Bt(){this._map=new kt}return Object.defineProperty(Bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Bt.prototype.has=function(tr){return this._map.has(tr)},Bt.prototype.add=function(tr){return this._map.set(tr,tr),this},Bt.prototype.delete=function(tr){return this._map.delete(tr)},Bt.prototype.clear=function(){this._map.clear()},Bt.prototype.keys=function(){return this._map.keys()},Bt.prototype.values=function(){return this._map.values()},Bt.prototype.entries=function(){return this._map.entries()},Bt.prototype["@@iterator"]=function(){return this.keys()},Bt.prototype[ze]=function(){return this.keys()},Bt}()}function lo(){var Bt=16,tr=Et.create(),Or=Vr();return function(){function An(){this._key=Vr()}return An.prototype.has=function(Mi){var Li=Ln(Mi,!1);return Li!==void 0?Et.has(Li,this._key):!1},An.prototype.get=function(Mi){var Li=Ln(Mi,!1);return Li!==void 0?Et.get(Li,this._key):void 0},An.prototype.set=function(Mi,Li){var Na=Ln(Mi,!0);return Na[this._key]=Li,this},An.prototype.delete=function(Mi){var Li=Ln(Mi,!1);return Li!==void 0?delete Li[this._key]:!1},An.prototype.clear=function(){this._key=Vr()},An}();function Vr(){var An;do An="@@WeakMap@@"+pi();while(Et.has(tr,An));return tr[An]=!0,An}function Ln(An,Mi){if(!X.call(An,Or)){if(!Mi)return;Object.defineProperty(An,Or,{value:Et.create()})}return An[Or]}function zn(An,Mi){for(var Li=0;Li<Mi;++Li)An[Li]=Math.random()*255|0;return An}function bi(An){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(An)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(An)):zn(new Uint8Array(An),An):zn(new Array(An),An)}function pi(){var An=bi(Bt);An[6]=An[6]&79|64,An[8]=An[8]&191|128;for(var Mi="",Li=0;Li<Bt;++Li){var Na=An[Li];(Li===4||Li===6||Li===8)&&(Mi+="-"),Na<16&&(Mi+="0"),Mi+=Na.toString(16).toLowerCase()}return Mi}}function Va(Bt){return Bt.__=void 0,delete Bt.__,Bt}})})(De||(De={}))},69848:function(Cr){(function(oe,Q){Cr.exports=Q()})(this,function(){"use strict";function oe(He,$e,bt,et,qt,Tr){if(!(qt-et<=bt)){var Br=et+qt>>1;Q(He,$e,Br,et,qt,Tr%2),oe(He,$e,bt,et,Br-1,Tr+1),oe(He,$e,bt,Br+1,qt,Tr+1)}}function Q(He,$e,bt,et,qt,Tr){for(;qt>et;){if(qt-et>600){var Br=qt-et+1,rn=bt-et+1,Ee=Math.log(Br),We=.5*Math.exp(2*Ee/3),Re=.5*Math.sqrt(Ee*We*(Br-We)/Br)*(rn-Br/2<0?-1:1),_t=Math.max(et,Math.floor(bt-rn*We/Br+Re)),ft=Math.min(qt,Math.floor(bt+(Br-rn)*We/Br+Re));Q(He,$e,bt,_t,ft,Tr)}var Lt=$e[2*bt+Tr],Ht=et,Mr=qt;for(Pe(He,$e,et,bt),$e[2*qt+Tr]>Lt&&Pe(He,$e,et,qt);Ht<Mr;){for(Pe(He,$e,Ht,Mr),Ht++,Mr--;$e[2*Ht+Tr]<Lt;)Ht++;for(;$e[2*Mr+Tr]>Lt;)Mr--}$e[2*et+Tr]===Lt?Pe(He,$e,et,Mr):(Mr++,Pe(He,$e,Mr,qt)),Mr<=bt&&(et=Mr+1),bt<=Mr&&(qt=Mr-1)}}function Pe(He,$e,bt,et){De(He,bt,et),De($e,2*bt,2*et),De($e,2*bt+1,2*et+1)}function De(He,$e,bt){var et=He[$e];He[$e]=He[bt],He[bt]=et}function m(He,$e,bt,et,qt,Tr,Br){for(var rn=[0,He.length-1,0],Ee=[],We,Re;rn.length;){var _t=rn.pop(),ft=rn.pop(),Lt=rn.pop();if(ft-Lt<=Br){for(var Ht=Lt;Ht<=ft;Ht++)We=$e[2*Ht],Re=$e[2*Ht+1],We>=bt&&We<=qt&&Re>=et&&Re<=Tr&&Ee.push(He[Ht]);continue}var Mr=Math.floor((Lt+ft)/2);We=$e[2*Mr],Re=$e[2*Mr+1],We>=bt&&We<=qt&&Re>=et&&Re<=Tr&&Ee.push(He[Mr]);var Kn=(_t+1)%2;(_t===0?bt<=We:et<=Re)&&(rn.push(Lt),rn.push(Mr-1),rn.push(Kn)),(_t===0?qt>=We:Tr>=Re)&&(rn.push(Mr+1),rn.push(ft),rn.push(Kn))}return Ee}function Ie(He,$e,bt,et,qt,Tr){for(var Br=[0,He.length-1,0],rn=[],Ee=qt*qt;Br.length;){var We=Br.pop(),Re=Br.pop(),_t=Br.pop();if(Re-_t<=Tr){for(var ft=_t;ft<=Re;ft++)X($e[2*ft],$e[2*ft+1],bt,et)<=Ee&&rn.push(He[ft]);continue}var Lt=Math.floor((_t+Re)/2),Ht=$e[2*Lt],Mr=$e[2*Lt+1];X(Ht,Mr,bt,et)<=Ee&&rn.push(He[Lt]);var Kn=(We+1)%2;(We===0?bt-qt<=Ht:et-qt<=Mr)&&(Br.push(_t),Br.push(Lt-1),Br.push(Kn)),(We===0?bt+qt>=Ht:et+qt>=Mr)&&(Br.push(Lt+1),Br.push(Re),Br.push(Kn))}return rn}function X(He,$e,bt,et){var qt=He-bt,Tr=$e-et;return qt*qt+Tr*Tr}var de=function(He){return He[0]},ce=function(He){return He[1]},ze=function($e,bt,et,qt,Tr){bt===void 0&&(bt=de),et===void 0&&(et=ce),qt===void 0&&(qt=64),Tr===void 0&&(Tr=Float64Array),this.nodeSize=qt,this.points=$e;for(var Br=$e.length<65536?Uint16Array:Uint32Array,rn=this.ids=new Br($e.length),Ee=this.coords=new Tr($e.length*2),We=0;We<$e.length;We++)rn[We]=We,Ee[2*We]=bt($e[We]),Ee[2*We+1]=et($e[We]);oe(rn,Ee,qt,0,rn.length-1,0)};ze.prototype.range=function($e,bt,et,qt){return m(this.ids,this.coords,$e,bt,et,qt,this.nodeSize)},ze.prototype.within=function($e,bt,et){return Ie(this.ids,this.coords,$e,bt,et,this.nodeSize)};var ge={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(He){return He}},nt=Math.fround||function(He){return function($e){return He[0]=+$e,He[0]}}(new Float32Array(1)),ct=function($e){this.options=or(Object.create(ge),$e),this.trees=new Array(this.options.maxZoom+1)};ct.prototype.load=function($e){var bt=this.options,et=bt.log,qt=bt.minZoom,Tr=bt.maxZoom,Br=bt.nodeSize;et&&console.time("total time");var rn="prepare "+$e.length+" points";et&&console.time(rn),this.points=$e;for(var Ee=[],We=0;We<$e.length;We++)!$e[We].geometry||Ee.push(ar($e[We],We));this.trees[Tr+1]=new ze(Ee,q,Gt,Br,Float32Array),et&&console.timeEnd(rn);for(var Re=Tr;Re>=qt;Re--){var _t=+Date.now();Ee=this._cluster(Ee,Re),this.trees[Re]=new ze(Ee,q,Gt,Br,Float32Array),et&&console.log("z%d: %d clusters in %dms",Re,Ee.length,+Date.now()-_t)}return et&&console.timeEnd("total time"),this},ct.prototype.getClusters=function($e,bt){var et=(($e[0]+180)%360+360)%360-180,qt=Math.max(-90,Math.min(90,$e[1])),Tr=$e[2]===180?180:(($e[2]+180)%360+360)%360-180,Br=Math.max(-90,Math.min(90,$e[3]));if($e[2]-$e[0]>=360)et=-180,Tr=180;else if(et>Tr){var rn=this.getClusters([et,qt,180,Br],bt),Ee=this.getClusters([-180,qt,Tr,Br],bt);return rn.concat(Ee)}for(var We=this.trees[this._limitZoom(bt)],Re=We.range(nr(et),Ut(Br),nr(Tr),Ut(qt)),_t=[],ft=0,Lt=Re;ft<Lt.length;ft+=1){var Ht=Lt[ft],Mr=We.points[Ht];_t.push(Mr.numPoints?dr(Mr):this.points[Mr.index])}return _t},ct.prototype.getChildren=function($e){var bt=this._getOriginId($e),et=this._getOriginZoom($e),qt="No cluster with the specified id.",Tr=this.trees[et];if(!Tr)throw new Error(qt);var Br=Tr.points[bt];if(!Br)throw new Error(qt);for(var rn=this.options.radius/(this.options.extent*Math.pow(2,et-1)),Ee=Tr.within(Br.x,Br.y,rn),We=[],Re=0,_t=Ee;Re<_t.length;Re+=1){var ft=_t[Re],Lt=Tr.points[ft];Lt.parentId===$e&&We.push(Lt.numPoints?dr(Lt):this.points[Lt.index])}if(We.length===0)throw new Error(qt);return We},ct.prototype.getLeaves=function($e,bt,et){bt=bt||10,et=et||0;var qt=[];return this._appendLeaves(qt,$e,bt,et,0),qt},ct.prototype.getTile=function($e,bt,et){var qt=this.trees[this._limitZoom($e)],Tr=Math.pow(2,$e),Br=this.options,rn=Br.extent,Ee=Br.radius,We=Ee/rn,Re=(et-We)/Tr,_t=(et+1+We)/Tr,ft={features:[]};return this._addTileFeatures(qt.range((bt-We)/Tr,Re,(bt+1+We)/Tr,_t),qt.points,bt,et,Tr,ft),bt===0&&this._addTileFeatures(qt.range(1-We/Tr,Re,1,_t),qt.points,Tr,et,Tr,ft),bt===Tr-1&&this._addTileFeatures(qt.range(0,Re,We/Tr,_t),qt.points,-1,et,Tr,ft),ft.features.length?ft:null},ct.prototype.getClusterExpansionZoom=function($e){for(var bt=this._getOriginZoom($e)-1;bt<=this.options.maxZoom;){var et=this.getChildren($e);if(bt++,et.length!==1)break;$e=et[0].properties.cluster_id}return bt},ct.prototype._appendLeaves=function($e,bt,et,qt,Tr){for(var Br=this.getChildren(bt),rn=0,Ee=Br;rn<Ee.length;rn+=1){var We=Ee[rn],Re=We.properties;if(Re&&Re.cluster?Tr+Re.point_count<=qt?Tr+=Re.point_count:Tr=this._appendLeaves($e,Re.cluster_id,et,qt,Tr):Tr<qt?Tr++:$e.push(We),$e.length===et)break}return Tr},ct.prototype._addTileFeatures=function($e,bt,et,qt,Tr,Br){for(var rn=0,Ee=$e;rn<Ee.length;rn+=1){var We=Ee[rn],Re=bt[We],_t=Re.numPoints,ft=void 0,Lt=void 0,Ht=void 0;if(_t)ft=kt(Re),Lt=Re.x,Ht=Re.y;else{var Mr=this.points[Re.index];ft=Mr.properties,Lt=nr(Mr.geometry.coordinates[0]),Ht=Ut(Mr.geometry.coordinates[1])}var Kn={type:1,geometry:[[Math.round(this.options.extent*(Lt*Tr-et)),Math.round(this.options.extent*(Ht*Tr-qt))]],tags:ft},Wr=void 0;_t?Wr=Re.id:this.options.generateId?Wr=Re.index:this.points[Re.index].id&&(Wr=this.points[Re.index].id),Wr!==void 0&&(Kn.id=Wr),Br.features.push(Kn)}},ct.prototype._limitZoom=function($e){return Math.max(this.options.minZoom,Math.min(Math.floor(+$e),this.options.maxZoom+1))},ct.prototype._cluster=function($e,bt){for(var et=[],qt=this.options,Tr=qt.radius,Br=qt.extent,rn=qt.reduce,Ee=qt.minPoints,We=Tr/(Br*Math.pow(2,bt)),Re=0;Re<$e.length;Re++){var _t=$e[Re];if(!(_t.zoom<=bt)){_t.zoom=bt;for(var ft=this.trees[bt+1],Lt=ft.within(_t.x,_t.y,We),Ht=_t.numPoints||1,Mr=Ht,Kn=0,Wr=Lt;Kn<Wr.length;Kn+=1){var na=Wr[Kn],Yn=ft.points[na];Yn.zoom>bt&&(Mr+=Yn.numPoints||1)}if(Mr>Ht&&Mr>=Ee){for(var ai=_t.x*Ht,oi=_t.y*Ht,ci=rn&&Ht>1?this._map(_t,!0):null,gi=(Re<<5)+(bt+1)+this.points.length,xa=0,qi=Lt;xa<qi.length;xa+=1){var Gi=qi[xa],ia=ft.points[Gi];if(!(ia.zoom<=bt)){ia.zoom=bt;var ba=ia.numPoints||1;ai+=ia.x*ba,oi+=ia.y*ba,ia.parentId=gi,rn&&(ci||(ci=this._map(_t,!0)),rn(ci,this._map(ia)))}}_t.parentId=gi,et.push(Et(ai/Mr,oi/Mr,gi,Mr,ci))}else if(et.push(_t),Mr>1)for(var R=0,sn=Lt;R<sn.length;R+=1){var Ea=sn[R],Bi=ft.points[Ea];Bi.zoom<=bt||(Bi.zoom=bt,et.push(Bi))}}}return et},ct.prototype._getOriginId=function($e){return $e-this.points.length>>5},ct.prototype._getOriginZoom=function($e){return($e-this.points.length)%32},ct.prototype._map=function($e,bt){if($e.numPoints)return bt?or({},$e.properties):$e.properties;var et=this.points[$e.index].properties,qt=this.options.map(et);return bt&&qt===et?or({},qt):qt};function Et(He,$e,bt,et,qt){return{x:nt(He),y:nt($e),zoom:Infinity,id:bt,parentId:-1,numPoints:et,properties:qt}}function ar(He,$e){var bt=He.geometry.coordinates,et=bt[0],qt=bt[1];return{x:nt(nr(et)),y:nt(Ut(qt)),zoom:Infinity,index:$e,parentId:-1}}function dr(He){return{type:"Feature",id:He.id,properties:kt(He),geometry:{type:"Point",coordinates:[ht(He.x),St(He.y)]}}}function kt(He){var $e=He.numPoints,bt=$e>=1e4?Math.round($e/1e3)+"k":$e>=1e3?Math.round($e/100)/10+"k":$e;return or(or({},He.properties),{cluster:!0,cluster_id:He.id,point_count:$e,point_count_abbreviated:bt})}function nr(He){return He/360+.5}function Ut(He){var $e=Math.sin(He*Math.PI/180),bt=.5-.25*Math.log((1+$e)/(1-$e))/Math.PI;return bt<0?0:bt>1?1:bt}function ht(He){return(He-.5)*360}function St(He){var $e=(180-He*360)*Math.PI/180;return 360*Math.atan(Math.exp($e))/Math.PI-90}function or(He,$e){for(var bt in $e)He[bt]=$e[bt];return He}function q(He){return He.x}function Gt(He){return He.y}return ct})},75752:function(Cr){Cr.exports.RADIUS=6378137,Cr.exports.FLATTENING=1/298.257223563,Cr.exports.POLAR_RADIUS=63567523142e-4}}]);
